[{"title":"çº¢é»‘æ ‘","path":"/posts/çº¢é»‘æ ‘.html","content":"ä¸€ã€ çº¢é»‘æ ‘çš„åŸç†çº¢é»‘æ ‘RB Treeæ˜¯äºŒå‰æ ‘çš„ä¸€ç§ï¼Œä½œä¸ºä¸€ç§è‡ªå¹³è¡¡äºŒå‰æ ‘ï¼ˆä¸€äº›æƒ…å†µä¸‹ä¸æ˜¯å®Œå…¨å¹³è¡¡çš„ï¼‰ï¼Œå®ƒåœ¨æœ€åçš„æƒ…å†µä¸‹æŸ¥è¯¢å¤æ‚åº¦ä¸ºO(logN)ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘)ã€‚ä¸AVLæ ‘ç±»ä¼¼ï¼Œå°½ç®¡RB TreeæŸ¥è¯¢æ•ˆç‡ä¸å¦‚AVLæ ‘ï¼ˆå› ä¸ºRB Treeå·¦å³å­æ ‘é«˜åº¦å·®è·æœ€å¤šæ¥è¿‘ä¸¤å€ï¼Œè€ŒAVLæ ‘å§‹ç»ˆä¿æŒå·¦å³å­æ ‘é«˜åº¦æœ€å¤šä¸è¶…è¿‡1ï¼‰ï¼Œä½†å…¶æ’å…¥åˆ é™¤æ•ˆç‡é«˜ï¼Œé€‚åˆç”¨äºå¤§æ•°æ®é‡ä¸”æ›´æ–°é¢‘ç¹çš„åœºæ™¯ï¼Œä¾‹å¦‚å†…æ ¸IOè°ƒåº¦ç®—æ³•ã€‚çº¢é»‘æ ‘åœ¨äºŒå‰æ ‘çš„åŸºç¡€ä¸Šåšäº†å¦‚ä¸‹çº¦æŸï¼š æ ‘ç§å…¨éƒ¨èŠ‚ç‚¹è¦ä¹ˆæ˜¯é»‘è‰²è¦ä¹ˆæ˜¯çº¢è‰² æ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ å¶èŠ‚ç‚¹ï¼ˆæŒ‡NULLèŠ‚ç‚¹ï¼‰é¢œè‰²ä¸ºé»‘è‰² çº¢è‰²èŠ‚ç‚¹ä¹‹é—´ä¸èƒ½ç›¸é‚» ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘é«˜åº¦ï¼ˆåªç»Ÿè®¡é»‘è‰²èŠ‚ç‚¹ï¼‰ç›¸åŒ åœ¨ä»‹ç»çº¢é»‘æ ‘çš„æ“ä½œå‰ï¼Œæˆ‘ä»¬å…ˆè¯´æ˜ä»¥ä¸‹å‡ ç‚¹æƒ¯ä¾‹ï¼š &#x3D;&#x3D;æ‰€æœ‰èŠ‚ç‚¹åœ¨æ’å…¥çš„æ—¶å€™éƒ½å°†æ˜¯çº¢è‰²èŠ‚ç‚¹ï¼ˆä¸åŒ…æ‹¬æ ¹èŠ‚ç‚¹ï¼Œå…¶æ’å…¥æ—¶æ˜¯é»‘è‰²çš„ï¼‰&#x3D;&#x3D;ï¼Œè¿™æ ·æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥ä¸è¿åçº¦æŸ1ï¼Œ2ï¼Œ3å’Œ5ï¼Œå¯¹äºçº¦æŸ1ï¼Œ2å’Œ3æ˜¯æ˜¾ç„¶çš„ï¼Œå¯¹äº5ï¼Œç”±äºæ·»åŠ çº¢è‰²èŠ‚ç‚¹å¹¶ä¸ä¼šå½±å“å…¶çˆ¶èŠ‚ç‚¹åŠä»¥ä¸ŠèŠ‚ç‚¹å·¦å³å­æ ‘é»‘è‰²èŠ‚ç‚¹æ•°é‡ï¼Œæ•…ä¸è¿åçº¦æŸ5ã€‚å› æ­¤ï¼Œåœ¨æ’å…¥èŠ‚ç‚¹åï¼Œåªéœ€åˆ¤æ–­æ˜¯å¦è¿åçº¦æŸ4ã€‚ &#x3D;&#x3D;ä¸€é¢—çº¢é»‘æ ‘ä¸­ï¼ŒæŸä¸€èŠ‚ç‚¹å·¦å³å­æ ‘èŠ‚ç‚¹é«˜åº¦å·®ä¸ä¼šè¶…è¿‡2å€&#x3D;&#x3D;ï¼Œè€ƒè™‘ä¸€ç§æé™æƒ…å†µï¼šå·¦å­æ ‘é»‘è‰²èŠ‚ç‚¹é«˜åº¦ä¸ºxï¼Œä¸”æœ€é•¿è·¯å¾„ä¸­ä¸å­˜åœ¨çº¢è‰²èŠ‚ç‚¹ï¼Œè¿™æ˜¯å…è®¸çš„ï¼Œå³å­æ ‘æœ‰é»‘è‰²èŠ‚ç‚¹é«˜åº¦ä¸ºxï¼Œè¿™æ ·æ»¡è¶³çº¦æŸ5ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå³å­æ ‘æœ€é•¿è·¯å¾„é»‘è‰²å‡ ç‚¹ä¹‹é—´éƒ½ç”±çº¢è‰²èŠ‚ç‚¹éš”å¼€ï¼ˆæ»¡è¶³çº¦æŸ4ï¼‰ï¼Œæ•…å³å­æ ‘æ€»é«˜åº¦ä¸º2x-1ï¼Œçº¦ç­‰äº2xã€‚ äºŒã€çº¢é»‘æ ‘æ“ä½œåœ¨Linuxå†…æ ¸ä»£ç ä¸­ä»…æä¾›äº†çº¢é»‘æ ‘èŠ‚ç‚¹é“¾æ¥ã€ç´¢å¼•ã€è°ƒæ•´ã€åˆ é™¤ç­‰åŸºç¡€æ“ä½œï¼Œä¸åŒ…å«ç‰¹å®šå«ä¹‰çš„æŸ¥è¯¢ã€æ’å…¥ç­‰æ“ä½œï¼š void rb_insert_color(struct rb_node *, struct rb_root *);ï¼Œæ£€æŸ¥è°ƒæ•´ä¸€ä¸ªæŒ‡å®šèŠ‚ç‚¹ï¼Œé€šå¸¸ä¸rb_link_nodeæ­é…ä½¿ç”¨ï¼› void rb_erase(struct rb_node *, struct rb_root *);ï¼Œä»æ ‘ä¸­åˆ é™¤ä¸€ä¸ªæŒ‡å®šèŠ‚ç‚¹ï¼› struct rb_node *rb_next(struct rb_node *);ï¼Œè¿”å›ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆé¡ºåºçš„ï¼‰ï¼› struct rb_node *rb_prev(struct rb_node *);ï¼Œè¿”å›ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼ˆé¡ºåºçš„ï¼‰ï¼› struct rb_node *rb_first(struct rb_root *);ï¼Œè¿”å›æ ‘ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆé¡ºåºçš„ï¼‰ï¼› struct rb_node *rb_last(struct rb_root *);ï¼Œè¿”å›æ ‘ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ˆé¡ºåºçš„ï¼‰ï¼› void rb_replace_node(struct rb_node *victim, struct rb_node *new, struct rb_root *root);ï¼Œç”¨newæ›¿æ¢èŠ‚ç‚¹victimï¼› inline void rb_link_node(struct rb_node * node, struct rb_node * parent, struct rb_node ** rb_link)ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹é“¾æ¥åˆ°æ ‘ä¸­æŒ‡å®šä½ç½®ï¼Œparentæ˜¯çˆ¶èŠ‚ç‚¹ï¼Œrb_linkæŒ‡å®šäº†é“¾æ¥çˆ¶èŠ‚ç‚¹çš„ä½ç½®æ˜¯å·¦è¿˜æ˜¯å³ã€‚ 2.1 çº¢é»‘æ ‘çš„èŠ‚ç‚¹æ’å…¥æ ¹æ®ç¬¬ä¸€ä¸ªéƒ¨åˆ†æˆ‘ä»¬æ‰€è®²çš„å†…å®¹å¯çŸ¥ï¼Œä¸€ä¸ªèŠ‚ç‚¹æ’å…¥RB Treeæ—¶ä¼šè¢«æŸ“æˆçº¢è‰²ï¼Œå› æ­¤åªéœ€è¦æ£€æŸ¥æ’å…¥æ—¶æ˜¯å¦è¿åè§„åˆ™4ï¼Œæ—¢æ’å…¥èŠ‚ç‚¹ä¸å…¶çˆ¶èŠ‚ç‚¹æ˜¯å¦éƒ½æ˜¯çº¢è‰²ï¼Œç„¶ååšå‡ºç›¸åº”çš„è°ƒæ•´ï¼Œè¿™äº›å·¥ä½œç”±rb_insert_colorå‡½æ•°å®Œæˆï¼Œå…¶ä¸»è¦åˆ†ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æ˜¯çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼Œé‚£ä¹ˆä¸éœ€è¦åšä»»ä½•äº‹æƒ…ï¼Œæ’å…¥çº¢èŠ‚ç‚¹åè¯¥æ ‘ä»ç„¶ç¬¦åˆæ‰€æœ‰è§„åˆ™ã€‚ 1234567891011void rb_insert_color(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *parent, *gparent; while ((parent = node-&gt;rb_parent) &amp;&amp; parent-&gt;rb_color == RB_RED) &#123; ... // æ£€æŸ¥ä¸å¤„ç† &#125; root-&gt;rb_node-&gt;rb_color = RB_BLACK; // ä¿è¯æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„&#125; ç”±ä»£ç å¯çŸ¥ï¼Œåªè¦çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰²é‚£ä¹ˆå¯ä»¥ç›´æ¥é€€å‡ºã€‚ç¬¬äºŒç§æƒ…å†µæ˜¯çˆ¶èŠ‚ç‚¹ä¸ºçº¢è‰²ï¼Œæ­¤æ—¶è¿åè§„åˆ™4ï¼Œä½†æ˜¯å…¶å”çˆ¶èŠ‚ç‚¹ï¼ˆçˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„å¦ä¸€ä¸ªå­èŠ‚ç‚¹ï¼‰ä¹Ÿæ˜¯çº¢è‰²ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦è¾¹å››ä¸ªæ ‘åŒ…å«äº†å…¨éƒ¨è¿™ç§æƒ…å†µï¼ŒAæ˜¯ç¥–çˆ¶ï¼ŒBæ˜¯æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼ŒEæ˜¯æ’å…¥èŠ‚ç‚¹ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥å°†çˆ¶èŠ‚ç‚¹å’Œå”çˆ¶èŠ‚ç‚¹æŸ“æˆé»‘è‰²ï¼Œç¥–çˆ¶èŠ‚ç‚¹æŸ“æˆçº¢è‰²ï¼Œè¿™æ ·æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹è§£å†³äº†è§„åˆ™4ï¼ŒåŒæ—¶ç¥–çˆ¶èŠ‚ç‚¹å·¦å³å­æ ‘é»‘è‰²èŠ‚ç‚¹é«˜åº¦ä»ç„¶ç›¸åŒï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­çš„ç¬¬5æ£µæ ‘ï¼Œä¹‹åå°†ç¥–çˆ¶èŠ‚ç‚¹ä½œä¸ºæ’å…¥èŠ‚ç‚¹ç»§ç»­å‘ä¸Šæ£€æŸ¥ï¼Œä¸‹é¢çš„ä»£ç æ‰§è¡Œçš„æ­£æ˜¯è¿™ä¸€æ­¥éª¤ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940void rb_insert_color(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *parent, *gparent; while ((parent = node-&gt;rb_parent) &amp;&amp; parent-&gt;rb_color == RB_RED) &#123; gparent = parent-&gt;rb_parent; // ç¥–çˆ¶èŠ‚ç‚¹ if (parent == gparent-&gt;rb_left) &#123; &#123; register struct rb_node *uncle = gparent-&gt;rb_right; if (uncle &amp;&amp; uncle-&gt;rb_color == RB_RED) &#123; uncle-&gt;rb_color = RB_BLACK; parent-&gt;rb_color = RB_BLACK; gparent-&gt;rb_color = RB_RED; node = gparent; continue; &#125; &#125; ... // å…¶ä»–æ£€æŸ¥å’Œå¤„ç† &#125; else &#123; &#123; register struct rb_node *uncle = gparent-&gt;rb_left; if (uncle &amp;&amp; uncle-&gt;rb_color == RB_RED) &#123; uncle-&gt;rb_color = RB_BLACK; parent-&gt;rb_color = RB_BLACK; gparent-&gt;rb_color = RB_RED; node = gparent; continue; &#125; &#125; ... // å…¶ä»–æ£€æŸ¥å’Œå¤„ç† &#125; &#125; root-&gt;rb_node-&gt;rb_color = RB_BLACK;&#125; ç¬¬ä¸‰ç§æƒ…å†µæœ€ä¸ºå¤æ‚ï¼Œç”±äºå”çˆ¶èŠ‚ç‚¹ä¸å†æ˜¯çº¢è‰²ï¼Œæ•…ä¸èƒ½åªé æŸ“è‰²æ¥è§£å†³ï¼Œå…¶å¯åˆ†ä¸ºä»¥ä¸‹å››ç§ï¼š æ’å…¥èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹ä¸ºç¥–çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼› æ’å…¥èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹ä¸ºç¥–çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼› æ’å…¥èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹ä¸ºç¥–çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼› æ’å…¥èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹ä¸ºç¥–çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼› åœ¨è¿™å››ç§ä¸­ï¼Œç¬¬2ç§ï¼ˆå·¦å·¦ï¼‰å’Œç¬¬3ç§ï¼ˆå³å³ï¼‰éœ€è¦å…ˆè¿›è¡Œä¸€æ¬¡æŸ“è‰²è§£å†³è§„åˆ™4å†²çªï¼Œç„¶åç»è¿‡æ—‹è½¬è§£å†³æŸ“è‰²åçš„è§„åˆ™5å†²çªã€‚ä»¥å·¦å·¦ä¸ºä¾‹ï¼Œå…ˆå°†çˆ¶èŠ‚ç‚¹æŸ“æˆé»‘è‰²ï¼Œç¥–çˆ¶èŠ‚ç‚¹æŸ“æˆçº¢è‰²ï¼Œæ­¤æ—¶ä¸å†æœ‰é¢œè‰²å†²çªï¼Œä½†æ˜¯è§„åˆ™5å‡ºç°å†²çªï¼Œå› ä¸ºå·¦å­æ ‘æ˜¾ç„¶å¤šå‡ºä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ç¥–çˆ¶èŠ‚ç‚¹å³æ—‹ï¼Œå°†çˆ¶èŠ‚ç‚¹ä½œä¸ºç¥–çˆ¶èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸¤ä¸ªæ°åˆ°å¥½å¤„çš„äº‹æƒ…ï¼š1ï¼‰ç¥–çˆ¶èŠ‚ç‚¹ä½ç½®çš„é¢œè‰²å†æ¬¡å˜ä¸ºé»‘è‰²ï¼Œè¿™å¿…ç„¶ä½¿å¾—ç¥–çˆ¶ä¸ä¼šç ´åè§„åˆ™4ï¼›2ï¼‰ç”±äºåŸç¥–çˆ¶èŠ‚ç‚¹æŸ“æˆçº¢è‰²ï¼Œæ‰€ä»¥å³ä½¿å…¶å˜æˆäº†å³å­æ ‘çš„èŠ‚ç‚¹ä¹Ÿä¸å½±å“è§„åˆ™5ã€‚ä¸‹å›¾å±•ç¤ºäº†è¿™ä¸€è¿‡ç¨‹ï¼š å¯¹äºå³å³ï¼Œå…¶ä¸å·¦å·¦åŒºåˆ«åœ¨äºä½¿ç”¨å·¦æ—‹ï¼ŒåŸç†å¯ä»¥å‚è€ƒå·¦å·¦è‡ªè¡Œæ¨æ–­ã€‚å¯¹äºç¬¬1ç§ï¼ˆå³å·¦ï¼‰å’Œç¬¬4ç§ï¼ˆå·¦å³ï¼‰ï¼Œéœ€è¦å¤šå¢åŠ ä¸€ä¸ªæ—‹è½¬ï¼Œä½¿å…¶å˜ä¸ºå·¦å·¦æˆ–è€…å³å³ï¼Œç„¶åä¾¿å¯æŒ‰ç…§å·¦å·¦&#x2F;å³å³çš„è§„åˆ™è°ƒæ•´RB Treeï¼Œä¸‹å›¾å±•ç¤ºäº†å³å·¦çš„è°ƒæ•´è¿‡ç¨‹ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è®ºæ˜¯è¿™å››ç§ä¸­çš„å“ªç§ï¼Œæœ€åæ“ä½œçš„ç»“æœå®é™…ä¸Šéƒ½æ˜¯åœ¨ç¥–çˆ¶èŠ‚ç‚¹å’Œå”çˆ¶èŠ‚ç‚¹ç›´æ¥æ–°æ’å…¥äº†çº¢è‰²èŠ‚ç‚¹ï¼Œç¥–çˆ¶èŠ‚ç‚¹é¢œè‰²å¹¶æ²¡æœ‰æ”¹å˜ï¼Œè€Œä¸”é»‘è‰²èŠ‚ç‚¹æ•°é‡ä¹Ÿæ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥åœ¨è°ƒæ•´ç»“æŸåæ— éœ€ç»§ç»­å‘ä¸Šæ£€æŸ¥ã€‚ä¸‹é¢æ˜¯å†…æ ¸ä¸­å…³äºç¬¬ä¸‰ç§æƒ…å†µçš„å¤„ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990static void __rb_rotate_left(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *right = node-&gt;rb_right; if ((node-&gt;rb_right = right-&gt;rb_left)) right-&gt;rb_left-&gt;rb_parent = node; right-&gt;rb_left = node; if ((right-&gt;rb_parent = node-&gt;rb_parent)) &#123; if (node == node-&gt;rb_parent-&gt;rb_left) node-&gt;rb_parent-&gt;rb_left = right; else node-&gt;rb_parent-&gt;rb_right = right; &#125; else root-&gt;rb_node = right; node-&gt;rb_parent = right;&#125;static void __rb_rotate_right(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *left = node-&gt;rb_left; if ((node-&gt;rb_left = left-&gt;rb_right)) left-&gt;rb_right-&gt;rb_parent = node; left-&gt;rb_right = node; if ((left-&gt;rb_parent = node-&gt;rb_parent)) &#123; if (node == node-&gt;rb_parent-&gt;rb_right) node-&gt;rb_parent-&gt;rb_right = left; else node-&gt;rb_parent-&gt;rb_left = left; &#125; else root-&gt;rb_node = left; node-&gt;rb_parent = left;&#125;void rb_insert_color(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *parent, *gparent; while ((parent = node-&gt;rb_parent) &amp;&amp; parent-&gt;rb_color == RB_RED) &#123; gparent = parent-&gt;rb_parent; if (parent == gparent-&gt;rb_left) &#123; &#123; register struct rb_node *uncle = gparent-&gt;rb_right; ... // å”çˆ¶ä¸ºçº¢è‰²çš„å¤„ç† &#125; if (parent-&gt;rb_right == node) &#123; register struct rb_node *tmp; __rb_rotate_left(parent, root); tmp = parent; parent = node; node = tmp; &#125; parent-&gt;rb_color = RB_BLACK; gparent-&gt;rb_color = RB_RED; __rb_rotate_right(gparent, root); &#125; else &#123; &#123; register struct rb_node *uncle = gparent-&gt;rb_left; ... // å”çˆ¶ä¸ºçº¢è‰²çš„å¤„ç† &#125; if (parent-&gt;rb_left == node) &#123; register struct rb_node *tmp; __rb_rotate_right(parent, root); tmp = parent; parent = node; node = tmp; &#125; parent-&gt;rb_color = RB_BLACK; gparent-&gt;rb_color = RB_RED; __rb_rotate_left(gparent, root); &#125; &#125; root-&gt;rb_node-&gt;rb_color = RB_BLACK;&#125; åœ¨Linuxå†…æ ¸ä¸­ï¼Œå¦‚æœéœ€è¦æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹åˆ°RB Treeä¸­ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‡ æ­¥ï¼š éå†RB Treeï¼Œæ‰¾åˆ°æ–°èŠ‚ç‚¹æ’å…¥ä½ç½®ï¼› è°ƒç”¨rb_link_nodeå°†èŠ‚ç‚¹é“¾æ¥åˆ°1æ‰¾åˆ°çš„ä½ç½®ï¼› è°ƒç”¨rb_insert_colorè°ƒæ•´RB Treeï¼Œä½¿å…¶ç¬¦åˆè§„åˆ™ã€‚ 2.2 çº¢é»‘æ ‘çš„èŠ‚ç‚¹åˆ é™¤çº¢é»‘æ ‘çš„åˆ é™¤æ¯”æ’å…¥æ“ä½œæ›´ä¸ºå¤æ‚ï¼Œå…¶åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µå…ˆåˆ é™¤èŠ‚ç‚¹ï¼Œå…¶æŠ€å·§ä¸ºï¼šå¦‚æœåˆ é™¤èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­©å­æˆ–è€…æ²¡å­©å­ï¼Œé‚£ä¹ˆç›´æ¥åˆ é™¤è¯¥èŠ‚ç‚¹ï¼Œå¹¶é“¾æ¥çˆ¶èŠ‚ç‚¹å’Œå­©å­èŠ‚ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334void rb_erase(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *child, *parent; int color; if (!node-&gt;rb_left) child = node-&gt;rb_right; else if (!node-&gt;rb_right) child = node-&gt;rb_left; else &#123; ... // æœ‰ä¸¤ä¸ªå­©å­çš„æ“ä½œ &#125; parent = node-&gt;rb_parent; color = node-&gt;rb_color; // é“¾æ¥çˆ¶èŠ‚ç‚¹å’Œå­©å­èŠ‚ç‚¹ if (child) child-&gt;rb_parent = parent; if (parent) &#123; if (parent-&gt;rb_left == node) parent-&gt;rb_left = child; else parent-&gt;rb_right = child; &#125; else root-&gt;rb_node = child; color: // ç¬¬äºŒé˜¶æ®µï¼šè°ƒæ•´ if (color == RB_BLACK) __rb_erase_color(child, parent, root);&#125; å¦‚æœæœ‰ä¸¤ä¸ªå­©å­ï¼Œé‚£ä¹ˆé€‰æ‹©åˆ é™¤èŠ‚ç‚¹çš„é¡ºåºä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ›¿æ¢åˆ é™¤èŠ‚ç‚¹ï¼Œæ—¢åˆ é™¤ä½ç½®å˜åˆ°äº†åˆ é™¤èŠ‚ç‚¹çš„é¡ºåºä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„åŸå…ˆä½ç½®ï¼Œè¿™æ ·å¯ä»¥ä¿è¯åˆ é™¤èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå³å­æ ‘ï¼ˆå› ä¸ºåˆ é™¤èŠ‚ç‚¹çš„é¡ºåºä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯åˆ é™¤èŠ‚ç‚¹çš„å³å­æ ‘çš„æœ€å·¦è¾¹çš„å¶å­èŠ‚ç‚¹ï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263void rb_erase(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *child, *parent; int color; if (!node-&gt;rb_left) ... else if (!node-&gt;rb_right) ... else &#123; struct rb_node *old = node, *left; node = node-&gt;rb_right; while ((left = node-&gt;rb_left) != NULL) node = left; // æ­¤æ—¶ node ä¸º åˆ é™¤èŠ‚ç‚¹çš„é¡ºåºä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆåªæœ‰å³å­æ ‘æˆ–è€…æ— å­©å­ï¼‰ï¼Œold ä¸ºåŸåˆ é™¤èŠ‚ç‚¹ child = node-&gt;rb_right; parent = node-&gt;rb_parent; color = node-&gt;rb_color; // é“¾æ¥åˆ é™¤èŠ‚ç‚¹çš„é¡ºåºä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹ if (child) child-&gt;rb_parent = parent; if (parent) &#123; if (parent-&gt;rb_left == node) parent-&gt;rb_left = child; else parent-&gt;rb_right = child; &#125; else root-&gt;rb_node = child; if (node-&gt;rb_parent == old) // ç”±äº old æ˜¯å¾…åˆ é™¤èŠ‚ç‚¹ï¼Œè€Œ parent æ­¤æ—¶æŒ‡å‘ oldï¼Œæ‰€ä»¥è¦å°† parent æŒ‡å‘æ–°çš„ node parent = node; // node èŠ‚ç‚¹æ›¿æ¢åŸåˆ é™¤èŠ‚ç‚¹ node-&gt;rb_parent = old-&gt;rb_parent; node-&gt;rb_color = old-&gt;rb_color; node-&gt;rb_right = old-&gt;rb_right; node-&gt;rb_left = old-&gt;rb_left; // å°†æ–° node é“¾æ¥åˆ°åŸåˆ é™¤èŠ‚ç‚¹ old çš„çˆ¶èŠ‚ç‚¹ä¸Š if (old-&gt;rb_parent) &#123; if (old-&gt;rb_parent-&gt;rb_left == old) old-&gt;rb_parent-&gt;rb_left = node; else old-&gt;rb_parent-&gt;rb_right = node; &#125; else root-&gt;rb_node = node; // å°†æ–° node é“¾æ¥åˆ°åŸåˆ é™¤èŠ‚ç‚¹ old çš„å­èŠ‚ç‚¹ä¸Š old-&gt;rb_left-&gt;rb_parent = node; if (old-&gt;rb_right) // å¯èƒ½åˆ é™¤çš„å³å­æ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ é™¤åå˜ä¸ºNULL old-&gt;rb_right-&gt;rb_parent = node; goto color; &#125; color: // ç¬¬äºŒé˜¶æ®µï¼šè°ƒæ•´ if (color == RB_BLACK) __rb_erase_color(child, parent, root);&#125; ç¬¬äºŒé˜¶æ®µ å½“åœ¨ç¬¬ä¸€é˜¶æ®µç¡®å®šäº†åˆ é™¤èŠ‚ç‚¹ä½ç½®ï¼ˆé€šå¸¸å…¶åªæœ‰ä¸€ä¸ªå­æ ‘æˆ–è€…æ²¡æœ‰å­æ ‘ï¼‰åï¼Œå°†ä¼šæ£€æŸ¥æ˜¯å¦è¦è¿›è¡Œè°ƒè‰²å’Œæ—‹è½¬ä½¿å¾—èŠ‚ç‚¹åˆ é™¤åçš„RB Treeå†æ¬¡ç¬¦åˆè§„åˆ™ã€‚æˆ‘ä»¬åœ¨ä¸‹é¢é€šè¿‡5ç§å¤§çš„æƒ…å†µæ¥è®²è§£è¿™ä¸€æ“ä½œã€‚(1) æœ€ç®€å•çš„æƒ…å†µæ˜¯ï¼šæˆ‘ä»¬åˆ é™¤çš„èŠ‚ç‚¹é¢œè‰²æ˜¯çº¢è‰²çš„ï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹åˆ é™¤åï¼Œå­æ ‘è¿æ¥åˆ°å…¶çˆ¶èŠ‚ç‚¹åé»‘è‰²èŠ‚ç‚¹é«˜åº¦ä¸å˜ï¼Œå› æ­¤æ— éœ€è°ƒæ•´ï¼Œè¿™ç‚¹å¯ä»¥åœ¨rb_eraseå‡½æ•°çš„æœ€åå°è¯ï¼Œå› ä¸ºåªæœ‰åˆ é™¤èŠ‚ç‚¹ä¸ºé»‘è‰²æ‰éœ€è¦æ‰§è¡Œ__rb_erase_colorå‡½æ•°ã€‚ (2) ç¨å¾®å¤æ‚çš„ä¸€ç§æƒ…å†µæ˜¯ï¼šæˆ‘ä»¬åˆ é™¤çš„èŠ‚ç‚¹Bé¢œè‰²æ˜¯é»‘è‰²ï¼ŒåŒæ—¶å…¶çˆ¶èŠ‚ç‚¹çš„å¦ä¸€ä¸ªå­©å­èŠ‚ç‚¹Cé¢œè‰²ä¹Ÿæ˜¯é»‘è‰²ä¸”å…¶å·¦å³å­©å­èŠ‚ç‚¹E&#x2F;Fä¹Ÿä¸ºé»‘è‰²ã€‚ç”±äºçˆ¶èŠ‚ç‚¹Açš„ä¸€è¾¹å°‘äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œæ‰€ä»¥åº”è¯¥æŠŠå¦ä¸€è¾¹çš„é»‘è‰²èŠ‚ç‚¹æŸ“æˆçº¢è‰²ï¼Œè¿™æ ·çˆ¶èŠ‚ç‚¹Açš„å·¦å³é»‘è‰²èŠ‚ç‚¹é«˜åº¦ç›¸åŒï¼Œè€Œä¸”Cå’ŒE&#x2F;FèŠ‚ç‚¹é¢œè‰²ä¸å†²çªã€‚å¯¹äºçˆ¶èŠ‚ç‚¹Aï¼Œå¦‚æœå…¶ä¸ºçº¢è‰²ï¼Œé‚£æ­£å¥½ï¼Œå°†å…¶æŸ“è‰²ä¸ºé»‘è‰²ï¼Œè¿™æ ·ä»¥Aä¸ºæ ¹çš„å­æ ‘é«˜åº¦åˆæ¢å¤åŸæ ·ï¼Œä¸”é¢œè‰²ä¹Ÿä¸ä¼šå†²çªï¼›å¦‚æœAä¸ºé»‘è‰²ï¼Œé‚£ä¹ˆå°±è¦ç»§ç»­å‘ä¸Šæ£€æŸ¥è°ƒæ•´ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253static void __rb_erase_color(struct rb_node *node, struct rb_node *parent, struct rb_root *root)&#123; struct rb_node *other; while ((!node || node-&gt;rb_color == RB_BLACK) &amp;&amp; node != root-&gt;rb_node) &#123; if (parent-&gt;rb_left == node) &#123; other = parent-&gt;rb_right; if (other-&gt;rb_color == RB_RED) &#123; ... &#125; if ((!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &amp;&amp; (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK)) &#123; other-&gt;rb_color = RB_RED; node = parent; parent = node-&gt;rb_parent; &#125; else &#123; ... &#125; &#125; else &#123; other = parent-&gt;rb_left; if (other-&gt;rb_color == RB_RED) &#123; ... &#125; if ((!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &amp;&amp; (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK)) &#123; other-&gt;rb_color = RB_RED; node = parent; parent = node-&gt;rb_parent; &#125; else &#123; ... &#125; &#125; &#125; if (node) node-&gt;rb_color = RB_BLACK;&#125; ä¸‹é¢ä»¥åˆ é™¤èŠ‚ç‚¹ä¸ºå·¦å­æ ‘ä¸ºä¾‹å±•ç¤ºäº†è°ƒè‰²è¿‡ç¨‹ï¼š (3) æˆ‘ä»¬åˆ é™¤çš„èŠ‚ç‚¹Bé¢œè‰²æ˜¯é»‘è‰²çš„ï¼ŒåŒæ—¶å…¶çˆ¶èŠ‚ç‚¹Açš„å¦ä¸€ä¸ªå­©å­èŠ‚ç‚¹Cé¢œè‰²æ˜¯é»‘è‰²çš„ï¼Œè€ŒCå·¦å­©å­èŠ‚ç‚¹Eä¸ºé»‘è‰²ï¼Œå³å­©å­èŠ‚ç‚¹Fä¸ºçº¢è‰²ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå¯ä»¥å°†çˆ¶èŠ‚ç‚¹æŸ“è‰²æˆé»‘è‰²å·¦æ—‹&#x2F;å³æ—‹ä½¿å¾—åˆ é™¤èŠ‚ç‚¹ä¸€ä¾§å¢åŠ ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œå¯¹äºå¦ä¸€è¾¹ï¼Œå› ä¸ºCå› ä¸ºæ—‹è½¬å˜æˆäº†å­æ ‘æ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥å…¶åº”è¯¥ç»§æ‰¿åŸå…ˆå­æ ‘æ ¹èŠ‚ç‚¹é¢œè‰²ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºCä¸å†æ˜¯å­æ ‘èŠ‚ç‚¹ï¼Œæ‰€ä»¥å°‘äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¦æŠŠFæŸ“æˆé»‘è‰²ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071static void __rb_erase_color(struct rb_node *node, struct rb_node *parent, struct rb_root *root)&#123; struct rb_node *other; while ((!node || node-&gt;rb_color == RB_BLACK) &amp;&amp; node != root-&gt;rb_node) &#123; if (parent-&gt;rb_left == node) &#123; other = parent-&gt;rb_right; if (other-&gt;rb_color == RB_RED) &#123; ... &#125; if ((!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &amp;&amp; (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK)) &#123; ... &#125; else &#123; if (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK) &#123; ... &#125; other-&gt;rb_color = parent-&gt;rb_color; parent-&gt;rb_color = RB_BLACK; if (other-&gt;rb_right) other-&gt;rb_right-&gt;rb_color = RB_BLACK; __rb_rotate_left(parent, root); node = root-&gt;rb_node; break; &#125; &#125; else &#123; other = parent-&gt;rb_left; if (other-&gt;rb_color == RB_RED) &#123; ... &#125; if ((!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &amp;&amp; (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK)) &#123; ... &#125; else &#123; if (!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &#123; ... &#125; other-&gt;rb_color = parent-&gt;rb_color; parent-&gt;rb_color = RB_BLACK; if (other-&gt;rb_left) other-&gt;rb_left-&gt;rb_color = RB_BLACK; __rb_rotate_right(parent, root); node = root-&gt;rb_node; break; &#125; &#125; &#125; if (node) node-&gt;rb_color = RB_BLACK;&#125; ä¸‹é¢ä»¥åˆ é™¤èŠ‚ç‚¹ä¸ºå·¦å­æ ‘ä¸ºä¾‹å±•ç¤ºäº†è°ƒè‰²è¿‡ç¨‹ï¼š (4) æˆ‘ä»¬åˆ é™¤çš„èŠ‚ç‚¹Bé¢œè‰²æ˜¯é»‘è‰²çš„ï¼ŒåŒæ—¶å…¶çˆ¶èŠ‚ç‚¹Açš„å¦ä¸€ä¸ªå­©å­èŠ‚ç‚¹Cé¢œè‰²æ˜¯é»‘è‰²çš„ï¼Œè€ŒCå·¦å­©å­èŠ‚ç‚¹Eä¸ºçº¢è‰²ï¼Œå³å­©å­èŠ‚ç‚¹Fä¸ºé»‘è‰²ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œåº”è¯¥å…ˆç»è¿‡æŸ“è‰²å’Œæ—‹è½¬å°†å…¶å˜ä¸ºæƒ…å†µ(3)ã€‚å…¶è¿‡ç¨‹ä¸ºå°†CæŸ“æˆçº¢è‰²å³æ—‹ï¼Œè¿™æ ·CåŸå…ˆè¿™é¢—å­æ ‘å·¦å³å­æ ‘é»‘è‰²èŠ‚ç‚¹é«˜åº¦ä¸å˜ï¼Œåªæ˜¯Cå’ŒEé¢œè‰²å†²çªï¼Œä¸è¿‡è¿™ä¸ç”¨æ‹…å¿ƒï¼ŒæŒ‰ç…§(3)çš„æ–¹æ³•ï¼ŒCæœ€åå˜æˆé»‘è‰²ï¼Œè€ŒEå˜æˆäº†åŸå…ˆAçš„é¢œè‰²ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980 struct rb_root *root)&#123; struct rb_node *other; while ((!node || node-&gt;rb_color == RB_BLACK) &amp;&amp; node != root-&gt;rb_node) &#123; if (parent-&gt;rb_left == node) &#123; other = parent-&gt;rb_right; if (other-&gt;rb_color == RB_RED) &#123; ... &#125; if ((!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &amp;&amp; (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK)) &#123; ... &#125; else &#123; if (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK) &#123; register struct rb_node *o_left; if ((o_left = other-&gt;rb_left)) o_left-&gt;rb_color = RB_BLACK; other-&gt;rb_color = RB_RED; __rb_rotate_right(other, root); other = parent-&gt;rb_right; &#125; other-&gt;rb_color = parent-&gt;rb_color; parent-&gt;rb_color = RB_BLACK; if (other-&gt;rb_right) other-&gt;rb_right-&gt;rb_color = RB_BLACK; __rb_rotate_left(parent, root); node = root-&gt;rb_node; break; &#125; &#125; else &#123; other = parent-&gt;rb_left; if (other-&gt;rb_color == RB_RED) &#123; ... &#125; if ((!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &amp;&amp; (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK)) &#123; ... &#125; else &#123; if (!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &#123; register struct rb_node *o_right; if ((o_right = other-&gt;rb_right)) o_right-&gt;rb_color = RB_BLACK; other-&gt;rb_color = RB_RED; __rb_rotate_left(other, root); other = parent-&gt;rb_left; &#125; other-&gt;rb_color = parent-&gt;rb_color; parent-&gt;rb_color = RB_BLACK; if (other-&gt;rb_left) other-&gt;rb_left-&gt;rb_color = RB_BLACK; __rb_rotate_right(parent, root); node = root-&gt;rb_node; break; &#125; &#125; &#125; if (node) node-&gt;rb_color = RB_BLACK;&#125; ä¸‹é¢ä»¥åˆ é™¤èŠ‚ç‚¹ä¸ºå·¦å­æ ‘ä¸ºä¾‹å±•ç¤ºäº†è°ƒè‰²è¿‡ç¨‹ï¼š (5) æˆ‘ä»¬åˆ é™¤çš„èŠ‚ç‚¹Bé¢œè‰²æ˜¯é»‘è‰²çš„ï¼ŒåŒæ—¶å…¶çˆ¶èŠ‚ç‚¹Açš„å¦ä¸€ä¸ªå­©å­èŠ‚ç‚¹Cé¢œè‰²æ˜¯çº¢è‰²çš„ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæ„å‘³ç€çˆ¶èŠ‚ç‚¹Aå¿…å®šä¸ºé»‘è‰²çš„ï¼Œè€ŒCçš„E&#x2F;Få­©å­èŠ‚ç‚¹ä¸ºé»‘è‰²çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†AæŸ“æˆçº¢è‰²å·¦æ—‹&#x2F;å³æ—‹ï¼Œç„¶åCæŸ“æˆé»‘è‰²ï¼Œè¿™æ ·ï¼Œè¿™é¢—å­æ ‘é»‘è‰²èŠ‚ç‚¹é«˜åº¦ä¸å˜ï¼ŒåŒæ—¶åˆ é™¤èŠ‚ç‚¹ä¸€ä¾§çš„å­æ ‘å˜æˆäº†(3)æˆ–è€…(4)çš„æƒ…å†µï¼Œå› ä¸ºç»è¿‡æ—‹è½¬ï¼ŒAçš„å³èŠ‚ç‚¹å˜æˆäº†é»‘è‰²ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334 struct rb_root *root)&#123; struct rb_node *other; while ((!node || node-&gt;rb_color == RB_BLACK) &amp;&amp; node != root-&gt;rb_node) &#123; if (parent-&gt;rb_left == node) &#123; other = parent-&gt;rb_right; if (other-&gt;rb_color == RB_RED) &#123; other-&gt;rb_color = RB_BLACK; parent-&gt;rb_color = RB_RED; __rb_rotate_left(parent, root); other = parent-&gt;rb_right; &#125; ... &#125; else &#123; other = parent-&gt;rb_left; if (other-&gt;rb_color == RB_RED) &#123; other-&gt;rb_color = RB_BLACK; parent-&gt;rb_color = RB_RED; __rb_rotate_right(parent, root); other = parent-&gt;rb_left; &#125; ... &#125; &#125; if (node) node-&gt;rb_color = RB_BLACK;&#125; ä¸‹é¢ä»¥åˆ é™¤èŠ‚ç‚¹ä¸ºå·¦å­æ ‘ä¸ºä¾‹å±•ç¤ºäº†è°ƒè‰²è¿‡ç¨‹ï¼š 2.3 çº¢é»‘æ ‘çš„æŸ¥è¯¢æ“ä½œLinuxå†…æ ¸ä¸­çº¢é»‘æ ‘åº“æä¾›çš„åŠŸèƒ½æ²¡æœ‰ç‰¹å®šæŸä¸€ç§æ’åºæ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰ç»™å‡ºæŸ¥è¯¢æ¥å£ã€‚ç”±äºçº¢é»‘æ ‘ä¹Ÿæ˜¯äºŒå‰æ’åºæ ‘çš„ä¸€ç§ï¼Œä»¥å‡åºä¸ºä¾‹ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§ä»¥ä¸‹æµç¨‹å³å¯è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼š 12345678910Query x:node = rootwhile node is not null and node.value != x: if node.value &lt; xï¼š node = node.right else: node = node.leftReturn node 3. çº¢é»‘æ ‘æ“ä½œå®éªŒ å®éªŒä»‹ç»ï¼šæœ‰ä¸€ç§å¯¹è±¡Itemï¼Œé‡Œé¢åŒ…å«ï¼š1ï¼‰æ ‘èŠ‚ç‚¹ï¼Œç”¨äºç®¡ç†RB Treeï¼›2ï¼‰æ•°å€¼ï¼Œè¡¨ç¤ºäº†å¯¹è±¡çš„å®é™…å†…å®¹ï¼›3ï¼‰å‡ºç°æ¬¡æ•°ï¼Œç”±äºæˆ‘ä»¬å¸Œæœ›èŠ‚ç‚¹éšæœºäº§ç”Ÿï¼Œå› æ­¤å¯èƒ½å­˜åœ¨é‡å¤çš„æƒ…å†µï¼Œè¯¥å€¼ç”¨äºç»Ÿè®¡ç›¸åŒèŠ‚ç‚¹çš„æ•°é‡ã€‚æˆ‘ä»¬å…ˆéšæœºnumä¸ªItemï¼Œç„¶åä½¿ç”¨è¿™äº›Itemæ„å»ºå‡ºçº¢é»‘æ ‘ã€‚æœ€åé€šè¿‡è¾“å…¥è¦æ“¦é™¤çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°†å…¶ä»æ ‘ä¸­åˆ é™¤å¹¶æ˜¾ç¤ºã€‚ ä¸‹å›¾æ—¶ä»£ç è¿è¡Œåçš„æ•ˆæœï¼Œæ¯ä¸ªèŠ‚ç‚¹æ‰“å°å«ä¹‰ä¸º[æ•°å€¼ï¼Œå‡ºç°æ¬¡æ•°ï¼ŒèŠ‚ç‚¹é¢œè‰²]ï¼Œæœ€å·¦è¾¹ä¸ºæ ¹èŠ‚ç‚¹ï¼Œå·¦èŠ‚ç‚¹åœ¨å³èŠ‚ç‚¹ä¸Šæ–¹ã€‚ é™„å½•A: å®éªŒä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740main.c :#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;time.h&gt;#include &quot;rbtree.h&quot;typedef struct _Item&#123; int val; int num; // appear num struct rb_node node;&#125;Item;static int print_num = 0;static int print_level = 0;Item* GenerateItem();void DFS(struct rb_node *node);int main()&#123; int num = 0; Item *item, *cur, *prev = NULL; struct rb_node **link; struct rb_root root = RB_ROOT; srand(time(NULL)); printf(&quot;Test item num: &quot;); scanf(&quot;%d&quot;, &amp;num); print_num = 0; printf(&quot;Generate Item[%d]: &quot;, num); /* generate a random rb tree with [num] node */ while (num &gt; 0) &#123; /* randomize a rb tree node */ item = GenerateItem(); if (print_num == 16) &#123; printf(&quot; &quot;); print_num = 0; &#125; printf(&quot;%d\\t&quot;, item-&gt;val); /* insert a rb tree node to rb tree */ if (!root.rb_node) // empty rb tree &#123; root.rb_node = &amp;(item-&gt;node); rb_insert_color(&amp;(item-&gt;node), &amp;root); goto next_loop; &#125; cur = rb_entry(root.rb_node, Item, node); /* 1. find insert position */ while (cur) &#123; if (cur-&gt;val == item-&gt;val) // the same item &#123; cur-&gt;num++; free(item); goto next_loop; &#125; else if (cur-&gt;val &gt; item-&gt;val) &#123; prev = cur; link = &amp;(cur-&gt;node.rb_left); if (cur-&gt;node.rb_left == NULL) &#123; break; &#125; cur = rb_entry(cur-&gt;node.rb_left, Item, node); &#125; else &#123; prev = cur; link = &amp;(cur-&gt;node.rb_right); if (cur-&gt;node.rb_right == NULL) &#123; break; &#125; cur = rb_entry(cur-&gt;node.rb_right, Item, node); &#125; &#125; /* 2. link node */ rb_link_node(&amp;(item-&gt;node), &amp;(prev-&gt;node), link); /* 3. adjust */ rb_insert_color(&amp;(item-&gt;node), &amp;root);next_loop: num--; &#125; /* print a generated rb tree */ print_num = 0; print_level = 0; printf(&quot; sort result: &quot;); DFS(root.rb_node); printf(&quot; &quot;); /* testing erase some rb tree node */ printf(&quot; Test Erase, input node value to erase its node, or input negative value to exit &quot;); while (1) &#123; /* get the node need to erase */ printf(&quot;&gt;&gt;&quot;); scanf(&quot;%d&quot;, &amp;num); if (num &lt; 0) &#123; break; &#125; /* 1. find insert position */ if (!root.rb_node) // empty rb tree &#123; printf(&quot;empty tree &quot;); break; &#125; cur = rb_entry(root.rb_node, Item, node); while (cur) &#123; if (cur-&gt;val == num) // the same item &#123; break; &#125; else if (cur-&gt;val &gt; num) &#123; if (cur-&gt;node.rb_left == NULL) &#123; cur = NULL; break; &#125; cur = rb_entry(cur-&gt;node.rb_left, Item, node); &#125; else &#123; if (cur-&gt;node.rb_right == NULL) &#123; cur = NULL; break; &#125; cur = rb_entry(cur-&gt;node.rb_right, Item, node); &#125; &#125; /* 2. do erase function */ if (cur) &#123; printf(&quot;erase %d &quot;, num); rb_erase(&amp;(cur-&gt;node), &amp;root); free(cur); DFS(root.rb_node); printf(&quot; &quot;); &#125; else &#123; printf(&quot;not exist &quot;); &#125; printf(&quot;=================================================================== &quot;); &#125; return 0;&#125;Item* GenerateItem()&#123; Item *item = (Item*)malloc(sizeof(Item)); item-&gt;val = rand() % 1000; item-&gt;num = 1; item-&gt;node.rb_parent = NULL; item-&gt;node.rb_left = NULL; item-&gt;node.rb_right = NULL; return item;&#125;void DFS(struct rb_node *node)&#123; Item *item; int i; if (node) &#123; print_level++; DFS(node-&gt;rb_left); if (print_num == 4) &#123; printf(&quot; &quot;); print_num = 0; &#125; item = rb_entry(node, Item, node); for (i = 1; i &lt; print_level; i++) &#123; printf(&quot; &quot;); &#125; printf(&quot;[%3d,%3d,%c] &quot;, item-&gt;val, item-&gt;num, (item-&gt;node.rb_color == RB_RED) ? &#x27;R&#x27; : &#x27;B&#x27;); print_num++; DFS(node-&gt;rb_right); print_level--; &#125;&#125;rbtree.h :/* Red Black Trees (C) 1999 Andrea Arcangeli &lt;andrea@suse.de&gt; This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA linux/include/linux/rbtree.h To use rbtrees you&#x27;ll have to implement your own insert and search cores. This will avoid us to use callbacks and to drop drammatically performances. I know it&#x27;s not the cleaner way, but in C (not in C++) to get performances and genericity... Some example of insert and search follows here. The search is a plain normal search over an ordered tree. The insert instead must be implemented int two steps: as first thing the code must insert the element in order as a red leaf in the tree, then the support library function rb_insert_color() must be called. Such function will do the not trivial work to rebalance the rbtree if necessary.-----------------------------------------------------------------------static inline struct page * rb_search_page_cache(struct inode * inode, unsigned long offset)&#123; struct rb_node * n = inode-&gt;i_rb_page_cache.rb_node; struct page * page; while (n) &#123; page = rb_entry(n, struct page, rb_page_cache); if (offset &lt; page-&gt;offset) n = n-&gt;rb_left; else if (offset &gt; page-&gt;offset) n = n-&gt;rb_right; else return page; &#125; return NULL;&#125;static inline struct page * __rb_insert_page_cache(struct inode * inode, unsigned long offset, struct rb_node * node)&#123; struct rb_node ** p = &amp;inode-&gt;i_rb_page_cache.rb_node; struct rb_node * parent = NULL; struct page * page; while (*p) &#123; parent = *p; page = rb_entry(parent, struct page, rb_page_cache); if (offset &lt; page-&gt;offset) p = &amp;(*p)-&gt;rb_left; else if (offset &gt; page-&gt;offset) p = &amp;(*p)-&gt;rb_right; else return page; &#125; rb_link_node(node, parent, p); return NULL;&#125;static inline struct page * rb_insert_page_cache(struct inode * inode, unsigned long offset, struct rb_node * node)&#123; struct page * ret; if ((ret = __rb_insert_page_cache(inode, offset, node))) goto out; rb_insert_color(node, &amp;inode-&gt;i_rb_page_cache); out: return ret;&#125;-----------------------------------------------------------------------*/#ifndef _LINUX_RBTREE_H#define _LINUX_RBTREE_H// #include &lt;linux/kernel.h&gt;// #include &lt;linux/stddef.h&gt;#include &lt;stdlib.h&gt;#define offsetof(TYPE, MEMBER) ((size_t) &amp;((TYPE*)0)-&gt;MEMBER)#define container_of(ptr, type, member) (&#123; \\ const typeof( ((type *)0)-&gt;member ) *__mptr = (ptr); \\ (type *)( (char *)__mptr - offsetof(type,member) );&#125;)struct rb_node&#123; struct rb_node *rb_parent; int rb_color;#define RB_RED 0#define RB_BLACK 1 struct rb_node *rb_right; struct rb_node *rb_left;&#125;;struct rb_root&#123; struct rb_node *rb_node;&#125;;#define RB_ROOT (struct rb_root) &#123; NULL, &#125;#define rb_entry(ptr, type, member) container_of(ptr, type, member)extern void rb_insert_color(struct rb_node *, struct rb_root *);extern void rb_erase(struct rb_node *, struct rb_root *);/* Find logical next and previous nodes in a tree */extern struct rb_node *rb_next(struct rb_node *);extern struct rb_node *rb_prev(struct rb_node *);extern struct rb_node *rb_first(struct rb_root *);extern struct rb_node *rb_last(struct rb_root *);/* Fast replacement of a single node without remove/rebalance/add/rebalance */extern void rb_replace_node(struct rb_node *victim, struct rb_node *new, struct rb_root *root);static inline void rb_link_node(struct rb_node * node, struct rb_node * parent, struct rb_node ** rb_link)&#123; node-&gt;rb_parent = parent; node-&gt;rb_color = RB_RED; node-&gt;rb_left = node-&gt;rb_right = NULL; *rb_link = node;&#125;#endif /* _LINUX_RBTREE_H */rbtree.c :/* Red Black Trees (C) 1999 Andrea Arcangeli &lt;andrea@suse.de&gt; (C) 2002 David Woodhouse &lt;dwmw2@infradead.org&gt; This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA linux/lib/rbtree.c*/// #include &lt;linux/rbtree.h&gt;// #include &lt;linux/module.h&gt;#include &quot;rbtree.h&quot;static void __rb_rotate_left(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *right = node-&gt;rb_right; if ((node-&gt;rb_right = right-&gt;rb_left)) right-&gt;rb_left-&gt;rb_parent = node; right-&gt;rb_left = node; if ((right-&gt;rb_parent = node-&gt;rb_parent)) &#123; if (node == node-&gt;rb_parent-&gt;rb_left) node-&gt;rb_parent-&gt;rb_left = right; else node-&gt;rb_parent-&gt;rb_right = right; &#125; else root-&gt;rb_node = right; node-&gt;rb_parent = right;&#125;static void __rb_rotate_right(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *left = node-&gt;rb_left; if ((node-&gt;rb_left = left-&gt;rb_right)) left-&gt;rb_right-&gt;rb_parent = node; left-&gt;rb_right = node; if ((left-&gt;rb_parent = node-&gt;rb_parent)) &#123; if (node == node-&gt;rb_parent-&gt;rb_right) node-&gt;rb_parent-&gt;rb_right = left; else node-&gt;rb_parent-&gt;rb_left = left; &#125; else root-&gt;rb_node = left; node-&gt;rb_parent = left;&#125;void rb_insert_color(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *parent, *gparent; while ((parent = node-&gt;rb_parent) &amp;&amp; parent-&gt;rb_color == RB_RED) &#123; gparent = parent-&gt;rb_parent; if (parent == gparent-&gt;rb_left) &#123; &#123; register struct rb_node *uncle = gparent-&gt;rb_right; if (uncle &amp;&amp; uncle-&gt;rb_color == RB_RED) &#123; uncle-&gt;rb_color = RB_BLACK; parent-&gt;rb_color = RB_BLACK; gparent-&gt;rb_color = RB_RED; node = gparent; continue; &#125; &#125; if (parent-&gt;rb_right == node) &#123; register struct rb_node *tmp; __rb_rotate_left(parent, root); tmp = parent; parent = node; node = tmp; &#125; parent-&gt;rb_color = RB_BLACK; gparent-&gt;rb_color = RB_RED; __rb_rotate_right(gparent, root); &#125; else &#123; &#123; register struct rb_node *uncle = gparent-&gt;rb_left; if (uncle &amp;&amp; uncle-&gt;rb_color == RB_RED) &#123; uncle-&gt;rb_color = RB_BLACK; parent-&gt;rb_color = RB_BLACK; gparent-&gt;rb_color = RB_RED; node = gparent; continue; &#125; &#125; if (parent-&gt;rb_left == node) &#123; register struct rb_node *tmp; __rb_rotate_right(parent, root); tmp = parent; parent = node; node = tmp; &#125; parent-&gt;rb_color = RB_BLACK; gparent-&gt;rb_color = RB_RED; __rb_rotate_left(gparent, root); &#125; &#125; root-&gt;rb_node-&gt;rb_color = RB_BLACK;&#125;static void __rb_erase_color(struct rb_node *node, struct rb_node *parent, struct rb_root *root)&#123; struct rb_node *other; while ((!node || node-&gt;rb_color == RB_BLACK) &amp;&amp; node != root-&gt;rb_node) &#123; if (parent-&gt;rb_left == node) &#123; other = parent-&gt;rb_right; if (other-&gt;rb_color == RB_RED) &#123; other-&gt;rb_color = RB_BLACK; parent-&gt;rb_color = RB_RED; __rb_rotate_left(parent, root); other = parent-&gt;rb_right; &#125; if ((!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &amp;&amp; (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK)) &#123; other-&gt;rb_color = RB_RED; node = parent; parent = node-&gt;rb_parent; &#125; else &#123; if (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK) &#123; register struct rb_node *o_left; if ((o_left = other-&gt;rb_left)) o_left-&gt;rb_color = RB_BLACK; other-&gt;rb_color = RB_RED; __rb_rotate_right(other, root); other = parent-&gt;rb_right; &#125; other-&gt;rb_color = parent-&gt;rb_color; parent-&gt;rb_color = RB_BLACK; if (other-&gt;rb_right) other-&gt;rb_right-&gt;rb_color = RB_BLACK; __rb_rotate_left(parent, root); node = root-&gt;rb_node; break; &#125; &#125; else &#123; other = parent-&gt;rb_left; if (other-&gt;rb_color == RB_RED) &#123; other-&gt;rb_color = RB_BLACK; parent-&gt;rb_color = RB_RED; __rb_rotate_right(parent, root); other = parent-&gt;rb_left; &#125; if ((!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &amp;&amp; (!other-&gt;rb_right || other-&gt;rb_right-&gt;rb_color == RB_BLACK)) &#123; other-&gt;rb_color = RB_RED; node = parent; parent = node-&gt;rb_parent; &#125; else &#123; if (!other-&gt;rb_left || other-&gt;rb_left-&gt;rb_color == RB_BLACK) &#123; register struct rb_node *o_right; if ((o_right = other-&gt;rb_right)) o_right-&gt;rb_color = RB_BLACK; other-&gt;rb_color = RB_RED; __rb_rotate_left(other, root); other = parent-&gt;rb_left; &#125; other-&gt;rb_color = parent-&gt;rb_color; parent-&gt;rb_color = RB_BLACK; if (other-&gt;rb_left) other-&gt;rb_left-&gt;rb_color = RB_BLACK; __rb_rotate_right(parent, root); node = root-&gt;rb_node; break; &#125; &#125; &#125; if (node) node-&gt;rb_color = RB_BLACK;&#125;void rb_erase(struct rb_node *node, struct rb_root *root)&#123; struct rb_node *child, *parent; int color; if (!node-&gt;rb_left) child = node-&gt;rb_right; else if (!node-&gt;rb_right) child = node-&gt;rb_left; else &#123; struct rb_node *old = node, *left; node = node-&gt;rb_right; while ((left = node-&gt;rb_left) != NULL) node = left; child = node-&gt;rb_right; parent = node-&gt;rb_parent; color = node-&gt;rb_color; if (child) child-&gt;rb_parent = parent; if (parent) &#123; if (parent-&gt;rb_left == node) parent-&gt;rb_left = child; else parent-&gt;rb_right = child; &#125; else root-&gt;rb_node = child; if (node-&gt;rb_parent == old) parent = node; node-&gt;rb_parent = old-&gt;rb_parent; node-&gt;rb_color = old-&gt;rb_color; node-&gt;rb_right = old-&gt;rb_right; node-&gt;rb_left = old-&gt;rb_left; if (old-&gt;rb_parent) &#123; if (old-&gt;rb_parent-&gt;rb_left == old) old-&gt;rb_parent-&gt;rb_left = node; else old-&gt;rb_parent-&gt;rb_right = node; &#125; else root-&gt;rb_node = node; old-&gt;rb_left-&gt;rb_parent = node; if (old-&gt;rb_right) old-&gt;rb_right-&gt;rb_parent = node; goto color; &#125; parent = node-&gt;rb_parent; color = node-&gt;rb_color; if (child) child-&gt;rb_parent = parent; if (parent) &#123; if (parent-&gt;rb_left == node) parent-&gt;rb_left = child; else parent-&gt;rb_right = child; &#125; else root-&gt;rb_node = child; color: if (color == RB_BLACK) __rb_erase_color(child, parent, root);&#125;/* * This function returns the first node (in sort order) of the tree. */struct rb_node *rb_first(struct rb_root *root)&#123; struct rb_node *n; n = root-&gt;rb_node; if (!n) return NULL; while (n-&gt;rb_left) n = n-&gt;rb_left; return n;&#125;struct rb_node *rb_last(struct rb_root *root)&#123; struct rb_node *n; n = root-&gt;rb_node; if (!n) return NULL; while (n-&gt;rb_right) n = n-&gt;rb_right; return n;&#125;struct rb_node *rb_next(struct rb_node *node)&#123; /* If we have a right-hand child, go down and then left as far as we can. */ if (node-&gt;rb_right) &#123; node = node-&gt;rb_right; while (node-&gt;rb_left) node=node-&gt;rb_left; return node; &#125; /* No right-hand children. Everything down and left is smaller than us, so any &#x27;next&#x27; node must be in the general direction of our parent. Go up the tree; any time the ancestor is a right-hand child of its parent, keep going up. First time it&#x27;s a left-hand child of its parent, said parent is our &#x27;next&#x27; node. */ while (node-&gt;rb_parent &amp;&amp; node == node-&gt;rb_parent-&gt;rb_right) node = node-&gt;rb_parent; return node-&gt;rb_parent;&#125;struct rb_node *rb_prev(struct rb_node *node)&#123; /* If we have a left-hand child, go down and then right as far as we can. */ if (node-&gt;rb_left) &#123; node = node-&gt;rb_left; while (node-&gt;rb_right) node=node-&gt;rb_right; return node; &#125; /* No left-hand children. Go up till we find an ancestor which is a right-hand child of its parent */ while (node-&gt;rb_parent &amp;&amp; node == node-&gt;rb_parent-&gt;rb_left) node = node-&gt;rb_parent; return node-&gt;rb_parent;&#125;void rb_replace_node(struct rb_node *victim, struct rb_node *new, struct rb_root *root)&#123; struct rb_node *parent = victim-&gt;rb_parent; /* Set the surrounding nodes to point to the replacement */ if (parent) &#123; if (victim == parent-&gt;rb_left) parent-&gt;rb_left = new; else parent-&gt;rb_right = new; &#125; else &#123; root-&gt;rb_node = new; &#125; if (victim-&gt;rb_left) victim-&gt;rb_left-&gt;rb_parent = new; if (victim-&gt;rb_right) victim-&gt;rb_right-&gt;rb_parent = new; /* Copy the pointers/colour from the victim to the replacement */ *new = *victim;&#125;","tags":["kernel"],"categories":["kernel"]},{"title":"å†…æ ¸é˜Ÿåˆ—","path":"/posts/å†…æ ¸é˜Ÿåˆ—.html","content":"ä¸€ã€kfifoåŸç† kfifoå®ç°åŸç†æ˜¯é‡‡ç”¨å¾ªç¯ï¼ˆç¯å½¢ï¼‰é˜Ÿåˆ—ã€‚ 1234567struct kfifo&#123; unsigned char *buffer; / *ä¿å­˜æ•°æ®çš„ç¼“å†²åŒº* / unsigned int size; / *åˆ†é…çš„ç¼“å†²åŒºçš„å¤§å°* / unsigned int in; / *æ•°æ®ä»¥åç§»é‡(in%size)æ·»åŠ * / unsigned int out; / *æ•°æ®ä»offä¸­æå–ã€‚(out%size)* /&#125;; äºŒã€kfifoç‰¹ç‚¹1ã€é‡‡ç”¨ç¯å½¢ç¼“å†²åŒºæ¥å®ç°ï¼Œæä¾›ä¸€ä¸ªæ— è¾¹ç•Œçš„å­—èŠ‚æµæœåŠ¡ã€‚é‡‡ç”¨ç¯å½¢ç¼“å†²åŒºçš„å¥½å¤„ä¸ºï¼Œå½“ä¸€ä¸ªæ•°æ®å…ƒç´ è¢«ç”¨æ‰åï¼Œå…¶ä½™æ•°æ®å…ƒç´ ä¸éœ€è¦ç§»åŠ¨å…¶å­˜å‚¨ä½ç½®ï¼Œä»è€Œå‡å°‘æ‹·è´æé«˜æ•ˆç‡ã€‚ 2ã€ä¿è¯ç¼“å†²åŒºå¤§å°ä¸º2çš„æ¬¡å¹‚ï¼Œä¸æ˜¯çš„å‘ä¸Šå–æ•´ä¸º2çš„æ¬¡å¹‚ï¼ˆå¾ˆé‡è¦ï¼‰ã€‚ 3ã€ä½¿ç”¨æ— ç¬¦å·æ•´æ•°ä¿å­˜è¾“å…¥(in)å’Œè¾“å‡º(out)çš„ä½ç½®ï¼Œåœ¨è¾“å…¥è¾“å‡ºæ—¶ä¸å¯¹inå’Œoutçš„å€¼è¿›è¡Œæ¨¡è¿ç®—ï¼Œè€Œè®©å…¶è‡ªç„¶æº¢å‡ºï¼Œå¹¶èƒ½å¤Ÿä¿è¯in-outçš„ç»“æœä¸ºç¼“å†²åŒºä¸­å·²å­˜æ”¾çš„æ•°æ®é•¿åº¦ã€‚ 4ã€å°†éœ€è¦å–æ¨¡çš„è¿ç®—ç”¨ &amp; æ“ä½œä»£æ›¿ï¼ˆ a % size &#x3D; (a &amp; (size âˆ’ 1)) ), è¿™éœ€è¦sizeä¿è¯ä¸º2çš„æ¬¡å¹‚ã€‚ 5ã€ä½¿ç”¨å†…å­˜å±éšœ(Memory Barrier)æŠ€æœ¯ï¼Œå®ç°å•æ¶ˆè´¹è€…å’Œå•ç”Ÿäº§è€…å¯¹kfifoçš„æ— é”å¹¶å‘è®¿é—®ï¼ˆåŒ…æ‹¬å¤šCPUçš„æƒ…å†µï¼‰ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ã€ç”Ÿäº§è€…çš„å¹¶å‘è®¿é—®è¿˜æ˜¯éœ€è¦åŠ é”çš„ã€‚ å…³äºkfifoä¸­å†…å­˜å±éšœçš„ä½¿ç”¨ï¼Œè¯·å‚è€ƒhttps://www.linuxidc.com/Linux/2016-12/137936.htmã€‚ ä¸‰ã€kfifoåŠŸèƒ½å‡½æ•°ä¹‹åˆ›å»ºé˜Ÿåˆ— kfifoæä¾›ä¸¤ç§åˆ›å»ºé˜Ÿåˆ—çš„æ–¹æ³•ï¼ŒåŠ¨æ€åˆ›å»ºå’Œé™æ€åˆ›å»ºã€‚ 1ã€åŠ¨æ€åˆ›å»º(1)ã€kfifo_alloc 123struct kfifo g_fifoqueue;int kfifo_alloc(struct kfifo *fifo, unsigned int size, gfp_t gfp_mask); è¯¥å‡½æ•°åˆ›å»ºå¹¶åˆå§‹åŒ–ä¸€ä¸ªsizeå¤§å°çš„kfifoã€‚å†…æ ¸ä½¿ç”¨gfp_maskæ ‡è¯†ç¬¦åˆ†é…é˜Ÿåˆ—çš„ç¼“å†²åŒºå†…å­˜ã€‚å¦‚æœæˆåŠŸï¼Œå‡½æ•°è¿”å›0ï¼Œé”™è¯¯åˆ™è¿”å›è´Ÿæ•°çš„é”™è¯¯ç ã€‚æ³¨æ„kfifo_allocç”³è¯·çš„å†…å­˜æ˜¯åœ¨ç‰©ç†åœ°å€ä¸Šæ˜¯è¿ç»­çš„ (2)ã€kfifo_init å¦‚æœè¦è‡ªå·±åˆ†é…ç¼“å†²åŒºï¼Œå¯ä»¥è°ƒç”¨å‡½æ•°ï¼š 1void kfifo_init(struct kfifo *fifo, void *buffer, unsigned int size); 2ã€é™æ€åˆ›å»ºDECLARE_KFIFO(name, size) ; INIT_KFIFO(name); å››ã€å…¥é˜Ÿæ“ä½œå¯¹äºæ¨å…¥é˜Ÿåˆ—æ•°æ®ï¼Œkfifoæä¾›ä¸‰å¤§ç±»å‡½æ•°ï¼šå¸¸è§„å‡½æ•°ï¼Œ å°†ç”¨æˆ·ç©ºé—´æ•°æ®æ¨å…¥é˜Ÿåˆ—çš„å‡½æ•°ï¼Œå¸¦è®°å½•åŸŸåŠŸèƒ½çš„å‡½æ•°ã€‚ 1ï¼‰å¸¸è§„å‡½æ•° unsigned int kfifo_in(struct kfifo *fifo, const void *from, unsigned int len); unsigned int kfifo_in_locked(struct kfifo *fifo, const void *from, unsigned int n, spinlock_t *lock); 2ï¼‰å°†ç”¨æˆ·ç©ºé—´æ•°æ®æ¨å…¥é˜Ÿåˆ—çš„å‡½æ•° int kfifo_from_user(struct kfifo *fifo, const void __user *from, unsigned int n, unsigned *lenout); unsigned int kfifo_from_user_rec(struct kfifo *fifo, const void __user *from, unsigned int n, unsigned int recsize); 3ï¼‰å¸¦è®°å½•åŸŸåŠŸèƒ½çš„å‡½æ•° unsigned int kfifo_in_rec(struct kfifo *fifo, void *from, unsigned int n, unsigned int recsize)ï¼› äº”ã€å‡ºé˜Ÿå¯¹äºæ‘˜å–é˜Ÿåˆ—æ•°æ®ï¼Œkfifoæä¾›ä¸‰å¤§ç±»å‡½æ•°ï¼šå¸¸è§„å‡½æ•°ï¼Œ æ‘˜å–é˜Ÿåˆ—æ•°æ®è‡³ç”¨æˆ·ç©ºé—´çš„å‡½æ•°ï¼Œå¸¦è®°å½•åŸŸåŠŸèƒ½çš„å‡½æ•°ã€‚ (1)ã€å¸¸è§„å‡½æ•° 12345unsigned int kfifo_out(struct kfifo *fifo, void *to, unsigned int len);unsigned int kfifo_out_locked(struct kfifo *fifo, void *to, unsigned int n, spinlock_t *lock);unsigned int kfifo_out_peek(struct kfifo *fifo, void *to, unsigned int len, unsigned offset); (2)ã€æ‘˜å–é˜Ÿåˆ—æ•°æ®è‡³ç”¨æˆ·ç©ºé—´çš„å‡½æ•° 123unsigned int kfifo_to_user(struct kfifo *fifo, void __user *to, unsigned int n, unsigned *lenout);unsigned int kfifo_to_user_rec(struct kfifo *fifo, void __user *to, unsigned int n, unsigned int recsize, unsigned int *total); (3)ã€å¸¦è®°å½•åŸŸåŠŸèƒ½çš„å‡½æ•° 1unsigned int kfifo_out_rec(struct kfifo *fifo, void *to, unsigned int n, unsigned int recsize, unsigned int *total); å…­ã€è·å–é˜Ÿåˆ—é•¿åº¦ã€åˆ¤ç©ºç­‰æ“ä½œ(1)ã€è·å–é˜Ÿåˆ—ç¼“å†²åŒºå¤§å° 1unsigned int kfifo_size(struct kfifo *fifo); (2)ã€è·å–é˜Ÿåˆ—å·²æ¨å…¥çš„æ•°æ®å¤§å° 1unsigned int kfifo_len(struct kfifo *fifo); (3)ã€è·å–é˜Ÿåˆ—å¯ç”¨ç©ºé—´å¤§å° 1unsigned int kfifo_avail(struct kfifo *fifo); (4)ã€åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ç©º 1int kfifo_is_empty(struct kfifo *fifo); (5)ã€åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡ 1int kfifo_is_full(struct kfifo *fifo); ä¸ƒã€é‡ç½®å’Œæ’¤é”€é˜Ÿåˆ—(1)ã€é‡ç½®é˜Ÿåˆ— 123void kfifo_reset(struct kfifo *fifo);void kfifo_skip(struct kfifo *fifo, unsigned int len); (2)ã€æ’¤é”€é˜Ÿåˆ— å¦‚æœé˜Ÿåˆ—æ˜¯ç”±å‡½æ•°kfifo_allocåˆ›å»ºï¼Œåˆ™æ’¤é”€é˜Ÿåˆ—ä½¿ç”¨ï¼š 12void kfifo_free(struct kfifo *fifo); å¦‚æœé˜Ÿåˆ—æ˜¯ç”±å‡½æ•°kfifo_initåˆ›å»ºï¼Œåˆ™ä½ éœ€è¦è´Ÿè´£é‡Šæ”¾ç›¸å…³ç¼“å†²ã€‚","tags":["kernel"],"categories":["kernel"]},{"title":"å†…æ ¸é“¾è¡¨","path":"/posts/å†…æ ¸é“¾è¡¨.html","content":"åœ¨Linuxå†…æ ¸ä¸­ä½¿ç”¨äº†å¤§é‡çš„é“¾è¡¨ç»“æ„æ¥ç»„ç»‡æ•°æ®ï¼ŒåŒ…æ‹¬è®¾å¤‡åˆ—è¡¨ä»¥åŠå„ç§åŠŸèƒ½æ¨¡å—ä¸­çš„æ•°æ®ç»„ç»‡ã€‚è¿™äº›é“¾è¡¨å¤§å¤šé‡‡ç”¨åœ¨include&#x2F;linux&#x2F;list.hå®ç°çš„ä¸€ä¸ªç›¸å½“ç²¾å½©çš„é“¾è¡¨æ•°æ®ç»“æ„ã€‚äº‹å®ä¸Šï¼Œå†…æ ¸é“¾è¡¨å°±æ˜¯é‡‡ç”¨åŒå¾ªç¯é“¾è¡¨æœºåˆ¶ã€‚ å†…æ ¸é“¾è¡¨æœ‰åˆ«äºä¼ ç»Ÿé“¾è¡¨å°±åœ¨èŠ‚ç‚¹æœ¬èº«ä¸åŒ…å«æ•°æ®åŸŸï¼ŒåªåŒ…å«æŒ‡é’ˆåŸŸã€‚æ•…è€Œå¯ä»¥å¾ˆçµæ´»çš„æ‹“å±•æ•°æ®ç»“æ„ã€‚ ä¸€ã€ç¥å¥‡çš„ç»“æ„ï¼šlist_headè¦äº†è§£å†…æ ¸é“¾è¡¨ï¼Œå°±ä¸å¾—ä¸æ list_headã€‚è¿™ä¸ªç»“æ„å¾ˆæœ‰æ„æ€ï¼Œæ•´ä¸ªç»“æ„æ²¡æœ‰æ•°æ®åŸŸï¼Œåªæœ‰ä¸¤ä¸ªæŒ‡é’ˆåŸŸã€‚è¿™ä¸ªç»“æ„æœ¬èº«æ„ä¹‰ä¸å¤§ï¼Œä¸è¿‡åœ¨å†…æ ¸é“¾è¡¨ä¸­ï¼Œèµ·ç€æ•´ä¸ªè¡”æ¥ä½œç”¨ï¼Œå¯ä»¥è¯´æ˜¯å†…æ ¸é“¾è¡¨çš„æ ¸å¿ƒä¸ä¸ºè¿‡ã€‚ 123struct list_head &#123; struct list_head *next, *prev;&#125;; äºŒã€é“¾è¡¨åˆå§‹åŒ–å†…æ ¸æä¾›å¤šç§æ–¹å¼æ¥åˆå§‹åŒ–é“¾è¡¨ï¼šå®åˆå§‹åŒ–å’Œæ¥å£åˆå§‹åŒ–ã€‚ (1)å®åˆå§‹åŒ–LIST_HEAD_HEAD_INITå®è®¾è®¡çš„å¾ˆç²¾å¦™ã€‚è¿™ä¸ªå®æœ¬èº«ä¸åŒ…å«ä»»ä½•æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰é™å®šå”¯ä¸€çš„æ•°æ®ç±»å‹ï¼Œè¿™å°±ä½¿å¾—æ•´ä¸ªé“¾è¡¨è¶³å¤Ÿçµæ´»ã€‚æ˜¯ä¸æ˜¯æœ‰ç‚¹C++æ¨¡æ¿çš„æ„æ€ï¼Ÿ å¯¹äºä»»æ„ç»™å®šçš„ç»“æ„æŒ‡é’ˆï¼Œå°†ã€å‰é©±ã€‘å’Œã€åç»§ã€‘æŒ‡é’ˆéƒ½æŒ‡å‘è‡ªå·±ï¼Œä½œä¸ºé“¾è¡¨å¤´æŒ‡é’ˆã€‚ LIST_HEAD å® æœ¬è´¨å°±æ˜¯èµ‹äºˆäº† name äº ã€struct list_headã€‘ å±æ€§ï¼Œç”±äº list_head æœ¬èº«ä¸åŒ…å«æ•°æ®åŸŸï¼Œæ‰€ä»¥æ­é… LIST_HEAD_HEAD_INIT å®ï¼Œå°±ä½¿å¾—æ•´ä¸ªé“¾è¡¨ä¸Šçš„æ•°æ®æ›´åŠ çµæ´»ã€‚å…·å¤‡é€šç”¨æ€§ã€‚ 123#define LIST_HEAD_INIT(name) &#123; &amp;(name), &amp;(name) &#125;#define LIST_HEAD(name) \\ struct list_head name = LIST_HEAD_INIT(name) (2)æ¥å£åˆå§‹åŒ–æ¥å£æ“ä½œå°±æ¯”è¾ƒç›´æ¥æ˜äº†ï¼ŒåŸºæœ¬ä¸Šå’Œå®å®ç°çš„æ„å›¾ä¸€æ ·ã€‚ç›´æ¥å°†é“¾è¡¨å¤´æŒ‡é’ˆçš„å‰é©±å’Œåç»§éƒ½æŒ‡å‘è‡ªå·± 12345static inline void INIT_LIST_HEAD(struct list_head *list)&#123; list-&gt;next = list; list-&gt;prev = list;&#125; æˆ‘ä»¬ä»¥ç¤ºä¾‹æ¥è¡¥å……è¯´æ˜ï¼Œè¿™æ ·æœ‰åŠ©äºå¤§å®¶è¾…åŠ©ç†è§£ï¼š 12// 1. é“¾è¡¨èŠ‚ç‚¹åˆå§‹åŒ–ï¼Œå‰é©±å’Œåç»§éƒ½æŒ‡å‘è‡ªå·±ï¼ˆåˆå§‹åŒ–ï¼‰struct list = LIST_HEAD(list); å‰é¢è¯´äº† list_head åªæœ‰æŒ‡é’ˆåŸŸï¼Œæ²¡æœ‰æ•°æ®åŸŸï¼Œå¦‚æœåªæ˜¯è¿™æ ·å°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå®¿ä¸»ç»“æ„ï¼Œç„¶åå†å†æ­¤ç»“æ„åŒ…å« list å­—æ®µï¼Œå®¿ä¸»ç»“æ„ï¼Œä¹Ÿæœ‰å…¶ä»–å­—æ®µï¼ˆè¿›ç¨‹æè¿°ç¬¦ï¼Œé¡µé¢ç®¡ç†ç»“æ„ç­‰éƒ½æ˜¯é‡‡ç”¨è¿™ç§æ–¹æ³•åˆ›å»ºé“¾è¡¨çš„ï¼‰ã€‚å‡è®¾å®šä¹‰å¦‚ä¸‹ï¼š 1234struct my_data_list &#123; int data ; struct list_head list; /* list head , è¿™ä¸ªè‡³å…³é‡è¦ï¼ŒåæœŸéå†é€šè¿‡container_of è§£æmy_data_list åœ°å€ */&#125;; åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼š 123456struct my_data_list first_data =&#123; .val = 1, /* è¿™é‡Œæœ‰ç‚¹ç»•ï¼Œäº‹å®ä¸Šå°±æ˜¯å°†first_data.list , å‰é©±å’Œåç»§éƒ½æŒ‡å‘è‡ªå·±è¿›è¡Œåˆå§‹åŒ– */ .list = LIST_HEAD_INIT(first_data.list),&#125;; è¿™é‡Œ list çš„ prev å’Œ next éƒ½æŒ‡å‘list è‡ªå·±äº†ï¼Œå¹¶ä¸”list å±äº my_data_list çš„æˆå‘˜ã€‚åªéœ€è¦éå†åˆ°lst èŠ‚ç‚¹å°±èƒ½æ ¹æ® å‰é¢è®²çš„ container_of æ¨å¯¼å¾—åˆ°å…¶å®¿ä¸»ç»“æ„çš„åœ°å€ï¼Œä»è€Œè®¿é—®valå€¼ï¼Œå¦‚æœæœ‰å…¶ä»–æ–¹æ³•ï¼Œä¹Ÿå¯è®¿é—®ã€‚ åˆ†æåˆ°è¿™é‡Œï¼Œåº”è¯¥é€æ¸æ˜æ™°ï¼Œä¸ºä½•list_head è®¾è®¡å¾ˆæœ‰æ„æ€ï¼Ÿä¸ºä»€ä¹ˆé“¾è¡¨æœ¬èº«ä¸åŒ…å«æ•°æ®åŸŸï¼Œå´èƒ½è¡ç”Ÿå‡ºæ— æ•°æ•°æ®ç±»å‹ï¼Œä¸å—ç‰¹å®šçš„æ•°æ®ç±»å‹é™åˆ¶ã€‚ ä¸‰ã€æ·»åŠ èŠ‚ç‚¹å†…æ ¸ç›¸åº”çš„æä¾›äº†æ·»åŠ èŠ‚ç‚¹çš„æ¥å£ï¼š (1)list_addlist_add å¦‚ä¸‹ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯__list_add å‡½æ•°ï¼Œæ ¹æ®æ³¨é‡Šå¯çŸ¥ï¼Œlist_add æ˜¯å¤´éƒ¨æ’å…¥ï¼Œæ€»æ˜¯åœ¨é“¾è¡¨çš„å¤´éƒ¨æ’å…¥ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚ list_add 123456789101112/** * list_add - add a new entry * @new: new entry to be added * @head: list head to add it after * * Insert a new entry after the specified head. * This is good for implementing stacks. */static inline void list_add(struct list_head *new, struct list_head *head)&#123; __list_add(new, head, head-&gt;next);&#125; __list_add 123456789101112131415/* * Insert a new entry between two known consecutive entries. * * This is only for internal list manipulation where we know * the prev/next entries already! */static inline void __list_add(struct list_head *new, struct list_head *prev, struct list_head *next)&#123; next-&gt;prev = new; new-&gt;next = next; new-&gt;prev = prev; prev-&gt;next = new;&#125; æˆ‘ä»¬å†ä»¥ç¤ºä¾‹è¡¥å……è¯´æ˜ï¼š é¦–å…ˆåˆ›å»ºä¸€ä¸ªé“¾è¡¨å¤´ï¼šlistHead 1LIST_HEAD(listHead); ç„¶åå†åˆ›å»ºç¬¬ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ï¼š 12345struct my_data_list first_data =&#123; .val = 1, .list = LIST_HEAD_INIT(first_data.list),&#125;; æ¥ç€ æŠŠè¿™ä¸ªèŠ‚ç‚¹æ’å…¥åˆ° listHead å 1list_add(&amp;frist_data.list, &amp;listHead); ç´§æ¥ç€æˆ‘ä»¬å†åˆ›å»ºç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼š 12345678struct my_data_list second_data =&#123; .val = 2, /* ä¹Ÿå¯ä»¥è°ƒç”¨æ¥å£ åˆå§‹åŒ–*/ .list = LIST_HEAD_INIT(second_data.list),&#125;;list_add(&amp;second_data.list, &amp;listHead); ç¤ºæ„å›¾å¦‚ä¸‹ï¼š ä»¥æ­¤ç±»æ¨ï¼Œæ¯æ¬¡æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œéƒ½æ˜¯ç´§é ç€headerèŠ‚ç‚¹ï¼Œè€Œä¹‹å‰æ’å…¥çš„èŠ‚ç‚¹ä¾æ¬¡æ’åºé åï¼Œé‚£æœ€åä¸€ä¸ªèŠ‚ç‚¹åˆ™æ˜¯ç¬¬ä¸€æ¬¡æ’å…¥headeråçš„é‚£ä¸ªèŠ‚ç‚¹ã€‚ å¯ä»¥çœ‹å‡ºï¼šå…ˆæ¥çš„èŠ‚ç‚¹é åï¼Œè€Œåæ¥çš„èŠ‚ç‚¹é å‰ï¼Œç¬¦åˆâ€œå…ˆè¿›åå‡ºï¼Œåè¿›å…ˆå‡ºâ€ã€‚æ‰€ä»¥æ­¤ç§ç»“æ„ç±»ä¼¼äº stackâ€œæ ˆâ€ ï¼Œ ç±»ä¼¼äºå†…æ ¸stackä¸­çš„æ ˆé¡¶æŒ‡é’ˆespï¼Œ å®ƒéƒ½æ˜¯ç´§é ç€æœ€åpushåˆ°æ ˆçš„å…ƒç´ ã€‚ (2)list_add_tailå†çœ‹å†…æ ¸å¦å¤–ä¸€ç§æ’å…¥æ–¹å¼ï¼Œæœ¬è´¨éƒ½æ˜¯è°ƒç”¨__lis_addã€‚ä¸åŒçš„æ˜¯ï¼Œä¸€ä¸ªæ˜¯å¤´éƒ¨æ’å…¥ï¼Œä¸€ä¸ªæ˜¯å°¾éƒ¨æ’å…¥ã€‚ 123456789101112/** * list_add_tail - add a new entry * @new: new entry to be added * @head: list head to add it before * * Insert a new entry before the specified head. * This is useful for implementing queues. */static inline void list_add_tail(struct list_head *new, struct list_head *head)&#123; __list_add(new, head-&gt;prev, head);&#125; æˆ‘ä»¬è¿˜æ˜¯ä»¥ç¤ºä¾‹è¾…åŠ©è¯´æ˜ï¼š é¦–å…ˆåˆ›å»ºä¸€ä¸ªé“¾è¡¨å¤´ï¼š 1LIST_HEAD(listHead); ç„¶ååˆ›å»ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ 12345struct my_data_list first_data =&#123; .val = 1, .list = LIST_HEAD_INIT(first_data.list),&#125;; æ’å…¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼š 1list_add_tail(&amp;first_data.list, listHead); ç´§æ¥ç€æ’å…¥ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼š 12345678struct my_data_list second_data =&#123; .val = 2, /* ä¹Ÿå¯ä»¥è°ƒç”¨æ¥å£ åˆå§‹åŒ–*/ .list = LIST_HEAD_INIT(second_data.list),&#125;;list_add_tail(&amp;second_data.list, &amp;listHead); ç¤ºæ„å›¾å¦‚ä¸‹ï¼š æ¯æ¬¡æ’å…¥çš„æ–°èŠ‚ç‚¹éƒ½æ˜¯ç´§æŒ¨ç€ header è¡¨å°¾ï¼Œè€Œæ’å…¥çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ’åœ¨äº†ç¬¬ä¸€ä½ï¼Œç¬¬äºŒä¸ªæ’åœ¨äº†ç¬¬äºŒä½ã€‚ å…ˆæ’å…¥çš„èŠ‚ç‚¹æ’åœ¨å‰é¢ï¼Œåæ’å…¥çš„èŠ‚ç‚¹æ’åœ¨åé¢ï¼Œâ€œå…ˆè¿›å…ˆå‡ºï¼Œåè¿›åå‡ºâ€ï¼ˆFirst in First out,FIFOï¼‰ï¼è¿™ä¸å°±æ˜¯é˜Ÿåˆ—å—ï¼Ÿ æ€»ç»“ç”±äºæ˜¯åŒå¾ªç¯é“¾è¡¨ï¼Œçœ‹èµ·æ¥å°¾éƒ¨æ’å…¥å’Œå¤´éƒ¨æ’å…¥æ˜¯ä¸€æ ·çš„ï¼Œå…¶å®ä¸ç„¶ã€‚ æˆ‘ä»¬å†æ¥å¯¹æ¯”å°¾éƒ¨å’Œå¤´éƒ¨æ’å…¥çš„åŒºåˆ«ï¼š å¤´éƒ¨æ’å…¥ï¼Œç»“æ„æ˜¯é€†åºï¼Œå±äºå…ˆè¿›åå‡ºï¼Œæœ€ä¸»è¦çš„åŒºåˆ«å°±æ˜¯å¤´èŠ‚ç‚¹çš„prevæŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å°¾éƒ¨æ’å…¥ï¼Œç»“æ„æ˜¯é¡ºåºï¼Œå±äºFIFOç»“æ„ï¼Œæœ€ä¸»è¦çš„åŒºåˆ«å°±æ˜¯å¤´èŠ‚ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ list_addï¼šå¤´éƒ¨æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ list_add_tailï¼šå°¾éƒ¨æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ å››ã€åˆ é™¤èŠ‚ç‚¹å†…æ ¸åŒæ ·å®šä¹‰äº†åˆ é™¤èŠ‚ç‚¹çš„æ¥å£ list_del list_delï¼š 123456789static inline void list_del(struct list_head *entry)&#123; /* __list_del_entry(entry) ä¹Ÿè¡Œ*/ __list_del(entry-&gt;prev, entry-&gt;next); /* æŒ‡å‘ç‰¹å®šçš„ä½ç½®ï¼Œååˆå§‹åŒ– */ entry-&gt;next = LIST_POISON1; entry-&gt;prev = LIST_POISON2;&#125; __list_delï¼šè¿™ä¸ªæ¥å£ï¼Œæ ¹æ®prev&#x2F;next åˆ é™¤å…¶èŠ‚ç‚¹ï¼Œåˆ é™¤çš„èŠ‚ç‚¹å¿…é¡»æ˜¯å·²çŸ¥çš„å¹¶ä¸” prev å’Œ next ä¸ä¸ºç©º 123456789101112/* * Delete a list entry by making the prev/next entries * point to each other. * * This is only for internal list manipulation where we know * the prev/next entries already! */static inline void __list_del(struct list_head * prev, struct list_head * next)&#123; next-&gt;prev = prev; prev-&gt;next = next;&#125; __list_del_entryï¼šåˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ã€‚ 12345678910/** * list_del - deletes entry from list. * @entry: the element to delete from the list. * Note: list_empty() on entry does not return true after this, the entry is * in an undefined state. */static inline void __list_del_entry(struct list_head *entry)&#123; __list_del(entry-&gt;prev, entry-&gt;next);&#125; 123456789/** * list_del_init - deletes entry from list and reinitialize it. * @entry: the element to delete from the list. */static inline void list_del_init(struct list_head *entry)&#123; __list_del_entry(entry); INIT_LIST_HEAD(entry);&#125; åˆ©ç”¨list_del(struct list_head *entry) æ¥å£å°±å¯ä»¥åˆ é™¤é“¾è¡¨ä¸­çš„ä»»æ„èŠ‚ç‚¹äº†ï¼Œéœ€æ³¨æ„ï¼Œå‰ææ¡ä»¶æ˜¯è¿™ä¸ªèŠ‚ç‚¹æ˜¯å·²çŸ¥çš„ï¼Œæ—¢åœ¨é“¾è¡¨ä¸­çœŸå®å­˜åœ¨ï¼Œåˆ‡prevï¼ŒnextæŒ‡é’ˆéƒ½ä¸ä¸ºNULLã€‚ è¢«å‰”é™¤ä¸‹æ¥çš„ my_data_list.listï¼Œprevã€next æŒ‡é’ˆåˆ†åˆ«è¢«è®¾ä¸º LIST_POSITION2å’ŒLIST_POSITION1ä¸¤ä¸ªç‰¹æ®Šå€¼ï¼Œè¿™æ ·è®¾ç½®æ˜¯ä¸ºäº†ä¿è¯ä¸åœ¨é“¾è¡¨ä¸­çš„èŠ‚ç‚¹é¡¹ä¸å¯è®¿é—®â€“å¯¹LIST_POSITION1å’ŒLIST_POSITION2çš„è®¿é—®éƒ½å°†å¼•èµ·é¡µæ•…éšœã€‚ ä¸ä¹‹ç›¸å¯¹åº”ï¼Œlist_del_init()å‡½æ•°å°†èŠ‚ç‚¹ä»é“¾è¡¨ä¸­è§£ä¸‹æ¥ä¹‹åï¼Œè°ƒç”¨LIST_INIT_HEAD()å°†èŠ‚ç‚¹ç½®ä¸ºç©ºé“¾çŠ¶æ€ã€‚ list_del() å’Œ list_del_init æ˜¯å¤–éƒ¨æ¥å£ã€‚__list_del() å’Œ __list_entry() æ˜¯å†…æ ¸å†…éƒ¨èŠ‚ç‚¹ã€‚ list_del() ä½œç”¨æ˜¯åˆ é™¤åŒé“¾è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¹¶å°†èŠ‚ç‚¹çš„prevå’Œnextéƒ½æŒ‡å‘ç‰¹å®šä½ç½®ï¼ŒLIST_POSITION1å’ŒLIST_POSITION2ã€‚ list_del_init() ä½œç”¨æ˜¯åˆ é™¤åŒé“¾è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶å°†èŠ‚ç‚¹çš„prevå’Œnextéƒ½æŒ‡å‘è‡ªå·±ï¼Œå›åˆ°æœ€å¼€å§‹åˆ›å»ºèŠ‚ç‚¹å‰çš„çŠ¶æ€ã€‚ äº”ã€æ¬ç§»å†…æ ¸æä¾›äº†å°†åŸæœ¬å±äºä¸€ä¸ªé“¾è¡¨çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªé“¾è¡¨çš„æ“ä½œï¼Œå¹¶æ ¹æ®æ’å…¥åˆ°æ–°é“¾è¡¨çš„ä½ç½®åˆ†ä¸ºä¸¤ç±»ï¼šå¤´éƒ¨æ¬ç§»å’Œå°¾éƒ¨æ¬ç§»ã€‚æ¬ç§»çš„æœ¬è´¨å°±æ˜¯åˆ é™¤åŠ æ’å…¥ã€‚ å¤´éƒ¨æ¬ç§»12345678910/** * list_move - delete from one list and add as another&#x27;s head * @list: the entry to move * @head: the head that will precede our entry */static inline void list_move(struct list_head *list, struct list_head *head)&#123; __list_del_entry(list); list_add(list, head);&#125; å°¾éƒ¨æ¬ç§»1234567891011/** * list_move_tail - delete from one list and add as another&#x27;s tail * @list: the entry to move * @head: the head that will follow our entry */static inline void list_move_tail(struct list_head *list, struct list_head *head)&#123; __list_del_entry(list); list_add_tail(list, head);&#125; å…­ã€åˆå¹¶å†…æ ¸è¿˜æä¾›ä¸¤ç»„åˆå¹¶æ“ä½œï¼Œå°†ä¸¤æ¡é“¾è¡¨åˆå¹¶åœ¨ä¸€èµ·ã€‚ å½“ list1 è¢«æŒ‚æ¥åˆ° list2 ä¹‹åï¼Œä½œä¸ºåŸè¡¨å¤´æŒ‡é’ˆçš„ list1 çš„nextã€prevä»ç„¶æŒ‡å‘åŸæ¥çš„èŠ‚ç‚¹ï¼Œä¸ºäº†é¿å…å¼•èµ·æ··ä¹±ï¼ŒLinuxæä¾›äº†ä¸€ä¸ªlist_splice_init()å‡½æ•°.è¯¥å‡½æ•°åœ¨å°†liståˆå¹¶åˆ°headé“¾è¡¨çš„åŸºç¡€ä¸Šï¼Œè°ƒç”¨INIT_LIST_HEAD(list)å°†listè®¾ç½®ä¸ºç©ºé“¾ã€‚ 1234static inline void list_splice(const struct list_head *list, struct list_head *head);static inline void list_splice_init(struct list_head *list, struct list_head *head);static inline void list_splice_tail(const struct list_head *list, struct list_head *head);static inline void list_splice_tail_init(struct list_head *list, struct list_head *head); ç¤ºæ„å›¾å¦‚ä¸‹ï¼š å¦å¤–ä¸€ç§æ–¹å¼ç±»ä¼¼ï¼Œåªä¸è¿‡åˆå¹¶æ—¶æ–­å¼€çš„ä½ç½®æœ‰æ‰€ä¸åŒ ä¸ƒã€æ›¿æ¢å†…æ ¸è¿˜æä¾›ä¸€ç»„æ›¿æ¢é“¾è¡¨èŠ‚ç‚¹çš„æ“ä½œã€‚list_replaceï¼šå°†æ–°çš„èŠ‚ç‚¹æ›¿æ¢åˆ°æ—§çš„èŠ‚ç‚¹ä¸Šã€‚list_replace_initï¼šå°†æ–°çš„èŠ‚ç‚¹æ›¿æ¢åˆ°æ—§çš„èŠ‚ç‚¹ä¸Šã€‚åŒæ—¶å°†æ—§çš„èŠ‚ç‚¹çš„prevå’ŒnextæŒ‡å‘è‡ªå·±ï¼Œååˆå§‹åŒ– 12static inline void list_replace(struct list_head *old, struct list_head *new);static inline void list_replace_init(struct list_head *old, struct list_head *new); å…«ã€éå†æ“ä½œå†…æ ¸æä¾›äº†ä¸€ç»„å®è¿›è¡Œéå†æ“ä½œã€‚ç»è¿‡ä¸€ç³»åˆ—çš„å¢åˆ å‡æ”¹æ“ä½œï¼Œæˆ‘ä»¬ç»ˆäºåˆ°äº†éå†çš„æ—¶å€™ã€‚ list_entry å®é‡å¤´æˆæ¥äº†ï¼Œéå†çš„å…³é”®å°±æ˜¯è¿™ä¸ªlist_entryå®ã€‚æœ¬è´¨å°±æ˜¯container_ofå®ã€‚ å…·ä½“åˆ†æè§ä¸Šä¸€ç¯‡æ–‡ç« ã€‚è¿™ä¸ªå®çš„ä¸»è¦ä½œç”¨å°±æ˜¯è·å–å®¿ä¸»ç»“æ„çš„æŒ‡é’ˆåœ°å€ã€‚ å‰æ–‡æåˆ°ï¼Œæˆ‘ä»¬æ˜¯ä»¥list æŒ‡é’ˆä¸ºèŠ‚ç‚¹ç»„æˆçš„ä¸€æ¡åŒé“¾è¡¨ï¼Œéå†çš„è¿‡ç¨‹ä¸­åªèƒ½å¾—åˆ°listçš„åœ°å€ï¼Œé‚£ä¹ˆå¯¹äºå…¶æ‰€æœ‰è€…åœ°å€å°±æ˜¯é€šè¿‡è¿™ä¸ªå®è·å–çš„ã€‚ 12345678/*** list_entry - get the struct for this entry* @ptr: the &amp;struct list_head pointer.* @type: the type of the struct this is embedded in.* @member: the name of the list_struct within the struct.*/#define list_entry(ptr, type, member) \\ container_of(ptr, type, member) 12/* æ ¹æ®list å€’æ¨ my_list_data*/list_entry(&amp;my_list_data.list, typeof(&amp;my_list_data), list) list_for_eachlist_for_each å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªforå¾ªç¯ï¼Œåˆ©ç”¨ä¼ å…¥çš„posä½œä¸ºå¾ªç¯å˜é‡ï¼Œä»è¡¨å¤´headå¼€å§‹ï¼Œé€é¡¹å‘åï¼ˆnextæ–¹å‘ï¼‰ç§»åŠ¨posï¼Œç›´è‡³åˆå›åˆ°head 1234567/** * list_for_each - iterate over a list * @pos: the &amp;struct list_head to use as a loop cursor. * @head: the head for your list. */#define list_for_each(pos, head) \\ for (pos = (head)-&gt;next; pos != (head); pos = pos-&gt;next) list_for_each_entryéå†æ¯ä¸€ä¸ªlist,ç„¶åè·å–å…¶å®¿ä¸»ç»“æ„åœ°å€ã€‚&#x3D;&#x3D;posä¸€èˆ¬æ˜¯æ–°å»ºä¸€ä¸ªé“¾è¡¨ï¼Œä¼ å…¥ï¼Œç”¨äºforå¾ªç¯éå†ï¼Œheadä¸€èˆ¬æ˜¯å¾…éå†çš„é“¾è¡¨ï¼Œmemberæ˜¯ä¼ å…¥çš„posä¸­çš„list_headå¯¹åº”çš„æˆå‘˜&#x3D;&#x3D; 12345678910/** * list_for_each_entry - iterate over list of given type * @pos: the type * to use as a loop cursor. * @head: the head for your list. * @member: the name of the list_struct within the struct. */#define list_for_each_entry(pos, head, member) \\ for (pos = list_entry((head)-&gt;next, typeof(*pos), member); \\ &amp;pos-&gt;member != (head); \\ pos = list_entry(pos-&gt;member.next, typeof(*pos), member)) list_for_each_prevåå‘éå†å¾—åˆ°list. 1234567/** * list_for_each_prev - iterate over a list backwards * @pos: the &amp;struct list_head to use as a loop cursor. * @head: the head for your list. */#define list_for_each_prev(pos, head) \\ for (pos = (head)-&gt;prev; pos != (head); pos = pos-&gt;prev) list_for_each_entry_reverseåå‘éå†å¾—åˆ°list,ç„¶åè·å–å…¶å®¿ä¸»ç»“æ„åœ°å€ã€‚ 12345678910/*** list_for_each_entry_reverse - iterate backwards over list of given type.* @pos: the type * to use as a loop cursor.* @head: the head for your list.* @member: the name of the list_struct within the struct.*/#define list_for_each_entry_reverse(pos, head, member) \\ for (pos = list_entry((head)-&gt;prev, typeof(*pos), member); \\ &amp;pos-&gt;member != (head); \\ pos = list_entry(pos-&gt;member.prev, typeof(*pos), member)) ä¹ã€æ€»ç»“æœ¬æ–‡è¯¦ç»†åˆ†æäº† linux å†…æ ¸ ä¸­çš„åŒé“¾è¡¨ç»“æ„ï¼Œä»¥å›¾æ–‡çš„æ–¹å¼æ—¨åœ¨å¸®åŠ©å¤§å®¶ç†è§£ã€‚ å½“ç„¶è¿˜æœ‰å¾ˆå¤šæ¥å£é™äºç¯‡å¹…æ²¡æœ‰ä»‹ç»ï¼Œæœ¬æ–‡åªåˆ—å‡ºäº†å¸¸ç”¨äº†æ¥å£ï¼Œç›¸ä¿¡åªè¦ç†è§£äº†å‰é¢åŒé“¾è¡¨çš„ç»„æˆå’Œæ’å…¥è¿‡ç¨‹ï¼Œåé¢çš„åˆ é™¤å’Œéå†å°±è‡ªç„¶è€Œç„¶é€šäº†ã€‚","tags":["kernel"],"categories":["kernel"]},{"title":"offset_ofå’Œcontainer_ofå®","path":"/posts/offset-ofå’Œcontainer-ofå®.html","content":"ä¸€ã€container_of å®ä»‹ç»åˆ°è¿™é‡Œå‡è®¾å¤§å®¶éƒ½æ‡‚äº† typeof å’Œ è¯­å¥è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹ä¸€ç¹ Linux å†…æ ¸ç¬¬ä¸€å® container_of çš„èŠ³å®¹å§ï¼š 1234#define offsetof(TYPE, MEMBER) ((size_t) &amp;((TYPE *)0)-&gt;MEMBER)#define container_of(ptr, type, member) (&#123; \\ const typeof( ((type *)0)-&gt;member ) *__mptr = (ptr); \\ (type *)( (char *)__mptr - offsetof(type,member) );&#125;) ä½œä¸º Linux å†…æ ¸ç¬¬ä¸€ä¸ªå®ï¼Œç»å¯¹æ˜¯å®è‡³åå½’çš„ï¼Œçœ‹çœ‹å®ƒå¤–è¡¨æ–¯æ–‡è€Œå†…è—å…«å—è…¹è‚Œçš„èº«å½¢ï¼Œå°±çŸ¥é“å®ƒæ˜¯ä¸å¥½æƒ¹çš„ã€‚å®ä¸­æœ‰å®ï¼Œä½œä¸º GNU C é«˜ç«¯æ‰©å±•ç‰¹æ€§çš„ç»¼åˆè¿ç”¨ï¼Œé‚£ä¹ˆå®ƒæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ï¼šæ ¹æ®ç»“æ„ä½“æŸä¸€æˆå‘˜çš„åœ°å€ï¼Œè·å–è¿™ä¸ªç»“æ„ä½“çš„é¦–åœ°å€ã€‚ æ ¹æ®å®å®šä¹‰ï¼Œå¯çŸ¥è¿™ä¸ªå®æœ‰ä¸‰ä¸ªå‚æ•°ï¼š ptrï¼šç»“æ„ä½“å†…æˆå‘˜ member çš„åœ°å€ typeï¼šç»“æ„ä½“ç±»å‹ memberï¼šç»“æ„ä½“å†…çš„æˆå‘˜ ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬çŸ¥é“äº†ä¸€ä¸ªç»“æ„ä½“çš„ç±»å‹ï¼Œç»“æ„ä½“å†…æŸä¸€æˆå‘˜çš„åœ°å€ï¼Œä¹Ÿå°±å¯ä»¥ç›´æ¥è·å¾—åˆ°è¿™ä¸ªç»“æ„ä½“çš„é¦–åœ°å€ã€‚container_of å®è¿”å›çš„å°±æ˜¯è¿™ä¸ªç»“æ„ä½“çš„é¦–åœ°å€ã€‚ äºŒã€container_of å®çš„ä½¿ç”¨ç¤ºä¾‹è¿™ä¸ªå®åœ¨å†…æ ¸ä¸­éå¸¸é‡è¦ã€‚åœ¨å†…æ ¸ä¸­ä¼šç»å¸¸æœ‰è¿™æ ·çš„éœ€æ±‚ï¼šæˆ‘ä»¬ä¼ é€’ç»™æŸä¸ªå‡½æ•°çš„å‚æ•°æ˜¯æŸä¸ªç»“æ„ä½“çš„æˆå‘˜å˜é‡ï¼Œç„¶ååœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œå¯èƒ½è¿˜ä¼šç”¨åˆ°æ­¤ç»“æ„ä½“çš„å…¶å®ƒæˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ container_of å…ˆé€šè¿‡ç»“æ„ä½“æŸä¸€æˆå‘˜çš„è®¿é—®æ‰¾åˆ°è¿™ä¸ªç»“æ„ä½“çš„é¦–åœ°å€ï¼Œç„¶åå°±å¯ä»¥è®¿é—®å…¶å®ƒæˆå‘˜å˜é‡äº†ã€‚ 12345678910111213141516171819struct _box_t&#123; double length; // ç›’å­çš„é•¿åº¦ double breadth; // ç›’å­çš„å®½åº¦ double height; // ç›’å­çš„é«˜åº¦&#125;; int main(void)&#123; struct _box_t box = &#123;30.0, 20.0, 10.0&#125;; struct _box_t *p_box = NULL; p_box = container_of(&amp;box.height, struct _box_t, height); printf(&quot;%p &quot;, p_box); printf(&quot;length: %f &quot;, p_box-&gt;length); printf(&quot;breadth: %f &quot;, p_box-&gt;breadth); return 0;&#125; åœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»“æ„ä½“å˜é‡ boxï¼ŒçŸ¥é“äº†å®ƒçš„æˆå‘˜å˜é‡ height çš„åœ°å€ &amp;box.heightï¼Œå°±å¯ä»¥é€šè¿‡ container_of å®ç›´æ¥è·å¾— box ç»“æ„ä½“å˜é‡çš„é¦–åœ°å€ï¼Œç„¶åç›´æ¥è®¿é—® box ç»“æ„ä½“çš„å…¶å®ƒæˆå‘˜ p_box-&gt;length å’Œ p_box-&gt;breadthã€‚ ä¸‰ã€container_of å®å®ç°åŸç†åˆ†æcontainer_of å®çš„å®ç°ä¸»è¦ç”¨åˆ°çš„çŸ¥è¯†ä¸ºï¼šè¯­å¥è¡¨è¾¾å¼å’Œ typeofï¼Œå†åŠ ä¸Šç»“æ„ä½“å­˜å‚¨çš„åŸºç¡€çŸ¥è¯†ã€‚ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£è¿™ä¸ªå®ï¼Œæˆ‘ä»¬å…ˆå¤ä¹ ä¸‹ç»“æ„ä½“å­˜å‚¨çš„åŸºç¡€çŸ¥è¯†ã€‚ 3.1 ç»“æ„ä½“åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æˆ‘ä»¬çŸ¥é“ï¼Œç»“æ„ä½“ä½œä¸ºä¸€ä¸ªå¤åˆç±»å‹æ•°æ®ï¼Œå®ƒé‡Œé¢å¯ä»¥æœ‰å¤šä¸ªæˆå‘˜ã€‚å½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»“æ„ä½“å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨è¦ç»™è¿™ä¸ªå˜é‡åœ¨å†…å­˜ä¸­åˆ†é…å­˜å‚¨ç©ºé—´ã€‚é™¤äº†è€ƒè™‘æ•°æ®ç±»å‹ã€å­—èŠ‚å¯¹é½ç­‰å› ç´ ä¹‹å¤–ï¼Œç¼–è¯‘å™¨ä¼šæŒ‰ç…§ç»“æ„ä½“ä¸­å„ä¸ªæˆå‘˜çš„é¡ºåºï¼Œåœ¨å†…å­˜ä¸­åˆ†é…ä¸€ç‰‡è¿ç»­çš„ç©ºé—´æ¥å­˜å‚¨å®ƒä»¬ã€‚ 1234567891011121314151617struct _box_t&#123; double length; // ç›’å­çš„é•¿åº¦ double breadth; // ç›’å­çš„å®½åº¦ double height; // ç›’å­çš„é«˜åº¦&#125;; int main(void)&#123; struct _box_t box = &#123;30.0, 20.0, 10.0&#125;; printf(&quot;&amp;box = %p &quot;, &amp;box); printf(&quot;&amp;box.length = %p &quot;, &amp;box.length); printf(&quot;&amp;box.breadth = %p &quot;, &amp;box.breadth); printf(&quot;&amp;box.height = %p &quot;, &amp;box.height); return 0;&#125; åœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œé‡Œé¢æœ‰ä¸‰ä¸ª double å‹æ•°æ®æˆå‘˜ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œç„¶ååˆ†åˆ«æ‰“å°ç»“æ„ä½“çš„åœ°å€ã€å„ä¸ªæˆå‘˜å˜é‡çš„åœ°å€ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š 1234&amp;box = 2b6c3dd0&amp;box.length = 2b6c3dd0&amp;box.breadth = 2b6c3dd8&amp;box.height = 2b6c3de0 ä»è¿è¡Œç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»“æ„ä½“ä¸­çš„æ¯ä¸ªæˆå‘˜å˜é‡ï¼Œä»ç»“æ„ä½“é¦–åœ°å€å¼€å§‹ï¼Œä¾æ¬¡å­˜æ”¾ã€‚æ¯ä¸ªæˆå‘˜å˜é‡ç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€ï¼Œéƒ½æœ‰ä¸€ä¸ªå›ºå®šåç§»ã€‚æ¯”å¦‚ breadth ç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€åç§»äº†8ä¸ªå­—èŠ‚ã€‚height çš„å­˜å‚¨åœ°å€ï¼Œç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€åç§»äº†16ä¸ªå­—èŠ‚ã€‚ 3.2 è®¡ç®—æˆå‘˜å˜é‡åœ¨ç»“æ„ä½“å†…çš„åç§»ä¸€ä¸ªç»“æ„ä½“æ•°æ®ç±»å‹ï¼Œåœ¨åŒä¸€ä¸ªç¼–è¯‘ç¯å¢ƒä¸‹ï¼Œå„ä¸ªæˆå‘˜ç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€çš„åç§»æ˜¯å›ºå®šçš„ã€‚æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„ç¨‹åºï¼Œå½“ç»“æ„ä½“çš„é¦–åœ°å€ä¸º 0 æ—¶ï¼Œç»“æ„ä½“ä¸­çš„å„æˆå‘˜åœ°å€åœ¨æ•°å€¼ä¸Šç­‰äºç»“æ„ä½“å„æˆå‘˜ç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€çš„åç§»ã€‚ 123456789101112131415struct _box_t&#123; double length; // ç›’å­çš„é•¿åº¦ double breadth; // ç›’å­çš„å®½åº¦ double height; // ç›’å­çš„é«˜åº¦&#125;; int main(void)&#123; printf(&quot;&amp;length = %p &quot;, &amp;((struct _box_t*)0)-&gt;length); printf(&quot;&amp;breadth = %p &quot;, &amp;((struct _box_t*)0)-&gt;breadth); printf(&quot;&amp;height = %p &quot;, &amp;((struct _box_t*)0)-&gt;height); return 0;&#125; åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ç›´æ¥å®šä¹‰ç»“æ„ä½“å˜é‡ï¼Œè€Œæ˜¯å°†æ•°å­— 0 é€šè¿‡å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè½¬æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“ç±»å‹ä¸º _box_t çš„å¸¸é‡æŒ‡é’ˆï¼Œç„¶ååˆ†åˆ«æ‰“å°è¿™ä¸ªå¸¸é‡æŒ‡é’ˆæŒ‡å‘çš„ç»“æ„ä½“çš„å„æˆå‘˜åœ°å€ã€‚è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 123&amp;length = ox0&amp;breadth = 0x8&amp;height = 0x10 å› ä¸ºå¸¸é‡æŒ‡é’ˆä¸º 0ï¼Œå³å¯ä»¥çœ‹åšç»“æ„ä½“é¦–åœ°å€ä¸º 0ï¼Œæ‰€ä»¥ç»“æ„ä½“ä¸­æ¯ä¸ªæˆå‘˜å˜é‡çš„åœ°å€å³ä¸ºè¯¥æˆå‘˜ç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€çš„åç§»ã€‚container_of å®çš„å®ç°å°±æ˜¯ä½¿ç”¨è¿™ä¸ªæŠ€å·§æ¥å®ç°çš„ã€‚ 3.3 container_of å®çš„åŸç†å®ç°container_of å®æ•´ä½“çš„å®ç°åŸç†å¦‚å›¾æ‰€ç¤ºï¼š ä»è¯­æ³•è§’åº¦æ¥çœ‹ï¼Œcontainer_of å®çš„å®ç°ç”±ä¸€ä¸ªè¯­å¥è¡¨è¾¾å¼æ„æˆï¼š 1234#define offsetof(TYPE, MEMBER) ((size_t) &amp;((TYPE *)0)-&gt;MEMBER)#define container_of(ptr, type, member) (&#123; \\ const typeof( ((type *)0)-&gt;member ) *__mptr = (ptr); \\ (type *)( (char *)__mptr - offsetof(type,member) );&#125;) è¯­å¥è¡¨è¾¾å¼çš„å€¼å³ä¸ºæœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼š 1(type *)( (char *)__mptr - offsetof(type,member) ); ä»¥ä¸Šè¿™ä¸ªè¯­å¥çš„æ„ä¹‰å°±æ˜¯ï¼Œæ‹¿ç»“æ„ä½“æŸä¸ªæˆå‘˜ member çš„åœ°å€ï¼Œå‡å»è¿™ä¸ªæˆå‘˜åœ¨ç»“æ„ä½“ type ä¸­çš„åç§»ï¼Œç»“æœå°±æ˜¯ç»“æ„ä½“ type çš„é¦–åœ°å€ã€‚å› ä¸ºè¯­å¥è¡¨è¾¾å¼çš„å€¼ç­‰äºæœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œæ‰€ä»¥è¿™ä¸ªç»“æœä¹Ÿæ˜¯æ•´ä¸ªè¯­å¥è¡¨è¾¾å¼çš„å€¼ï¼Œcontainer_of æœ€åå°±ä¼šè¿”å›è¿™ä¸ªåœ°å€å€¼ç»™å®çš„è°ƒç”¨è€…ã€‚ å†…æ ¸ä¸­å®šä¹‰äº† offset å®æ¥è®¡ç®—ç»“æ„ä½“æŸä¸ªæˆå‘˜åœ¨ç»“æ„ä½“å†…çš„åç§»ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š 1#define offsetof(TYPE, MEMBER) ((size_t) &amp;((TYPE *)0)-&gt;MEMBER) è¿™ä¸ªå®æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ç»“æ„ä½“ç±»å‹ TYPEï¼Œä¸€ä¸ªæ˜¯ç»“æ„ä½“çš„æˆå‘˜ MEMBERï¼Œå®ƒä½¿ç”¨çš„æŠ€å·§è·Ÿæˆ‘ä»¬ä¸Šé¢è®¡ç®— 0 åœ°å€å¸¸é‡æŒ‡é’ˆçš„åç§»æ˜¯ä¸€æ ·çš„ï¼šå°† 0 å¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ TYPE çš„ç»“æ„ä½“å¸¸é‡æŒ‡é’ˆï¼Œç„¶åé€šè¿‡è¿™ä¸ªå¸¸é‡æŒ‡é’ˆè®¿é—®æˆå‘˜ï¼Œè·å–æˆå‘˜ MEMBER çš„åœ°å€ï¼Œå…¶å¤§å°åœ¨æ•°å€¼ä¸Šå°±ç­‰äº MEMBER åœ¨ç»“æ„ä½“ TYPE ä¸­çš„åç§»ã€‚ å› ä¸ºç»“æ„ä½“çš„æˆå‘˜æ•°æ®ç±»å‹å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥ä¸ºäº†è®©è¿™ä¸ªå®å…¼å®¹å„ç§æ•°æ®ç±»å‹ã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªä¸´æ—¶æŒ‡é’ˆå˜é‡ __mptr ï¼Œè¯¥å˜é‡ç”¨æ¥å­˜å‚¨ç»“æ„ä½“æˆå‘˜ MEMBER çš„åœ°å€ï¼Œå³å­˜å‚¨ ptr çš„å€¼ã€‚é‚£ä¹ˆå¦‚ä½•è·å– ptr æŒ‡é’ˆç±»å‹å‘¢ï¼Ÿé€šè¿‡ä¸‹é¢çš„æ–¹å¼ï¼š 1typeof( ((type *)0)-&gt;member ) *__mptr = (ptr); ä»¥ä¸Šå®çš„å‚æ•° ptr ä»£è¡¨çš„æ˜¯ä¸€ä¸ªç»“æ„ä½“æˆå‘˜å˜é‡ MEMBER çš„åœ°å€ï¼Œæ‰€ä»¥ ptr çš„ç±»å‹æ˜¯ä¸€ä¸ªæŒ‡å‘ MEMBER æ•°æ®ç±»å‹çš„æŒ‡é’ˆã€‚ä¸ºäº†ç¡®ä¿ä¸´æ—¶å˜é‡ __mptr çš„æŒ‡é’ˆç±»å‹ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡å‘ MEMBER ç±»å‹çš„æŒ‡é’ˆå˜é‡ï¼Œé€šè¿‡ typeof( ((type *)0)-&gt;member ) è¡¨è¾¾å¼ï¼Œä½¿ç”¨ typeof å…³é”®å­—æ¥è·å–ç»“æ„ä½“æˆå‘˜ member çš„æ•°æ®ç±»å‹ï¼Œç„¶åä½¿ç”¨ typeof( ((type *)0)-&gt;member ) *__mptr å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªæŒ‡å‘è¯¥ç±»å‹çš„æŒ‡é’ˆå˜é‡äº†ã€‚ æ³¨æ„ï¼šåœ¨è¯­å¥è¡¨è¾¾å¼çš„æœ€åï¼Œå› ä¸ºè¿”å›çš„æ˜¯ç»“æ„ä½“çš„é¦–åœ°å€ï¼Œæ‰€ä»¥æ•°æ®ç±»å‹è¿˜å¿…é¡»å¼ºåˆ¶è½¬æ¢ä¸º TYPE *ï¼Œå³è¿”å›ä¸€ä¸ªæŒ‡å‘ TYPE ç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥ä½ ä¼šåœ¨æœ€åä¸€ä¸ªè¡¨è¾¾çš„offsetå®ä¸­çœ‹åˆ°ä¸€ä¸ªå¼ºåˆ¶ç±»å‹è½¬æ¢(TYPE *)ã€‚ å››ã€æ€»ç»“é€šè¿‡å¯¹ container_of å®çš„æ•´ä½“åˆ†æåï¼Œè¿™ä¸ªè¿‡ç¨‹åˆ°åº•å¯¹æˆ‘ä»¬æœ‰ä»€ä¹ˆå¯å‘å‘¢ï¼Ÿ å¯¹äºä»»ä½•ä¸€ä¸ªå¤æ‚çš„æŠ€æœ¯ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æŠŠå®ƒç”±ä¸Šè€Œä¸‹çš„é€æ­¥åˆ†è§£ï¼Œç„¶åè¿ç”¨æ‰€å­¦çš„åŸºç¡€çŸ¥è¯†ä¸€ç‚¹ä¸€ç‚¹å‰–æï¼šå…ˆè¿›è¡Œå°æ¨¡å—åˆ†æï¼Œç„¶åå†è¿›è¡Œç»¼åˆåˆ†æã€‚ æ¯”å¦‚ container_of å®çš„å®šä¹‰ï¼Œå°±è¿ç”¨äº†ç»“æ„ä½“çš„å­˜å‚¨ã€è¯­å¥è¡¨è¾¾å¼ã€typeof ç­‰çŸ¥è¯†ç‚¹ã€‚ å½“æˆ‘ä»¬æŒæ¡äº†è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œå¹¶ä¸”æœ‰äº†åˆ†ææ–¹æ³•ï¼Œä»¥ååœ¨å†…æ ¸ä¸­å†é‡åˆ°è¿™æ ·ç±»ä¼¼çš„å®ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªä¿¡ä»å®¹åœ°å»è‡ªå·±åˆ†æï¼Œè€Œä¸å¿…æ€»æ˜¯ä¾èµ–ç½‘ä¸Šå¤§æµ·æé’ˆå¼çš„æœç´¢äº†ã€‚ è¿™å°±æ˜¯ä½ çš„æ ¸å¿ƒç«äº‰åŠ›ï¼Œä¹Ÿæ˜¯ä½ è¶…è¶Šå…¶ä»–å·¥ç¨‹å¸ˆã€è„±é¢–è€Œå‡ºçš„æœºä¼šã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/m0_37383484/article/details/129244244","tags":["kernel"],"categories":["kernel"]},{"title":"mmap","path":"/posts/mmap.html","content":"mmap å³ memory mapï¼Œä¹Ÿå°±æ˜¯å†…å­˜æ˜ å°„ã€‚mmap æ˜¯ä¸€ç§å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ–¹æ³•ï¼Œå³å°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å…¶å®ƒå¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå®ç°æ–‡ä»¶ç£ç›˜åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸€æ®µè™šæ‹Ÿåœ°å€çš„ä¸€ä¸€å¯¹æ˜ å…³ç³»ã€‚å®ç°è¿™æ ·çš„æ˜ å°„å…³ç³»åï¼Œè¿›ç¨‹å°±å¯ä»¥é‡‡ç”¨æŒ‡é’ˆçš„æ–¹å¼è¯»å†™æ“ä½œè¿™ä¸€æ®µå†…å­˜ï¼Œè€Œç³»ç»Ÿä¼šè‡ªåŠ¨å›å†™è„é¡µé¢åˆ°å¯¹åº”çš„æ–‡ä»¶ç£ç›˜ä¸Šï¼Œå³å®Œæˆäº†å¯¹æ–‡ä»¶çš„æ“ä½œè€Œä¸å¿…å†è°ƒç”¨ readã€write ç­‰ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚ç›¸åï¼Œå†…æ ¸ç©ºé—´å¯¹è¿™æ®µåŒºåŸŸçš„ä¿®æ”¹ä¹Ÿç›´æ¥åæ˜ ç”¨æˆ·ç©ºé—´ï¼Œä»è€Œå¯ä»¥å®ç°ä¸åŒè¿›ç¨‹é—´çš„æ–‡ä»¶å…±äº«ã€‚ mmapåŸå‹ 12#include &lt;sys/mman.h&gt;void *mmap(void *start, size_t length, int prot, int flags, int fd, off_t offset) &#x3D;&#x3D;å¿…é¡»æ³¨æ„è¿™é‡Œçš„æ˜ å°„é•¿åº¦lengthå¿…é¡»æ˜¯4Kæ•´æ•°å€&#x3D;&#x3D; 123456789101112131415161718192021222324252627282930313233343536373839#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;sys/mman.h&gt;#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt; int main() &#123; int my_data; int fd = open(&quot;/dev/mem&quot;, O_RDWR | O_SYNC); if (fd &lt; 0) &#123; perror(&quot;open&quot;); return 1; &#125; unsigned long addr = 0x80000000; // å‡è®¾æˆ‘ä»¬è¦è®¿é—®çš„ç‰©ç†åœ°å€ unsigned long map_length = 0x1000; // æ˜ å°„çš„é•¿åº¦ä¸º4KB // æ˜ å°„å†…å­˜ void *ptr = mmap(NULL, map_length, PROT_READ | PROT_WRITE, MAP_SHARED, fd, addr &amp; ~(getpagesize() - 1)); // è·å–é¡µé¢å¯¹é½åŸºåœ°å€ï¼Œå¿…é¡»ä»¥4Kå¯¹é½ if (ptr == MAP_FAILED) &#123; perror(&quot;mmap&quot;); close(fd); return 1; &#125; my_data = *(int *)(ptr + addr &amp; (getpagesize() - 1)); // è§£é™¤å†…å­˜æ˜ å°„ if (munmap(ptr, map_length) &lt; 0) &#123; perror(&quot;munmap&quot;); close(fd); return 1; &#125; // å…³é—­æ–‡ä»¶æè¿°ç¬¦ close(fd); return 0;&#125;","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"gtest","path":"/posts/gtest.html","content":"ä¸€ã€æ„å»ºgtestæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åï¼Œå°±ä¼šåœ¨ç³»ç»Ÿç›®å½•ä¸‹ç”Ÿæˆå¯¹åº”çš„å¤´æ–‡ä»¶å’Œé™æ€åº“ï¼Œå¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­å¼•ç”¨äº†ã€‚ 1234567git clone git@github.com:google/googletest.git cd googletestmkdir buildcd buildcmake .. makesudo make install ä¸€ä¸ªå°ä¾‹å­ mySrc.h 1234#ifndef UNTITLED_MYSRC_H#define UNTITLED_MYSRC_Hint Foo(int a,int b);#endif //UNTITLED_MYSRC_H mySrc.cpp 12345int Foo(int a, int b) &#123; if (0 == a || 0 == b) throw &quot;don&#x27;t do that&quot;; int c = a % b; if (0 == c) &#123; return b; &#125; return Foo(b, c); &#125;` test.cpp 123456789101112`#include &quot;mySrc.h&quot;#include &quot;gtest/gtest.h&quot;TEST(FooTest, HandleNoneZeroInput) &#123; EXPECT_EQ(2, Foo(4, 10)); EXPECT_EQ(6, Foo(30, 18)); &#125; int main(int argc, char *argv[]) &#123; testing::InitGoogleTest(&amp;argc, argv); return RUN_ALL_TESTS(); &#125; CMakeLists.txt 1234567cmake_minimum_required(VERSION 3.20)project(untitled) set(CMAKE_CXX_STANDARD 11) include_directories(/usr/local/include) add_executable(untitled mySrc.cpp test.cpp) FIND_LIBRARY(gtest libgtest.a /usr/local/lib) target_link_libraries (untitled $&#123;gtest&#125;) è¾“å‡ºä¿¡æ¯ï¼š 1234567[==========] Running 1 test from 1 test suite. [----------] Global test environment set-up. [----------] 1 test from FooTest [ RUN ] FooTest.HandleNoneZeroInput[ OK ] FooTest.HandleNoneZeroInput (0 ms) [----------] 1 test from FooTest (0 ms total) [----------] Global test environment tear-down [==========] 1 test from 1 test suite ran. (0 ms total) [ PASSED ] 1 test. ä¸Šé¢çš„æ˜¯é€šè¿‡äº‹å…ˆç¼–è¯‘å¥½gtestçš„æ–¹å¼è¿›è¡Œä½¿ç”¨ï¼Œå…¶å®ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®çš„ç›®å½•ä¸‹ï¼Œç›´æ¥æŠŠgoogletestæ”¾è¿›å»çš„æ–¹å¼è¿›è¡Œä½¿ç”¨ äºŒã€assertionåœ¨gtestä¸­ï¼Œæ˜¯é€šè¿‡æ–­è¨€ï¼ˆassertionï¼‰æ¥åˆ¤æ–­ä»£ç å®ç°çš„åŠŸèƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚æ–­è¨€çš„ç»“æœåˆ†ä¸ºsuccessã€non-fatal failtureå’Œfatal failtureã€‚ æ ¹æ®æ–­è¨€å¤±è´¥çš„ç§ç±»ï¼Œgtestæä¾›äº†ä¸¤ç§æ–­è¨€å‡½æ•°ï¼š successï¼šå³æ–­è¨€æˆåŠŸï¼Œç¨‹åºçš„è¡Œä¸ºç¬¦åˆé¢„æœŸï¼Œç¨‹åºç»§ç»­å‘ä¸‹å…è®¸ã€‚ non-fatal failureï¼šå³æ–­è¨€å¤±è´¥ï¼Œä½†æ˜¯ç¨‹åºæ²¡æœ‰ç›´æ¥crashï¼Œè€Œæ˜¯ç»§ç»­å‘ä¸‹è¿è¡Œã€‚ gtestæä¾›äº†å®å‡½æ•°EXPECT_XXX(expected, actual)ï¼šå¦‚æœcondition(expected, actual)è¿”å›falseï¼Œåˆ™EXPECT_XXXäº§ç”Ÿçš„å°±æ˜¯non-fatal failureé”™è¯¯ï¼Œå¹¶æ˜¾ç¤ºç›¸å…³é”™è¯¯ã€‚ fatal failureï¼šæ–­è¨€å¤±è´¥ï¼Œç¨‹åºç›´æ¥crashï¼Œåç»­çš„æµ‹è¯•æ¡ˆä¾‹ä¸ä¼šè¢«è¿è¡Œã€‚ gtestæä¾›äº†å®å‡½æ•°ASSERT_XXX(expected, actual)ã€‚ åœ¨å†™å•å…ƒæµ‹è¯•æ—¶ï¼Œæ›´åŠ å€¾å‘äºä½¿ç”¨EXPECT_XXXï¼Œå› ä¸ºASSERT_XXXæ˜¯ç›´æ¥crashé€€å‡ºçš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›å†…å­˜ã€æ–‡ä»¶èµ„æºæ²¡æœ‰é‡Šæ”¾ï¼Œå› æ­¤å¯èƒ½ä¼šå¼•å…¥ä¸€äº›bugã€‚ å…·ä½“çš„EXPECT_XXXã€ASSERT_XXXå‡½æ•°åŠå…¶åˆ¤æ–­æ¡ä»¶ï¼Œå¦‚ä¸‹ä¸¤ä¸ªè¡¨ã€‚ è¡¨1 ä¸€å…ƒæ¯”è¾ƒ ASSERT EXPECT Verifies ASSERT_TRUE(condition); EXPECT_TRUE(condition); condition is true ASSERT_FALSE(condition) EXPECT_FALSE(condition) condition is false è¡¨2 äºŒå…ƒæ¯”è¾ƒ ASSERT EXPECT Condition ASSERT_EQ(val1, val2); EXPECT_EQ(val1, val2); val1 &#x3D;&#x3D; val2 ASSERT_NE(val1, val2); EXPECT_NE(val1, val2); val1 !&#x3D; val2 ASSERT_LT(val1, val2); EXPECT_LT(val1, val2); val1 &lt; val2 ASSERT_LE(val1, val2); EXPECT_LE(val1, val2); val1 &lt;&#x3D; val2 ASSERT_GT(val1, val2); EXPECT_GT(val1, val2); val1 &gt; val2 ASSERT_GE(val1, val2); EXPECT_GE(val1, val2); val1 &gt;&#x3D; val2 ä¸‰ã€Quick Startä¸‹é¢ä»¥EXPECT_XXXä¸ºä¾‹å­ï¼Œå¿«é€Ÿå¼€å§‹ä½¿ç”¨gtestå§ã€‚ å¯¹äºEXPECT_XXXï¼Œæ— è®ºæ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œéƒ½ä¼šç»§ç»­å‘ä¸‹è¿è¡Œï¼Œä½†æ˜¯å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œåœ¨æŠ¥é”™çš„åœ°æ–¹ä¼šæ˜¾ç¤ºï¼š æ²¡æœ‰é€šè¿‡çš„é‚£ä¸ªEXPECT_XXXå‡½æ•°ä½ç½®ï¼› EXPECT_XXXç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ï¼Œå³æœŸå¾…å€¼ EXPECT_XXXç¬¬äºŒä¸ªå‚æ•°çš„å€¼ï¼Œå³å®é™…å€¼ å¦‚ä¸‹demoï¼š 12345678910// in gtest_demo_1.cc#include &lt;gtest/gtest.h&gt;int add(int lhs, int rhs) &#123; return lhs + rhs; &#125; int main(int argc, char const *argv[]) &#123; EXPECT_EQ(add(1,1), 2); // PASS EXPECT_EQ(add(1,1), 1) &lt;&lt; &quot;FAILED: EXPECT: 2, but given 1&quot;;; // FAILDED return 0; &#125; ç¼–è¯‘æ‰§è¡Œåè¾“å‡ºå¦‚ä¸‹ï¼š 1234567`$ ./gtest_demo_1 /Users/self_study/Cpp/OpenSource/demo/gtest_demo_1.cc:9: Failure Expected equality of these values: add(1,1) Which is: 2 # æœŸå¾…çš„å€¼ 1 # ç»™å®šçš„å€¼FAILED: EXPECT: 2, but given 1 # è‡ªå·±æ·»åŠ çš„æç¤ºä¿¡æ¯ å¯èƒ½ä½ æ³¨æ„åˆ°äº†ï¼Œåœ¨EXPECT_EQ(add(1,1), 1)åæœ‰ä¸ª&lt;&lt;ï¼Œè¿™æ˜¯å› ä¸ºgtestå…è®¸æ·»åŠ è‡ªå®šä¹‰çš„æè¿°ä¿¡æ¯ï¼Œå½“è¿™ä¸ªè¯­å¥æµ‹è¯•æœªé€šè¿‡æ—¶å°±ä¼šæ˜¾ç¤ºï¼Œæ¯”å¦‚ä¸Šé¢çš„â€FAILED: EXPECT: 2, but given 1â€ã€‚ è¿™ä¸ª&lt;&lt;å’Œstd::ostreamæ¥å—çš„ç±»å‹ä¸€è‡´ï¼Œå³å¯ä»¥æ¥å—std::ostreamå¯ä»¥æ¥å—çš„ç±»å‹ã€‚ å››ã€TESTä¸‹é¢ä»¥googletest&#x2F;samplesä¸­çš„sample1_unittest.ccä¸­çš„demoä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•æ›´å¥½åœ°ç»„ç»‡æµ‹è¯•æ¡ˆä¾‹ã€‚ ä¸€ä¸ªç®€å•è®¡ç®—é˜¶ä¹˜å‡½æ•°Factorialå®ç°å¦‚ä¸‹ï¼š 1234567int Factorial(int n) &#123; int result = 1; for (int i = 1; i &lt;= n; i++) &#123; result *= i; &#125; return result; &#125; æ€ä¹ˆä½¿ç”¨gtestæ¥æµ‹è¯•è¿™ä¸ªå‡½æ•°çš„è¡Œä¸ºï¼Ÿ æŒ‰ç…§ä¸Šé¢çš„quick startå¯çŸ¥ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨EXPECT_EQå®æ¥åˆ¤æ–­ï¼š 123EXPECT_EQ(1, Factorial(-5)); // æµ‹è¯•è®¡ç®—è´Ÿæ•°çš„é˜¶ä¹˜ EXPECT_EQ(1, Factorial(0)); // æµ‹è¯•è®¡ç®—0çš„é˜¶ä¹˜ EXPECT_EQ(6, Factorial(3)); // æµ‹è¯•è®¡ç®—æ­£æ•°çš„é˜¶ä¹˜ ä½†æ˜¯å½“æµ‹è¯•æ¡ˆä¾‹è§„æ¨¡å˜å¤§ï¼Œä¸å¥½ç»„ç»‡ã€‚ å› æ­¤ï¼Œä¸ºäº†æ›´å¥½çš„ç»„ç»‡test casesï¼Œæ¯”å¦‚é’ˆå¯¹Factorialå‡½æ•°ï¼Œè¾“å…¥æ˜¯è´Ÿæ•°çš„casesä¸ºä¸€ç»„ï¼Œè¾“å…¥æ˜¯0çš„caseä¸ºä¸€ç»„ï¼Œæ­£æ•°casesä¸ºä¸€ç»„ã€‚gtestæä¾›äº†ä¸€ä¸ªå®TEST(TestSuiteName, TestName)ï¼Œç”¨äºç»„ç»‡ä¸åŒåœºæ™¯çš„casesï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨gtestä¸­ç§°ä¸ºtest suiteã€‚ ç”¨æ³•å¦‚ä¸‹ï¼š 12345678910111213141516// ä¸‹é¢ä¸‰ä¸ª TEST éƒ½æ˜¯å±äºåŒä¸€ä¸ª test suiteï¼Œå³ FactorialTest// æ­£æ•°ä¸ºä¸€ç»„TEST(FactorialTest, Negative) &#123; EXPECT_EQ(1, Factorial(-5)); EXPECT_EQ(1, Factorial(-1)); EXPECT_GT(Factorial(-10), 0); &#125; // 0TEST(FactorialTest, Zero) &#123; EXPECT_EQ(1, Factorial(0)); &#125; // è´Ÿæ•°ä¸ºä¸€ç»„TEST(FactorialTest, Positive) &#123; EXPECT_EQ(1, Factorial(1)); EXPECT_EQ(2, Factorial(2)); EXPECT_EQ(6, Factorial(3)); EXPECT_EQ(40320, Factorial(8)); &#125; é—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆè¿è¡Œè¿™äº›TESTï¼Ÿ åœ¨sample1_unittest.ccçš„mainå‡½æ•°ä¸­ï¼Œæ·»åŠ RUN_ALL_TESTSå‡½æ•°å³å¯ã€‚ 12345int main(int argc, char **argv) &#123; printf(&quot;Running main() from %s &quot;, __FILE__); testing::InitGoogleTest(&amp;argc, argv); return RUN_ALL_TESTS(); &#125; åœ¨build&#x2F;binè·¯å¾„ä¸‹ï¼Œæ‰§è¡Œå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š 12345678$./sample1_unittest Running main() from /Users/self_study/Cpp/OpenSource/demo/include/googletest/googletest/samples/sample1_unittest.cc [==========] Running 6 tests from 2 test suites. # åœ¨ sample1_unittest.cc ä¸­æœ‰ä¸¤ä¸ª test suites [----------] Global test environment set-up. # ç¬¬ä¸€ä¸ª test suiteï¼Œå³ä¸Šé¢çš„ FactorialTest [----------] 3 tests from FactorialTest # 3 ç»„ [ RUN ] FactorialTest.Negative # Negative ç»„è¾“å‡º [ OK ] FactorialTest.Negative (0 ms) # OK è¡¨ç¤º Negative ç»„å…¨éƒ¨æµ‹è¯•é€šè¿‡ [ RUN ] FactorialTest.Zero # Zeroç»„è¾“å‡º [ OK ] FactorialTest.Zero (0 ms) [ RUN ] FactorialTest.Positive # Positiveç»„è¾“å‡º [ OK ] FactorialTest.Positive (0 ms) [----------] 3 tests from FactorialTest (0 ms total) #sample1_unitest å¦ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹çš„è¾“å‡º ... [----------] Global test environment tear-down [==========] 6 tests from 2 test suites ran. (0 ms total) [ PASSED ] 6 tests. # å…¨éƒ¨æµ‹è¯•ç»“æœï¼šPASSè¡¨ç¤ºå…¨éƒ¨é€šè¿‡ ä¸‹é¢ç¨å¾®ä¿®æ”¹ä¸‹sample1_unittest.ccä¸­çš„ä»£ç ï¼Œæ¥äº§ç”Ÿä¸€ä¸ªé”™è¯¯ï¼š TEST(FactorialTest, Negative) &#123; EXPECT_EQ(10, Factorial(-5)); // æ­£ç¡®çš„åº”è¯¥æ˜¯ EXPECT_EQ(1, Factorial(-5)); // ... &#125; é‡æ–°ç¼–è¯‘ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š 12345$ ./sample1_unittest Running main() from /Users/self_study/Cpp/OpenSource/demo/include/googletest/googletest/samples/sample1_unittest.cc [==========] Running 6 tests from 2 test suites. [----------] Global test environment set-up. [----------] 3 tests from FactorialTest [ RUN ] FactorialTest.Negative # å¼€å§‹è¿è¡Œä¸Šé¢ä¿®æ”¹çš„é‚£ä¸ªç»„ /Users/self_study/Cpp/OpenSource/demo/include/googletest/googletest/samples/sample1_unittest.cc:79: Failure # æµ‹è¯•å¤±è´¥ï¼Œå¹¶æŒ‡å‡ºé”™è¯¯caseçš„ä½ç½® Expected equality of these values: # æœŸå¾…çš„å€¼ 10 Factorial(-5) # å®é™…è®¡ç®—å‡ºçš„å€¼ Which is: 1 [ FAILED ] FactorialTest.Negative (0 ms) # è¿™ç»„caseæµ‹è¯•çŠ¶æ€ï¼šFAILED [ RUN ] FactorialTest.Zero # ä¸‹é¢ç»§ç»­è¿è¡Œ [ OK ] FactorialTest.Zero (0 ms) [ RUN ] FactorialTest.Positive [ OK ] FactorialTest.Positive (0 ms) [----------] 3 tests from FactorialTest (0 ms total) # ... [----------] Global test environment tear-down [==========] 6 tests from 2 test suites ran. (0 ms total) [ PASSED ] 5 tests. [ FAILED ] 1 test, listed below: # 1ä¸ªtestå¤±è´¥ [ FAILED ] FactorialTest.Negative # å¤±è´¥çš„test suiteåŠå…¶ç»„ 1 FAILED TEST æ­¤å¤–ï¼Œåœ¨TESTå®å‡½æ•°ä¸­ï¼Œä¹Ÿå¯ä»¥åƒä¸ªæ™®é€šå‡½æ•°ä¸€æ ·ï¼Œå®šä¹‰å˜é‡ä¹‹ç±»çš„è¡Œä¸ºã€‚ æ¯”å¦‚åœ¨sample2_unittest.ccä¸­ï¼Œæµ‹è¯•ä¸€ä¸ªè‡ªå®šä¹‰ç±»MyStringçš„å¤åˆ¶æ„é€ å‡½æ•°æ˜¯å¦è¡¨ç°æ­£å¸¸ï¼š 12345const char kHelloString[] = &quot;Hello, world!&quot;; // åœ¨ TESTå†…éƒ¨ï¼Œå®šä¹‰å˜é‡TEST(MyString, CopyConstructor) &#123; const MyString s1(kHelloString); const MyString s2 = s1; EXPECT_EQ(0, strcmp(s2.c_string(), kHelloString)); &#125; ä¸ºè·å¾—è¿›ä¸€æ­¥å­¦ä¹ ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œè°ƒæ•´sample1_unittest.ccã€sample2_unittest.ccä¸­çš„TESTè¡Œä¸ºï¼ŒåŠ æ·±å¯¹gtestçš„TESTå®çš„ç†è§£ã€‚ äº”ã€TEST_Fä¸‹é¢ä»‹ç»gtestä¸­æ›´ä¸ºé«˜çº§çš„åŠŸèƒ½ï¼štest fixtureï¼Œå¯¹åº”çš„å®å‡½æ•°æ˜¯TEST_F(TestFixtureName, TestName)ã€‚ fixtureï¼Œå…¶è¯­ä¹‰æ˜¯å›ºå®šçš„è®¾æ–½ï¼Œè€Œtest fixtureåœ¨gtestä¸­çš„ä½œç”¨å°±æ˜¯ä¸ºæ¯ä¸ªTESTéƒ½æ‰§è¡Œä¸€äº›åŒæ ·çš„æ“ä½œã€‚ æ¯”å¦‚ï¼Œè¦æµ‹è¯•ä¸€ä¸ªé˜Ÿåˆ—Queueçš„å„ä¸ªæ¥å£åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œå› æ­¤å°±éœ€è¦å‘é˜Ÿåˆ—ä¸­æ·»åŠ å…ƒç´ ã€‚å¦‚æœä½¿ç”¨ä¸€ä¸ªTESTå‡½æ•°æµ‹è¯•Queueçš„ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæ¯æ¬¡æ‰§è¡ŒTESTæ—¶ï¼Œéƒ½éœ€è¦åœ¨TESTå®å‡½æ•°ä¸­å®šä¹‰ä¸€ä¸ªQueueå¯¹è±¡ï¼Œå¹¶å‘è¯¥å¯¹è±¡ä¸­æ·»åŠ å…ƒç´ ï¼Œå°±å¾ˆå†—ä½™ã€ç¹çã€‚ æ€ä¹ˆé¿å…è¿™éƒ¨åˆ†å†—ä½™çš„è¿‡ç¨‹ï¼Ÿ TEST_Få°±æ˜¯å®Œæˆè¿™æ ·çš„äº‹æƒ…ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°TestFixtureNameæ˜¯ä¸ªç±»ï¼Œéœ€è¦ç»§æ‰¿testing::Testï¼ŒåŒæ—¶æ ¹æ®éœ€è¦å®ç°ä»¥ä¸‹ä¸¤ä¸ªè™šå‡½æ•°ï¼š virtual void SetUp()ï¼šåœ¨TEST_Fä¸­æµ‹è¯•æ¡ˆä¾‹ä¹‹å‰è¿è¡Œï¼› virtual void TearDown()ï¼šåœ¨TEST_Fä¹‹åè¿è¡Œã€‚ å¯ä»¥ç±»æ¯”å¯¹è±¡çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ã€‚è¿™æ ·ï¼ŒåŒä¸€ä¸ªTestFixtureNameä¸‹çš„æ¯ä¸ªTEST_Féƒ½ä¼šå…ˆæ‰§è¡ŒSetUpï¼Œæœ€åæ‰§è¡ŒTearDwomã€‚ æ­¤å¤–ï¼Œtesting::Testè¿˜æä¾›äº†ä¸¤ä¸ªstaticå‡½æ•°ï¼š static void SetUpTestSuite()ï¼šåœ¨ç¬¬ä¸€ä¸ªTESTä¹‹å‰è¿è¡Œ static void TearDownTestSuite()ï¼šåœ¨æœ€åä¸€ä¸ªTESTä¹‹åè¿è¡Œ ä»¥sample3-inlä¸­å®ç°çš„class Queueä¸ºä¾‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839class QueueTestSmpl3 : public testing::Test &#123; // ç»§æ‰¿äº† testing::Test protected: static void SetUpTestSuite() &#123; std::cout&lt;&lt;&quot;run before first case...&quot;&lt;&lt;std::endl; &#125; static void TearDownTestSuite() &#123; std::cout&lt;&lt;&quot;run after last case...&quot;&lt;&lt;std::endl; &#125; virtual void SetUp() override &#123; std::cout&lt;&lt;&quot;enter into SetUp()&quot; &lt;&lt;std::endl; q1_.Enqueue(1); q2_.Enqueue(2); q2_.Enqueue(3); &#125; virtual void TearDown() override &#123; std::cout&lt;&lt;&quot;exit from TearDown&quot; &lt;&lt;std::endl; &#125; static int Double(int n) &#123; return 2*n; &#125; void MapTester(const Queue&lt;int&gt; * q) &#123; const Queue&lt;int&gt; * const new_q = q-&gt;Map(Double); ASSERT_EQ(q-&gt;Size(), new_q-&gt;Size()); for (const QueueNode&lt;int&gt;*n1 = q-&gt;Head(), *n2 = new_q-&gt;Head(); n1 != nullptr; n1 = n1-&gt;next(), n2 = n2-&gt;next()) &#123; EXPECT_EQ(2 * n1-&gt;element(), n2-&gt;element()); &#125; delete new_q; &#125; Queue&lt;int&gt; q0_; Queue&lt;int&gt; q1_; Queue&lt;int&gt; q2_; &#125;; ä¸‹é¢æ˜¯sample3_unittest.ccä¸­çš„TEST_Fï¼š 12345678910111213141516171819202122232425262728// in sample3_unittest.cc// Tests the default c&#x27;tor.TEST_F(QueueTestSmpl3, DefaultConstructor) &#123; // !!! åœ¨ TEST_F ä¸­å¯ä»¥ä½¿ç”¨ QueueTestSmpl3 çš„æˆå‘˜å˜é‡ã€æˆå‘˜å‡½æ•° EXPECT_EQ(0u, q0_.Size()); &#125; // Tests Dequeue().TEST_F(QueueTestSmpl3, Dequeue) &#123; int * n = q0_.Dequeue(); EXPECT_TRUE(n == nullptr); n = q1_.Dequeue(); ASSERT_TRUE(n != nullptr); EXPECT_EQ(1, *n); EXPECT_EQ(0u, q1_.Size()); delete n; n = q2_.Dequeue(); ASSERT_TRUE(n != nullptr); EXPECT_EQ(2, *n); EXPECT_EQ(1u, q2_.Size()); delete n; &#125; // Tests the Queue::Map() function.TEST_F(QueueTestSmpl3, Map) &#123; MapTester(&amp;q0_); MapTester(&amp;q1_); MapTester(&amp;q2_); &#125; ä»¥TEST_F(QueueTestSmpl3, DefaultConstructor)ä¸ºä¾‹ï¼Œå†å…·ä½“è®²è§£ä¸‹TEST_Fçš„è¿è¡Œæµç¨‹ï¼š gtestæ„é€ ä¸€ä¸ªQueueTestSmpl3å¯¹è±¡t1ï¼› t1.setUpåˆå§‹åŒ–t1 ç¬¬ä¸€ä¸ªTEST_Få³DefaultConstructorå¼€å§‹è¿è¡Œå¹¶ç»“æŸ t1.TearDwonè¿è¡Œï¼Œç”¨äºæ¸…ç†å·¥ä½œ t1è¢«ææ„ å› æ­¤ï¼Œsample3_unittest.ccè¾“å‡ºå¦‚ä¸‹ï¼š 123456789% ./sample3_unittest Running main() from /Users/self_study/Cpp/OpenSource/demo/include/googletest/googletest/samples/sample3_unittest.cc [==========] Running 3 tests from 1 test suite. [----------] Global test environment set-up. [----------] 3 tests from QueueTestSmpl3 run before first case... # æ‰€æœ‰çš„test case ä¹‹å‰è¿è¡Œ [ RUN ] QueueTestSmpl3.DefaultConstructor enter into SetUp() # æ¯æ¬¡éƒ½ä¼šè¿è¡Œ exit from TearDown [ OK ] QueueTestSmpl3.DefaultConstructor (0 ms) [ RUN ] QueueTestSmpl3.Dequeue enter into SetUp() # æ¯æ¬¡éƒ½ä¼šè¿è¡Œ exit from TearDown [ OK ] QueueTestSmpl3.Dequeue (0 ms) [ RUN ] QueueTestSmpl3.Map enter into SetUp() # æ¯æ¬¡éƒ½ä¼šè¿è¡Œ exit from TearDown [ OK ] QueueTestSmpl3.Map (0 ms) run after last case... # æ‰€æœ‰test caseç»“æŸä¹‹åè¿è¡Œ [----------] 3 tests from QueueTestSmpl3 (0 ms total) [----------] Global test environment tear-down [==========] 3 tests from 1 test suite ran. (0 ms total) [ PASSED ] 3 tests. TEST_Fç›¸æ¯”è¾ƒTESTå¯ä»¥æ›´åŠ ç®€æ´åœ°å®ç°åŠŸèƒ½æµ‹è¯•ã€‚ gtestçš„åŸºç¡€å…¥é—¨æ•™ç¨‹å°±åˆ°æ­¤ä¸ºæ­¢ å…­ã€MOCKERå¯¹æ‰“æ¡©çš„å‡½æ•°ï¼Œä½¿ç”¨MOCKERï¼Œå¯ä»¥æŒ‰ç…§é¢„æœŸå€¼è¿”å› ç¤ºä¾‹ï¼š 12345678910111213#include &quot;gtest/gtest.h&quot;#include &quot;mockercpp/mockercpp.hpp&quot;TEST_F(QueueTestSmpl3, xxx_test)&#123; MOCKER(hal_kernel_get_soc_type) .stub() .with(any(), outBoundP()) .will(return (0)); xxx_test(); GlobalMockObject::verify();&#125; C++ä¸­MOCKERç±»ä¸­çš„å‡½æ•°å¯ä»¥ä½¿ç”¨MOCKERCPP GlobalMockObject::verify();æ˜¯éªŒè¯mockæ˜¯å¦æ­£å¸¸æŒ‰ç…§é¢„æœŸä¼ å…¥å‚æ•°ï¼Œæ¸…é™¤åç»­mocker","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"pollã€epoll","path":"/posts/pollã€epoll.html","content":"ä¸€ã€pollä»‹ç»pollä¸selectä¸€æ ·ï¼Œåªè´Ÿè´£IOçš„ç­‰çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡ä¸€æ¬¡å¯ä»¥ç­‰å¾…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä»–çš„ä½œç”¨æ˜¯è®©readå’Œwriteä¸å†é˜»å¡ã€‚ æ˜¯ç”¨æ¥ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€å˜åŒ–çš„ç¨‹åºä¼šåœåœ¨pollè¿™é‡Œç­‰å¾…ï¼Œç›´åˆ°è¢«ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå‘ç”Ÿäº†çŠ¶æ€æ”¹å˜ äºŒã€pollçš„æ¥å£pollçš„æ¥å£å¦‚ä¸‹ï¼Œæ¯”selectè¦è½»é‡åŒ–å¾ˆå¤šï¼Œåªæœ‰ä¸‰ä¸ªå‚æ•° 123456789101112131415161718å‚æ•°1ï¼šstruct pollfd *fdsï¼Œpollfdæ•°ç»„é¦–å…ƒç´ åœ°å€ï¼Œ pollfdæ˜¯æ“ä½œç³»ç»Ÿç»™æˆ‘ä»¬æä¾›çš„ç»“æ„ä½“ï¼Œä¸»è¦æˆå‘˜å¦‚ä¸‹ fdï¼šæ–‡ä»¶æè¿°ç¬¦ eventsï¼šç”¨æˆ·å‘Šè¯‰å†…æ ¸ï¼Œéœ€è¦å…³å¿ƒçš„fdï¼Œä¸Šé¢çš„äº‹ä»¶ reventsï¼špollè¿”å›ï¼Œå†…æ ¸å‘Šè¯‰ç”¨æˆ·ï¼Œå…³å¿ƒçš„fdï¼Œé‚£äº›äº‹ä»¶å°±ç»ªå‚æ•°2ï¼šnfds_t nfdsï¼Œæ•°ç»„å…ƒç´ ä¸ªæ•°å‚æ•°3ï¼šint timeoutï¼Œæ¯«ç§’çº§çš„ç­‰å¾…æ—¶é—´timeout &gt; 0 ç­‰å¾…timeoutæ¯«ç§’æˆ–è€…æœ‰fdå°±ç»ªå†è¿”å›ã€‚timeout == 0 éé˜»å¡è½®è¯¢ã€‚timeout == -1 é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æœ‰fdå°±ç»ªã€‚è¿”å›å€¼ï¼šret &gt; 0 ï¼špollç­‰å¾…çš„å¤šä¸ªfdä¸­ï¼Œå·²ç»å°±éœ€è¦çš„fdä¸ªæ•°ret == 0 ï¼špollè¶…æ—¶è¿”å›ret &lt; 0 ï¼špollå‡ºé”™ pollçš„äº‹ä»¶å¦‚ä¸‹ï¼Œè¿™äº›å€¼æ˜¯bitä½ï¼Œå¯ä»¥é€šè¿‡ |ï¼ˆæˆ–è¿ç®—ï¼‰ çš„æ–¹å¼å†™å…¥åˆ°eventsä¸­ï¼Œæˆ‘ä»¬ç€é‡å­¦ä¹ POLLINå’ŒPOLLOUT ä¸‰ã€pollä½¿ç”¨ä¾‹å­Log.hpp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177#pragma once #include &lt;iostream&gt;#include &lt;cstdarg&gt;#include &lt;unistd.h&gt;#include &lt;sys/stat.h&gt;#include &lt;sys/types.h&gt;#include &lt;pthread.h&gt;using namespace std; enum&#123; Debug = 0, Info, Warning, Error, Fatal&#125;; enum&#123; Screen = 10, OneFile, ClassFile&#125;; string LevelToString(int level)&#123; switch (level) &#123; case Debug: return &quot;Debug&quot;; case Info: return &quot;Info&quot;; case Warning: return &quot;Warning&quot;; case Error: return &quot;Error&quot;; case Fatal: return &quot;Fatal&quot;; default: return &quot;Unknown&quot;; &#125;&#125; const int default_style = Screen;const string default_filename = &quot;Log.&quot;;const string logdir = &quot;log&quot;; class Log&#123;public: Log(int style = default_style, string filename = default_filename) : _style(style), _filename(filename) &#123; if (_style != Screen) mkdir(logdir.c_str(), 0775); &#125; // æ›´æ”¹æ‰“å°æ–¹å¼ void Enable(int style) &#123; _style = style; if (_style != Screen) mkdir(logdir.c_str(), 0775); &#125; // æ—¶é—´æˆ³è½¬åŒ–ä¸ºå¹´æœˆæ—¥æ—¶åˆ†ç§’ string GetTime() &#123; time_t currtime = time(nullptr); struct tm *curr = localtime(&amp;currtime); char time_buffer[128]; snprintf(time_buffer, sizeof(time_buffer), &quot;%d-%d-%d %d:%d:%d&quot;, curr-&gt;tm_year + 1900, curr-&gt;tm_mon + 1, curr-&gt;tm_mday, curr-&gt;tm_hour, curr-&gt;tm_min, curr-&gt;tm_sec); return time_buffer; &#125; // å†™å…¥åˆ°æ–‡ä»¶ä¸­ void WriteLogToOneFile(const string &amp;logname, const string &amp;message) &#123; FILE *fp = fopen(logname.c_str(), &quot;a&quot;); if (fp == nullptr) &#123; perror(&quot;fopen failed&quot;); exit(-1); &#125; fprintf(fp, &quot;%s &quot;, message.c_str()); fclose(fp); &#125; // æ‰“å°æ—¥å¿— void WriteLogToClassFile(const string &amp;levelstr, const string &amp;message) &#123; string logname = logdir; logname += &quot;/&quot;; logname += _filename; logname += levelstr; WriteLogToOneFile(logname, message); &#125; pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER; void WriteLog(const string &amp;levelstr, const string &amp;message) &#123; pthread_mutex_lock(&amp;lock); switch (_style) &#123; case Screen: cout &lt;&lt; message &lt;&lt; endl; // æ‰“å°åˆ°å±å¹•ä¸­ break; case OneFile: WriteLogToClassFile(&quot;all&quot;, message); // ç»™å®šallï¼Œç›´æ¥å†™åˆ°allé‡Œ break; case ClassFile: WriteLogToClassFile(levelstr, message); // å†™å…¥levelstré‡Œ break; default: break; &#125; pthread_mutex_unlock(&amp;lock); &#125; // æä¾›æ¥å£ç»™è¿ç®—ç¬¦é‡è½½ä½¿ç”¨ void _LogMessage(int level, const char *file, int line, char *rightbuffer) &#123; char leftbuffer[1024]; string levelstr = LevelToString(level); string currtime = GetTime(); string idstr = to_string(getpid()); snprintf(leftbuffer, sizeof(leftbuffer), &quot;[%s][%s][%s][%s:%d]&quot;, levelstr.c_str(), currtime.c_str(), idstr.c_str(), file, line); string messages = leftbuffer; messages += rightbuffer; WriteLog(levelstr, messages); &#125; // è¿ç®—ç¬¦é‡è½½ void operator()(int level, const char *file, int line, const char *format, ...) &#123; char rightbuffer[1024]; va_list args; // va_list æ˜¯æŒ‡é’ˆ va_start(args, format); // åˆå§‹åŒ–va_listå¯¹è±¡ï¼Œformatæ˜¯æœ€åä¸€ä¸ªç¡®å®šçš„å‚æ•° vsnprintf(rightbuffer, sizeof(rightbuffer), format, args); // å†™å…¥åˆ°rightbufferä¸­ va_end(args); _LogMessage(level, file, line, rightbuffer); &#125; ~Log() &#123; &#125; private: int _style; string _filename;&#125;; Log lg; class Conf&#123;public: Conf() &#123; lg.Enable(Screen); &#125; ~Conf() &#123; &#125;&#125;; Conf conf; // è¾…åŠ©å®#define lg(level, format, ...) lg(level, __FILE__, __LINE__, format, ##__VA_ARGS__) Socket.hpp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170#pragma once #include &lt;iostream&gt;#include &lt;string&gt;#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;cstring&gt;#include &lt;unistd.h&gt;using namespace std;namespace Net_Work&#123; static const int default_backlog = 5; static const int default_sockfd = -1; using namespace std; enum &#123; SocketError = 1, BindError, ListenError, ConnectError, &#125;; // å°è£…å¥—æ¥å­—æ¥å£åŸºç±» class Socket &#123; public: // å°è£…äº†socketç›¸å…³æ–¹æ³• virtual ~Socket() &#123;&#125; virtual void CreateSocket() = 0; virtual void BindSocket(uint16_t port) = 0; virtual void ListenSocket(int backlog) = 0; virtual bool ConnectSocket(string &amp;serverip, uint16_t serverport) = 0; virtual int AcceptSocket(string *peerip, uint16_t *peerport) = 0; virtual int GetSockFd() = 0; virtual void SetSockFd(int sockfd) = 0; virtual void CloseSocket() = 0; virtual bool Recv(string *buff, int size) = 0; virtual void Send(string &amp;send_string) = 0; // æ–¹æ³•çš„é›†ä¸­åœ¨ä¸€èµ·ä½¿ç”¨ public: void BuildListenSocket(uint16_t port, int backlog = default_backlog) &#123; CreateSocket(); BindSocket(port); ListenSocket(backlog); &#125; bool BuildConnectSocket(string &amp;serverip, uint16_t serverport) &#123; CreateSocket(); return ConnectSocket(serverip, serverport); &#125; void BuildNormalSocket(int sockfd) &#123; SetSockFd(sockfd); &#125; &#125;; class TcpSocket : public Socket &#123; public: TcpSocket(int sockfd = default_sockfd) : _sockfd(sockfd) &#123; &#125; ~TcpSocket() &#123;&#125; void CreateSocket() override &#123; _sockfd = socket(AF_INET, SOCK_STREAM, 0); if (_sockfd &lt; 0) exit(SocketError); &#125; void BindSocket(uint16_t port) override &#123; int opt = 1; setsockopt(_sockfd, SOL_SOCKET, SO_REUSEADDR | SO_REUSEPORT, &amp;opt, sizeof(opt)); struct sockaddr_in local; memset(&amp;local, 0, sizeof(local)); local.sin_family = AF_INET; local.sin_port = htons(port); local.sin_addr.s_addr = INADDR_ANY; int n = bind(_sockfd, (struct sockaddr *)&amp;local, sizeof(local)); if (n &lt; 0) exit(BindError); &#125; void ListenSocket(int backlog) override &#123; int n = listen(_sockfd, backlog); if (n &lt; 0) exit(ListenError); &#125; bool ConnectSocket(string &amp;serverip, uint16_t serverport) override &#123; struct sockaddr_in addr; memset(&amp;addr, 0, sizeof(addr)); addr.sin_family = AF_INET; addr.sin_port = htons(serverport); // addr.sin_addr.s_addr = inet_addr(serverip.c_str()); inet_pton(AF_INET, serverip.c_str(), &amp;addr.sin_addr); int n = connect(_sockfd, (sockaddr *)&amp;addr, sizeof(addr)); if (n == 0) return true; return false; &#125; int AcceptSocket(string *peerip, uint16_t *peerport) override &#123; struct sockaddr_in addr; socklen_t len = sizeof(addr); int newsockfd = accept(_sockfd, (sockaddr *)&amp;addr, &amp;len); if (newsockfd &lt; 0) return -1; // *peerip = inet_ntoa(addr.sin_addr); // INET_ADDRSTRLEN æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨å¤´æ–‡ä»¶ä¸­çš„å®ï¼Œè¡¨ç¤º IPv4 åœ°å€çš„æœ€å¤§é•¿åº¦ char ip_str[INET_ADDRSTRLEN]; inet_ntop(AF_INET, &amp;addr.sin_addr, ip_str, INET_ADDRSTRLEN); *peerip = ip_str; *peerport = ntohs(addr.sin_port); return newsockfd; &#125; int GetSockFd() override &#123; return _sockfd; &#125; void SetSockFd(int sockfd) override &#123; _sockfd = sockfd; &#125; void CloseSocket() override &#123; if (_sockfd &gt; default_sockfd) close(_sockfd); &#125; bool Recv(string *buff, int size) override &#123; char inbuffer[size]; ssize_t n = recv(_sockfd, inbuffer, size - 1, 0); if (n &gt; 0) &#123; inbuffer[n] = 0; *buff += inbuffer; return true; &#125; else return false; &#125; void Send(string &amp;send_string) override &#123; send(_sockfd, send_string.c_str(),send_string.size(),0); &#125; private: int _sockfd; string _ip; uint16_t _port; &#125;;&#125; PollServer.hpp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162#pragma once#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;poll.h&gt;#include &lt;memory&gt;#include &quot;Log.hpp&quot;#include &quot;Socket.hpp&quot; using namespace Net_Work;const static int gdefaultport = 8888;const static int gbacklog = 8;const static int gnum = 1024;class PollServer&#123;public: PollServer(int port) : _port(port), _num(gnum), _listensock(new TcpSocket()) &#123; &#125; void HandlerEvent() &#123; for (int i = 0; i &lt; _num; i++) &#123; if (_rfds[i].fd == -1) continue; int fd = _rfds[i].fd; short revents = _rfds[i].revents; // åˆ¤æ–­äº‹ä»¶æ˜¯å¦å°±ç»ª if (revents &amp; POLLIN) &#123; // è¯»äº‹ä»¶åˆ†ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯æ–°é“¾æ¥åˆ°æ¥ï¼Œä¸€ç±»æ˜¯æ–°æ•°æ®åˆ°æ¥ if (fd == _listensock-&gt;GetSockFd()) &#123; // æ–°é“¾æ¥åˆ°æ¥ lg(Info, &quot;get a new link&quot;); // è·å–è¿æ¥ std::string clientip; uint16_t clientport; int sockfd = _listensock-&gt;AcceptSocket(&amp;clientip, &amp;clientport); if (sockfd == -1) &#123; lg(Error, &quot;accept error&quot;); continue; &#125; lg(Info, &quot;get a client,client info is# %s:%d,fd: %d&quot;, clientip.c_str(), clientport, sockfd); // æ­¤æ—¶è·å–è¿æ¥æˆåŠŸäº†ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥read write,sockfdä»éœ€è¦äº¤ç»™pollæ‰˜ç®¡ -- æ·»åŠ åˆ°æ•°ç»„_rfdsä¸­ int pos = 0; for (; pos &lt; _num; pos++) &#123; if (_rfds[pos].fd == -1) &#123; _rfds[pos].fd = sockfd; _rfds[pos].events = POLLIN; lg(Info, &quot;get a new link, fd is : %d&quot;, sockfd); break; &#125; &#125; if (pos == _num) &#123; // 1.æ‰©å®¹ // 2.å…³é—­ close(sockfd); lg(Warning, &quot;server is full, be carefull...&quot;); &#125; &#125; else &#123; // æ™®é€šçš„è¯»äº‹ä»¶å°±ç»ª char buffer[1024]; ssize_t n = recv(fd, buffer, sizeof(buffer-1), 0); if (n &gt; 0) &#123; buffer[n] = 0; lg(Info, &quot;client say# %s&quot;, buffer); std::string message = &quot;ä½ å¥½,åŒå¿—&quot;; message += buffer; send(fd, message.c_str(), message.size(), 0); &#125; else &#123; lg(Warning, &quot;client quit ,maybe close or error,close fd: %d&quot;, fd); close(fd); // è¿˜è¦å–æ¶ˆpollçš„å…³å¿ƒ _rfds[i].fd = -1; _rfds[i].events = 0; _rfds[i].revents = 0; &#125; &#125; &#125; &#125; &#125; void InitServer() &#123; _listensock-&gt;BuildListenSocket(_port, gbacklog); _rfds = new struct pollfd[_num]; for (int i = 0; i &lt; _num; i++) &#123; _rfds[i].fd = -1; _rfds[i].events = 0; _rfds[i].revents = 0; &#125; // æœ€å¼€å§‹çš„æ—¶å€™ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ŒListensock _rfds[0].fd = _listensock-&gt;GetSockFd(); _rfds[0].events |= POLLIN; &#125; void Loop() &#123; _isrunning = true; // å¾ªç¯é‡ç½®selectéœ€è¦çš„rfds while (_isrunning) &#123; // å®šä¹‰æ—¶é—´ int timeout = 1000; //PrintDebug(); // rfdsæ˜¯è¾“å…¥è¾“å‡ºå‹å‚æ•°ï¼Œrfdsæ˜¯åœ¨selectè°ƒç”¨è¿”å›æ—¶ï¼Œä¸æ–­è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡éœ€è¦é‡ç½®rfds int n = poll(_rfds, _num, timeout); switch (n) &#123; case 0: lg(Info, &quot;select timeout...&quot;); break; case -1: lg(Error, &quot;select error!!!&quot;); default: // æ­£å¸¸å°±ç»ªçš„fd lg(Info, &quot;select success,begin event handler&quot;); HandlerEvent(); break; &#125; &#125; _isrunning = false; &#125; void Stop() &#123; _isrunning = false; &#125; void PrintDebug() &#123; // std::cout &lt;&lt; &quot;current select rfds list is :&quot;; // for (int i = 0; i &lt; num; i++) // &#123; // if (_rfds_array[i] == nullptr) // continue; // else // std::cout &lt;&lt; _rfds_array[i]-&gt;GetSockFd() &lt;&lt; &quot; &quot;; // &#125; // std::cout &lt;&lt; std::endl; &#125; private: std::unique_ptr&lt;Socket&gt; _listensock; int _port; bool _isrunning; struct pollfd *_rfds; int _num;&#125;; Main.cc 12345678910111213141516171819202122232425#include &lt;iostream&gt;#include &lt;memory&gt;#include &quot;PollServer.hpp&quot; void Usage(char* argv)&#123; std::cout&lt;&lt;&quot;Usage: \\t&quot;&lt;&lt;argv&lt;&lt;&quot; port &quot;&lt;&lt;std::endl;&#125;// ./select_server 8080int main(int argc,char* argv[])&#123; // std::cout&lt;&lt;num&lt;&lt;std::endl; 1024 if(argc!=2) &#123; Usage(argv[0]); return -1; &#125; uint16_t localport = std::stoi(argv[1]); std::unique_ptr&lt;PollServer&gt; svr = std::make_unique&lt;PollServer&gt;(localport); svr-&gt;InitServer(); svr-&gt;Loop(); return 0;&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œç”±äºæˆ‘ä»¬pollç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®çš„æ˜¯1000msï¼Œå› æ­¤æ¯ä¸€ç§’polléƒ½ä¼šè¿”å›ï¼Œå½“å‘ç°æœ‰æ–°é“¾æ¥çš„æ—¶å€™ï¼Œå°±å›å»æ‰§è¡Œå‡½æ•°ï¼Œåœ¨å‡½æ•°ä¸­è°ƒç”¨writeæˆ–è€…readå˜ä¸ä¼šå†é˜»å¡äº†ã€‚","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"è¿›ç¨‹é—´é€šä¿¡","path":"/posts/è¿›ç¨‹é—´é€šä¿¡.html","content":"ä¸€ã€ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†ä¸€ç§ä»ä¸€ä¸ªè¿›ç¨‹å‘å¦ä¸€ä¸ªè¿›ç¨‹å‘é€ä¸€ä¸ªæ•°æ®å—çš„æ–¹æ³•ã€‚ æ¯ä¸ªæ•°æ®å—éƒ½è¢«è®¤ä¸ºå«æœ‰ä¸€ä¸ªç±»å‹ï¼Œæ¥æ”¶è¿›ç¨‹å¯ä»¥ç‹¬ç«‹åœ°æ¥æ”¶å«æœ‰ä¸åŒç±»å‹çš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘é€æ¶ˆæ¯æ¥é¿å…å‘½åç®¡é“çš„åŒæ­¥å’Œé˜»å¡é—®é¢˜ã€‚ä½†æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸å‘½åç®¡é“ä¸€æ ·ï¼Œæ¯ä¸ªæ•°æ®å—éƒ½æœ‰ä¸€ä¸ªæœ€å¤§é•¿åº¦çš„é™åˆ¶ã€‚ Linuxç”¨å®MSGMAXå’ŒMSGMNBæ¥é™åˆ¶ä¸€æ¡æ¶ˆæ¯çš„æœ€å¤§é•¿åº¦å’Œä¸€ä¸ªé˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚ äºŒã€åœ¨Linuxä¸­ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—Linuxæä¾›äº†ä¸€ç³»åˆ—æ¶ˆæ¯é˜Ÿåˆ—çš„å‡½æ•°æ¥å£æ¥è®©æˆ‘ä»¬æ–¹ä¾¿åœ°ä½¿ç”¨å®ƒæ¥å®ç°è¿›ç¨‹é—´çš„é€šä¿¡ã€‚å®ƒçš„ç”¨æ³•ä¸å…¶ä»–ä¸¤ä¸ªSystem V PICæœºåˆ¶ï¼Œå³ä¿¡å·é‡å’Œå…±äº«å†…å­˜ç›¸ä¼¼ã€‚ 1ã€msggetå‡½æ•°è¯¥å‡½æ•°ç”¨æ¥åˆ›å»ºå’Œè®¿é—®ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚å®ƒçš„åŸå‹ä¸ºï¼š int msgget(key_t, key, int msgflg); ä¸å…¶ä»–çš„IPCæœºåˆ¶ä¸€æ ·ï¼Œç¨‹åºå¿…é¡»æä¾›ä¸€ä¸ªé”®æ¥å‘½åæŸä¸ªç‰¹å®šçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚msgflgæ˜¯ä¸€ä¸ªæƒé™æ ‡å¿—ï¼Œè¡¨ç¤ºæ¶ˆæ¯é˜Ÿåˆ—çš„è®¿é—®æƒé™ï¼Œå®ƒä¸æ–‡ä»¶çš„è®¿é—®æƒé™ä¸€æ ·ã€‚msgflgå¯ä»¥ä¸IPC_CREATåšæˆ–æ“ä½œï¼Œè¡¨ç¤ºå½“keyæ‰€å‘½åçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸å­˜åœ¨æ—¶åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æœkeyæ‰€å‘½åçš„æ¶ˆæ¯é˜Ÿåˆ—å­˜åœ¨æ—¶ï¼ŒIPC_CREATæ ‡å¿—ä¼šè¢«å¿½ç•¥ï¼Œè€Œåªè¿”å›ä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚ å®ƒè¿”å›ä¸€ä¸ªä»¥keyå‘½åçš„æ¶ˆæ¯é˜Ÿåˆ—çš„æ ‡è¯†ç¬¦ï¼ˆéé›¶æ•´æ•°ï¼‰ï¼Œå¤±è´¥æ—¶è¿”å›-1. 2ã€msgsndå‡½æ•°è¯¥å‡½æ•°ç”¨æ¥æŠŠæ¶ˆæ¯æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚å®ƒçš„åŸå‹ä¸ºï¼š int msgsend(int msgid, const void *msg_ptr, size_t msg_sz, int msgflg); msgidæ˜¯ç”±msggetå‡½æ•°è¿”å›çš„æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦ã€‚ msg_ptræ˜¯ä¸€ä¸ªæŒ‡å‘å‡†å¤‡å‘é€æ¶ˆæ¯çš„æŒ‡é’ˆï¼Œä½†æ˜¯æ¶ˆæ¯çš„æ•°æ®ç»“æ„å´æœ‰ä¸€å®šçš„è¦æ±‚ï¼ŒæŒ‡é’ˆmsg_ptræ‰€æŒ‡å‘çš„æ¶ˆæ¯ç»“æ„ä¸€å®šè¦æ˜¯ä»¥ä¸€ä¸ªé•¿æ•´å‹æˆå‘˜å˜é‡å¼€å§‹çš„ç»“æ„ä½“ï¼Œæ¥æ”¶å‡½æ•°å°†ç”¨è¿™ä¸ªæˆå‘˜æ¥ç¡®å®šæ¶ˆæ¯çš„ç±»å‹ã€‚æ‰€ä»¥æ¶ˆæ¯ç»“æ„è¦å®šä¹‰æˆè¿™æ ·ï¼š 1234struct my_message&#123; long int message_type; /* The data you wish to transfer*/ &#125;; msg_szæ˜¯msg_ptræŒ‡å‘çš„æ¶ˆæ¯çš„é•¿åº¦ï¼Œæ³¨æ„æ˜¯æ¶ˆæ¯çš„é•¿åº¦ï¼Œè€Œä¸æ˜¯æ•´ä¸ªç»“æ„ä½“çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´msg_szæ˜¯ä¸åŒ…æ‹¬é•¿æ•´å‹æ¶ˆæ¯ç±»å‹æˆå‘˜å˜é‡çš„é•¿åº¦ã€‚ msgflgç”¨äºæ§åˆ¶å½“å‰æ¶ˆæ¯é˜Ÿåˆ—æ»¡æˆ–é˜Ÿåˆ—æ¶ˆæ¯åˆ°è¾¾ç³»ç»ŸèŒƒå›´çš„é™åˆ¶æ—¶å°†è¦å‘ç”Ÿçš„äº‹æƒ…ã€‚ å¦‚æœè°ƒç”¨æˆåŠŸï¼Œæ¶ˆæ¯æ•°æ®çš„ä¸€åˆ†å‰¯æœ¬å°†è¢«æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶è¿”å›0ï¼Œå¤±è´¥æ—¶è¿”å›-1. 3ã€msgrcvå‡½æ•°è¯¥å‡½æ•°ç”¨æ¥ä»ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—è·å–æ¶ˆæ¯ï¼Œå®ƒçš„åŸå‹ä¸º int msgrcv(int msgid, void *msg_ptr, size_t msg_st, long int msgtype, int msgflg); msgid, msg_ptr, msg_stçš„ä½œç”¨ä¹Ÿå‡½æ•°msgsndå‡½æ•°çš„ä¸€æ ·ã€‚ msgtypeå¯ä»¥å®ç°ä¸€ç§ç®€å•çš„æ¥æ”¶ä¼˜å…ˆçº§ã€‚å¦‚æœmsgtypeä¸º0ï¼Œå°±è·å–é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ã€‚å¦‚æœå®ƒçš„å€¼å¤§äºé›¶ï¼Œå°†è·å–å…·æœ‰ç›¸åŒæ¶ˆæ¯ç±»å‹çš„ç¬¬ä¸€ä¸ªä¿¡æ¯ã€‚å¦‚æœå®ƒå°äºé›¶ï¼Œå°±è·å–ç±»å‹ç­‰äºæˆ–å°äºmsgtypeçš„ç»å¯¹å€¼çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ã€‚ msgflgç”¨äºæ§åˆ¶å½“é˜Ÿåˆ—ä¸­æ²¡æœ‰ç›¸åº”ç±»å‹çš„æ¶ˆæ¯å¯ä»¥æ¥æ”¶æ—¶å°†å‘ç”Ÿçš„äº‹æƒ…ã€‚ è°ƒç”¨æˆåŠŸæ—¶ï¼Œè¯¥å‡½æ•°è¿”å›æ”¾åˆ°æ¥æ”¶ç¼“å­˜åŒºä¸­çš„å­—èŠ‚æ•°ï¼Œæ¶ˆæ¯è¢«å¤åˆ¶åˆ°ç”±msg_ptræŒ‡å‘çš„ç”¨æˆ·åˆ†é…çš„ç¼“å­˜åŒºä¸­ï¼Œç„¶ååˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„å¯¹åº”æ¶ˆæ¯ã€‚å¤±è´¥æ—¶è¿”å›-1. 4ã€msgctlå‡½æ•°è¯¥å‡½æ•°ç”¨æ¥æ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒä¸å…±äº«å†…å­˜çš„shmctlå‡½æ•°ç›¸ä¼¼ï¼Œå®ƒçš„åŸå‹ä¸ºï¼š int msgctl(int msgid, int command, struct msgid_ds *buf); commandæ˜¯å°†è¦é‡‡å–çš„åŠ¨ä½œï¼Œå®ƒå¯ä»¥å–3ä¸ªå€¼ï¼Œ IPC_STATï¼šæŠŠmsgid_dsç»“æ„ä¸­çš„æ•°æ®è®¾ç½®ä¸ºæ¶ˆæ¯é˜Ÿåˆ—çš„å½“å‰å…³è”å€¼ï¼Œå³ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„å½“å‰å…³è”å€¼è¦†ç›–msgid_dsçš„å€¼ã€‚ IPC_SETï¼šå¦‚æœè¿›ç¨‹æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œå°±æŠŠæ¶ˆæ¯åˆ—é˜Ÿçš„å½“å‰å…³è”å€¼è®¾ç½®ä¸ºmsgid_dsç»“æ„ä¸­ç»™å‡ºçš„å€¼ IPC_RMIDï¼šåˆ é™¤æ¶ˆæ¯é˜Ÿåˆ— bufæ˜¯æŒ‡å‘msgid_dsç»“æ„çš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å¼å’Œè®¿é—®æƒé™çš„ç»“æ„ã€‚msgid_dsç»“æ„è‡³å°‘åŒ…æ‹¬ä»¥ä¸‹æˆå‘˜ï¼š 123456struct msgid_ds &#123; uid_t shm_perm.uid; uid_t shm_perm.gid; mode_t shm_perm.mode; &#125;; æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥æ—¶è¿”å›-1. ä¸‰ã€ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡é©¬ä¸åœè¹„ï¼Œä»‹ç»å®Œæ¶ˆæ¯é˜Ÿåˆ—çš„å®šä¹‰å’Œå¯ä½¿ç”¨çš„æ¥å£ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆè®©è¿›ç¨‹è¿›è¡Œé€šä¿¡çš„ã€‚ç”±äºå¯ä»¥è®©ä¸ç›¸å…³çš„è¿›ç¨‹è¿›è¡Œè¡Œé€šä¿¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œå°†ä¼šç¼–å†™ä¸¤ä¸ªç¨‹åºï¼Œmsgreceiveå’Œmsgsnedæ¥è¡¨ç¤ºæ¥æ”¶å’Œå‘é€ä¿¡æ¯ã€‚æ ¹æ®æ­£å¸¸çš„æƒ…å†µï¼Œæˆ‘ä»¬å…è®¸ä¸¤ä¸ªç¨‹åºéƒ½å¯ä»¥åˆ›å»ºæ¶ˆæ¯ï¼Œä½†åªæœ‰æ¥æ”¶è€…åœ¨æ¥æ”¶å®Œæœ€åä¸€ä¸ªæ¶ˆæ¯ä¹‹åï¼Œå®ƒæ‰æŠŠå®ƒåˆ é™¤ã€‚ æ¥æ”¶ä¿¡æ¯çš„ç¨‹åºæºæ–‡ä»¶ä¸ºmsgreceive.cçš„æºä»£ç ä¸ºï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;unistd.h&gt; #include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; #include &lt;errno.h&gt; #include &lt;sys/msg.h&gt; struct msg_st &#123; long int msg_type; char text[BUFSIZ]; &#125;; int main() &#123; int running = 1; int msgid = -1; struct msg_st data; long int msgtype = 0; //æ³¨æ„1 //å»ºç«‹æ¶ˆæ¯é˜Ÿåˆ— msgid = msgget((key_t)1234, 0666 | IPC_CREAT); if(msgid == -1) &#123; fprintf(stderr, &quot;msgget failed with error: %d &quot;, errno); exit(EXIT_FAILURE); &#125; //ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ï¼Œç›´åˆ°é‡åˆ°endæ¶ˆæ¯ä¸ºæ­¢ while(running) &#123; if(msgrcv(msgid, (void*)&amp;data, BUFSIZ, msgtype, 0) == -1) &#123; fprintf(stderr, &quot;msgrcv failed with errno: %d &quot;, errno); exit(EXIT_FAILURE); &#125; printf(&quot;You wrote: %s &quot;,data.text); //é‡åˆ°endç»“æŸ if(strncmp(data.text, &quot;end&quot;, 3) == 0) running = 0; &#125; //åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ— if(msgctl(msgid, IPC_RMID, 0) == -1) &#123; fprintf(stderr, &quot;msgctl(IPC_RMID) failed &quot;); exit(EXIT_FAILURE); &#125; exit(EXIT_SUCCESS); &#125; å‘é€ä¿¡æ¯çš„ç¨‹åºçš„æºæ–‡ä»¶msgsend.cçš„æºä»£ç ä¸ºï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#include &lt;unistd.h&gt; #include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; #include &lt;sys/msg.h&gt; #include &lt;errno.h&gt; #define MAX_TEXT 512 struct msg_st &#123; long int msg_type; char text[MAX_TEXT]; &#125;; int main() &#123; int running = 1; struct msg_st data; char buffer[BUFSIZ]; int msgid = -1; //å»ºç«‹æ¶ˆæ¯é˜Ÿåˆ— msgid = msgget((key_t)1234, 0666 | IPC_CREAT); if(msgid == -1) &#123; fprintf(stderr, &quot;msgget failed with error: %d &quot;, errno); exit(EXIT_FAILURE); &#125; //å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­å†™æ¶ˆæ¯ï¼Œç›´åˆ°å†™å…¥end while(running) &#123; //è¾“å…¥æ•°æ® printf(&quot;Enter some text: &quot;); fgets(buffer, BUFSIZ, stdin); data.msg_type = 1; //æ³¨æ„2 strcpy(data.text, buffer); //å‘é˜Ÿåˆ—å‘é€æ•°æ® if(msgsnd(msgid, (void*)&amp;data, MAX_TEXT, 0) == -1) &#123; fprintf(stderr, &quot;msgsnd failed &quot;); exit(EXIT_FAILURE); &#125; //è¾“å…¥endç»“æŸè¾“å…¥ if(strncmp(buffer, &quot;end&quot;, 3) == 0) running = 0; sleep(1); &#125; exit(EXIT_SUCCESS); &#125; å››ã€ä¾‹å­åˆ†æâ€”â€”æ¶ˆæ¯ç±»å‹è¿™é‡Œä¸»è¦è¯´æ˜ä¸€ä¸‹æ¶ˆæ¯ç±»å‹æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œæ³¨æ„msgreceive.cæ–‡ä»¶mainå‡½æ•°ä¸­å®šä¹‰çš„å˜é‡msgtypeï¼ˆæ³¨é‡Šä¸ºæ³¨æ„1ï¼‰ï¼Œå®ƒä½œä¸ºmsgrcvå‡½æ•°çš„æ¥æ”¶ä¿¡æ¯ç±»å‹å‚æ•°çš„å€¼ï¼Œå…¶å€¼ä¸º0ï¼Œè¡¨ç¤ºè·å–é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªå¯ç”¨çš„æ¶ˆæ¯ã€‚å†æ¥çœ‹çœ‹msgsend.cæ–‡ä»¶ä¸­whileå¾ªç¯ä¸­çš„è¯­å¥data.msg_type &#x3D; 1ï¼ˆæ³¨é‡Šä¸ºæ³¨æ„2ï¼‰ï¼Œå®ƒç”¨æ¥è®¾ç½®å‘é€çš„ä¿¡æ¯çš„ä¿¡æ¯ç±»å‹ï¼Œå³å…¶å‘é€çš„ä¿¡æ¯çš„ç±»å‹ä¸º1ã€‚æ‰€ä»¥ç¨‹åºmsgreceiveèƒ½å¤Ÿæ¥æ”¶åˆ°ç¨‹åºmsgsendå‘é€çš„ä¿¡æ¯ã€‚ å¦‚æœæŠŠæ³¨æ„1ï¼Œå³msgreceive.cæ–‡ä»¶mainå‡½æ•°ä¸­çš„è¯­å¥ç”± long int msgtype &#x3D; 0;æ”¹å˜ä¸ºlong int msgtype &#x3D; 2;ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Œmsgreceiveå°†ä¸èƒ½æ¥æ”¶åˆ°ç¨‹åºmsgsendå‘é€çš„ä¿¡æ¯ã€‚å› ä¸ºåœ¨è°ƒç”¨msgrcvå‡½æ•°æ—¶ï¼Œå¦‚æœmsgtypeï¼ˆç¬¬å››ä¸ªå‚æ•°ï¼‰å¤§äºé›¶ï¼Œåˆ™å°†åªè·å–å…·æœ‰ç›¸åŒæ¶ˆæ¯ç±»å‹çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼Œä¿®æ”¹åè·å–çš„æ¶ˆæ¯ç±»å‹ä¸º2ï¼Œè€Œmsgsendå‘é€çš„æ¶ˆæ¯ç±»å‹ä¸º1ï¼Œæ‰€ä»¥ä¸èƒ½è¢«msgreceiveç¨‹åºæ¥æ”¶ã€‚é‡æ–°ç¼–è¯‘msgreceive.cæ–‡ä»¶å¹¶å†æ¬¡æ‰§è¡Œ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œmsgreceiveå¹¶æ²¡æœ‰æ¥æ”¶åˆ°ä¿¡æ¯å’Œè¾“å‡ºï¼Œè€Œä¸”å½“msgsendè¾“å…¥endç»“æŸåï¼Œmsgreceiveä¹Ÿæ²¡æœ‰ç»“æŸï¼Œé€šè¿‡jobså‘½ä»¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè¿˜åœ¨åå°è¿è¡Œç€ã€‚ äº”ã€æ¶ˆæ¯é˜Ÿåˆ—ä¸å‘½åç®¡é“çš„æ¯”è¾ƒæ¶ˆæ¯é˜Ÿåˆ—è·Ÿå‘½åç®¡é“æœ‰ä¸å°‘çš„ç›¸åŒä¹‹å¤„ï¼Œé€šè¿‡ä¸å‘½åç®¡é“ä¸€æ ·ï¼Œæ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œé€šä¿¡çš„è¿›ç¨‹å¯ä»¥æ˜¯ä¸ç›¸å…³çš„è¿›ç¨‹ï¼ŒåŒæ—¶å®ƒä»¬éƒ½æ˜¯é€šè¿‡å‘é€å’Œæ¥æ”¶çš„æ–¹å¼æ¥ä¼ é€’æ•°æ®çš„ã€‚åœ¨å‘½åç®¡é“ä¸­ï¼Œå‘é€æ•°æ®ç”¨writeï¼Œæ¥æ”¶æ•°æ®ç”¨readï¼Œåˆ™åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå‘é€æ•°æ®ç”¨msgsndï¼Œæ¥æ”¶æ•°æ®ç”¨msgrcvã€‚è€Œä¸”å®ƒä»¬å¯¹æ¯ä¸ªæ•°æ®éƒ½æœ‰ä¸€ä¸ªæœ€å¤§é•¿åº¦çš„é™åˆ¶ã€‚ ä¸å‘½åç®¡é“ç›¸æ¯”ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜åŠ¿åœ¨äºï¼Œ 1ã€æ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿå¯ä»¥ç‹¬ç«‹äºå‘é€å’Œæ¥æ”¶è¿›ç¨‹è€Œå­˜åœ¨ï¼Œä»è€Œæ¶ˆé™¤äº†åœ¨åŒæ­¥å‘½åç®¡é“çš„æ‰“å¼€å’Œå…³é—­æ—¶å¯èƒ½äº§ç”Ÿçš„å›°éš¾ã€‚ 2ã€åŒæ—¶é€šè¿‡å‘é€æ¶ˆæ¯è¿˜å¯ä»¥é¿å…å‘½åç®¡é“çš„åŒæ­¥å’Œé˜»å¡é—®é¢˜ï¼Œä¸éœ€è¦ç”±è¿›ç¨‹è‡ªå·±æ¥æä¾›åŒæ­¥æ–¹æ³•ã€‚ 3ã€æ¥æ”¶ç¨‹åºå¯ä»¥é€šè¿‡æ¶ˆæ¯ç±»å‹æœ‰é€‰æ‹©åœ°æ¥æ”¶æ•°æ®ï¼Œè€Œä¸æ˜¯åƒå‘½åç®¡é“ä¸­é‚£æ ·ï¼Œåªèƒ½é»˜è®¤åœ°æ¥æ”¶ã€‚","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"é”ã€ä¿¡å·é‡","path":"/posts/é”ã€ä¿¡å·é‡.html","content":"ä¸€ã€ä¿¡å·é‡çº¿ç¨‹çš„ä¿¡å·é‡ä¸è¿›ç¨‹é—´é€šä¿¡ä¸­ä½¿ç”¨çš„ä¿¡å·é‡çš„æ¦‚å¿µæ˜¯ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å˜é‡ï¼Œå®ƒå¯ä»¥è¢«å¢åŠ æˆ–å‡å°‘ï¼Œä½†å¯¹å…¶çš„å…³é”®è®¿é—®è¢«ä¿è¯æ˜¯åŸå­æ“ä½œã€‚å¦‚æœä¸€ä¸ªç¨‹åºä¸­æœ‰å¤šä¸ªçº¿ç¨‹è¯•å›¾æ”¹å˜ä¸€ä¸ªä¿¡å·é‡çš„å€¼ï¼Œç³»ç»Ÿå°†ä¿è¯æ‰€æœ‰çš„æ“ä½œéƒ½å°†ä¾æ¬¡è¿›è¡Œã€‚ è€Œåªæœ‰0å’Œ1ä¸¤ç§å–å€¼çš„ä¿¡å·é‡å«åšäºŒè¿›åˆ¶ä¿¡å·é‡ï¼Œåœ¨è¿™é‡Œå°†é‡ç‚¹ä»‹ç»ã€‚è€Œä¿¡å·é‡ä¸€èˆ¬å¸¸ç”¨äºä¿æŠ¤ä¸€æ®µä»£ç ï¼Œä½¿å…¶æ¯æ¬¡åªè¢«ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹è¿è¡Œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶ä¿¡å·é‡æ¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚ Cè¯­è¨€ä¸­çš„ä¿¡å·é‡åˆ†ä¸ºä¸¤ç§ï¼ŒPOSIXä¿¡å·é‡å’ŒSyetem -Vä¿¡å·é‡ äºŒã€POSIXä¿¡å·é‡ä¿¡å·é‡çš„å‡½æ•°éƒ½ä»¥sem_å¼€å¤´ï¼Œçº¿ç¨‹ä¸­ä½¿ç”¨çš„åŸºæœ¬ä¿¡å·é‡å‡½æ•°æœ‰4ä¸ªï¼Œå®ƒä»¬éƒ½å£°æ˜åœ¨å¤´æ–‡ä»¶semaphore.hä¸­ã€‚ 1ã€sem_initå‡½æ•°è¯¥å‡½æ•°ç”¨äºåˆ›å»ºä¿¡å·é‡ï¼Œå…¶åŸå‹å¦‚ä¸‹ int sem_init(sem_t *sem,int pshared,unsigned int value); è¯¥å‡½æ•°åˆå§‹åŒ–ç”±semæŒ‡å‘çš„ä¿¡å·å¯¹è±¡ï¼Œè®¾ç½®å®ƒçš„å…±äº«é€‰é¡¹ï¼Œå¹¶ç»™å®ƒä¸€ä¸ªåˆå§‹çš„æ•´æ•°å€¼ã€‚psharedæ§åˆ¶ä¿¡å·é‡çš„ç±»å‹ï¼Œå¦‚æœå…¶å€¼ä¸º0ï¼Œå°±è¡¨ç¤ºè¿™ä¸ªä¿¡å·é‡æ˜¯å½“å‰è¿›ç¨‹çš„å±€éƒ¨ä¿¡å·é‡ï¼Œå¦åˆ™ä¿¡å·é‡å°±å¯ä»¥åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«ï¼Œvalueä¸ºsemçš„åˆå§‹å€¼ã€‚è°ƒç”¨æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥è¿”å›-1. 2ã€sem_waitå‡½æ•°è¯¥å‡½æ•°ç”¨äºä»¥åŸå­æ“ä½œçš„æ–¹å¼å°†ä¿¡å·é‡çš„å€¼å‡1ã€‚åŸå­æ“ä½œå°±æ˜¯ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹ä¼å›¾åŒæ—¶ç»™ä¸€ä¸ªä¿¡å·é‡åŠ 1æˆ–å‡1ï¼Œå®ƒä»¬ä¹‹é—´ä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚å®ƒçš„åŸå‹å¦‚ä¸‹ï¼š int sem_wait(sem_t *sem); ç­‰å¾…ä¿¡å·é‡ï¼Œå¦‚æœä¿¡å·é‡çš„å€¼å¤§äº0ï¼Œå°†ä¿¡å·é‡çš„å€¼å‡1ï¼Œç«‹å³è¿”å›ã€‚å¦‚æœä¿¡å·é‡çš„å€¼ä¸º0ï¼Œåˆ™çº¿ç¨‹é˜»å¡ã€‚ç›¸å½“äºPæ“ä½œã€‚æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ã€‚semæŒ‡å‘çš„å¯¹è±¡æ˜¯ç”±sem_initè°ƒç”¨åˆå§‹åŒ–çš„ä¿¡å·é‡ã€‚ 3ã€ sem_postå‡½æ•°è¯¥å‡½æ•°ç”¨äºä»¥åŸå­æ“ä½œçš„æ–¹å¼å°†ä¿¡å·é‡çš„å€¼åŠ 1ã€‚å®ƒçš„åŸå‹å¦‚ä¸‹ï¼š int sem_post(sem_t *sem); é‡Šæ”¾ä¿¡å·é‡ï¼Œè®©ä¿¡å·é‡çš„å€¼åŠ 1ã€‚ç›¸å½“äºVæ“ä½œã€‚ä¸sem_waitä¸€æ ·ï¼ŒsemæŒ‡å‘çš„å¯¹è±¡æ˜¯ç”±sem_initè°ƒç”¨åˆå§‹åŒ–çš„ä¿¡å·é‡ã€‚è°ƒç”¨æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥è¿”å›-1. 4ã€sem_destroyå‡½æ•°è¯¥å‡½æ•°ç”¨äºå¯¹ç”¨å®Œçš„ä¿¡å·é‡çš„æ¸…ç†ã€‚å®ƒçš„åŸå‹å¦‚ä¸‹ï¼š int sem_destroy(sem_t *sem); æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥æ—¶è¿”å›-1. 123456789101112131415161718192021222324252627282930313233343536373839#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;pthread.h&gt;#include &lt;semaphore.h&gt; sem_t sem; void func1(void* arg) &#123; sem_wait(&amp;sem); int *running=arg; printf(&quot;thread running1 &quot;); printf(&quot;%d &quot;,*running); &#125; void func2(void* arg) &#123; printf(&quot;pthread2 running &quot;); sem_post(&amp;sem); &#125; int main() &#123; sem_init(&amp;sem,0,0); pthread_t thread[2]; int a=5; pthread_create(&amp;(thread[0]),NULL,(void*)func1,(void*)&amp;a); printf(&quot;main thread running &quot;); sleep(10); pthread_create(&amp;(thread[1]),NULL,(void*)func2,(void*)&amp;a); printf(&quot;main thread running2 &quot;); pthread_join(thread[0],NULL); pthread_join(thread[1],NULL); sem_destroy(&amp;sem); return 0; &#125; é¦–å…ˆåˆ›å»ºä¿¡å·é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º0ï¼Œè¡¨ç¤ºè¿™ä¸ªä¿¡å·é‡æ˜¯å½“å‰è¿›ç¨‹çš„å±€éƒ¨ä¿¡å·é‡ï¼Œåˆå§‹å€¼ä¸º0ã€‚ ç„¶åä½¿ç”¨pthread_create()å‡½æ•°åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œä¼ å…¥å‚æ•°aã€‚ çº¿ç¨‹1åˆ›å»ºå®Œæˆåï¼Œç”±äºä¿¡å·é‡åˆå§‹åŒ–value&#x3D;0ï¼Œè°ƒç”¨sem_waitä¼šé˜»å¡è¿™ä¸ªçº¿ç¨‹ï¼Œä¿¡å·é‡çš„å€¼å°†å‡å°‘1ï¼ˆæ­¤æ—¶&lt;0ï¼‰ï¼Œè¿™ä¸ªçº¿ç¨‹å‡½æ•°å°±ä¼šç­‰å¾…ã€‚ ä¸»çº¿ç¨‹sleep(10)åï¼Œçº¿ç¨‹2åˆ›å»ºå¹¶æ‰§è¡Œè°ƒç”¨ï¼Œsem_postç”¨äºä½¿ä¿¡å·é‡çš„å€¼å¢åŠ 1ï¼Œæ­¤æ—¶çº¿ç¨‹1å¯ä»¥æ‰§è¡Œã€‚ ä½¿ç”¨pthread_joinç­‰å¾…æ‰€åˆ›å»ºçš„ä¸¤ä¸ªçº¿ç¨‹çš„ç»“æŸã€‚ ä»¥ä¸Šä»£ç è¾“å‡ºä¸ºï¼š 12345main thread runningmain thread running2pthread2 runningthread running15 å¯ä»¥ç”¨æ¥åšçº¿ç¨‹åŒæ­¥ä½¿ç”¨ï¼Œæ¯”å¦‚å‡çº§æµç¨‹ä»£ç ä¸­ï¼Œå¯ä»¥åœ¨å‡çº§çš„åˆå§‹åŒ–ä»£ç ä¸­ä½¿ç”¨sem_waitï¼Œæœ€ç»ˆè¢«é˜»å¡åœ¨é‚£é‡Œï¼Œè€Œç”¨æˆ·æ‰§è¡Œå‡çº§å‘½ä»¤çš„æµç¨‹ä¸­æ‰ä¼šæ‰§è¡Œåˆ°sem_postå‡½æ•°ï¼Œä»è€Œè§¦å‘åˆ°sem_waitåé¢çš„æµç¨‹ç»§ç»­æ‰§è¡Œã€‚ ä¸‰ã€System -Vä¿¡å·é‡1ã€åˆ›å»ºSEMåŠŸèƒ½ï¼šè·å–ä¿¡å·é‡ID int semget(key_t key,int nsems,int semflg); è¿”å›å€¼ï¼šæˆåŠŸï¼šä¿¡å·é‡IDå¤±è´¥ï¼š-1å‚æ•°ï¼škeyï¼šä¿¡å·é‡çš„é”®å€¼nsemsï¼šä¿¡å·é‡å…ƒç´ çš„ä¸ªæ•°semflgï¼šåˆ›å»ºé€‰é¡¹IPC_CREATï¼šå¦‚æœkeyå¯¹åº”çš„ä¿¡å·é‡ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºIPC_EXCLï¼šå¦‚æœkeyå¯¹åº”çš„ä¿¡å·é‡å­˜åœ¨ï¼Œåˆ™æŠ¥é”™modeï¼šä¿¡å·é‡çš„è®¿é—®æƒé™åˆ›å»ºä¿¡å·é‡æ—¶ï¼Œè¿˜å—åˆ°ä»¥ä¸‹ç³»ç»Ÿä¿¡æ¯çš„å½±å“ SEMMNIï¼šç³»ç»Ÿä¸­ä¿¡å·é‡çš„æ€»æ•°æœ€å¤§å€¼SEMMSLï¼šæ¯ä¸ªä¿¡å·é‡ä¸­ä¿¡å·é‡å…ƒç´ çš„ä¸ªæ•°æœ€å¤§å€¼SEMMNSï¼šç³»ç»Ÿä¸­ç´ æœ‰ä¿¡å·é‡ä¸­çš„ä¿¡å·é‡å…ƒç´ çš„æ€»æ•°æœ€å¤§å€¼å®ä¾‹ä»£ç ï¼š 12345int main(void) &#123; key_t key = ftok(&quot;.&quot;,1); int semid = semget(key,2,IPC_CREATE|0666); &#125; 2ã€PVæ“ä½œåŠŸèƒ½ï¼šå¯¹ä¿¡å·é‡è¿›è¡ŒPVæ“ä½œï¼Œæˆ–è€…ç­‰é›¶æ“ä½œ int semop(int semid,struct sembuf sops[],unsigned nsops); è¿”å›å€¼ï¼šæˆåŠŸï¼š0å¤±è´¥ï¼š-1 å‚æ•°ï¼šsemidï¼šä¿¡å·é‡IDsopsï¼šä¿¡å·é‡æ“ä½œç»“æ„ä½“æ•°ç»„nsopsç»“æœä½“æ•°ç»„å…ƒç´ ä¸ªæ•°ä¿¡å·é‡æ“ä½œç»“æ„ä½“ 12345struct sembuf &#123; unsigned short sem_num;//ä¿¡å·é‡å…ƒç´ åºå· short sem_op;//æ“ä½œå‚æ•° short sem_flg;//æ“ä½œé€‰é¡¹ &#125; æ ¹æ®sem_opçš„å€¼ï¼Œä¿¡å·é‡æ“ä½œåˆ†ä¸º3ä¸­æƒ…å†µï¼šsem_op&gt;0ï¼šVæ“ä½œsem_op&#x3D;0ï¼šç­‰é›¶æ“ä½œsem_opç¤ºä¾‹ä»£ç  12345678910111213int main() &#123; key_t key = ftok(&quot;.&quot;, 1); // åˆ›å»ºï¼ˆè‹¥å·²æœ‰åˆ™æ‰“å¼€ï¼‰ä¸€ä¸ªåŒ…å«2ä¸ªå…ƒç´ çš„ä¿¡å·é‡ç»„ int id = semget(key, 2, IPC_CREAT|0666); // å®šä¹‰åŒ…å«ä¸¤ä¸ªP/Væ“ä½œçš„ç»“æ„ä½“æ•°ç»„ struct sembuf op[2]; op[0].sem_num = 0; // ä¿¡å·é‡å…ƒç´ åºå· op[0].sem_op = -2; // Pæ“ä½œ op[0].sem_num = 0; // é€‰é¡¹é»˜è®¤0 op[1].sem_num = 1; // ä¿¡å·é‡å…ƒç´ åºå· op[1].sem_op = +3; // Væ“ä½œ op[1].sem_num = 0; // é€‰é¡¹é»˜è®¤0 // åŒæ—¶å¯¹ç¬¬0ã€1å·ä¿¡å·é‡å…ƒç´ åˆ†åˆ«è¿›è¡ŒPã€Væ“ä½œ semop(id, op, 2);&#125; 3ã€è·å–æˆ–è®¾ç½®ä¿¡å·é‡çš„ç›¸å…³å±æ€§int semctl(int semid,int semnum,int cmd....) å‚æ•°ï¼šsemidï¼šä¿¡å·é‡IDsemnumï¼šä¿¡å·é‡å…ƒç´ åºå·cmdIPC_STATï¼šè·å–å±æ€§ä¿¡æ¯IPC_SETï¼šè®¾ç½®å±æ€§ä¿¡æ¯IPC_RMIDï¼šç«‹å³åˆ é™¤è¯¥ä¿¡å·é‡ï¼Œå‚æ•°semnumå°†è¢«å¿½ç•¥IPC_INFOï¼šè·å¾—å…³äºä¿¡å·é‡çš„ç³»ç»Ÿé™åˆ¶ä¿¡æ¯SEM_INFOï¼šè·å¾—ç³»ç»Ÿä¸ºå…±äº«å†…å­˜æ¶ˆè€—çš„èµ„æºä¿¡æ¯SEM_STATï¼šè·å¾—ç³»ç»Ÿä¸­æ‰€æœ‰SEMçš„ç›¸å…³ä¿¡æ¯GETALLï¼šè¿”å›æ‰€æœ‰ä¿¡å·é‡å…ƒç´ çš„å€¼ï¼Œå‚æ•°semnumå°†è¢«å¿½ç•¥GETNCNTï¼šè¿”å›æ­£é˜»å¡åœ¨å¯¹è¯¥å¸çº³åé‡å…ƒç´ Pæ“ä½œçš„è¿›ç¨‹æ€»æ•°GETPIDï¼šè¿”å›æœ€åä¸€ä¸ªé˜Ÿè¯¥ä¿¡å·é‡å…ƒç´ æ“ä½œçš„è¿›ç¨‹PIDGETVALï¼šè¿”å›è¯¥ä¿¡å·é‡å…ƒç´ çš„å€¼GETZCNTï¼šè¿”å›æ­£é˜»å¡å¯¹è¯¥ä¿¡å·é‡å…ƒç´ ç­‰é›¶æ“ä½œçš„è¿›ç¨‹æ€»æ•°SETALLï¼šè¿”å›æ‰€æœ‰ä¿¡å·é‡å…ƒç´ çš„å€¼ï¼Œå‚æ•°semnumå°†è¢«å¿½ç•¥SETVALï¼šè®¾ç½®è¯¥ä¿¡å·é‡å…ƒç´ çš„å€¼è¿”å›å€¼GETNCNTï¼šsemncntGETPIDï¼šsempidGETVALï¼šsemvalGETZCNTï¼šsemzcntIPC_INFOï¼šå†…æ ¸ä¸­è®°å½•æ‰€æœ‰SEMä¿¡æ¯çš„æ•°ç»„çš„ä¸‹æ ‡æœ€å¤§å€¼SEM_INFOï¼šåŒIPC_INFOSEM_STATï¼šå†…æ ¸ä¸­çœ‹iè·¯æ‰€æœ‰SEMä¿¡æ¯çš„æ•°ç»„å¤±è´¥ï¼š-1è¿™æ˜¯ä¸€ä¸ªå˜å‚å‡½æ•°ï¼Œæ ¹æ®cmdçš„ä¸åŒï¼Œå¯èƒ½éœ€è¦ç¬¬å››ä¸ªå‚æ•°ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„è”åˆä½“ï¼Œç”¨æˆ·éœ€è¦è‡ªå·±å®šä¹‰ 123456union semun &#123; int val;//å½“cmdä¸ºSERVALæ—¶ä½¿ç”¨ struct semid_ds *buf;//å½“cmdä¸ºIPC_STATæˆ–IPC_SETæ—¶ä½¿ç”¨ unsigned short *array;//å½“cmdä¸ºGETALLæˆ–SETALLæ—¶ä½¿ç”¨ struct seminfo *_buf;//å½“cmdä¸ºIPC_INFOæ—¶ä½¿ç”¨ &#125; å½“cmdä¸ºIPC_STATæˆ–IPC_SETæ—¶,éœ€è¦ç”¨åˆ°ä¸€ä¸‹å±æ€§ä¿¡æ¯ç»“æ„ä½“ 123456struct semid_ds &#123; struct ipc_perm sem_perm;//æƒé™ç›¸å…³ä¿¡æ¯ time_t sem_otime;//æœ€åä¸€æ¬¡semop()çš„ä¿¡æ¯ tien_t sem_ctime;//æœ€åä¸€æ¬¡çŠ¶æ€æ”¹å˜æ—¶é—´ unsigned short sem_nsems;//ä¿¡å·é‡å…ƒç´ ä¸ªæ•° &#125; ä½¿ç”¨ä¾‹å­ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758int mutex_p(key_t sem_tag, int *sem_id, unsigned int timeout)&#123; int ret; int semid =0; int semno = 0; int val; struct sembuf smbf[2] = &#123;&#123;0&#125;&#125;; DRV_CHECK_RETV(sem_id != NULL, -EINVAL); ret = semget(sem_tag, 1, IPC_CREAT | IPC_EXCL | MSG_SEM_PERMISSION_RW_GROUP); if (ret &lt; 0) &#123; if (errno == EEXIST) &#123; semid = semget(sem_tag, 1, 0); if (semid &lt; 0) &#123; return -EINVAL; &#125; &#125; else &#123; return -EINVAL; &#125; &#125; else &#123; semid = ret; val = 1; ret = semctl(semid, semno, SETVAL, val); if (ret &lt; 0) &#123; return -EINVAL; &#125; &#125; *sem_id = semid; smbf[0].sem_num = 0; smbf[0].sem_op = -1; smbf[0].sem_flg = (timeout == MUTEX_WAIT_FOR_EVER) ? SEM_UNDO : (SEM_UNDO | IPC_NOWAIT); ret = semop(semid, smbf, 1); if (ret == 0) &#123; return 0; &#125; else if (errno == EAGAIN) &#123; printf(&quot;have another process use &quot;); &#125; else &#123; printf(&quot;semop fail &quot;); &#125; return -EINVAL;&#125;int mutex_v(int sem_id)&#123; int ret; struct sembuf smbf; smbf[0].sem_num = 0; smbf[0].sem_op = 1; smbf[0].sem_flg = SEM_UNDO | IPC_NOWAIT; ret = semop(semid, &amp;smbf, 1); if (ret != 0) &#123; return -EINVAL; &#125; return ret;&#125; å››ã€é”äº’æ–¥é‡ä»æœ¬è´¨ä¸Šè¯´å°±æ˜¯ä¸€æŠŠé”, æä¾›å¯¹å…±äº«èµ„æºçš„ä¿æŠ¤è®¿é—®ã€‚ 1ã€åˆå§‹åŒ–åœ¨Linuxä¸‹, çº¿ç¨‹çš„äº’æ–¥é‡æ•°æ®ç±»å‹æ˜¯pthread_mutex_t. åœ¨ä½¿ç”¨å‰, è¦å¯¹å®ƒè¿›è¡Œåˆå§‹åŒ–: å¯¹äºé™æ€åˆ†é…çš„äº’æ–¥é‡, å¯ä»¥æŠŠå®ƒè®¾ç½®ä¸ºPTHREAD_MUTEX_INITIALIZER, æˆ–è€…è°ƒç”¨pthread_mutex_init.å¯¹äºåŠ¨æ€åˆ†é…çš„äº’æ–¥é‡, åœ¨ç”³è¯·å†…å­˜(malloc)ä¹‹å, é€šè¿‡pthread_mutex_initè¿›è¡Œåˆå§‹åŒ–, å¹¶ä¸”åœ¨é‡Šæ”¾å†…å­˜(free)å‰éœ€è¦è°ƒç”¨pthread_mutex_destroy. åŸå‹: &#96;int pthread_mutex_init(pthread_mutex_t *restrict mutex, const pthread_mutexattr_t *restric attr); int pthread_mutex_destroy(pthread_mutex_t *mutex); å¤´æ–‡ä»¶:#include&lt;pthread.h&gt; è¿”å›å€¼: æˆåŠŸåˆ™è¿”å›0, å‡ºé”™åˆ™è¿”å›é”™è¯¯ç¼–å·. è¯´æ˜: å¦‚æœä½¿ç”¨é»˜è®¤çš„å±æ€§åˆå§‹åŒ–äº’æ–¥é‡, åªéœ€æŠŠattrè®¾ä¸ºNULL. å…¶ä»–å€¼åœ¨ä»¥åè®²è§£ã€‚ 2ã€äº’æ–¥æ“ä½œ:å¯¹å…±äº«èµ„æºçš„è®¿é—®, è¦å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”, å¦‚æœäº’æ–¥é‡å·²ç»ä¸Šäº†é”, è°ƒç”¨çº¿ç¨‹ä¼šé˜»å¡, ç›´åˆ°äº’æ–¥é‡è¢«è§£é”. åœ¨å®Œæˆäº†å¯¹å…±äº«èµ„æºçš„è®¿é—®å, è¦å¯¹äº’æ–¥é‡è¿›è¡Œè§£é”ã€‚ é¦–å…ˆè¯´ä¸€ä¸‹åŠ é”å‡½æ•°: å¤´æ–‡ä»¶:#include&lt;pthread.h&gt; åŸå‹: 12int pthread_mutex_lock(pthread_mutex_t *mutex);int pthread_mutex_trylock(pthread_mutex_t *mutex); è¿”å›å€¼: æˆåŠŸåˆ™è¿”å›0, å‡ºé”™åˆ™è¿”å›é”™è¯¯ç¼–å·. è¯´æ˜: å…·ä½“è¯´ä¸€ä¸‹trylockå‡½æ•°, è¿™ä¸ªå‡½æ•°æ˜¯éé˜»å¡è°ƒç”¨æ¨¡å¼, ä¹Ÿå°±æ˜¯è¯´, å¦‚æœäº’æ–¥é‡æ²¡è¢«é”ä½, trylockå‡½æ•°å°†æŠŠäº’æ–¥é‡åŠ é”, å¹¶è·å¾—å¯¹å…±äº«èµ„æºçš„è®¿é—®æƒé™; å¦‚æœäº’æ–¥é‡è¢«é”ä½äº†, trylockå‡½æ•°å°†ä¸ä¼šé˜»å¡ç­‰å¾…è€Œç›´æ¥è¿”å›EBUSY, è¡¨ç¤ºå…±äº«èµ„æºå¤„äºå¿™çŠ¶æ€ã€‚ å†è¯´ä¸€ä¸‹è§£é”å‡½æ•°:åŸå‹: int pthread_mutex_unlock(pthread_mutex_t *mutex); è¿”å›å€¼: æˆåŠŸåˆ™è¿”å›0, å‡ºé”™åˆ™è¿”å›é”™è¯¯ç¼–å·.","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"çº¿ç¨‹","path":"/posts/çº¿ç¨‹.html","content":"æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œä¼šç”¨åˆ°pthread_create()å‡½æ•° ï¼Œæˆ‘ä»¬æ¥ç®€å•ä»‹ç»ä¸€ä¸‹è¯¥å‡½æ•°ï¼š pthread_create(çº¿ç¨‹çš„tid ï¼Œ çº¿ç¨‹å±æ€§ ï¼Œ å·¥ä½œå‡½æ•°å ï¼Œ å‡½æ•°éœ€è¦çš„å‚æ•°); è¿™ç¯‡åšå®¢è¦è®²çš„çº¿ç¨‹å±æ€§ï¼Œä¾¿æ˜¯ç”¨äºè¿›è¡Œçº¿ç¨‹çš„åˆå§‹åŒ–çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹çº¿ç¨‹å±æ€§çš„ä¿®æ”¹æ¥è‡ªå®šä¹‰çº¿ç¨‹ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆçº¿ç¨‹å±æ€§ ä¸€ã€çº¿ç¨‹å±æ€§ä¸­çš„æˆå‘˜çº¿ç¨‹å±æ€§æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨æ³•ä¸º pthread_attr_t å˜é‡åï¼ˆæœ¬ç¯‡åšå®¢é‡Œé»˜è®¤å˜é‡åä¸ºattrï¼‰ çº¿ç¨‹å±æ€§ç»“æ„ä½“ä¸­çš„æˆå‘˜åˆ†åˆ«æœ‰ï¼šçº¿ç¨‹çš„è­¦æˆ’ç¼“å†²åŒºã€çº¿ç¨‹çš„ä¼˜å…ˆçº§æŒ‡é’ˆã€çº¿ç¨‹çš„é€€å‡ºçŠ¶æ€ã€çº¿ç¨‹æ ˆåœ°å€ã€çº¿ç¨‹æ ˆå¤§å° æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹è¯¥ç»“æ„ä½“ä¸­çš„è¿™å‡ ä¸ªæˆå‘˜ çº¿ç¨‹çš„è­¦æˆ’ç¼“å†²åŒºé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œæ¯å½“ä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºå‡ºæ¥çš„æ—¶å€™ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„çº¿ç¨‹æ ˆå‡ºç°ï¼Œè€Œæ ˆå­˜åœ¨æº¢å‡ºé—®é¢˜ï¼ˆæ ˆçš„æº¢å‡ºéƒ½æ˜¯ä¸Šæº¢ï¼‰ï¼Œçº¿ç¨‹æ ˆæ˜¯ç”³è¯·åœ¨å †ç©ºé—´çš„ ä¸€æ—¦æ ˆå‘ç”Ÿæº¢å‡ºï¼Œæ•°æ®å°±ä¼šå‘ä¸Šè¦†ç›–ï¼Œå½±å“ç”šè‡³ç ´ååˆ°åº“ã€æ ˆåŒºç­‰ç©ºé—´ä¸­çš„æ•°æ®ã€‚ä½†æ›´å¯æ€•çš„æ˜¯ï¼Œç”±äºç”¨æˆ·å¯¹ç”¨æˆ·ç©ºé—´ä¸­çš„å†…å®¹å…·æœ‰è¯»å†™æƒé™ï¼Œçº¿ç¨‹æ ˆä¸Šæº¢æ‰€å¯¼è‡´çš„å¯¹è¿™äº›å†…å®¹çš„ä¿®æ”¹ï¼Œç³»ç»Ÿæ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œåªæœ‰å½“æ•°æ®æº¢å‡ºåˆ°å†…æ ¸å±‚æ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿå‘ç°é—®é¢˜ï¼Œä½†æ­¤æ—¶å·²ç»æ™šäº†ï¼Œæ•°æ®å·²ç»å…¨è¢«ç ´åäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ¥ç»™æ¯ä¸ªçº¿ç¨‹æ ˆâ€œåŠ ä¸ªç›–å­â€ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œè­¦æˆ’ç¼“å†²åŒºâ€ã€‚ è­¦æˆ’ç¼“å†²åŒºçš„å¤§å°ä¸€èˆ¬ä¸º4Kï¼Œè¿™å—å†…å­˜æ˜¯ä¸å¯è¯»å†™çš„ï¼Œæ‰€ä»¥å½“çº¿ç¨‹æ ˆå‘ç”Ÿä¸Šæº¢ï¼Œæƒ³è¦ä¿®æ”¹è¿™å—å†…å­˜ä¸­çš„å†…å®¹æ—¶ï¼Œç³»ç»Ÿå°±ä¼šå‘ç°æœ‰çº¿ç¨‹éæ³•æ“ä½œå†…å­˜ï¼Œå¹¶æ€æ­»è¯¥çº¿ç¨‹ï¼Œè¿™æ ·å°±å¯ä»¥ä¿æŠ¤å…¶ä»–å†…å­˜ä¸­çš„æ•°æ® çº¿ç¨‹çš„ä¼˜å…ˆçº§æŒ‡é’ˆè¡¨ç¤ºçº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸å»ºè®®ä¿®æ”¹ï¼Œå› ä¸ºä¼šå½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä¸€èˆ¬åªæœ‰æ€æ¯’è½¯ä»¶æˆ–ç³»ç»Ÿçš„é˜²å¾¡è½¯ä»¶æ‰ä¼šä¿®æ”¹å…¶ä¼˜å…ˆçº§ äºŒã€çº¿ç¨‹é€€å‡ºçŠ¶æ€çº¿ç¨‹çš„é€€å‡ºçŠ¶æ€æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯å›æ”¶æ€(PTHREAD_JOINABLE)å’Œåˆ†ç¦»æ€(PTHREAD_DETACH) çº¿ç¨‹æ ˆåœ°å€ç”±äºå½“ä¿®æ”¹çº¿ç¨‹å±æ€§æ—¶ï¼Œçº¿ç¨‹è¿˜æ²¡æœ‰è¢«åˆ›å»ºï¼Œè‡ªç„¶ä¹Ÿå°±æ²¡æœ‰åœ°å€å¯å­˜ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯nilï¼Œè¡¨ç¤ºç©º çº¿ç¨‹æ ˆå¤§å°çº¿ç¨‹æ ˆå¤§å°ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯8Mï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œ8Må¦‚æœç”¨äºŒè¿›åˆ¶è¡¨ç¤ºæ—¶éå¸¸å¤§çš„æ•°ï¼Œå°†è¿™ä¹ˆå¤§çš„æ•°æ”¾è¿›å»ä»…ä»…è¡¨ç¤ºçº¿ç¨‹æ ˆçš„å¤§å°å…¶å®æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™é‡Œå­˜æ”¾çš„æ•°æ®å°±æ˜¯0ï¼Œè¡¨ç¤º8Mï¼Œç”³è¯·ç©ºé—´æ—¶ä¹Ÿæ˜¯ç”³è¯·8Må¤§å°çš„ç©ºé—´ ä¸‰ã€ä¿®æ”¹çº¿ç¨‹å±æ€§çš„ç›¸å…³å‡½æ•°åœ¨äº†è§£äº†çº¿ç¨‹å±æ€§çš„ç»„æˆä¹‹åï¼Œæˆ‘ä»¬å°±è¦æ¥äº†è§£ä¸€ä¸‹ä¿®æ”¹çº¿ç¨‹å±æ€§çš„ç›¸å…³å‡½æ•°äº† å…ˆä»‹ç»ä¸‹ä¸€ä¼šä¼šç”¨åˆ°çš„å‡ ä¸ªå˜é‡ï¼š pthread_attr_t attr ; &#x2F;&#x2F;å®šä¹‰ä¸€ä¸ªçº¿ç¨‹å±æ€§ç»“æ„ä½“ int exit_state ; &#x2F;&#x2F;çº¿ç¨‹å±æ€§ä¸­çš„é€€å‡ºçŠ¶æ€ void* thread_stack_addr ; &#x2F;&#x2F;çº¿ç¨‹å±æ€§ä¸­çš„çº¿ç¨‹æ ˆåœ°å€ size_t thread_stack_size ; &#x2F;&#x2F;çº¿ç¨‹å±æ€§ä¸­çš„çº¿ç¨‹æ ˆå¤§å° å‡½æ•° åŠŸèƒ½ è¿”å›å€¼ pthread_attr_getdetachstate(&amp;attr , &amp;exit_state); exit_stateä½œä¸ºä¼ å‡ºå‚æ•°ï¼Œå¯ä»¥è·å–çº¿ç¨‹å±æ€§ä¸­çš„é€€å‡ºçŠ¶æ€ å›æ”¶æ€è¿”å› PTHREAD_CREATE_JOINABLEåˆ†ç¦»æ€è¿”å› PTHREAD_CREATE_DETACHED pthread_attr_setdetachstate(&amp;attr , exit_state); é€šè¿‡ä¼ å…¥å‚æ•°exit_stateï¼Œè®¾ç½®çº¿ç¨‹å±æ€§ä¸­çš„é€€å‡ºçŠ¶æ€ æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é0é”™è¯¯ç  pthread_attr_getstack(&amp;attr , &amp;thread_stack_addr , &amp;thread_stack_size); thread_stack_addrã€thread_stack_sizeä½œä¸ºä¼ å‡ºå‚æ•°ï¼Œå¯ä»¥è·å–çº¿ç¨‹å±æ€§ä¸­çš„æ ˆåœ°å€ä¸æ ˆå¤§å° è¿”å›ä¸¤ä¸ªå‚æ•°â€”â€”çº¿ç¨‹æ ˆåœ°å€ä¸çº¿ç¨‹æ ˆå¤§å° pthread_attr_setstack(&amp;attr , thread_stack_addr , thread_stack_size); é€šè¿‡ä¼ å…¥å‚æ•°thread_stack_addrã€thread_stack_sizeï¼Œå¯ä»¥è®¾ç½®çº¿ç¨‹å±æ€§ä¸­çš„æ ˆåœ°å€ä¸æ ˆå¤§å° æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é0é”™è¯¯ç  pthread_attr_init(&amp;attr); åˆå§‹åŒ–çº¿ç¨‹å±æ€§ç»“æ„ä½“ æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1 pthread_attr_destroy(&amp;attr); é‡Šæ”¾çº¿ç¨‹å±æ€§ç»“æ„ä½“å†…å­˜ æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1 å››ã€ä¿®æ”¹çº¿ç¨‹å±æ€§çš„å…·ä½“å®ç°æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™äº›å‡½æ•°æ¥å®é™…æ“ä½œä¸€ä¸‹ï¼Œå®Œæˆä»¥ä¸‹ä¸¤ä¸ªå°ä»»åŠ¡ è·å–çº¿ç¨‹å±æ€§ä¸­é»˜è®¤çš„é€€å‡ºçŠ¶æ€ï¼ˆéš¾åº¦ï¼šâ­ï¼‰è·å–é»˜è®¤çŠ¶æ€ä¸‹çº¿ç¨‹å±æ€§ä¸­çš„çº¿ç¨‹æ ˆåœ°å€ä¸å¤§å°ã€‚å°†çº¿ç¨‹å±æ€§ä¸­çš„é€€å‡ºçŠ¶æ€è®¾ç½®ä¸ºåˆ†ç¦»æ€ï¼Œä¿®æ”¹çº¿ç¨‹æ ˆåœ°å€ï¼Œä¿®æ”¹çº¿ç¨‹æ ˆå¤§å°ä¸º1Mï¼Œå¹¶æµ‹è¯•ä½¿ç”¨è¿™ç§çº¿ç¨‹å±æ€§çš„çº¿ç¨‹ï¼Œç³»ç»Ÿä¸€å…±èƒ½å¤Ÿåˆ›å»ºå¤šå°‘ä¸ªï¼Ÿï¼ˆéš¾åº¦ï¼šâ­â­â­â­ï¼‰PSï¼š64ä½æœºä¸‹ï¼Œå³ä½¿ä½ ä¿®æ”¹äº†çº¿ç¨‹æ ˆå¤§å°ï¼Œåˆ›å»ºçš„æ•°ç›®å’ŒåŸæ¥è¿˜æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºä½ çš„ä¿®æ”¹æ˜¯æ— æ•ˆçš„ï¼Œç³»ç»Ÿåˆ›å»ºçš„çº¿ç¨‹æ ˆå¤§å°è¿˜æ˜¯8Mï¼Œä¿®æ”¹çº¿ç¨‹æ ˆå¤§å°åªæœ‰32ä½æœºæœ‰æ•ˆ 1ã€è·å–çº¿ç¨‹å±æ€§ä¸­é»˜è®¤çš„é€€å‡ºçŠ¶æ€ï¼Œä»¥ä¸‹æ˜¯ä»£ç å®ç° 123456789101112131415161718192021222324252627282930#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;pthread.h&gt;#include &lt;fcntl.h&gt; int main()&#123; pthread_attr_t attr; //1.åˆå§‹åŒ–çº¿ç¨‹å±æ€§ pthread_attr_init(&amp;attr); //2.æ£€æµ‹çº¿ç¨‹å±æ€§ä¸­çš„çº¿ç¨‹é€€å‡ºçŠ¶æ€ int detach_status; pthread_attr_getdetachstate(&amp;attr , &amp;detach_status); //3.åˆ¤æ–­æ˜¯å›æ”¶æ€è¿˜æ˜¯åˆ†ç¦»æ€ if(detach_status == PTHREAD_CREATE_JOINABLE) &#123; printf(&quot;çº¿ç¨‹å±æ€§é»˜è®¤ä¸ºå›æ”¶æ€ &quot;); &#125; else &#123; printf(&quot;çº¿ç¨‹å±æ€§é»˜è®¤ä¸ºåˆ†ç¦»æ€ &quot;); &#125; //4.é‡Šæ”¾çº¿ç¨‹å±æ€§ç»“æ„ä½“å†…å­˜ pthread_attr_destroy(&amp;attr); printf(&quot;è¿›ç¨‹é€€å‡ºï¼ &quot;);&#125; æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢ï¼Ÿ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®Œæˆç¬¬äºŒä¸ªå°ä»»åŠ¡ 2ã€è·å–é»˜è®¤çŠ¶æ€ä¸‹çº¿ç¨‹å±æ€§ä¸­çš„çº¿ç¨‹æ ˆåœ°å€ä¸å¤§å°ã€‚å°†çº¿ç¨‹å±æ€§ä¸­çš„é€€å‡ºçŠ¶æ€è®¾ç½®ä¸ºåˆ†ç¦»æ€ï¼Œä¿®æ”¹çº¿ç¨‹æ ˆåœ°å€ï¼Œä¿®æ”¹çº¿ç¨‹æ ˆå¤§å°ä¸º1Mï¼Œå¹¶æµ‹è¯•ä½¿ç”¨è¿™ç§çº¿ç¨‹å±æ€§çš„çº¿ç¨‹ï¼Œç³»ç»Ÿä¸€å…±èƒ½å¤Ÿåˆ›å»ºå¤šå°‘ä¸ªï¼Œä»¥ä¸‹æ˜¯ä»£ç å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475//pthread_addr_change.c #include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/wait.h&gt;#include &lt;sys/stat.h&gt;#include &lt;pthread.h&gt;#include &lt;fcntl.h&gt; void* thread_jobs(void* arg)&#123; while(1) &#123; sleep(1); &#125; pthread_exit(NULL);&#125; int main()&#123; pthread_attr_t attr; //1.åˆå§‹åŒ–çº¿ç¨‹å±æ€§ pthread_attr_init(&amp;attr); //2.æ£€æµ‹çº¿ç¨‹å±æ€§ä¸­çš„çº¿ç¨‹é€€å‡ºçŠ¶æ€ int detach_status; pthread_attr_getdetachstate(&amp;attr , &amp;detach_status); //3.åˆ¤æ–­æ˜¯å›æ”¶æ€è¿˜æ˜¯åˆ†ç¦»æ€å¹¶æ‰“å° if(detach_status == PTHREAD_CREATE_JOINABLE) &#123; printf(&quot;çº¿ç¨‹å±æ€§é»˜è®¤ä¸ºå›æ”¶æ€ &quot;); &#125; else &#123; printf(&quot;çº¿ç¨‹å±æ€§é»˜è®¤ä¸ºåˆ†ç¦»æ€ &quot;); &#125; //4.å°†çº¿ç¨‹å±æ€§ä¸­çš„é€€å‡ºæ€ä¿®æ”¹ä¸ºåˆ†ç¦»æ€ pthread_attr_setdetachstate(&amp;attr , PTHREAD_CREATE_DETACHED); //5.è·å–çº¿ç¨‹å±æ€§ä¸­çº¿ç¨‹æ ˆçš„åˆå§‹åœ°å€ä¸å¤§å°å¹¶æ‰“å° void* thread_stack_addr; size_t thread_stack_size; pthread_attr_getstack(&amp;attr , &amp;thread_stack_addr , &amp;thread_stack_size); printf(&quot;çº¿ç¨‹æ ˆåœ°å€ä¸º %p , çº¿ç¨‹æ ˆå¤§å°ä¸º %d &quot; , thread_stack_addr , (int)thread_stack_size); //6.é€šè¿‡mallocå‡½æ•°ä¿®æ”¹çº¿ç¨‹æ ˆçš„åˆå§‹åœ°å€ï¼Œå¹¶å°†çº¿ç¨‹æ ˆå¤§å°æ”¹ä¸º1M pthread_t tid; thread_stack_size = 0x100000;//0x100000ä»£è¡¨1M int flag = 0; int errno; while(1) &#123; //å¦‚æœmallocå‡½æ•°çš„è¿”å›å€¼ä¸ºNULLï¼Œå°±è¯´æ˜åˆ†é…å¤±è´¥ï¼Œå†…å­˜å·²ç»ç”¨å®Œ if((thread_stack_addr = (void*)malloc(thread_stack_size)) == NULL) &#123; perror(&quot;thread_addr malloc failed! &quot;); exit(0);//è¿›ç¨‹é€€å‡º &#125; //ä¿®æ”¹æ ˆåˆå§‹åœ°å€å’Œå¤§å° pthread_attr_setstack(&amp;attr , thread_stack_addr , thread_stack_size); //åˆ›å»ºçº¿ç¨‹ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦åˆ›å»ºå¤±è´¥ if((errno = pthread_create(&amp;tid , &amp;attr , thread_jobs , NULL)) &gt; 0) &#123; perror(&quot;thread create failed! &quot;); exit(0);//è¿›ç¨‹ç›´æ¥é€€å‡º &#125; else &#123; flag++; printf(&quot;flag = %d &quot;,flag); &#125; &#125; pthread_attr_destroy(&amp;attr); return 0; &#125; ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š äº”ã€pthread äº²å’Œæ€§è®¾ç½®1ã€pthread_attr_setaffinity_npå‡½æ•°åŸå‹ï¼š 12int pthread_attr_setaffinity_np(pthread_attr_t *attr, size_t cpusetsize, const cpu_set_t *cpuset); attrï¼šæŒ‡å‘çº¿ç¨‹å±æ€§å¯¹è±¡çš„æŒ‡é’ˆã€‚ cpusetsizeï¼šCPU äº²å’Œæ€§é›†åˆçš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ cpusetï¼šæŒ‡å‘ CPU äº²å’Œæ€§é›†åˆçš„æŒ‡é’ˆï¼Œå…¶ä¸­åŒ…å«è¦ç»‘å®šçº¿ç¨‹çš„ CPUã€‚ è¿”å›å€¼ï¼šæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ä»£ç ã€‚ ç”¨äºè®¾ç½®çº¿ç¨‹çš„ CPU äº²å’Œæ€§ï¼ˆCPU Affinityï¼‰ã€‚ å®ƒå…è®¸å°†çº¿ç¨‹ç»‘å®šåˆ°ç‰¹å®šçš„ CPU æ ¸å¿ƒæˆ– CPU é›†åˆä¸Šï¼Œä»¥æ§åˆ¶çº¿ç¨‹åœ¨å“ªäº› CPU ä¸Šè¿è¡Œã€‚ 2ã€pthread_setaffinity_npå‡½æ•°åŸå‹ï¼š 12int pthread_setaffinity_np(pthread_t thread, size_t cpusetsize, const cpu_set_t *cpuset); threadï¼šè¦è®¾ç½® CPU äº²å’Œæ€§çš„çº¿ç¨‹æ ‡è¯†ç¬¦ã€‚ cpusetsizeï¼šCPU äº²å’Œæ€§é›†åˆçš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ cpusetï¼šæŒ‡å‘ CPU äº²å’Œæ€§é›†åˆçš„æŒ‡é’ˆï¼Œå…¶ä¸­åŒ…å«è¦ç»‘å®šçº¿ç¨‹çš„ CPUã€‚ è¿”å›å€¼ï¼šæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ä»£ç ã€‚ ç”¨äºè®¾ç½®çº¿ç¨‹çš„ CPU äº²å’Œæ€§ï¼ˆCPU Affinityï¼‰ã€‚ å®ƒå…è®¸å°†çº¿ç¨‹ç»‘å®šåˆ°ç‰¹å®šçš„ CPU æ ¸å¿ƒæˆ– CPU é›†åˆä¸Šï¼Œä»¥æ§åˆ¶çº¿ç¨‹åœ¨å“ªäº› CPU ä¸Šè¿è¡Œã€‚ ç¤ºä¾‹1ï¼ˆæ¨èï¼‰æœ¬ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨åˆ›å»ºçº¿ç¨‹æ—¶é™åˆ¶å…¶åªèƒ½åœ¨ cpu1 ä¸Šè¿è¡Œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839#define _GNU_SOURCE#include &lt;stdio.h&gt;#include &lt;pthread.h&gt;#include &lt;unistd.h&gt;#include &lt;sched.h&gt;void *thread_func(void *arg)&#123; usleep(10000); // è·å–å½“å‰çº¿ç¨‹çš„ CPU äº²å’Œæ€§ cpu_set_t cpuset; CPU_ZERO(&amp;cpuset); pthread_getaffinity_np(pthread_self(), sizeof(cpu_set_t), &amp;cpuset); // æ‰“å°å½“å‰çº¿ç¨‹ç»‘å®šçš„ CPU for (int i = 0; i &lt; CPU_SETSIZE; i++) &#123; if (CPU_ISSET(i, &amp;cpuset)) &#123; printf(&quot;thread is running on cpu %d &quot;, i); &#125; &#125; return NULL;&#125;int main() &#123; pthread_t tid; pthread_attr_t attr; pthread_attr_init(&amp;attr); // åˆ›å»ºçº¿ç¨‹å¹¶è®¾ç½®å…¶åªèƒ½åœ¨ cpu1 ä¸Šè¿è¡Œ cpu_set_t mask; CPU_ZERO(&amp;mask); CPU_SET(1, &amp;mask); pthread_attr_setaffinity_np(&amp;attr, sizeof(mask), &amp;mask); pthread_create(&amp;tid, &amp;attr, thread_func, NULL); pthread_attr_destroy(&amp;attr); pthread_join(tid, NULL); return 0;&#125; ç¤ºä¾‹2ï¼šæœ¬ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨åˆ›å»ºçº¿ç¨‹åé™åˆ¶å…¶åªèƒ½åœ¨ cpu0 1 2 ä¸Šè¿è¡Œã€‚ 12345678910111213141516171819202122232425262728293031323334353637#define _GNU_SOURCE#include &lt;stdio.h&gt;#include &lt;pthread.h&gt;#include &lt;unistd.h&gt;#include &lt;sched.h&gt;void *thread_func(void *arg)&#123; usleep(10000); // è·å–å½“å‰çº¿ç¨‹çš„ CPU äº²å’Œæ€§ cpu_set_t cpuset; CPU_ZERO(&amp;cpuset); pthread_getaffinity_np(pthread_self(), sizeof(cpu_set_t), &amp;cpuset); // æ‰“å°å½“å‰çº¿ç¨‹ç»‘å®šçš„ CPU for (int i = 0; i &lt; CPU_SETSIZE; i++) &#123; if (CPU_ISSET(i, &amp;cpuset)) &#123; printf(&quot;thread is running on cpu %d &quot;, i); &#125; &#125; return NULL;&#125;int main() &#123; // åˆ›å»ºçº¿ç¨‹å¹¶è®¾ç½®å…¶åªèƒ½åœ¨ cpu0 1 2 ä¸Šè¿è¡Œ pthread_t tid; cpu_set_t mask; CPU_ZERO(&amp;mask); CPU_SET(0, &amp;mask); CPU_SET(1, &amp;mask); CPU_SET(2, &amp;mask); pthread_create(&amp;tid, NULL, thread_func, NULL); pthread_setaffinity_np(tid, sizeof(mask), &amp;mask); pthread_join(tid, NULL); return 0;&#125;","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"åŠ¨æ€é“¾æ¥åº“ã€é™æ€é“¾æ¥åº“","path":"/posts/åŠ¨æ€é“¾æ¥åº“ã€é™æ€é“¾æ¥åº“.html","content":"ä¸€ã€ä»€ä¹ˆæ˜¯é“¾æ¥åº“æœ‰æ—¶å€™æˆ‘ä»¬å¯¹å¤–æä¾›åŠŸèƒ½çš„æ—¶å€™ï¼Œå¯èƒ½ä¸å¸Œæœ›å¯¹æ–¹çœ‹åˆ°æºç ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ¶ä½œæˆåº“æ–‡ä»¶ï¼ŒæŠŠåº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶ç»™åˆ°å¯¹æ–¹å°±å¯ä»¥è¾¾åˆ°æä¾›åŠŸèƒ½åˆä¸æš´éœ²æºç çš„ç›®çš„ã€‚é“¾æ¥åº“å°±æ˜¯æŒ‡å°†åº“æ–‡ä»¶ç¼–è¯‘åæ‰“åŒ…ä¸ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶ä¼šåœ¨ç¨‹åºè°ƒç”¨çš„æ—¶å€™åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæºæ–‡ä»¶ç¼–è¯‘ä¸ºç›®æ ‡æ–‡ä»¶åï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­æ‰€å¼•ç”¨çš„å¤–éƒ¨çš„ç¬¦å·éœ€è¦é€šè¿‡é“¾æ¥æ¥æ‰¾åˆ°è¿™éƒ¨åˆ†ç¼ºå¤±çš„åœ°å€ã€‚è€Œé“¾æ¥çš„æ–¹å¼åˆåˆ†ä¸ºä¸¤ç§ï¼Œå¦‚æœæ˜¯åœ¨ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ä¹‹å‰å°±å·²ç»æŠŠæ‰€æœ‰çš„é“¾æ¥æ“ä½œå®Œæˆäº†ï¼Œè¿™ç§é“¾æ¥ç§°ä¸ºé™æ€é“¾æ¥ï¼Œè¿™ç§åº“æ–‡ä»¶ç§°ä¸ºé™æ€é“¾æ¥åº“ï¼›å¦‚æœæ˜¯åœ¨ç¨‹åºæ‰§è¡Œçš„æ—¶å€™æ‰è¿›è¡Œé“¾æ¥ï¼Œè¿™ç§ç§°ä¸ºåŠ¨æ€é“¾æ¥ï¼Œå¯¹åº”çš„åº“æ–‡ä»¶ç§°ä¸ºåŠ¨æ€é“¾æ¥åº“ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œä½¿ç”¨é™æ€åº“æ—¶ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¯ä»¥ç‹¬ç«‹è¿è¡Œçš„ï¼Œå› ä¸ºä»–ä¸å†éœ€è¦å¤–éƒ¨çš„å†…å®¹ï¼Œè€ŒåŠ¨æ€åº“ç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å°±æ— æ³•å•ç‹¬è¿è¡Œï¼Œå› ä¸ºä»–åœ¨è¿è¡Œæ—¶ï¼Œæ‰ä¼šå»é“¾æ¥æ‰€å¼•ç”¨çš„å¤–éƒ¨åœ°å€ã€‚ 1. é™æ€é“¾æ¥åº“é™æ€åº“ä¼šç›´æ¥åŠ è½½åˆ°ä»£ç æ®µï¼Œä»–å’Œæ‰€æœ‰çš„ç›®æ ‡æ–‡ä»¶ä¸€èµ·é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶åå¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚ä½†æ˜¯ï¼Œæ­£å› ä¸ºé™æ€åº“ä¼šç›´æ¥åŠ è½½åˆ°å†…å­˜çš„ä»£ç æ®µï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„å†…éƒ¨éƒ½æ‹·è´äº†æ‰€æœ‰ç›®æ ‡æ–‡ä»¶å’Œé™æ€åº“çš„æŒ‡ä»¤å’Œæ•°æ®ï¼Œç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¼šæ¯”è¾ƒå¤§ã€‚å¹¶ä¸”ï¼Œå¦‚æœæ•´ä¸ªç³»ç»Ÿä¸­æœ‰å¤šä¸ªé“¾æ¥ç»Ÿä¸€é™æ€åº“çš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œæ¯ä¸ªå¯æ‰§è¡Œæ–‡ä»¶éƒ½è¦æ‹·è´ä¸€ä»½é™æ€åº“çš„æŒ‡ä»¤å’Œæ•°æ®ï¼Œè¿™å°±é€ æˆäº†ç©ºé—´æµªè´¹ï¼Œå› ä¸ºä»–ä»¬æ‹·è´çš„æ•°æ®éƒ½æ˜¯åŒæ ·çš„å†…å®¹ã€‚æœ€åï¼Œå¦‚æœä¸€æ—¦é™æ€åº“æ–‡ä»¶æœ‰ä»£ç æ›´æ–°ï¼Œå°±éœ€è¦é‡æ–°ç¼–è¯‘é“¾æ¥é‡æ–°ç”Ÿæˆæ•´ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ›´æ–°å‡çº§éº»çƒ¦ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œé™æ€é“¾æ¥åº“æ–‡ä»¶çš„åç§°é€šå¸¸ä¸º libxxx .aï¼Œåœ¨ Windows ç³»ç»Ÿä¸­ï¼Œé™æ€é“¾æ¥åº“æ–‡ä»¶çš„åç¼€åä¸º .libã€‚ 2. åŠ¨æ€é“¾æ¥åº“å…¶å®ï¼ŒåŠ¨æ€åº“è¿™ä¸ªç§°å‘¼æœ¬èº«æ˜¯å¯¹ Windows å¹³å°ä¸ŠåŠ¨æ€é“¾æ¥æ‰€ç”¨çš„åº“æ–‡ä»¶çš„ä¸€ç§ç§°å‘¼ï¼Œåœ¨ Linux ä¸‹ï¼Œä¸€èˆ¬ç§°ä¸ºå…±äº«åº“ã€‚åŠ¨æ€åº“æ˜¯åœ¨è¿è¡Œæ—¶åŠ è½½åˆ°å†…å­˜çš„å…±äº«åº“æ®µï¼Œè¿™æ ·ï¼Œå¦‚æœå¾ˆå¤šç¨‹åºéƒ½è¦ç”¨åˆ°é™æ€åº“çš„æ—¶å€™ï¼Œå°±ä¼šèŠ‚çœå¤§é‡å†…å­˜ï¼Œå› ä¸ºå®ƒä¸åƒé™æ€åº“é‚£æ ·åŠ è½½åˆ°ä»£ç æ®µï¼Œè€Œæ˜¯æ˜¯åœ¨è¿è¡Œæ—¶è½½å…¥å†…å­˜çš„å…±äº«åº“æ®µï¼Œå½“å¤šä¸ªç¨‹åºè¦ç”¨åˆ°åŒä¸€ä¸ªåŠ¨æ€åº“æ—¶ï¼Œæ‰€æœ‰ç¨‹åºå¯ä»¥å…±äº«è¿™ä¸ªå…±äº«åº“æ®µçš„æŒ‡ä»¤å’Œæ•°æ®ã€‚åŠ¨æ€é“¾æ¥çš„å®ç°æ˜¯è¿™æ ·çš„ï¼Œåœ¨ç¼–è¯‘æ—¶é¦–å…ˆç”±é™æ€é“¾æ¥å™¨å°†æ‰€æœ‰çš„ç›®æ ‡æ–‡ä»¶é“¾æ¥ä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç­‰åˆ°ç¨‹åºè¿è¡Œæ—¶ä¼šå°†è¦ç”¨åˆ°çš„åŠ¨æ€åº“åŠ è½½åˆ°å†…å­˜çš„å…±äº«åº“æ®µï¼Œç”±åŠ¨æ€é“¾æ¥å™¨å®Œæˆå¯æ‰§è¡Œæ–‡ä»¶å’ŒåŠ¨æ€åº“æ–‡ä»¶çš„é“¾æ¥å·¥ä½œï¼Œå¯ä»¥ç†è§£ä¸ºæŒ‰éœ€è½½å…¥å†…å­˜ï¼ˆåœ¨éœ€è¦ç”¨åˆ°çš„æ—¶å€™ï¼Œæ‰ä¼šè½½å…¥å†…å­˜ï¼‰ã€‚åŠ¨æ€åº“å¤§å¤§æ–¹ä¾¿äº†ç¨‹åºçš„å‡çº§å’Œæ›´æ”¹ï¼Œåªè¦ç”¨æ–°çš„åŠ¨æ€åº“æ–‡ä»¶æ›¿æ¢æ—§çš„åŠ¨æ€åº“æ–‡ä»¶å³å¯ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨è¿æ¥æ–°çš„åº“æ–‡ä»¶ã€‚ä½†æ˜¯æ­£å› ä¸ºåŠ¨æ€åº“è¿è¡Œæ—¶è½½å…¥çš„è¿™ä¸ªç‰¹ç‚¹ï¼Œä½¿ç”¨åŠ¨æ€åº“çš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨è¿è¡Œæ—¶ï¼Œä¼šç•¥æ…¢ä¸€äº›ï¼Œä½†æ•´ä½“æ¥è¯´ï¼Œè¿è¡Œé€Ÿåº¦çš„æ€§èƒ½æŸå¤±ï¼Œè¿œè¿œå°äºå†…å­˜èŠ‚çœå¸¦æ¥çš„æ”¶ç›Šã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼ŒåŠ¨æ€é“¾æ¥åº“çš„åç§°é€šå¸¸ä¸º libxxx.soï¼Œåœ¨ Windows ç³»ç»Ÿä¸­ï¼ŒåŠ¨æ€é“¾æ¥åº“çš„åç¼€åä¸º .dllã€‚GCC ç¼–è¯‘å™¨åœ¨ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œé»˜è®¤ä¼šä¼˜å…ˆä½¿ç”¨åŠ¨æ€é“¾æ¥åº“å®Œæˆé“¾æ¥ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿç¯å¢ƒä¸­æ²¡æœ‰ç¨‹åºæ–‡ä»¶æ‰€éœ€è¦çš„åŠ¨æ€é“¾æ¥åº“ï¼ŒGCC ä¾¿ä¼šé€‰æ‹©é™æ€é“¾æ¥åº“è¿›è¡Œé™æ€é“¾æ¥ã€‚å¦‚æœä¸¤ç§åº“æ–‡ä»¶éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™é“¾æ¥å¤±è´¥ã€‚ 3. åº“æ–‡ä»¶ä¸å¤´æ–‡ä»¶æˆ‘ä»¬åœ¨å‘å¸ƒåº“æ–‡ä»¶çš„åŒæ—¶ï¼Œè¦å°†åº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶ä¸€èµ·å‘å¸ƒï¼Œå¤´æ–‡ä»¶ä¸­å­˜å‚¨äº†å˜é‡ã€å‡½æ•°æˆ–è€…ç±»ç­‰è¿™äº›åŠŸèƒ½æ¨¡å—çš„å£°æ˜éƒ¨åˆ†ï¼Œåº“æ–‡ä»¶ä¸­å­˜å‚¨äº†å„æ¨¡å—å…·ä½“çš„å®ç°éƒ¨åˆ†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤´æ–‡ä»¶ä¸­å®šä¹‰äº†è°ƒç”¨åº“æ–‡ä»¶ä¸­åŠŸèƒ½æ¨¡å—çš„æ¥å£ã€‚å¤´æ–‡ä»¶çš„å­˜åœ¨ä¹Ÿå®ç°äº†è¿™æ ·ä¸€ç§åŠŸèƒ½ï¼Œå½“æˆ‘ä»¬å¯¹å¤–æä¾›åŠŸèƒ½æ—¶ï¼Œå¯ä»¥é€šè¿‡åº“æ–‡ä»¶æ¥éšè—æºç å®ç°ï¼ŒåŠŸèƒ½çš„ä½¿ç”¨æ–¹åªéœ€è¦æ ¹æ®å¤´æ–‡ä»¶æ‰€æä¾›çš„æ¥å£æ¥è°ƒç”¨åŠŸèƒ½æ¨¡å—å³å¯ã€‚ 4. åº“æ–‡ä»¶çš„å¼•ç”¨å½“æˆ‘ä»¬ä½¿ç”¨ GCC ç¼–è¯‘å’Œé“¾æ¥ç¨‹åºæ—¶ï¼ŒGCC é»˜è®¤ä¼šé“¾æ¥ libc.a æˆ–è€… libc.soè¿™ä¸¤ä¸ªæ ‡å‡†åº“ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–çš„åº“ï¼ˆéæ ‡å‡†åº“ã€ç¬¬ä¸‰æ–¹åº“ç­‰ï¼‰ï¼Œå°±éœ€è¦æ‰‹åŠ¨å»æ·»åŠ é“¾æ¥åº“ã€‚é€šè¿‡ GCC -l é€‰é¡¹æ¥æŒ‡å®šåº“åï¼Œç›´æ¥åœ¨ -l åé¢åŠ åº“åå³å¯ã€‚ï¼ˆ -l æ˜¯å°å†™çš„ L ï¼‰æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æŒ‡å®šäº†è¦ä½¿ç”¨çš„åº“åæ—¶ï¼ŒGCC ä¼šè‡ªåŠ¨åœ¨æ ‡å‡†åº“ç›®å½•ä¸­æœç´¢æ–‡ä»¶ï¼Œä¾‹å¦‚åœ¨CentOSä¸­æ˜¯ &#x2F;usr&#x2F;lib ç›®å½•ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³é“¾æ¥ä½äºå…¶å®ƒç›®å½•ä¸­çš„åº“ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è‡ªå·±å»ºçš„åº“ï¼Œæˆ–è€…æˆ‘ä»¬è¦å¼•ç”¨åˆ«äººæä¾›çš„åº“ï¼Œå°±éœ€è¦åœ¨ç¼–è¯‘æ—¶æ˜¾ç¤ºæŒ‡å®šåº“çš„è·¯å¾„ã€‚æŒ‡å®šæ–¹æ³•æœ‰ä¸‰ç§ï¼šâ‘  åƒæŒ‡å®šæ™®é€šå¤´æ–‡ä»¶çš„è·¯å¾„ä¸€æ ·ï¼Œä¸º GCC æ˜¾ç¤ºæŒ‡å®šè¯¥åº“æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ä¸æ–‡ä»¶å -I &#x2F;ç›®å½•å ã€‚â‘¡ é€šè¿‡ GCC çš„ -L é€‰é¡¹ï¼Œä¸ºGCCå¢åŠ æœç´¢ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ª -L é€‰é¡¹ï¼Œæˆ–è€…åœ¨ä¸€ä¸ªé€‰é¡¹å†…ä½¿ç”¨å†’å· : åˆ†å‰²æ¥æŒ‡å®šå¤šä¸ªæœç´¢è·¯å¾„ã€‚â‘¢ æŠŠåº“æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åŠ åˆ°ç¯å¢ƒå˜é‡ LIBRARYPATH ä¸­ã€‚ äºŒã€è‡ªå·±åŠ¨æ‰‹åˆ¶ä½œé™æ€é“¾æ¥åº“å‡†å¤‡å·¥ä½œï¼Œå…±å‡†å¤‡4ä¸ªæ–‡ä»¶ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ my_print.h æ–‡ä»¶å†…å®¹å¦‚ä¸‹ 123456789101112#ifndef _TEST_H#define _TEST_H#include &quot;stdio.h&quot;#include &quot;stdlib.h&quot;void print_array_int(int* array, int len);void print_array_char(char* array, int len);void print_array_string(char* array[], int len);void print_hello();#endif my_print.c æ–‡ä»¶å†…å®¹å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334#include &quot;my_print.h&quot; void print_array_int(int* array, int len)&#123; int i = 0; printf(&quot;array: &quot;); for(i = 0; i &lt; len; i++) &#123; printf(&quot;%d &quot;, array[i]); &#125; printf(&quot; &quot;);&#125; void print_array_char(char* array, int len)&#123; i = 0; printf(&quot;array: &quot;); for(i = 0; i &lt; len; i++) &#123; printf(&quot;%c &quot;, array[i]); &#125; printf(&quot; &quot;);&#125;void print_array_string(char* array[], int len)&#123; int i = 0; printf(&quot;array: &quot;); for(i = 0; i &lt; len; i++) &#123; printf(&quot;%s &quot;, array[i]); &#125; printf(&quot; &quot;);&#125; main.c æ–‡ä»¶å†…å®¹å¦‚ä¸‹ 12345678910111213141516171819#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt; #include &quot;my_print.h&quot; int main()&#123; int a1[10]; int i = 0; for(i = 0; i &lt; 10; i++) &#123; a1[i] = i + 1; &#125; print_array_int(a1, 10); print_hello(); return 0;&#125; print_hello.c æ–‡ä»¶å†…å®¹å¦‚ä¸‹ 123456#include &quot;my_print.h&quot; void print_hello()&#123; printf(&quot;hello Linux ... &quot;);&#125; 1. é™æ€åº“çš„åˆ¶ä½œâ‘  é¦–å…ˆæŠŠæ‰€æœ‰ .c æ–‡ä»¶ç¼–è¯‘ä¸º .o æ–‡ä»¶ 1gcc -c *.c -I ../header/ ä¸€å®šè¦ä» .o æ–‡ä»¶å»ç”Ÿæˆ .a æ–‡ä»¶ï¼Œå¦åˆ™å³ä½¿ä½ ç”Ÿæˆäº†åº“ï¼Œåœ¨ä½¿ç”¨æ—¶ä¹Ÿå¯èƒ½å‡ºç°æœªçŸ¥çš„é”™è¯¯ã€‚â‘¡ å°† .o æ–‡ä»¶æ‰“åŒ…ä¸º .a æ–‡ä»¶è¿™ä¸€æ­¥éœ€è¦ä½¿ç”¨ ar å·¥å…·æ¥å®Œæˆã€‚ar å·¥å…·æ˜¯ç”¨æ¥åˆ›å»º, ä¿®æ”¹å’Œæå–æ¡£æ¡ˆçš„å·¥å…·ï¼Œar æ˜¯ archive çš„ç¼©å†™ã€‚å½’æ¡£æ˜¯æŒ‡å°†å¤šä¸ªæ–‡ä»¶ï¼ˆæˆ–ä¸€ä¸ªæ–‡ä»¶ï¼‰æ”¾åˆ°å•ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸è¿›è¡Œå…¶ä»–é¢å¤–çš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½’æ¡£å¹¶ä¸ç­‰åŒäºå‹ç¼©ï¼Œå‹ç¼©ä¼šä½¿æ–‡ä»¶çš„å¤§å°å‡å°ã€‚ 1ar rcs libmprint.a *.o å‚æ•° r ï¼šåœ¨åº“ä¸­æ’å…¥æ¨¡å—ï¼ˆæ›¿æ¢ï¼‰ã€‚å½“æ’å…¥çš„æ¨¡å—åå·²ç»åœ¨åº“ä¸­å­˜åœ¨ï¼Œåˆ™æ›¿æ¢åŒåçš„æ¨¡å—ã€‚å¦‚æœè‹¥å¹²æ¨¡å—ä¸­æœ‰ä¸€ä¸ªæ¨¡å—åœ¨åº“ä¸­ä¸å­˜åœ¨ï¼Œar æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œå¹¶ä¸æ›¿æ¢å…¶ä»–åŒåæ¨¡å—ã€‚é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œæ–°çš„æˆå‘˜å¢åŠ åœ¨åº“çš„ç»“å°¾å¤„ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–ä»»é€‰é¡¹æ¥æ”¹å˜å¢åŠ çš„ä½ç½®ã€‚ å‚æ•° c ï¼šåˆ›å»ºä¸€ä¸ªåº“ã€‚ä¸ç®¡åº“æ˜¯å¦å­˜åœ¨ï¼Œéƒ½å°†åˆ›å»ºã€‚ å‚æ•° s ï¼šåˆ›å»ºç›®æ ‡æ–‡ä»¶ç´¢å¼•ï¼Œè¿™åœ¨åˆ›å»ºè¾ƒå¤§çš„åº“æ—¶èƒ½åŠ å¿«æ—¶é—´ã€‚å¦‚æœä¸éœ€è¦åˆ›å»ºç´¢å¼•ï¼Œå¯æ”¹æˆå¤§å†™ S å‚æ•°ã€‚å¦‚æœ .a æ–‡ä»¶ç¼ºå°‘ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨ ranlib å‘½ä»¤æ·»åŠ ï¼‰ã€‚ ä¸€èˆ¬æˆ‘ä»¬å‘½ä»¤é™æ€åº“çš„æ—¶å€™æ˜¯è¿™æ ·çš„ï¼Œå‰é¢æ˜¯ lib ä¸­é—´åŠ ä¸Šæˆ‘ä»¬è‡ªå·±ç»™é™æ€åº“æ–‡ä»¶çš„åç§°ï¼Œåé¢åŠ åç¼€ .a ï¼Œä¹Ÿå°±æ˜¯ libxxx.a ï¼Œå®é™…ä¸Šï¼Œ xxx æ‰æ˜¯é™æ€åº“æ–‡ä»¶çš„åç§°ã€‚ å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ç”Ÿæˆçš„ libmprint.a çš„å†…å®¹ï¼Œä¸€å †ä¹±ç  æˆ‘ä»¬å¯ä»¥ç”¨ nm å‘½ä»¤æŸ¥çœ‹åº“æ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯ç”± my_print.o å’Œ print_hello.o ç”Ÿæˆçš„ã€‚ 2. é™æ€åº“çš„ä½¿ç”¨é™æ€åº“çš„ä½¿ç”¨æ–¹æ³• 1gcc main.c -o exe -lmyprint -L ../lib/ -I ../header/ é¦–å…ˆå¯¹ä¸Šé¢çš„å‘½ä»¤è¿›è¡Œåˆ†è§£ä¸€ä¸‹ï¼Œ-lmyprint ç”¨äºæŒ‡å®šé“¾æ¥åº“çš„åå­—ï¼Œæˆ‘ä»¬ä¸Šé¢ç”Ÿæˆäº†ä¸€ä¸ªåä¸º libmprint.a çš„é™æ€åº“ï¼ŒæŠŠå‰ç¼€åç¼€å»æ‰ç•™ä¸‹ä¸­é—´çš„åå­—å³å¯ï¼›-L â€¦&#x2F;lib&#x2F; æŒ‡å®šé™æ€åº“çš„æœç´¢ç›®å½•ï¼Œä¸æŒ‡å®šçš„ä¼šï¼Œç¼–è¯‘å™¨åªä¼šå»é»˜è®¤çš„é“¾æ¥åº“æœç´¢è·¯å¾„å¯»æ‰¾ï¼›-I â€¦&#x2F;header&#x2F; è¿™ä¸ªå°±æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼ŒæŒ‡å®šå¤´æ–‡ä»¶çš„è·¯å¾„ã€‚ æˆ‘ä»¬å†å‘å¸ƒçš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠ header å’Œ lib å‘å¸ƒç»™åˆ«äººå³å¯ ä¸‰ã€è‡ªå·±åŠ¨æ‰‹åˆ¶ä½œåŠ¨æ€é“¾æ¥åº“1. åŠ¨æ€åº“çš„åˆ¶ä½œâ‘  ç¼–è¯‘ç”Ÿæˆä¸ä½ç½®æ— å…³çš„ .o æ–‡ä»¶åŠ¨æ€å…±äº«åº“æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™æ‰åŠ è½½çš„ï¼Œå®ƒåŠ è½½åˆ°å†…å­˜çš„å…±äº«åº“æ®µï¼Œç”¨å®Œåå°±é‡Šæ”¾ï¼Œæ‰€ä»¥è¦ç¼–è¯‘ä¸ºä¸ä½ç½®æ— å…³çš„ã€‚è¿™é‡Œè¦ç”¨åˆ°GCC çš„ -fPIC é€‰é¡¹å‚æ•°ï¼Œè¯¥é€‰é¡¹è¡¨ç¤ºç¼–è¯‘ä¸ºä½ç½®ç‹¬ç«‹çš„ä»£ç ï¼Œå¦‚æœä¸ç”¨è¿™ä¸ªé€‰é¡¹çš„è¯ç¼–è¯‘åçš„ä»£ç æ˜¯ä½ç½®ç›¸å…³çš„ï¼Œæ‰€ä»¥åŠ¨æ€è½½å…¥çš„æ—¶å€™ä¼šé€šè¿‡ä»£ç æ‹·è´çš„æ–¹å¼æ¥æ»¡è¶³ä¸åŒè¿›ç¨‹çš„éœ€è¦ï¼Œè€Œä¸èƒ½è¾¾åˆ°çœŸæ­£ä»£ç æ®µå…±äº«çš„ç›®çš„ã€‚åœ¨é™æ€é“¾æ¥åº“ä¸­ï¼Œå¯æ‰§è¡Œæ–‡ä»¶åœ¨é“¾æ¥æ—¶å°±çŸ¥é“æ¯ä¸€è¡Œä»£ç ã€æ¯ä¸€ä¸ªå˜é‡ä¼šè¢«æ”¾åˆ°çº¿æ€§åœ°å€ç©ºé—´çš„ä»€ä¹ˆä½ç½®ï¼Œå› æ­¤è¿™äº›åœ°å€å¯ä»¥éƒ½ä½œä¸ºå¸¸æ•°å†™åˆ°ä»£ç é‡Œé¢ã€‚å¯¹äºåŠ¨æ€åº“ï¼Œåªæœ‰åŠ è½½çš„æ—¶å€™æ‰çŸ¥é“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ¨æ€é“¾æ¥åº“è¦ç¼–è¯‘ä¸ºä¸ä½ç½®æ— å…³çš„ä»£ç ï¼Œè¿™æ ·åªæœ‰åœ¨è¿è¡Œæ—¶æ‰ç›´åˆ°ä»£ç çš„ä½ç½®ã€‚è€Œé™æ€åº“æ˜¯åœ¨ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ä¹‹å‰ï¼Œå°±ç›´æ¥æŠŠä»£ç åŠ è½½åˆ°å†…å­˜çš„ä»£ç æ®µäº†ï¼Œä»£ç çš„ä½ç½®ç­‰ä¿¡æ¯ä¹Ÿå°±å·²ç»çŸ¥é“äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç”Ÿæˆä¸ä½ç½®æ— å…³çš„ä»£ç ã€‚ 1gcc -fPIC -c *.c -I ../header/ â‘¡ å°† .o æ–‡ä»¶æ‰“åŒ…è¿™é‡Œè¦ç”¨åˆ° GCC çš„ -shared é€‰é¡¹ï¼Œè¯¥é€‰é¡¹æŒ‡å®šç”ŸæˆåŠ¨æ€è¿æ¥åº“ï¼ˆè®©è¿æ¥å™¨ç”ŸæˆTç±»å‹çš„å¯¼å‡ºç¬¦å·è¡¨ï¼Œæœ‰æ—¶å€™ä¹Ÿç”Ÿæˆå¼±è¿æ¥Wç±»å‹çš„å¯¼å‡ºç¬¦å·ï¼‰ï¼Œå¦‚æœä¸ç”¨è¯¥æ ‡å¿—çš„è¯å¤–éƒ¨ç¨‹åºå°†æ— æ³•è¿æ¥ã€‚å¯ä»¥åœ¨åŠ¨æ€åº“æ–‡ä»¶ååé¢åŠ ç‰ˆæœ¬å· libxxx.so.ä¸»ç‰ˆæœ¬å·.å‰¯ç‰ˆæœ¬å· ï¼Œæ¯”å¦‚ libmdprint.so.1.1 è¡¨ç¤ºæˆ‘è¿™æ˜¯ 1.1 ç‰ˆæœ¬çš„åŠ¨æ€åº“ï¼Œæ–‡ä»¶åç¼€åé¢çš„æ•°å­—å°±æ˜¯ç‰ˆæœ¬å·çš„æ„æ€ã€‚ 1gcc -shared *.o -o libmdrint.so 2. åŠ¨æ€åº“çš„ä½¿ç”¨ï¼ˆ1ï¼‰åŠ è½½åŠ¨æ€åº“ä½¿ç”¨åŠ¨æ€åº“çš„å‘½ä»¤å’Œä½¿ç”¨é™æ€åº“çš„å‘½ä»¤ä¸€æ · 1gcc main.c -o exe -lmdrint -L ../lib/ -I ../header/ ï¼ˆ2ï¼‰â€œåŠ è½½å…±äº«åº“å‡ºé”™â€çš„è§£å†³æ–¹æ³•è¿™ä¸ªæ˜¯æ—¶å€™ï¼Œè™½ç„¶æˆ‘ä»¬å·²ç»ç”Ÿæˆäº†å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯ æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤ ldd æ¥æŸ¥çœ‹ä¸€ä¸‹å¯æ‰§è¡Œæ–‡ä»¶çš„é“¾æ¥æƒ…å†µ åœ¨æˆ‘ä»¬è‡ªå·±å¼•å…¥çš„åº“ libmdrint.so ä¸€æ æ˜¾ç¤º â€œnot foundâ€ ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è‡ªå·±å¼•å…¥çš„åŠ¨æ€åº“æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œéœ€è¦è¿›è¡Œä¸€äº›é…ç½®ã€‚è¿™é‡Œæä¾›ä»¥ä¸‹å‡ ç§è§£å†³æ–¹æ³•ã€‚ â‘  åœ¨ç³»ç»Ÿåº“è·¯å¾„ä¸‹å»ºç«‹è½¯é“¾æ¥å‰é¢æˆ‘ä»¬å·²ç»ä»‹ç»äº†ï¼ŒGCC ä¼šé»˜è®¤å»ç³»ç»Ÿåº“è·¯å¾„ä¸‹æœç´¢åº“æ–‡ä»¶ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬æŠŠè‡ªå·±çš„åº“æ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹å°±å¯ä»¥äº†ï¼Œç³»ç»Ÿåº“çš„è·¯å¾„æ˜¯ &#x2F;usr&#x2F;lib æˆ– &#x2F;lib ã€‚ä½†æ˜¯æˆ‘ä»¬å®é™…æ“ä½œçš„æ—¶å€™ï¼Œå¯èƒ½æ— æ³•æŠŠæ–‡ä»¶æ‹·è´åˆ°è¿™ä¸¤ä¸ªè·¯å¾„ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿåº“è·¯å¾„ä¸‹å»ºç«‹ä¸€ä¸ªè½¯é“¾æ¥æ¥æŒ‡å‘æˆ‘ä»¬çš„åº“æ–‡ä»¶ï¼ˆè½¯é“¾æ¥ç›¸å…³çŸ¥è¯†è¯·å‚è€ƒæœ¬äºº Linux ä¸“æ æ–‡ç« ã€Šã€Linuxç‹è€…ä¹‹è·¯åŸºç¡€ç¯‡ï¼šåŸºæœ¬å‘½ä»¤ä¸åŸºç¡€çŸ¥è¯†ã€‘Linuxå¸¸ç”¨shellå‘½ä»¤ï¼ˆåŠç›¸å…³çŸ¥è¯†ï¼‰è¯¦è§£ä¸ç”¨æ³•æ¼”ç¤ºã€‹ï¼‰ 1sudo ln -s /home/qq/dm/dm_lib/lib/libmdrint.so /usr/lib/libmdrint.so è¿™é‡Œç¬¬ä¸€ä¸ªè·¯å¾„ä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„åŠ¨æ€åº“æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œä¸€å®šè¦ç”¨ç»å¯¹è·¯å¾„ï¼ˆå¦‚æœä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¼šæ‰¾ä¸åˆ°è¯¥è·¯å¾„ï¼‰ï¼Œç¬¬äºŒä¸ªè·¯å¾„æ˜¯ç³»ç»Ÿåº“çš„è·¯å¾„ã€‚ â‘¡ é…ç½®ç¯å¢ƒå˜é‡å®é™…ä¸Šï¼Œ ld é“¾æ¥å™¨åœ¨å¯»æ‰¾åº“è·¯å¾„çš„æ—¶å€™ï¼Œéƒ½æ˜¯é€šè¿‡ä¸€ä¸ªç¯å¢ƒå˜é‡ LD_LIBRARY_PATH æ¥å¯»æ‰¾çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å°çœ‹ä¸€ä¸‹è¿™ä¸ªç¯å¢ƒå˜é‡ æˆ‘ä»¬å¯ä»¥é€šè¿‡ export å‘½ä»¤æ¥ç»™ç¯å¢ƒå˜é‡å¢åŠ ä¸€ä¸ªè·¯å¾„ï¼Œåªéœ€è¦æŠŠè‡ªå·±çš„è·¯å¾„åŠ è¿›å»å³å¯ï¼Œå‘½ä»¤å¦‚ä¸‹ 1export LD_LIBRARY_PATH=/home/qq/dm/dm_lib/lib/:$LD_LIBRARY_PATH æˆ‘ä»¬çŸ¥é“åœ¨ shell ä¸‹ç›´æ¥æŠŠç»å¯¹è·¯å¾„åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œåªæ˜¯ä¸€ç§ä¸´æ—¶çš„ç¯å¢ƒå˜é‡ï¼Œå½“å…³æœºå†æ¬¡å¼€æœºçš„æ—¶å€™ï¼Œå°±ä¼šå¤±æ•ˆï¼Œå¦‚æœæƒ³è¦æ°¸ä¹…æœ‰æ•ˆï¼Œå¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢è¿™æ¡å‘½ä»¤æ”¾åˆ° .bashrc æ–‡ä»¶ä¸­ã€‚åœ¨æˆ‘çš„ Linux ä¸“æ æ–‡ç« ä¸­ï¼Œå·²ç»ä¸åªä¸€æ¬¡æåˆ° .bashrc è¿™ä¸ªé…ç½®æ–‡ä»¶äº†ï¼Œå…¶å® Linux æ¯æ¬¡å¼€æœºéƒ½ä¼šæ‰§è¡Œè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å®ç°ç¯å¢ƒå˜é‡æ°¸ä¹…æœ‰æ•ˆçš„åŸç†å°±æ˜¯ï¼ŒLinux æ¯æ¬¡å¼€æœºéƒ½ä¼šæ‰§è¡Œ .bashrc é…ç½®æ–‡ä»¶ï¼Œè€Œé…ç½®æ–‡ä»¶ä¸­åŒ…å«è®¾ç½®ç¯å¢ƒå˜é‡çš„å‘½ä»¤ï¼Œæ‰€ä»¥æ¯æ¬¡å¼€æœºéƒ½ä¼šé…ä¸€ä¸‹ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†ç¯å¢ƒå˜é‡æ°¸ä¹…æœ‰æ•ˆçš„ç›®çš„ã€‚.bashrc é…ç½®æ–‡ä»¶åœ¨å®¶ç›®å½•ä¸‹ 1vim ~/.bashrc â‘¢ ä¿®æ”¹ ld.so åŠ è½½å™¨çš„é…ç½®æ–‡ä»¶ ld.so.confè¿™é‡Œå…ˆä»‹ç»å‡ ä¸ªæ¦‚å¿µï¼š ldé“¾æ¥å™¨ ï¼šgcc å¯ä»¥åœ¨ç¼–è¯‘å‘¨æœŸä¼ é€’å‚æ•°ï¼ŒæŒ‡å®šéœ€è¦é“¾æ¥çš„åº“æ–‡ä»¶ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ compile-timeã€‚ ld.soåŠ¨æ€é“¾æ¥å™¨&#x2F;åŠ è½½å™¨ï¼Œç¨‹åºè¿è¡Œçš„æ—¶å€™ä¼šæ ¹æ®æŒ‡å®šçš„è·¯å¾„å»åŠ è½½æŒ‡å®šçš„åº“ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ run-timeã€‚ ld.soåŠ è½½å™¨åŠé…ç½®æ–‡ä»¶ld.so.confï¼šæŒ‡å®šåŠ¨æ€é“¾æ¥åº“çš„æœç´¢è·¯å¾„ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡é…ç½®ç¯å¢ƒå˜é‡$LD_LIBRARY_PATH æ¥æŒ‡å®šç¨‹åºè¿è¡Œæ—¶çš„åŠ¨æ€åº“.soæ–‡ä»¶çš„æœç´¢è·¯å¾„ï¼‰ã€‚ä½¿ç”¨ ldconfig å°±å¯ä»¥å°† ld.so.conf ä¸­çš„æŒ‡å®šç›®å½•çš„åº“æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶è®°å½•åœ¨&#x2F;etc&#x2F;ld.so.cacheæ–‡ä»¶ä¸­ã€‚é…ç½®æ–‡ä»¶ &#x2F;etc&#x2F;ld.so.conf è®°å½•äº†ç¼–è¯‘æ—¶ä½¿ç”¨çš„åŠ¨æ€é“¾æ¥åº“çš„è·¯å¾„ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨åªä¼šä½¿ç”¨ &#x2F;lib å’Œ &#x2F;usr&#x2F;lib è¿™ä¸¤ä¸ªç›®å½•ä¸‹çš„åº“æ–‡ä»¶ï¼Œé€šè¿‡è¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥å¢åŠ æˆ‘ä»¬è‡ªå·±çš„åŠ¨æ€åº“æ–‡ä»¶æœç´¢è·¯å¾„ã€‚ ä½¿ç”¨ vim ç¼–è¾‘å™¨æ‰“å¼€é…ç½®æ–‡ä»¶ï¼ŒæŠŠè·¯å¾„æ”¾è¿›å» 1sudo vim /etc/ld.so.conf æ”¾å…¥è·¯å¾„ä¹‹åï¼Œè¿˜è¦åœ¨ shell ä¸‹æ‰§è¡Œä¸€æ¡å‘½ä»¤ï¼Œä½¿åˆšæ‰çš„é…ç½®ç”Ÿæ•ˆ 1sudo ldconfig -v ä¸ç®¡ä½¿ç”¨ä¸Šé¢ä¸‰ç§æ–¹æ³•çš„å“ªç§ï¼Œéƒ½å¯ä»¥ä½¿åŠ¨æ€åº“æ­£å¸¸åŠ è½½åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨ ldd å‘½ä»¤æŸ¥çœ‹ exe æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„åŠ¨æ€åº“ libmdrint.so åé¢ç”±åŸæ¥çš„ â€œnot foundâ€ å˜æˆäº†ä¸€ä¸ªè·¯å¾„ï¼Œè¿™è¯´æ˜åŠ è½½å™¨ç°åœ¨å¯ä»¥æ‰¾åˆ°åŠ¨æ€åº“çš„è·¯å¾„äº†ï¼Œå¯æ‰§è¡Œæ–‡ä»¶ exe ä¹Ÿå°±å¯ä»¥è¿è¡Œäº†ã€‚","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"é¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥","path":"/posts/é¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥.html","content":"Cè¯­è¨€ç»å…¸çš„ â€œhello world â€ ç¨‹åºï¼Œä¼´éšç€æ¯ä¸ªç¨‹åºå‘˜ä¸€èµ·æ­¥å…¥ç¼–ç¨‹ä¸–ç•Œçš„å¤§é—¨ã€‚ä»ç¼–å†™ã€ç¼–è¯‘åˆ°è¿è¡Œï¼Œçœ‹åˆ°å±å¹•ä¸Šè¾“å‡ºçš„â€œhello world â€ï¼Œé‚£ä¹ˆä½ çŸ¥é“å®ƒéƒ½ç»å†äº†ä»€ä¹ˆå—ï¼Ÿä»Šå¤©æˆ‘ä»¬å°±æ¥èŠèŠè¿™ä¸ªè¯é¢˜ã€‚ ä¸€ã€ä»hello.cèŠèµ·hello world.c 123456#include &lt;stdio.h&gt;int main() &#123; printf(&quot;hello,world! &quot;); return 0;&#125; åœ¨linuxä¸‹ï¼Œä½¿ç”¨ gcc ç¼–è¯‘hello.cæºæ–‡ä»¶ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹é»˜è®¤ç”Ÿæˆ a.out å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨ç»ˆç«¯è¾“å‡ºhelloï¼Œworldï¼ã€‚ 123$ gcc hello.c$ ./a.out$ hello,world! é¢„ç¼–è¯‘å™¨ã€æ±‡ç¼–å™¨asã€é“¾æ¥å™¨ldï¼Œå®é™…ä¸Šgcc å‘½ä»¤åªæ˜¯å¯¹è¿™äº›ä¸åŒç¨‹åºçš„å°è£…ï¼Œæ ¹æ®ä¸åŒçš„å‚æ•°å»è°ƒç”¨ä¸åŒçš„ç¨‹åºã€‚ ä» hello.c åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„å…¨è¿‡ç¨‹ï¼Œå¯åˆ†ä¸º4ä¸ªæ­¥éª¤ï¼š 1ã€é¢„å¤„ç†gcc -E hello.c -o hello.i å¾—åˆ°é¢„å¤„ç†æ–‡ä»¶ï¼Œå…¶ä¸­ï¼Œ-E è¡¨ç¤ºåªè¿›è¡Œé¢„ç¼–è¯‘ã€‚æºæ–‡ä»¶åœ¨é¢„ç¼–è¯‘é˜¶æ®µä¼šè¢«ç¼–è¯‘å™¨ç”Ÿæˆ.iæ–‡ä»¶ï¼Œä¸»è¦å¤„ç†æºä»£ç æ–‡ä»¶ä¸­ä»¥â€œ#â€å¼€å¤´çš„é¢„ç¼–è¯‘æŒ‡ä»¤ã€‚å¦‚ï¼šå®å®šä¹‰å±•å¼€ï¼Œå°†è¢«åŒ…å«çš„æ–‡ä»¶æ’å…¥åˆ°è¯¥ç¼–è¯‘æŒ‡ä»¤çš„ä½ç½®ç­‰ã€‚ 2ã€ç¼–è¯‘gcc -S hello.i -o hello.s å¾—åˆ°æ±‡ç¼–æ–‡ä»¶ï¼Œå…¶ä¸­ï¼Œ-S è¡¨ç¤ºç”Ÿæˆæ±‡ç¼–æ–‡ä»¶ã€‚ç¼–è¯‘å°±æ˜¯æŠŠé¢„å¤„ç†å®Œçš„æ–‡ä»¶ï¼Œè¿›è¡Œè¯­æ³•åˆ†æã€è¯æ³•åˆ†æã€è¯­ä¹‰åˆ†æåŠä¼˜åŒ–åç”Ÿæˆç›¸åº”çš„æ±‡ç¼–ä»£ç æ–‡ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ•´ä¸ªç¨‹åºæ„å»ºçš„æ ¸å¿ƒè¿‡ç¨‹ï¼Œä¹Ÿæ˜¯æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚ 3ã€æ±‡ç¼–as hello.s -o hello.o æˆ–è€… gcc -c hello.s -o hello.oï¼Œå…¶ä¸­ï¼Œ-c è¡¨ç¤ºåªç¼–è¯‘ä¸é“¾æ¥ã€‚å°†æ±‡ç¼–ä»£ç æ–‡ä»¶è½¬å˜æˆæœºå™¨å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤æ–‡ä»¶ï¼Œå³ç›®æ ‡æ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼šgcc -c hello.c -o hello.o ç»è¿‡é¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ç›´æ¥è¾“å‡ºç›®æ ‡æ–‡ä»¶ã€‚ä¸ºä»€ä¹ˆæ±‡ç¼–å™¨ä¸ç›´æ¥ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºï¼Œè€Œæ˜¯ä¸€ä¸ªç›®æ ‡æ–‡ä»¶å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦é“¾æ¥ï¼Ÿè¿™ä¸ªæˆ‘ä»¬åé¢ä¼šè¯¦ç»†è®¨è®ºã€‚ 4ã€é“¾æ¥éšç€ä»£ç é‡çš„å¢å¤šï¼Œæ‰€æœ‰ä»£ç è‹¥æ˜¯éƒ½æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œé‚£å°†æ˜¯ä¸€åœºç¾éš¾ã€‚ç°ä»£å¤§å‹è½¯ä»¶ï¼ŒåŠ¨è¾„ç”±æˆåƒä¸Šä¸‡çš„æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªæ¨¡å—ç›¸äº’ä¾èµ–åˆç›¸äº’ç‹¬ç«‹ã€‚å°†è¿™äº›æ¨¡å—ç»„è£…èµ·æ¥çš„è¿‡ç¨‹å°±æ˜¯é“¾æ¥ã€‚è¿™äº›æ¨¡å—å¦‚ä½•å½¢æˆä¸€ä¸ªå•ä¸€çš„ç¨‹åºå‘¢ï¼Ÿæ— éå°±æ˜¯ä¸¤ç§æ–¹å¼ï¼š1ã€æ¨¡å—é—´çš„å‡½æ•°è°ƒç”¨ï¼›2ã€æ¨¡å—é—´çš„å˜é‡è®¿é—®ã€‚å‡½æ•°è®¿é—®å¿…é¡»çŸ¥é“å‡½æ•°åœ°å€ï¼Œå˜é‡è®¿é—®å¿…é¡»çŸ¥é“å˜é‡åœ°å€ï¼Œæ‰€ä»¥ç»ˆå½’åˆ°åº•å°±æ˜¯ä¸€ç§æ–¹å¼ï¼Œä¸åŒæ¨¡å—é—´ç¬¦å·çš„å¼•ç”¨ã€‚","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"å†…å­˜ç”³è¯·å‡½æ•°","path":"/posts/å†…å­˜ç”³è¯·å‡½æ•°.html","content":"ä¸€ã€mallocå‡½æ•°åŸå‹ï¼š 1void* malloc (size_t size); è¿™ä¸ªå‡½æ•°å‘å†…å­˜ç”³è¯·ä¸€å—è¿ç»­å¯ç”¨çš„ç©ºé—´ï¼Œå¹¶è¿”å›æŒ‡å‘è¿™å—ç©ºé—´çš„æŒ‡é’ˆï¼› å¦‚æœå¼€è¾ŸæˆåŠŸï¼Œè¿”å›ä¸€ä¸ªæŒ‡å‘å¼€è¾Ÿçš„ç©ºé—´çš„é¦–åœ°å€çš„æŒ‡é’ˆï¼› å¦‚æœå¼€è¾Ÿå¤±è´¥ï¼Œè¿”å›ä¸€ä¸ªNULLæŒ‡é’ˆï¼Œå› æ­¤mallocå‡½æ•°çš„è¿”å›å€¼ï¼Œä¸€å®šè¦åšæ£€æŸ¥ï¼› è¿”å›å€¼çš„ç±»å‹æ—¶void*ï¼Œæ‰€ä»¥mallocå‡½æ•°å¹¶ä¸çŸ¥é“å¼€è¾Ÿç©ºé—´çš„ç±»å‹ï¼Œå…·ä½“åœ¨ä½¿ç”¨æ—¶ç”±ä½¿ç”¨è€…è‡ªå·±å†³å®šï¼ˆå¼ºåˆ¶è½¬æ¢ï¼‰ï¼› å¦‚æœå‚æ•°sizeä¸º0ï¼Œmallocå‡½æ•°çš„è¡Œä¸ºæ˜¯æ ‡å‡†æœªå®šä¹‰çš„ï¼Œå–å†³äºç¼–è¯‘å™¨ï¼› 12345678910111213141516171819202122232425#include &lt;stdio.h&gt;#include &lt;errno.h&gt;#include &lt;stdlib.h&gt;int main()&#123; int arr[10] = &#123; 0 &#125;; int* p = (int*)malloc(sizeof(arr));//åŠ¨æ€å†…å­˜å¼€è¾Ÿï¼› if (p == NULL) &#123; perror(&quot;malloc&quot;);//æ˜¯ç©ºæŒ‡é’ˆåˆ™è¾“å‡ºé”™è¯¯ä»£ç ï¼› return 1;//ç»ˆæ­¢ç¨‹åºï¼› &#125; for (int i = 0; i &lt; 10; i++) &#123; *(p + i) = i;//èµ‹å€¼ï¼› &#125; for (int i = 0; i &lt; 10; i++) &#123; printf(&quot;%d &quot;, *(p + i));//è¾“å‡º &#125; //æ²¡æœ‰ä½¿ç”¨ åŠ¨æ€å†…å­˜é‡Šæ”¾å‡½æ•° free ï¼Œæ­¤æ—¶å¦‚æœç¨‹åºç»§ç»­è¿è¡Œï¼Œåˆ™è¢«mallocå‡½æ•°å¼€è¾Ÿçš„ç©ºé—´ä¸ä¼šè¢«å›æ”¶ï¼› //ä½†åªè¦ç¨‹åºé€€å‡ºï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›æ”¶å†…å­˜ç©ºé—´ï¼› //æ­£å¸¸æƒ…å†µä¸‹ï¼Œç”±åŠ¨æ€å†…å­˜å¼€è¾Ÿå‡½æ•°æ‰€å¼€è¾Ÿçš„å†…å­˜ç©ºé—´ï¼Œåœ¨ä½¿ç”¨å®Œæˆåå¿…é¡»è¢«é‡Šæ”¾å¹¶é”€æ¯ï¼› free(p);//å°†pç©ºé—´ä¸­çš„å€¼é”€æ¯ï¼› p = NULL;//pä¸å†æŒ‡å‘æœ‰æ•ˆç©ºé—´ï¼› return 0;&#125; äºŒã€callocå‡½æ•°åŸå‹ï¼š 1void* calloc(size_t num,size_t size); å‡½æ•°çš„åŠŸèƒ½æ˜¯ä¸ºnumä¸ªå¤§å°ä¸ºsizeçš„å…ƒç´ å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œå¹¶å°†ç©ºé—´çš„æ¯ä¸ªå­—èŠ‚åˆå§‹åŒ–ä¸º0ï¼› ä¸å‡½æ•°mallocçš„åŒºåˆ«åœ¨äºï¼Œcallocä¼šåœ¨è¿”å›åœ°å€å‰æŠŠç”³è¯·çš„ç©ºé—´çš„æ¯ä¸ªå­—èŠ‚åˆå§‹åŒ–ä¸ºå…¨0ï¼› 1234567891011121314151617#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;errno.h&gt;int main()&#123; int* p = (int*)calloc(10, sizeof(int));//åŠ¨æ€å†…å­˜å¼€è¾Ÿï¼› if (p == NULL) &#123; perror(&quot;calloc&quot;);//æ˜¯ç©ºæŒ‡é’ˆåˆ™è¾“å‡ºé”™è¯¯ä»£ç ï¼› return 1;//ç»ˆæ­¢ç¨‹åºï¼› &#125; for (int i = 0; i &lt; 10; i++) &#123; printf(&quot;%d &quot;, *(p + i));//è¾“å‡ºä¸ºï¼š0 0 0 0 0 0 0 0 0 0ï¼› &#125; free(p);//å°†pç©ºé—´ä¸­çš„å€¼é”€æ¯ï¼› p = NULL;//pä¸å†æŒ‡å‘æœ‰æ•ˆç©ºé—´ï¼› return 0;&#125; ä¸‰ã€reallocå‡½æ•°åŸå‹ï¼š 1void* realloc(void* ptr,size_t size); ptræ˜¯éœ€è¦è°ƒæ•´çš„å†…å­˜åœ°å€ï¼Œsizeæ˜¯è°ƒæ•´ä¹‹åçš„ç©ºé—´å¤§å°ï¼› è¿”å›å€¼ä¸ºè°ƒæ•´åçš„å†…å­˜çš„èµ·å§‹åœ°å€ï¼› å‡½æ•°åœ¨è°ƒæ•´åŸå†…å­˜ç©ºé—´å¤§å°çš„åŸºç¡€ä¸Šï¼Œè¿˜ä¼šå°†åŸæ¥å†…å­˜ä¸­çš„æ•°æ®ç§»åŠ¨åˆ°æ–°çš„ç©ºé—´ï¼› &#x2F;&#x2F;å¯¹äºå†…å­˜ç©ºé—´çš„è°ƒæ•´ï¼Œå­˜åœ¨ä¸¤ç§æƒ…å†µï¼š 1.åŸæœ‰ç©ºé—´ä¹‹åçš„ç©ºé—´è¶³å¤Ÿæ»¡è¶³æ–°ç©ºé—´çš„å¼€è¾Ÿï¼› 2.åŸæœ‰ç©ºé—´ä¹‹åæ²¡æœ‰è¶³å¤Ÿå¤§çš„ç©ºé—´æ»¡è¶³æ–°ç©ºé—´çš„å¼€è¾Ÿï¼› &#x2F;&#x2F;å‡½æ•°è°ƒæ•´å¤±è´¥çš„æƒ…å†µï¼š 1.reallocå¤±è´¥çš„æ—¶å€™ï¼Œè¿”å›NULLï¼› 2.reallocå¤±è´¥çš„æ—¶å€™ï¼ŒåŸæ¥çš„å†…å­˜ä¸æ”¹å˜ï¼Œä¸ä¼šé‡Šæ”¾ä¹Ÿä¸ä¼šç§»åŠ¨ï¼› &#x2F;&#x2F;æ³¨æ„ä½¿ç”¨reallocå‡½æ•°æ”¹å˜æˆ–å¼€è¾Ÿç©ºé—´ï¼Œæœ€å¥½ä½¿ç”¨æ–°çš„å˜é‡æ¥æ”¶ï¼Œå†å°†æ–°å˜é‡èµ‹å€¼ç»™æ—§å˜é‡ï¼›åŸå› æ˜¯ä¸ºäº†é¿å…å¼€è¾Ÿç©ºé—´å¤±è´¥è¿”å›ç©ºæŒ‡é’ˆï¼Œå¯¼è‡´çš„æ—§ç©ºé—´å†…å­˜æ³„æ¼(æŒ‡é’ˆè¢«ç½®ç©ºï¼Œæ— æ³•æ‰¾åˆ°æ—§ç©ºé—´)ï¼› 123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;errno.h&gt;int main()&#123; int* p = (int*)malloc(40);//å¼€è¾Ÿ40å­—èŠ‚ç©ºé—´èµ‹äºˆpï¼› if (p == NULL) &#123; perror(&quot;malloc&quot;); return 1; &#125; for (int i = 0; i &lt; 10; i++) &#123; *(p + i) = i + 1; &#125; int* ptr = realloc(p, 80);//æ‰©å®¹ï¼›æ­¤æ—¶ï¼Œå¦‚æœåç»­å†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåˆ™ç©ºé—´é¦–åœ°å€ä¸ä¼šæ”¹å˜ï¼Œä½†å¦‚æœåç»­å†…å­˜ç©ºé—´ä¸è¶³ï¼Œåˆ™ä¼šå‘ç°ç©ºé—´é¦–åœ°å€æ”¹å˜ï¼Œå³æ–°ç©ºé—´çš„å¼€è¾Ÿï¼› if (ptr != NULL) &#123; p = ptr;//æ‰©å®¹æˆåŠŸåˆ™å°†æ‰©å®¹åçš„ç©ºé—´èµ‹äºˆpï¼› ptr = NULL;//pträ¸å†æŒ‡å‘æœ‰æ•ˆç©ºé—´ï¼› &#125; else &#123; perror(&quot;realloc&quot;); return 1; &#125; for (int i = 10; i &lt; 20; i++)//ä¸ºæ‰©å®¹åçš„ç©ºé—´èµ‹å€¼ï¼› &#123; *(p + i) = i + 1; &#125; ptr = realloc(p, 40);//ç¼©å®¹ï¼› if (ptr != NULL) &#123; p = ptr;//ç¼©å®¹æˆåŠŸåˆ™å°†æ‰©å®¹åçš„ç©ºé—´èµ‹äºˆpï¼› ptr = NULL;//å°†ptrç½®ç©ºï¼› &#125; for (int i = 0; i &lt; 20; i++)//ä¸ºæ‰©å®¹åçš„ç©ºé—´èµ‹å€¼ï¼› &#123; printf(&quot;%d &quot;, p[i]); &#125; free(p);//å°†pç©ºé—´ä¸­çš„å€¼é”€æ¯ï¼› p = NULL;//pä¸å†æŒ‡å‘æœ‰æ•ˆç©ºé—´ï¼› return 0;&#125;","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"å­—ç¬¦ä¸²å‡½æ•°","path":"/posts/å­—ç¬¦ä¸²å‡½æ•°.html","content":"ä¸€ã€strlen1ã€åŸå‹ï¼šsize_t strlen(char const* string);2ã€åŠŸèƒ½ï¼šè¿”å›å­—ç¬¦ä¸² string çš„é•¿åº¦ï¼ˆä¸åŒ…å«å­—ç¬¦ä¸²ç»ˆæ­¢ç¬¦NULï¼‰3ã€æ³¨æ„ï¼šsize_tæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ç±»å‹ äºŒã€strcpy1ã€åŸå‹ï¼šchar *strcpy(char *dst, char const *src); 2ã€åŠŸèƒ½ï¼šå°†å‚æ•°srcå­—ç¬¦ä¸²å¤åˆ¶åˆ°dstå‚æ•°ä¸­ã€‚å¦‚æœå‚æ•°srcå’Œdståœ¨å†…å­˜ä¸­å‡ºç°é‡å ï¼Œå…¶ç»“æœæ˜¯æœªå®šä¹‰çš„ã€‚ç”±äºdstå‚æ•°å°†è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥å®ƒå¿…é¡»æ˜¯ä¸ªå­—ç¬¦æ•°ç»„æˆ–è€…æ˜¯ä¸€ä¸ªæŒ‡å‘åŠ¨æ€åˆ†é…å†…å­˜çš„æ•°ç»„çš„æŒ‡é’ˆï¼Œä¸èƒ½ä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡ã€‚è¿”å›å‚æ•°dstçš„ä¸€ä»½æ‹·è´ã€‚ 3ã€æ³¨æ„ï¼š ç›®æ ‡å‚æ•°dstçš„ä»¥å‰å†…å®¹å°†è¢«è¦†ç›–å¹¶ä¸¢å¤±ã€‚å³ä½¿æ–°çš„å­—ç¬¦ä¸²æ¯”dståŸå…ˆçš„å†…å­˜æ›´çŸ­ï¼Œç”±äºæ–°å­—ç¬¦ä¸²æ˜¯ä»¥NULå­—ç¬¦ç»“å°¾ï¼Œæ‰€ä»¥è€å­—ç¬¦ä¸²æœ€åå‰©ä½™çš„å‡ ä¸ªå­—ç¬¦ä¹Ÿä¼šè¢«æœ‰æ•ˆçš„åˆ é™¤ã€‚å¦‚æœå­—ç¬¦ä¸²æ¯”æ•°ç»„é•¿ï¼Œå¤šä½™çš„å­—ç¬¦ä»è¢«å¤åˆ¶ï¼Œå®ƒä»¬å°†è¦†ç›–åŸå…ˆå­˜å‚¨äºæ•°ç»„åé¢çš„å†…å­˜ç©ºé—´çš„å€¼ã€‚æ‰€ä»¥å¿…é¡»ä¿è¯ç›®æ ‡å­—ç¬¦æ•°ç»„çš„ç©ºé—´è¶³ä»¥å®¹çº³éœ€è¦å¤åˆ¶çš„å­—ç¬¦ä¸²ã€‚ ä¸‰ã€strncpy1ã€åŸå‹ï¼šchar *strncpy(char *dst, char const *src, size_t len); 2ã€åŠŸèƒ½ï¼šå’Œstrcpyä¸€æ ·ï¼ŒstrncpyæŠŠæºå­—ç¬¦ä¸²çš„å­—ç¬¦å¤åˆ¶åˆ°ç›®æ ‡æ•°ç»„ã€‚ç„¶è€Œï¼Œå®ƒæ€»æ˜¯ æ­£å¥½å‘dstå†™å…¥lenä¸ªå­—ç¬¦ã€‚å¦‚æœstrlen(src)çš„å€¼å°äºlen, dstæ•°ç»„å°±ç”¨é¢å¤–çš„NULå­—èŠ‚å¡«å……åˆ°lené•¿åº¦ã€‚å¦‚æœstrlen(src)çš„å€¼å¤§äºæˆ–è€…ç­‰äºlen,é‚£ä¹ˆåªæœ‰lenä¸ªå­—ç¬¦è¢«å¤åˆ¶åˆ°dstä¸­ã€‚ 3ã€æ³¨æ„ï¼šstrncpyè°ƒç”¨çš„ç»“æœå¯èƒ½ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒçš„ç»“æœå°†ä¸ä¼šä»¥NULå­—ç¬¦ç»“å°¾ï¼Œ å› æ­¤å­—ç¬¦ä¸²å¿…é¡»ä»¥NULå­—ç¬¦ç»“å°¾ å››ã€strcat1ã€åŸå‹ï¼šchar *strcat(char *dst, char const *src); 2ã€åŠŸèƒ½ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²æ·»åŠ (è¿æ¥)åˆ°å¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„åé¢ã€‚ 3ã€æ³¨æ„ï¼šsrcå’Œdstçš„æ‰€æŒ‡çš„å†…å­˜åŒºåŸŸä¸èƒ½é‡å ï¼Œå¦‚æœå‘ç”Ÿé‡å ï¼Œå…¶ç»“æœæ˜¯æœªå®šä¹‰çš„ã€‚ äº”ã€strncat1ã€åŸå‹ï¼šchar *strncat(char *dst, char const *src, size_t len); 2ã€åŠŸèƒ½ï¼šå®ƒä»srcæœ€å¤šå¤åˆ¶ lenä¸ªå­—ç¬¦åˆ°dstä¸­ã€‚ä½†æ˜¯, strncatæ€»æ˜¯åœ¨ç»“æœå­—ç¬¦ä¸²åé¢æ·»åŠ ä¸€ä¸ªNULå­—ç¬¦ã€‚ 3ã€æ³¨æ„ï¼šsrcå’Œdstæ‰€æŒ‡çš„å†…å­˜åŒºåŸŸä¸èƒ½é‡å ï¼Œå¹¶ä¸”dstå¿…é¡»æœ‰è¶³å¤Ÿå¤šçš„ç©ºé—´æ¥å®¹çº³srcçš„å­—ç¬¦ä¸²ã€‚ å…­ã€strcmp1ã€åŸå‹ï¼šint strcmp(char const *s1, char const *s2); 2ã€åŠŸèƒ½ï¼šæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚å¦‚æœs1å°äºs2ï¼Œstrcmpå‡½æ•°è¿”å›ä¸€ä¸ªå°äºé›¶çš„å€¼ã€‚å¦‚æœs1å¤§äºs2ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªå¤§äºé›¶çš„å€¼ã€‚å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰ï¼Œå‡½æ•°å°±è¿”å›é›¶ã€‚ 3ã€æ³¨æ„ï¼šç”±äºstrcmpå¹¶ä¸ä¿®æ”¹å®ƒçš„ä»»ä½•ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æº¢å‡ºå­—ç¬¦æ•°ç»„çš„å±é™©ã€‚ä½†æ˜¯ï¼Œå’Œå…¶ä»–ä¸å—é™åˆ¶çš„å­—ç¬¦ä¸²å‡½æ•°(strcpy, strcat)ä¸€æ ·ï¼Œstrcmpå‡½æ•°çš„å­—ç¬¦ä¸²å‚æ•°ä¹Ÿå¿…é¡»ä»¥ä¸€ä¸ªNULå­—ç¬¦ç»“å°¾ã€‚å¦‚æœå¹¶éå¦‚æ­¤ï¼Œstrcmpå°±å¯èƒ½å¯¹å‚æ•°åé¢çš„å­—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼Œè¿™ä¸ªæ¯”è¾ƒç»“æœå°†ä¸ä¼šæœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ ä¸ƒã€strncmp1ã€åŸå‹ï¼šint strncmp(char const *s1, char const *s2, size_t len); 2ã€åŠŸèƒ½ï¼šå’Œstrcmpä¸€æ ·ï¼Œä¹Ÿç”¨äºæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œä½†å®ƒæœ€å¤šæ¯”è¾ƒ len ä¸ªå­—èŠ‚ã€‚å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²åœ¨ç¬¬ len ä¸ªå­—ç¬¦ä¹‹å‰å­˜åœ¨ä¸ç›¸ç­‰çš„å­—ç¬¦ï¼Œè¿™ä¸ªå‡½æ•°å°±åƒstrcmpä¸€æ ·åœæ­¢æ¯”è¾ƒï¼Œè¿”å›ç»“æœã€‚å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„å‰len ä¸ªå­—ç¬¦ç›¸ç­‰ï¼Œå‡½æ•°å°±è¿”å›é›¶ã€‚ å…«ã€strchrã€strrchr1ã€åŸå‹ï¼šchar *strchr(char const *str, int ch); char *strrchr(char const *str, int ch); 2ã€åŠŸèƒ½ï¼šåœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šå­—ç¬¦ã€‚ 3ã€æ³¨æ„ï¼šç¬¬2ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•´å‹å€¼ã€‚ä½†æ˜¯ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªå­—ç¬¦å€¼ã€‚strchråœ¨å­—ç¬¦ä¸²strä¸­æŸ¥æ‰¾å­—ç¬¦chç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œæ‰¾åˆ°åå‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥ä½ç½®çš„æŒ‡é’ˆã€‚å¦‚æœè¯¥å­—ç¬¦å¹¶ä¸å­˜åœ¨äºsträ¸­ï¼Œå‡½æ•°å°±è¿”å›ä¸€ä¸ªNULLæŒ‡é’ˆã€‚strrchrçš„åŠŸèƒ½å’ŒstrchråŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯å®ƒæ‰€è¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²ä¸­è¯¥å­—ç¬¦æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®(æœ€å³è¾¹é‚£ä¸ª)ã€‚ ä¹ã€strpbrk1ã€åŸå‹ï¼šchar *strpbrk(char const *str, char const *group); 2ã€åŠŸèƒ½ï¼šè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘strä¸­ç¬¬1ä¸ªåŒ¹é…groupä¸­ä»»ä½•ä¸€ä¸ªå­—ç¬¦çš„å­—ç¬¦ä½ç½®ã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªNULLæŒ‡é’ˆã€‚ åã€strstr1ã€åŸå‹ï¼šchar *strstr(char *s1, char *s2); 2ã€åŠŸèƒ½ï¼šè¿™ä¸ªå‡½æ•°åœ¨s1ä¸­æŸ¥æ‰¾æ•´ä¸ªs2ç¬¬1æ¬¡å‡ºç°çš„èµ·å§‹ä½ç½®ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥ä½ç½®çš„æŒ‡é’ˆã€‚å¦‚æœs2å¹¶æ²¡æœ‰å®Œæ•´åœ°å‡ºç°åœ¨s1çš„ä»»ä½•åœ°æ–¹ï¼Œå‡½æ•°å°†è¿”å›ä¸€ä¸ªNULLæŒ‡é’ˆã€‚å¦‚æœç¬¬2ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œå‡½æ•°å°±è¿”å›s1ã€‚ åä¸€ã€strtok1ã€åŸå‹ï¼šchar *strtok(char *str, char const *sep); 2ã€åŠŸèƒ½ï¼šåˆ†è§£å­—ç¬¦ä¸²strä¸ºä¸€ç»„å­—ç¬¦ä¸²ï¼Œåˆ†éš”ç¬¦ä¸ºsepã€‚ 3ã€æ³¨æ„ï¼šå¦‚æœstrtokå‡½æ•°çš„ç¬¬1ä¸ªå‚æ•°ä¸æ˜¯NULLï¼Œå‡½æ•°å°†æ‰¾åˆ°å­—ç¬¦ä¸²çš„ç¬¬1ä¸ªæ ‡è®°ã€‚strtokåŒæ—¶å°†ä¿å­˜å®ƒåœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ã€‚å¦‚æœstrtokå‡½æ•°çš„ç¬¬1ä¸ªå‚æ•°æ˜¯NULLï¼Œå‡½æ•°å°±åœ¨åŒä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ä»è¿™ä¸ªè¢«ä¿å­˜çš„ä½ç½®å¼€å§‹åƒå‰é¢ä¸€æ ·æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæ ‡è®°ã€‚å¦‚æœå­—ç¬¦ä¸²å†…ä¸å­˜åœ¨æ›´å¤šçš„æ ‡è®°ï¼Œstrtokå‡½æ•°å°±è¿”å›ä¸€ä¸ªNULLæŒ‡é’ˆã€‚åœ¨å…¸å‹æƒ…å†µä¸‹ï¼Œåœ¨ç¬¬1æ¬¡è°ƒç”¨strtokæ—¶ï¼Œå‘å®ƒä¼ é€’ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚ç„¶åï¼Œè¿™ä¸ªå‡½æ•°è¢«é‡å¤è°ƒç”¨ï¼ˆç¬¬1ä¸ªå‚æ•°ä¸ºNULLï¼‰ï¼Œç›´åˆ°å®ƒè¿”å›NULLä¸ºæ­¢ã€‚ 1234567891011121314#include &lt;stdio.h&gt;#include &lt;string.h&gt;int main()&#123; char whitespace[] = &quot; &quot;; char *token; char line[] = &quot;I love you&quot;; for (token = strtok(line, whitespace); token !=NULL; token = strtok(NULL, whitespace)) &#123; printf(&quot;Next token is |%s| &quot;, token); &#125; return 0;&#125;","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"æŒ‡é’ˆ","path":"/posts/æŒ‡é’ˆ.html","content":"1ã€Cè¯­è¨€çš„ç²¾é«“â€“æŒ‡é’ˆæŒ‡é’ˆå°±æ˜¯åœ°å€ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æŠŠæ•°ç»„åå°±çœ‹æˆä¸€ä¸ªç‰¹æ®Šçš„æŒ‡é’ˆ,æŒ‡é’ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªå˜é‡è€Œå·²ï¼ŒæŒ‡é’ˆå…¨åæŒ‡é’ˆå˜é‡ã€‚ ï¼ˆ1ï¼‰æŒ‡é’ˆæ•°ç»„æŒ‡é’ˆæ•°ç»„ï¼Œæ˜¯ä¸ªæ•°ç»„ï¼Œé‡Œè¾¹æ”¾çš„ä¸œè¥¿éƒ½æ˜¯æŒ‡é’ˆã€‚char *p[2]=&#123;&quot;china&quot;,&quot;linux&quot;&#125;; ä»”ç»†æ¥è¯´ï¼Œä»è¿ç®—ç¬¦ä¼˜å…ˆçº§æ¥çœ‹ï¼Œ[]çš„ä¼˜å…ˆçº§æ¯”*é«˜ï¼Œæ‰€ä»¥på…ˆå’Œ[]ç»“åˆã€‚æ‰€ä»¥è¿™å°±æ˜¯ä¸ªæ•°ç»„ï¼Œå†ä¸æŒ‡é’ˆç»“åˆï¼Œæ‰€ä»¥å«æŒ‡é’ˆæ•°ç»„ã€‚ äºŒé‡æŒ‡é’ˆå¯ä»¥æŒ‡å‘æŒ‡é’ˆæ•°ç»„ã€‚ ï¼ˆ2ï¼‰æ•°ç»„æŒ‡é’ˆæ•°ç»„æŒ‡é’ˆï¼Œæ˜¯ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ. 12int a[2][5]=&#123;0&#125;; int (*p)[5]=a; //æŒ‡å‘äºŒç»´æ•°ç»„ int b[2][3][4] = &#123;0&#125;; // å¤šç»´æ•°ç»„ int(*q)[3][4] = b; è¿™é‡ŒæŒ‡é’ˆæ˜¯åœ¨()ä¸­æ”¾ç€ï¼Œ())å’Œ[]ä¼˜å…ˆçº§éƒ½æ˜¯æœ€é«˜çš„ï¼Œç»“åˆæ€§æ˜¯ä»å·¦å‘å³ï¼Œæ‰€ä»¥å…ˆä¸*ç»“åˆï¼Œè¿™æ˜¯ä¸ªæŒ‡é’ˆï¼Œç„¶åä¸[]ç»“åˆï¼Œå°±æ˜¯æŒ‡é’ˆæ•°ç»„ã€‚ ï¼ˆ3ï¼‰å‡½æ•°æŒ‡é’ˆ1int (*p)(int a,char b);// å‡½æ•°æŒ‡é’ˆpæŒ‡å‘è¿”å›å€¼ç±»å‹ä¸ºintçš„ï¼Œä¸¤ä¸ªå‚æ•°ä¸ºintå’Œcharçš„å‡½æ•° ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œ p(a,b); æˆ–è€… (*p)(a,b); void *ç±»å‹å¯ä»¥æŒ‡å‘ä»»ä½•ä¸€ä¸ªç±»å‹çš„æŒ‡é’ˆ void (*signal(int sig, void (*func) (int))) (int) signalä»ç„¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»–è¿”å›ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œåªæœ‰ä¸€ä¸ªintç±»å‹çš„å‚æ•° ï¼ˆ4ï¼‰äºŒç»´æ•°ç»„a[5][7];//ç”¨æŒ‡é’ˆè®¿é—®å°±æ˜¯*ï¼ˆ*ï¼ˆp+5ï¼‰+7ï¼‰ int (*p)[7]=a; ï¼ˆ5ï¼‰å­—ç¬¦æ•°ç»„ä¸æŒ‡å‘å­—ç¬¦ä¸²æŒ‡é’ˆçš„é—®é¢˜å…¶ä¸­char *p=&quot;linux&quot; è¿™ç§æƒ…å†µå­—ç¬¦ä¸²Linuxåªå­˜åœ¨äºåªè¯»æ•°æ®æ®µä¸­ï¼ˆrodataï¼‰ï¼Œæ‰€ä»¥pæ‰€æŒ‡å‘çš„å†…å®¹ä¸å¯ä»¥è¢«æ›´æ”¹ï¼Œå¦‚*ï¼ˆp+1ï¼‰=a;è¿™æ˜¯å®ç°ä¸äº†çš„ï¼Œä½†æ˜¯å¯ä»¥æ›´æ”¹æŒ‡é’ˆp æŒ‡å‘çš„åœ°å€ï¼Œä¾‹å¦‚p&#x3D;â€mengchaoâ€,ä½†æ˜¯è¿™é‡Œçš„p&#x3D;â€mengchaoâ€è¿™æ®µè¯æ”¾åœ¨å­å‡½æ•°ä¸­æ˜¯ä¸å¯ä»¥çš„ï¼Œå­—ç¬¦ä¸²mengchaoæ˜¯å­˜åœ¨äºæ ˆä¸­ï¼Œå­å‡½æ•°ç»“æŸå°±è¢«é‡Šæ”¾äº†ï¼Œä¸èƒ½å¤Ÿè¾¾åˆ°æ”¹å˜çš„ç›®çš„ã€‚å¯ä»¥ä½¿ç”¨äºŒé‡æŒ‡é’ˆæ¥å®ç°ã€‚ char p[]&#x3D;â€linuxâ€ è¿™ä¸ªæ˜¯å­—ç¬¦æ•°ç»„ï¼Œç›¸å½“äºåˆå§‹åŒ–æ•°ç»„ï¼Œå¯ä»¥æ›´æ”¹å†…å®¹ï¼Œå¦‚p[1]&#x3D;â€™aâ€™;* è¿™é‡ŒLinuxå­˜åœ¨äºæ ˆä¸Š æ‰€ä»¥æœ‰çš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ä¾‹å¦‚â€‹â€‹char *strcat(char *dst,char const *src);â€‹â€‹å‰é¢çš„å‚æ•°dst,éœ€è¦ä¿®æ”¹ï¼Œåªèƒ½ä¼ æ•°ç»„ï¼Œä¸èƒ½ç›´æ¥ä¼ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå› ä¸ºå­—ç¬¦ä¸²ä¸å¯æ”¹å˜ æ‰€ä»¥æƒ³ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œè¯·å°†ä»–æ”¾åœ¨å­—ç¬¦æ•°ç»„ä¸­ã€‚ å¦å¤–å…³äºè¿™ä¸ªç¨‹åº 12345678char c = &#x27;a&#x27;; char *p = &amp;c;char *q = &quot;china&quot;; printf(&quot;%p &quot;,p); //006DFEE7 printf(&quot;%c &quot;,*p); //a cout &lt;&lt; *p &lt;&lt; endl; //a printf(&quot;%p &quot;,q); //004B9024 printf(&quot;%s &quot;,q); //china cout &lt;&lt; q &lt;&lt; endl; //china cout &lt;&lt; *q &lt;&lt; endl; //c è¿™é‡Œæƒ³æ’ä¸€å¥å…³äºstrlenå’Œsizeofçš„åŒºåˆ«ã€‚æ¯”å¦‚æˆ‘ä»¬å®šä¹‰char buf[100]&#x3D;{â€œhelloworldâ€}; strlen(buf);å°±æ˜¯é‡Œè¾¹å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè€Œsizeof(buf);å°±æ˜¯æ•°ç»„é•¿åº¦100. ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è®¤ä¸ºä¸€çº§æŒ‡é’ˆä¸ä¸€ç»´æ•°ç»„åç­‰ä»·ï¼ŒäºŒçº§æŒ‡é’ˆä¸æŒ‡é’ˆæ•°ç»„åç­‰ä»·ï¼Œæ•°ç»„æŒ‡é’ˆä¸äºŒç»´æ•°ç»„åç­‰ä»·ã€‚è€ŒäºŒçº§æŒ‡é’ˆå’ŒäºŒç»´æ•°ç»„åæ²¡æœ‰ä¸€æ¯›é’±å…³ç³»ã€‚ ï¼ˆ6ï¼‰æ•°ç»„åæ•°ç»„åå¯ä»¥çœ‹æˆæ˜¯é¦–å…ƒç´ çš„é¦–åœ°å€ï¼Œä¹Ÿå¯ä»¥å½“æˆä¸€ä¸ªæ•´ä½“æ¥çœ‹ã€‚æ•°ç»„åæ˜¯å¸¸é‡ï¼Œæ‰å¯ä»¥å”¯ä¸€çš„ç¡®å®šæ•°ç»„å…ƒç´ çš„èµ·å§‹åœ°å€ã€‚è®¾æœ‰ä¸€ç»´æ•°ç»„int a[5]: a[1] = *(a+1); //aä»£è¡¨é¦–å…ƒç´ é¦–åœ°å€,åŠ 1è·¨åº¦ä¸ºintå¤§å°ä¸º4 å¯¹ä¸€ç»´æ•°ç»„åå’ŒäºŒç»´æ•°ç»„åå¼•ç”¨(å–åœ°å€)å¯¹ä¸€ç»´æ•°ç»„åè¿›è¡Œå¼•ç”¨ä¼šå°†ä½¿å…¶å‡çº§ä¸ºäºŒç»´æ•°ç»„åã€‚ (&amp;a+1)//è¿™ä¸ªä¸œè¥¿åŠ 1ï¼ŒåŠ çš„å¤§å°æ˜¯æ•´ä¸ªæ•°ç»„çš„å¤§å°ï¼Œæ˜¯20. äºŒç»´æ•°ç»„åè§£å¼•ç”¨ï¼Œé™ç»´ä¸ºä¸€ç»´æ•°ç»„åã€‚äºŒç»´æ•°ç»„åæ˜¯é¦–å…ƒç´ é¦–åœ°å€ï¼Œè®¾æœ‰int a[4][3],åˆ™ *(a+1) //ä»£è¡¨çš„æ˜¯äºŒç»´æ•°ç»„çš„ç¬¬äºŒç»´ a[1][2] = *(*(a+1)+2) æ³¨æ„ä¸‹é¢çš„é—®é¢˜ 1234567*p++ï¼šç­‰åŒäºï¼š*p; p += 1;å…ˆè¿ç®—å†++ è§£æï¼šå®é™…ä¸Š*p++ç¬¦å·æ•´ä½“å¯¹å¤–è¡¨ç°çš„å€¼æ˜¯*pçš„å€¼ï¼Œè¿ç®—å®Œæˆåpå†åŠ 1. ã€æ³¨æ„ã€‘æ˜¯è¿ç®—åpå†åŠ 1ï¼Œè€Œä¸æ˜¯pæ‰€æŒ‡å‘çš„å˜é‡*på†åŠ 1 *++pï¼šç­‰åŒäº p += 1; *p;å…ˆ++å†è¿ç®— è§£æï¼šç”±äº++åœ¨pçš„å‰é¢ï¼Œ++å‰ç½®çš„å«ä¹‰æ˜¯ï¼Œå…ˆåŠ 1ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„pï¼ˆå®ƒçš„å€¼æ˜¯åŸæ¥pçš„å€¼åŠ 1ï¼‰ã€‚ç„¶åè¿™ä¸ªæ–°çš„på†ä¸å‰é¢çš„*ç»“åˆ. ã€æ€»ç»“ã€‘æ— è®ºæ˜¯*p++è¿˜æ˜¯*++pï¼Œéƒ½æ˜¯æŒ‡é’ˆp += 1ï¼Œå³pçš„å€¼+1ï¼Œè€Œä¸æ˜¯pæ‰€æŒ‡å‘çš„å˜é‡*pçš„å€¼+1ã€‚ ++å‰ç½®ä¸++åç½®ï¼Œåªæ˜¯å†³å®šäº†åˆ°åº•æ˜¯å…ˆp += 1ï¼Œè¿˜æ˜¯å…ˆ*pã€‚++å‰ç½®è¡¨ç¤ºå…ˆp += 1ï¼Œå†*pã€‚++åç½®è¡¨ç¤ºå…ˆ*pï¼Œåœ¨p += 1ï¼› --å‰ç½®ä¸--åç½®çš„çš„åˆ†ææ–¹æ³•++å‰ç½®ä¸++åç½®çš„ä¸€æ ·ã€‚ 2ã€è¿›ç¨‹ç©ºé—´ 123å…¨å±€å˜é‡ï¼šä¸åˆå§‹åŒ–çš„é»˜è®¤ä¸º0ï¼Œæ”¾åœ¨.bssæ®µï¼Œåˆå§‹åŒ–ä¸º0çš„ä¹Ÿæ”¾åœ¨.bssæ®µ åˆå§‹åŒ–ä¸ºé0çš„å…¨å±€å˜é‡æ”¾åœ¨.dataæ®µä¸­ï¼Œç”Ÿå‘½å‘¨æœŸå…¨å±€ å±€éƒ¨å˜é‡æ”¾åœ¨æ ˆä¸Šï¼Œå½“è°ƒç”¨ç»“æŸï¼Œç”Ÿå‘½å‘¨æœŸç»“æŸ 3ã€ç»“æ„ä½“ã€Šé“å¾·ç»ã€‹ æ›°ï¼šâ€ä¸€ç”ŸäºŒï¼ŒäºŒç”Ÿä¸‰ï¼Œä¸‰ç”Ÿä¸‡ç‰©â€ã€‚ç»“æ„ä½“ç”¨å…³é”®å­— struct å®šä¹‰ï¼Œè¡¨è¾¾å‡ºå¤šä¸ªä¸åŒå˜é‡åœ¨ä¸€èµ·çš„ç±»å‹ã€‚æˆ‘ä»¬ç”±æ­¤å¯ä»¥ä½¿ç”¨structè‡ªå®šä¹‰å‡ ä¹æ‰€æœ‰æƒ³è¦çš„ç±»å‹ã€‚ ç»“æ„ä½“çš„å®šä¹‰ï¼š 12345678struct student&#123; char name[30]; char sex; int age; float high;&#125;stu1;//è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå˜é‡stu1struct student stu2;//è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå˜é‡stu2 è¿™ç§å®šä¹‰å‡ºæ¥çš„ç»“æ„ä½“ç±»å‹åœ¨å®šä¹‰å˜é‡æ—¶å¿…é¡»è·Ÿç€structï¼Œå°±åƒstruct student stu1;ä¸€æ ·ï¼Œæˆ‘ä»¬å¼•å…¥typedefï¼Œé¿å…è¿™ç§æƒ…å†µã€‚ 12345678typedef struct student&#123; char name[30]; char sex; int age; float high;&#125;STUDENT;//å°†struct studentç±»å‹é‡å‘½åä¸ºSTUDENTSTUDENT stu, stu2;//ä½¿ç”¨STUDENTæ›¿æ¢struct studentå®šä¹‰å˜é‡ ç»“æ„ä½“å˜é‡åˆå§‹åŒ–åŠæˆå‘˜è®¿é—®å®šä¹‰çš„ç»“æ„ä½“å˜é‡ç”¨ç‚¹æˆå‘˜è¿ç®—ç¬¦ï¼ˆ.ï¼‰è®¿é—®æˆå‘˜å˜é‡ï¼Œæ¯”å¦‚stu.sexå°±è¿™æ ·è®¿é—®æˆå‘˜å˜é‡ã€‚å¦‚æœæ˜¯ç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆå˜é‡åˆ™ä½¿ç”¨-&gt;è®¿é—®æˆå‘˜å˜é‡ã€‚STUDENT stu; stu-&gt;sex = &#39;x&#39;;åˆå§‹åŒ–å¤§æ¦‚æœ‰ä¸‰ç§æ–¹æ³•ã€‚ ä¸¾ä¾‹ï¼š 12345typede struct block &#123; char name[32]; int type; int size; &#125;block; æ–¹æ³•ä¸€ï¼š 1block test = &#123;&quot;version&quot;, 1, 32&#125;ï¼› éœ€è¦æ³¨æ„å¯¹åº”çš„é¡ºåºï¼Œä¸èƒ½é”™ä½ã€‚ æ–¹æ³•äºŒï¼š 1234block test; test.name = &quot;version&quot;; test.type = 1; test.size= 3; æ–¹æ³•ä¸‰ï¼š 12345block test = &#123; .type= 1, .size = 12, .name= &quot;version&quot; &#125;; ç»“æ„ä½“å¤§å°è®¾è®¡å†…å­˜å¯¹é½ 1234567struct Date &#123; char a; int b; int64_t c; char d;&#125;; Date data [2][10]; ç»“æ„ä½“æ‰€å çš„å†…å­˜å¤§å° a.æ•´ä½“æ‰€å çš„å†…å­˜å¤§å°åº”è¯¥æ˜¯ç»“æ„ä¸­æˆå‘˜ç±»å‹æœ€å¤§çš„æ•´æ•°å€ï¼Œæ­¤å¤„æœ€å¤§çš„ç±»å‹æ˜¯int_64tï¼Œå 8ä¸ªå­—èŠ‚ã€‚å³æœ€åæ‰€å å­—èŠ‚çš„æ€»æ•°åº”è¯¥æ˜¯8çš„å€æ•°ï¼Œä¸è¶³çš„è¡¥è¶³ b.æ•°æ®å¯¹é½åŸåˆ™-å†…å­˜æŒ‰ç»“æ„ä½“æˆå‘˜çš„å…ˆåé¡ºåºæ’åˆ—ï¼Œå½“æ’åˆ°è¯¥æˆå‘˜å˜é‡æ—¶ï¼Œå…¶å‰é¢æ‰€æœ‰æˆå‘˜å·²ç»å ç”¨çš„ç©ºé—´å¤§å°å¿…é¡»æ˜¯è¯¥æˆå‘˜ç±»å‹å¤§å°çš„æ•´æ•°å€ï¼Œå¦‚æœä¸å¤Ÿï¼Œåˆ™å‰é¢çš„æˆå‘˜å ç”¨çš„ç©ºé—´è¦è¡¥é½ï¼Œä½¿ä¹‹æˆä¸ºå½“å‰æˆå‘˜ç±»å‹çš„æ•´æ•°å€ã€‚å‡è®¾æ˜¯åœ°å€æ˜¯ä»0å¼€å§‹ï¼Œç»“æ„ä½“ä¸­ç¬¬ä¸€ä¸ªæˆå‘˜ç±»å‹charå‹å ä¸€ä¸ªå­—èŠ‚ï¼Œåˆ™å†…å­˜åœ°å€0-1ï¼Œç¬¬äºŒæˆå‘˜ä»2å¼€å§‹ï¼Œintå‹æ‰€å å†…å­˜4ä¸ªå­—èŠ‚æ ¹æ®åŸåˆ™bï¼Œç¬¬ä¸€ä¸ªæˆå‘˜æ‰€å å†…å­˜è¡¥é½4çš„å€æ•°ï¼Œæ•…ç¬¬ä¸€ä¸ªæˆå‘˜æ‰€å å†…å­˜:1ï¼‹3ï¼4ï¼›ç¬¬äºŒä¸ªæˆå‘˜å 5-8.ç¬¬ä¸‰ä¸ªæˆå‘˜å 8ä¸ªå­—èŠ‚ï¼Œæ»¡è¶³åŸåˆ™bï¼Œä¸éœ€è¦è¡¥é½ï¼Œå 9-16ç¬¬å››ä¸ªæˆå‘˜å ä¸€ä¸ªå­—èŠ‚ï¼Œå 17.æ•…æ€»å†…å­˜ä¸º1ï¼‹3ï¼‹4ï¼‹8ï¼‹1ï¼17ä¸ªå­—èŠ‚ï¼Œä½†æ ¹æ®åŸåˆ™1æ€»å­—èŠ‚æ•°éœ€æ˜¯8çš„å€æ•°ï¼Œéœ€å°†17è¡¥é½åˆ°24.æ•…æ­¤ç»“æ„ä½“æ€»å­—èŠ‚æ•°ä¸º:24å­—èŠ‚ 4ã€ä¸€äº›å…³é”®å­—çš„è¯¦è§£inlineåœ¨c&#x2F;c++ä¸­ï¼Œä¸ºäº†è§£å†³ä¸€äº›é¢‘ç¹è°ƒç”¨çš„å°å‡½æ•°å¤§é‡æ¶ˆè€—æ ˆç©ºé—´ï¼ˆæ ˆå†…å­˜ï¼‰çš„é—®é¢˜ï¼Œç‰¹åˆ«çš„å¼•å…¥äº†inlineä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºä¸ºå†…è”å‡½æ•°ã€‚æ ˆç©ºé—´å°±æ˜¯æŒ‡æ”¾ç½®ç¨‹åºçš„å±€éƒ¨æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯å‡½æ•°å†…æ•°æ®ï¼‰çš„å†…å­˜ç©ºé—´ã€‚ inlineçš„ä½¿ç”¨æ˜¯æœ‰æ‰€é™åˆ¶çš„ï¼Œinlineåªé€‚åˆæ¶µæ•°ä½“å†…ä»£ç ç®€å•çš„æ¶µæ•°ä½¿ç”¨ï¼Œä¸èƒ½åŒ…å«å¤æ‚çš„ç»“æ„æ§åˆ¶è¯­å¥ä¾‹å¦‚whileã€switchï¼Œå¹¶ä¸”ä¸èƒ½å†…è”å‡½æ•°æœ¬èº«ä¸èƒ½æ˜¯ç›´æ¥é€’å½’å‡½æ•°ï¼ˆå³ï¼Œè‡ªå·±å†…éƒ¨è¿˜è°ƒç”¨è‡ªå·±çš„å‡½æ•°ï¼‰ã€‚ inlineå‡½æ•°ä»…ä»…æ˜¯ä¸€ä¸ªå¯¹ç¼–è¯‘å™¨çš„å»ºè®®ï¼Œæ‰€ä»¥æœ€åèƒ½å¦çœŸæ­£å†…è”ï¼Œçœ‹ç¼–è¯‘å™¨çš„æ„æ€ï¼Œå®ƒå¦‚æœè®¤ä¸ºå‡½æ•°ä¸å¤æ‚ï¼Œèƒ½åœ¨è°ƒç”¨ç‚¹å±•å¼€ï¼Œå°±ä¼šçœŸæ­£å†…è”ï¼Œå¹¶ä¸æ˜¯è¯´å£°æ˜äº†å†…è”å°±ä¼šå†…è”ï¼Œå£°æ˜å†…è”åªæ˜¯ä¸€ä¸ªå»ºè®®è€Œå·²ã€‚ inlineå‡½æ•°çš„å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­å…¶æ¬¡ï¼Œå› ä¸ºå†…è”å‡½æ•°è¦åœ¨è°ƒç”¨ç‚¹å±•å¼€ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¿…é¡»éšå¤„å¯è§å†…è”å‡½æ•°çš„å®šä¹‰ï¼Œè¦ä¸ç„¶å°±æˆäº†éå†…è”å‡½æ•°çš„è°ƒç”¨äº†ã€‚æ‰€ä»¥ï¼Œè¿™è¦æ±‚æ¯ä¸ªè°ƒç”¨äº†å†…è”å‡½æ•°çš„æ–‡ä»¶éƒ½å‡ºç°äº†è¯¥å†…è”å‡½æ•°çš„å®šä¹‰ã€‚ å› æ­¤ï¼Œå°†å†…è”å‡½æ•°çš„å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶é‡Œå®ç°æ˜¯åˆé€‚çš„ï¼Œçœå´ä½ ä¸ºæ¯ä¸ªæ–‡ä»¶å®ç°ä¸€æ¬¡çš„éº»çƒ¦ã€‚ å£°æ˜è·Ÿå®šä¹‰è¦ä¸€è‡´ï¼šå¦‚æœåœ¨æ¯ä¸ªæ–‡ä»¶é‡Œéƒ½å®ç°ä¸€æ¬¡è¯¥å†…è”å‡½æ•°çš„è¯ï¼Œé‚£ä¹ˆï¼Œæœ€å¥½ä¿è¯æ¯ä¸ªå®šä¹‰éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¦åˆ™ï¼Œå°†ä¼šå¼•èµ·æœªå®šä¹‰çš„è¡Œä¸ºã€‚å¦‚æœä¸æ˜¯æ¯ä¸ªæ–‡ä»¶é‡Œçš„å®šä¹‰éƒ½ä¸€æ ·ï¼Œé‚£ä¹ˆï¼Œç¼–è¯‘å™¨å±•å¼€çš„æ˜¯å“ªä¸€ä¸ªï¼Œé‚£è¦çœ‹å…·ä½“çš„ç¼–è¯‘å™¨è€Œå®šã€‚æ‰€ä»¥ï¼Œæœ€å¥½å°†å†…è”å‡½æ•°å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ã€‚ æ³¨ï¼šä¹‹æ‰€ä»¥å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œæ˜¯å› ä¸ºinlineæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå±•å¼€çš„ï¼Œå¹¶ä¸æ˜¯è¿æ¥æºæ–‡ä»¶ã€‚ staticstaticåˆ«çš„ä¸œè¥¿ä¸æƒ³è¯´ï¼Œå°±è¯´staticåœ¨ä¿®é¥°å±€éƒ¨å˜é‡çš„æ—¶å€™ï¼Œå‡½æ•°ç»“æŸæ­¤æ—¶å±€éƒ¨å˜é‡å¹¶ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶ä¸”ä¿®é¥°çš„å±€éƒ¨å˜é‡çš„å€¼æ˜¯ä¸€ç›´ä¿å­˜çš„ï¼Œç±»ä¼¼äºå…¨å±€å˜é‡ï¼Œä½†æ˜¯è¿˜æ˜¯åªèƒ½åœ¨è¿™ä¸ªå‡½æ•°å†…æ‰èƒ½è®¿é—® constconståˆå«å¸¸å˜é‡ï¼Œä¿®é¥°çš„å˜é‡ä¸€èˆ¬ä¸èƒ½è¢«æ›´æ”¹ã€‚ä½†æ˜¯åœ¨Cè¯­è¨€ä¸­è¿™æ˜¯å‡çš„ï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆï¼Œä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ä¾æ—§å¯ä»¥æ›´æ”¹constä¿®é¥°çš„å˜é‡ã€‚åœ¨C++ä¸­æ‰æ˜¯çœŸæ­£çš„constï¼Œæ— æ³•ä¿®æ”¹ã€‚ constä¸€èˆ¬å‡ºç°åœ¨å‚æ•°åˆ—è¡¨ä¸­ï¼Œæ„å‘³ç€è¿™ä¸ªå˜é‡åœ¨å‡½æ•°ä¸­å¹¶ä¸ä¼šè¢«ä¿®æ”¹ï¼Œæ˜¯è¾“å…¥å‹å‚æ•°ã€‚ volatileè¿™ä¸ªvolatileï¼Œè‹±æ–‡åæ˜“å˜çš„ã€‚å› ä¸ºè®¿é—®å¯„å­˜å™¨è¦æ¯”è®¿é—®å†…å­˜å•å…ƒå¿«çš„å¤š,æ‰€ä»¥ç¼–è¯‘å™¨ä¸€èˆ¬éƒ½ä¼šä½œå‡å°‘å­˜å–å†…å­˜çš„ä¼˜åŒ–ï¼Œä½†æœ‰å¯èƒ½ä¼šè¯»è„æ•°æ®ã€‚å½“è¦æ±‚ä½¿ç”¨volatileå£°æ˜å˜é‡å€¼çš„æ—¶å€™ï¼Œç³»ç»Ÿæ€»æ˜¯é‡æ–°ä»å®ƒæ‰€åœ¨çš„å†…å­˜è¯»å–æ•°æ®ï¼Œå³ä½¿å®ƒå‰é¢çš„æŒ‡ä»¤åˆšåˆšä»è¯¥å¤„è¯»å–è¿‡æ•°æ®ã€‚ ç²¾ç¡®åœ°è¯´å°±æ˜¯ï¼Œé‡åˆ°è¿™ä¸ªå…³é”®å­—å£°æ˜çš„å˜é‡ï¼Œç¼–è¯‘å™¨å¯¹è®¿é—®è¯¥å˜é‡çš„ä»£ç å°±ä¸å†è¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œå¯ä»¥æä¾›å¯¹ç‰¹æ®Šåœ°å€çš„ç¨³å®šè®¿é—®ï¼›å¦‚æœä¸ä½¿ç”¨valatileï¼Œåˆ™ç¼–è¯‘å™¨å°†å¯¹æ‰€å£°æ˜çš„è¯­å¥è¿›è¡Œä¼˜åŒ–ã€‚ 5ã€å¤šæ–‡ä»¶ç¼–ç¨‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ å…¨å±€å˜é‡æœ€å¥½å£°æ˜ä¸º staticï¼Œåªåœ¨å½“å‰æ–‡ä»¶ä¸­å¯è§ï¼Œä¸è¦å¯¹å¤–æš´éœ²ï¼›å¦‚æœå¿…é¡»å¯¹å¤–æš´éœ²ï¼Œå¯ä»¥ä½¿ç”¨å®å®šä¹‰ä»£æ›¿ï¼Œå…¨å±€å˜é‡æœ€å¥½åªåœ¨æœ¬æ–‡ä»¶å†…ä½¿ç”¨ï¼Œå¦‚æœå…¶ä»–æ–‡ä»¶å¿…é¡»ä½¿ç”¨ï¼Œæœ€å¥½å°è£…getæ¥å£setæ¥å£ï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç ã€‚ main.c æºç ï¼š 1234567891011#include &lt;stdio.h&gt;#include &lt;conio.h&gt;#include &quot;module.h&quot;int main()&#123; int n1 = 1, n2 = 100; printf(&quot;ä»%d åŠ åˆ°%d çš„å’Œä¸º%ld [By %s]&quot;, n1, n2, sum(n1, n2), OS); getch(); return 0;&#125; module.c æºç ï¼šå¦‚æœä½¿ç”¨äº†å¤´æ–‡ä»¶ä¸­çš„å®å®šä¹‰ï¼Œè¿™é‡Œä¹Ÿæ˜¯éœ€è¦åŒ…å«å¤´æ–‡ä»¶çš„ 123456789101112131415161718#include &lt;stdio.h&gt;#include &quot;module.h&quot;long sum(int fromNum, int endNum)&#123; int i; long result = 0; // å‚æ•°ä¸ç¬¦åˆè§„åˆ™ï¼Œè¿”å› -1 if(fromNum&lt;0 || endNum&lt;0 || endNum&lt;fromNum)&#123; return -1; &#125; for(i=fromNum; i&lt;=endNum; i++)&#123; result += i; &#125; // è¿”å›å¤§äºç­‰äº 0 çš„å€¼ return result;&#125; module.h æºç ï¼š 1234567#ifndef __MODULE_H_ #define __MODULE_H_ // ç”¨å®å®šä¹‰æ¥ä»£æ›¿å…¨å±€å˜é‡ #define OS &quot;Windows 7&quot; // ä¹Ÿå¯ä»¥çœç•¥ externï¼›ä¸è¿‡ä¸ºäº†ç¨‹åºå¯è¯»æ€§ï¼Œå»ºè®®å†™ä¸Š extern long sum(int, int);#endif å¤šä¸ª.cæ–‡ä»¶çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥åªç”¨ä¸€ä¸ª.hå¤´æ–‡ä»¶ï¼Œç„¶åéƒ½åŒ…å«ä¸€ä¸‹è¿™ä¸ª.hæ–‡ä»¶ 6ã€æ–‡ä»¶æ“ä½œhttps://www.cnblogs.com/wuqianling/p/5340719.htmlè¿™ç¯‡æ–‡ç« å†™çš„å°±ä¸é”™ã€‚ ä¸»è¦æ˜¯æ–‡ä»¶æ“ä½œåˆ†ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶å’Œæ–‡æœ¬æ–‡ä»¶ï¼Œfopenæ‰“å¼€çš„æ—¶å€™è®¾ç½®æ‰“å¼€æ¨¡å¼ï¼Œè¿”å›å€¼é—®FILE*ç±»å‹çš„ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆã€‚é€šè¿‡è¿™ä¸ªæ–‡ä»¶æŒ‡é’ˆå°±å¯ä»¥è®¿é—®è¿™ä¸ªæ–‡ä»¶ã€‚ 7ã€ç¼–ç è§„èŒƒ for whileç­‰å…³é”®å­—å’Œæ‹¬å·ä¹‹é—´ç•™å‡ºä¸€ä¸ªç©ºæ ¼ï¼Œçªå‡ºå…³é”®å­—ï¼Œforåå“ªæ€•åªæœ‰ä¸€è¡Œä¹Ÿå†™{} æ³¨é‡Šçš„åŒæ–œçº¿ä¹‹åè¦æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œçªå‡ºæ³¨é‡Š å‡½æ•°åå’Œç±»ä½¿ç”¨å¤§é©¼å³°å‘½åæ³•é¦–ä¸ªå•è¯å¤§å†™ï¼Œå˜é‡ä½¿ç”¨å°é©¼å³°å‘½åæ³•ç¬¬ä¸€ä¸ªå­—æ¯å°å†™ ç±»å’Œå‡½æ•°å†™å®Œä¹‹åè¦ç©ºä¸€è¡Œ åˆ†å·ã€é€—å·å‰è¾¹ä¸ç©ºæ ¼ï¼Œåè¾¹ç•™ç©ºæ ¼ã€‚åŒç›®è¿ç®—ç¬¦ä¸¤è¾¹ç•™ç©ºæ ¼","tags":["Cè¯­è¨€"],"categories":["Cè¯­è¨€"]},{"title":"procç›®å½•ä¸‹pidå„æ–‡ä»¶ç›®å½•å«ä¹‰","path":"/posts/procç›®å½•ä¸‹pidå„æ–‡ä»¶ç›®å½•å«ä¹‰.html","content":"Linux å†…æ ¸æä¾›äº†ä¸€ç§é€šè¿‡ proc æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨è¿è¡Œæ—¶è®¿é—®å†…æ ¸å†…éƒ¨æ•°æ®ç»“æ„ã€æ”¹å˜å†…æ ¸è®¾ç½®çš„æœºåˆ¶ã€‚proc æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåªå­˜åœ¨å†…å­˜å½“ä¸­ï¼Œè€Œä¸å ç”¨å¤–å­˜ç©ºé—´ã€‚å®ƒä»¥æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼ä¸ºè®¿é—®ç³»ç»Ÿå†…æ ¸æ•°æ®çš„æ“ä½œæä¾›æ¥å£ã€‚ ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ proc å¾—åˆ°ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¹¶å¯ä»¥æ”¹å˜å†…æ ¸çš„æŸäº›å‚æ•°ã€‚ç”±äºç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¦‚è¿›ç¨‹ï¼Œæ˜¯åŠ¨æ€æ”¹å˜çš„ï¼Œæ‰€ä»¥ç”¨æˆ·æˆ–åº”ç”¨ç¨‹åºè¯»å– proc æ–‡ä»¶æ—¶ï¼Œproc æ–‡ä»¶ç³»ç»Ÿæ˜¯åŠ¨æ€ä»ç³»ç»Ÿå†…æ ¸è¯»å‡ºæ‰€éœ€ä¿¡æ¯å¹¶æäº¤çš„ã€‚ ä¸‹é¢åˆ—å‡ºçš„è¿™äº›æ–‡ä»¶æˆ–å­æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸æ˜¯éƒ½æ˜¯åœ¨ä½ çš„ç³»ç»Ÿä¸­å­˜åœ¨ï¼Œè¿™å–å†³äºä½ çš„å†…æ ¸é…ç½®å’Œè£…è½½çš„æ¨¡å—ã€‚å¦å¤–ï¼Œåœ¨ proc ä¸‹è¿˜æœ‰ä¸‰ä¸ªå¾ˆé‡è¦çš„ç›®å½•ï¼šnetï¼Œscsi å’Œ sysã€‚ sys ç›®å½•æ˜¯å¯å†™çš„ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è®¿é—®æˆ–ä¿®æ”¹å†…æ ¸çš„å‚æ•°ï¼Œè€Œ net å’Œ scsi åˆ™ä¾èµ–äºå†…æ ¸é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç³»ç»Ÿä¸æ”¯æŒ scsiï¼Œåˆ™ scsi ç›®å½•ä¸å­˜åœ¨ã€‚ é™¤äº†ä»¥ä¸Šä»‹ç»çš„è¿™äº›ï¼Œè¿˜æœ‰çš„æ˜¯ä¸€äº›ä»¥æ•°å­—å‘½åçš„ç›®å½•ï¼Œå®ƒä»¬æ˜¯è¿›ç¨‹ç›®å½•ã€‚ç³»ç»Ÿä¸­å½“å‰è¿è¡Œçš„æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰å¯¹åº”çš„ä¸€ä¸ªç›®å½•åœ¨ proc ä¸‹ï¼Œä»¥è¿›ç¨‹çš„ PID å·ä¸ºç›®å½•åï¼Œå®ƒä»¬æ˜¯è¯»å–è¿›ç¨‹ä¿¡æ¯çš„æ¥å£ã€‚è€Œ self ç›®å½•åˆ™æ˜¯è¯»å–è¿›ç¨‹æœ¬èº«çš„ä¿¡æ¯æ¥å£ï¼Œæ˜¯ä¸€ä¸ª linkã€‚ &#x2F;proc&#x2F;[pid]&#x2F;auxv&#x2F;proc&#x2F;[pid]&#x2F;auxv åŒ…å«ä¼ é€’ç»™è¿›ç¨‹çš„ ELF è§£é‡Šå™¨ä¿¡æ¯ï¼Œæ ¼å¼æ˜¯æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ª unsigned longé•¿åº¦çš„ ID åŠ ä¸Šä¸€ä¸ª unsigned long é•¿åº¦çš„å€¼ã€‚æœ€åä¸€é¡¹ä»¥è¿ç»­çš„ä¸¤ä¸ª 0x00 å¼€å¤´ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ hexdump -x &#x2F;proc&#x2F;2406&#x2F;auxv 0000000 0021 0000 0000 0000 f000 f7fa 7fff 00000000010 0010 0000 0000 0000 fbff 1f8b 0000 00000000020 0006 0000 0000 0000 1000 0000 0000 00000000030 0011 0000 0000 0000 0064 0000 0000 00000000040 0003 0000 0000 0000 0040 0040 0000 00000000050 0004 0000 0000 0000 0038 0000 0000 00000000060 0005 0000 0000 0000 0007 0000 0000 00000000070 0007 0000 0000 0000 0000 0000 0000 00000000080 0008 0000 0000 0000 0000 0000 0000 00000000090 0009 0000 0000 0000 55e0 0045 0000 000000000a0 000b 0000 0000 0000 0000 0000 0000 000000000b0 000c 0000 0000 0000 0000 0000 0000 000000000c0 000d 0000 0000 0000 0000 0000 0000 000000000d0 000e 0000 0000 0000 0000 0000 0000 000000000e0 0017 0000 0000 0000 0000 0000 0000 000000000f0 0019 0000 0000 0000 f079 f7f6 7fff 00000000100 001f 0000 0000 0000 ffea f7f6 7fff 00000000110 000f 0000 0000 0000 f089 f7f6 7fff 00000000120 0000 0000 0000 0000 0000 0000 0000 00000000130 &#x2F;proc&#x2F;[pid]&#x2F;cmdline&#x2F;proc&#x2F;[pid]&#x2F;cmdline æ˜¯ä¸€ä¸ªåªè¯»æ–‡ä»¶ï¼ŒåŒ…å«è¿›ç¨‹çš„å®Œæ•´å‘½ä»¤è¡Œä¿¡æ¯ã€‚å¦‚æœè¯¥è¿›ç¨‹å·²ç»è¢«äº¤æ¢å‡ºå†…å­˜æˆ–è€…è¿™ä¸ªè¿›ç¨‹æ˜¯ zombie è¿›ç¨‹ï¼Œåˆ™è¿™ä¸ªæ–‡ä»¶æ²¡æœ‰ä»»ä½•å†…å®¹ã€‚è¯¥æ–‡ä»¶ä»¥ç©ºå­—ç¬¦ null è€Œä¸æ˜¯æ¢è¡Œç¬¦ä½œä¸ºç»“æŸæ ‡å¿—ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ ps aux|grep frpsroot 2406 0.1 0.1 54880 10524 ? Sl Dec11 21:30 frps -c .&#x2F;frps.ini $ cat &#x2F;proc&#x2F;2406&#x2F;cmdlinefrps-c.&#x2F;frps.ini &#x2F;proc&#x2F;[pid]&#x2F;comm&#x2F;proc&#x2F;[pid]&#x2F;comm åŒ…å«è¿›ç¨‹çš„å‘½ä»¤åã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ cat &#x2F;proc&#x2F;2406&#x2F;commfrps &#x2F;proc&#x2F;[pid]&#x2F;cwd&#x2F;proc&#x2F;[pid]&#x2F;cwd æ˜¯è¿›ç¨‹å½“å‰å·¥ä½œç›®å½•çš„ç¬¦å·é“¾æ¥ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ ls -lt &#x2F;proc&#x2F;2406&#x2F;cwdlrwxrwxrwx 1 root root 0 Dec 12 20:39 &#x2F;proc&#x2F;2406&#x2F;cwd -&gt; &#x2F;home&#x2F;mike&#x2F;frp_0.13.0_linux_amd64 &#x2F;proc&#x2F;[pid]&#x2F;environ&#x2F;proc&#x2F;[pid]&#x2F;environ æ˜¾ç¤ºè¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ strings &#x2F;proc&#x2F;2406&#x2F;environ SUPERVISOR_GROUP_NAME&#x3D;sshTERM&#x3D;linuxSUPERVISOR_SERVER_URL&#x3D;unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;supervisor.sockSUPERVISOR_PROCESS_NAME&#x3D;sshRUNLEVEL&#x3D;2UPSTART_EVENTS&#x3D;runlevelPREVLEVEL&#x3D;NPATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;binUPSTART_INSTANCE&#x3D;UPSTART_JOB&#x3D;rcSUPERVISOR_ENABLED&#x3D;1runlevel&#x3D;2PWD&#x3D;&#x2F;previous&#x3D;N &#x2F;proc&#x2F;[pid]&#x2F;exe&#x2F;proc&#x2F;[pid]&#x2F;exe ä¸ºå®é™…è¿è¡Œç¨‹åºçš„ç¬¦å·é“¾æ¥ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ ls -lt &#x2F;proc&#x2F;2406&#x2F;exelrwxrwxrwx 1 root root 0 Dec 11 19:00 &#x2F;proc&#x2F;2406&#x2F;exe -&gt; &#x2F;usr&#x2F;bin&#x2F;frps &#x2F;proc&#x2F;[pid]&#x2F;fd&#x2F;proc&#x2F;[pid]&#x2F;fd æ˜¯ä¸€ä¸ªç›®å½•ï¼ŒåŒ…å«è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„æƒ…å†µã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ ls -lt &#x2F;proc&#x2F;2406&#x2F;fd lrwxâ€”â€” 1 root root 64 Dec 24 09:39 77 -&gt; socket:[44377722]lrwxâ€”â€” 1 root root 64 Dec 17 15:07 47 -&gt; socket:[29482617]lr-xâ€”â€” 1 root root 64 Dec 12 20:18 0 -&gt; pipe:[13282]l-wxâ€”â€” 1 root root 64 Dec 12 20:18 1 -&gt; pipe:[13283]lrwxâ€”â€” 1 root root 64 Dec 12 20:18 10 -&gt; socket:[12238218]lrwxâ€”â€” 1 root root 64 Dec 12 20:18 4 -&gt; anon_inode:[eventpoll]lrwxâ€”â€” 1 root root 64 Dec 12 20:18 40 -&gt; socket:[19378614] ç›®å½•ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ•°å­—åˆ™ä»£è¡¨æ–‡ä»¶æè¿°ç¬¦ã€‚ &#x2F;proc&#x2F;[pid]&#x2F;latency&#x2F;proc&#x2F;[pid]&#x2F;latency æ˜¾ç¤ºå“ªäº›ä»£ç é€ æˆçš„å»¶æ—¶æ¯”è¾ƒå¤§ã€‚å¦‚æœè¦ä½¿ç”¨è¿™ä¸ªç‰¹æ€§éœ€è¦æ‰§è¡Œï¼š $ echo 1 &gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;latencytop ä¸¾ä¾‹å¦‚ä¸‹ $ cat &#x2F;proc&#x2F;2406&#x2F;latency Latency Top version : v0.130667 10650491 4891 poll_schedule_timeout do_sys_poll SyS_poll system_call_fastpath 0x7f636573dc1d8 105 44 futex_wait_queue_me futex_wait do_futex SyS_futex system_call_fastpath 0x7f6365a167bc æ¯ä¸€è¡Œå‰ä¸‰ä¸ªæ•°å­—åˆ†åˆ«æ˜¯åé¢ä»£ç æ‰§è¡Œçš„æ¬¡æ•°ã€æ€»å…±æ‰§è¡Œå»¶è¿Ÿæ—¶é—´(å•ä½æ˜¯å¾®ç§’)å’Œæœ€é•¿æ‰§è¡Œå»¶è¿Ÿæ—¶é—´(å•ä½æ˜¯å¾®ç§’)ã€‚åé¢åˆ™æ˜¯ä»£ç å®Œæ•´çš„è°ƒç”¨æ ˆã€‚ &#x2F;proc&#x2F;[pid]&#x2F;maps&#x2F;proc&#x2F;[pid]&#x2F;maps æ˜¾ç¤ºè¿›ç¨‹çš„å†…å­˜åŒºåŸŸæ˜ å°„ä¿¡æ¯ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ cat &#x2F;proc&#x2F;2406&#x2F;maps00400000-006ea000 r-xp 00000000 fd:01 1727569 &#x2F;usr&#x2F;bin&#x2F;frps006ea000-00a6c000 râ€“p 002ea000 fd:01 1727569 &#x2F;usr&#x2F;bin&#x2F;frps00a6c000-00ab1000 rw-p 0066c000 fd:01 1727569 &#x2F;usr&#x2F;bin&#x2F;frps00ab1000-00ad4000 rw-p 00000000 00:00 0c000000000-c00000b000 rw-p 00000000 00:00 0c41feac000-c420000000 rw-p 00000000 00:00 0c420000000-c420400000 rw-p 00000000 00:00 0c420400000-c420700000 rw-p 00000000 00:00 0c420700000-c420800000 rw-p 00000000 00:00 0c420800000-c420900000 rw-p 00000000 00:00 0c420900000-c420a00000 rw-p 00000000 00:00 0c420a00000-c421ea0000 rw-p 00000000 00:00 0c421ea0000-c422a00000 rw-p 00000000 00:00 0c422a00000-c422a60000 rw-p 00000000 00:00 07f0418c01000-7f0418ee1000 rw-p 00000000 00:00 07ffff7f4f000-7ffff7f70000 rw-p 00000000 00:00 0 [stack:5121]7ffff7fad000-7ffff7faf000 râ€“p 00000000 00:00 0 [vvar]7ffff7faf000-7ffff7fb1000 r-xp 00000000 00:00 0 [vdso]ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0 [vsyscall] å…¶ä¸­æ³¨æ„çš„ä¸€ç‚¹æ˜¯ [stack:] æ˜¯çº¿ç¨‹çš„å †æ ˆä¿¡æ¯ï¼Œå¯¹åº”äº &#x2F;proc&#x2F;[pid]&#x2F;task&#x2F;[tid]&#x2F; è·¯å¾„ã€‚ &#x2F;proc&#x2F;[pid]&#x2F;root&#x2F;proc&#x2F;[pid]&#x2F;root æ˜¯è¿›ç¨‹æ ¹ç›®å½•çš„ç¬¦å·é“¾æ¥ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ ls -lt &#x2F;proc&#x2F;2406&#x2F;rootlrwxrwxrwx 1 root root 0 Dec 12 20:39 &#x2F;proc&#x2F;2406&#x2F;root -&gt; &#x2F; &#x2F;proc&#x2F;[pid]&#x2F;stack&#x2F;proc&#x2F;[pid]&#x2F;stack ç¤ºå½“å‰è¿›ç¨‹çš„å†…æ ¸è°ƒç”¨æ ˆä¿¡æ¯ï¼Œåªæœ‰å†…æ ¸ç¼–è¯‘æ—¶æ‰“å¼€äº† CONFIG_STACKTRACE ç¼–è¯‘é€‰é¡¹ï¼Œæ‰ä¼šç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š 1234567$ cat /proc/2406/stack[&lt;ffffffff810fa996&gt;] futex_wait_queue_me+0xc6/0x130[&lt;ffffffff810fb05d&gt;] futex_wait+0x17d/0x270[&lt;ffffffff810fd2d5&gt;] do_futex+0xd5/0x520[&lt;ffffffff810fd791&gt;] SyS_futex+0x71/0x150[&lt;ffffffff8180cc76&gt;] entry_SYSCALL_64_fastpath+0x16/0x75[&lt;ffffffffffffffff&gt;] 0xffffffffffffffff &#x2F;proc&#x2F;[pid]&#x2F;statm&#x2F;proc&#x2F;[pid]&#x2F;statm æ˜¾ç¤ºè¿›ç¨‹æ‰€å ç”¨å†…å­˜å¤§å°çš„ç»Ÿè®¡ä¿¡æ¯ã€‚åŒ…å«ä¸ƒä¸ªå€¼ï¼Œåº¦é‡å•ä½æ˜¯ page(pageå¤§å°å¯é€šè¿‡ getconf PAGESIZE å¾—åˆ°)ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ cat &#x2F;proc&#x2F;2406&#x2F;statm13720 2617 493 746 0 12007 0 å„ä¸ªå€¼å«ä¹‰ï¼š aï¼‰è¿›ç¨‹å ç”¨çš„æ€»çš„å†…å­˜bï¼‰è¿›ç¨‹å½“å‰æ—¶åˆ»å ç”¨çš„ç‰©ç†å†…å­˜cï¼‰åŒå…¶å®ƒè¿›ç¨‹å…±äº«çš„å†…å­˜dï¼‰è¿›ç¨‹çš„ä»£ç æ®µeï¼‰å…±äº«åº“(ä»2.6ç‰ˆæœ¬èµ·ï¼Œè¿™ä¸ªå€¼ä¸º0)fï¼‰è¿›ç¨‹çš„å †æ ˆgï¼‰dirty pages(ä»2.6ç‰ˆæœ¬èµ·ï¼Œè¿™ä¸ªå€¼ä¸º0) &#x2F;proc&#x2F;[pid]&#x2F;status&#x2F;proc&#x2F;[pid]&#x2F;status åŒ…å«è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ã€‚å…¶å¾ˆå¤šå†…å®¹ä¸ &#x2F;proc&#x2F;[pid]&#x2F;stat å’Œ &#x2F;proc&#x2F;[pid]&#x2F;statm ç›¸åŒï¼Œä½†æ˜¯å´æ˜¯ä»¥ä¸€ç§æ›´æ¸…æ™°åœ°æ–¹å¼å±•ç°å‡ºæ¥ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ cat &#x2F;proc&#x2F;2406&#x2F;statusName: frpsState: S (sleeping)Tgid: 2406Ngid: 0Pid: 2406PPid: 2130TracerPid: 0Uid: 0 0 0 0Gid: 0 0 0 0FDSize: 128Groups: 0NStgid: 2406NSpid: 2406NSpgid: 2406NSsid: 2130VmPeak: 54880 kBVmSize: 54880 kBVmLck: 0 kBVmPin: 0 kBVmHWM: 34872 kBVmRSS: 10468 kBVmData: 47896 kBVmStk: 132 kBVmExe: 2984 kBVmLib: 0 kBVmPTE: 68 kBVmPMD: 20 kBVmSwap: 0 kBHugetlbPages: 0 kBThreads: 11SigQ: 0&#x2F;31834SigPnd: 0000000000000000ShdPnd: 0000000000000000SigBlk: 0000000000000000SigIgn: 0000000000000000SigCgt: fffffffe7fc1feffCapInh: 0000000000000000CapPrm: 0000003fffffffffCapEff: 0000003fffffffffCapBnd: 0000003fffffffffCapAmb: 0000000000000000Seccomp: 0Cpus_allowed: fCpus_allowed_list: 0-3Mems_allowed: 00000000,00000001Mems_allowed_list: 0voluntary_ctxt_switches: 2251028nonvoluntary_ctxt_switches: 18031 å…³äºä¿¡å·ï¼ˆsignalï¼‰çš„ä¿¡æ¯ï¼šSigQ åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼ˆä¾‹å¦‚ 0&#x2F;31834ï¼‰ï¼Œå‰é¢è¡¨ç¤ºå½“å‰å¤„åœ¨é˜Ÿåˆ—ä¸­çš„ä¿¡å·ï¼ˆ0ï¼‰ï¼Œåé¢åˆ™è¡¨ç¤ºé˜Ÿåˆ—ä¸€å…±å¯ä»¥å­˜å‚¨å¤šå°‘ä¿¡å·ï¼ˆ31834ï¼‰ï¼›SigPnd è¡¨ç¤ºå½“å‰çº¿ç¨‹ pending çš„ä¿¡å·ï¼Œè€ŒShdPnd åˆ™è¡¨ç¤ºæ•´ä¸ªè¿›ç¨‹ pending çš„ä¿¡å·ï¼›SigBlkã€SigIgn å’Œ SigCgt åˆ†åˆ«è¡¨ç¤ºå¯¹ä¿¡å·çš„å¤„ç†æ˜¯é˜»å¡ï¼Œå¿½ç•¥ï¼Œè¿˜æ˜¯æ•è·ã€‚ï¼ˆå…³äºUnixä¿¡å·çš„ç›¸å…³çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒ Unix: Dealing with signalsï¼‰ã€‚ &#x2F;proc&#x2F;[pid]&#x2F;syscall&#x2F;proc&#x2F;[pid]&#x2F;syscall æ˜¾ç¤ºå½“å‰è¿›ç¨‹æ­£åœ¨æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ cat &#x2F;proc&#x2F;2406&#x2F;syscall202 0xab3730 0x0 0x0 0x0 0x0 0x0 0x7ffff7f6ec68 0x455bb3 ç¬¬ä¸€ä¸ªå€¼æ˜¯ç³»ç»Ÿè°ƒç”¨å·ï¼ˆ202ä»£è¡¨pollï¼‰ï¼Œåé¢è·Ÿç€ 6 ä¸ªç³»ç»Ÿè°ƒç”¨çš„å‚æ•°å€¼ï¼ˆä½äºå¯„å­˜å™¨ä¸­ï¼‰ï¼Œæœ€åä¸¤ä¸ªå€¼ä¾æ¬¡æ˜¯å †æ ˆæŒ‡é’ˆå’ŒæŒ‡ä»¤è®¡æ•°å™¨çš„å€¼ã€‚å¦‚æœå½“å‰è¿›ç¨‹è™½ç„¶é˜»å¡ï¼Œä½†é˜»å¡å‡½æ•°å¹¶ä¸æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œåˆ™ç³»ç»Ÿè°ƒç”¨å·çš„å€¼ä¸º -1ï¼Œåé¢åªæœ‰å †æ ˆæŒ‡é’ˆå’ŒæŒ‡ä»¤è®¡æ•°å™¨çš„å€¼ã€‚å¦‚æœè¿›ç¨‹æ²¡æœ‰é˜»å¡ï¼Œåˆ™è¿™ä¸ªæ–‡ä»¶åªæœ‰ä¸€ä¸ª running çš„å­—ç¬¦ä¸²ã€‚ å†…æ ¸ç¼–è¯‘æ—¶æ‰“å¼€äº† CONFIG_HAVE_ARCH_TRACEHOOK ç¼–è¯‘é€‰é¡¹ï¼Œæ‰ä¼šç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ã€‚ &#x2F;proc&#x2F;[pid]&#x2F;wchan&#x2F;proc&#x2F;[pid]&#x2F;wchan æ˜¾ç¤ºå½“è¿›ç¨‹ sleep æ—¶ï¼Œkernel å½“å‰è¿è¡Œçš„å‡½æ•°ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š $ cat &#x2F;proc&#x2F;2406&#x2F;wchanfutex_wait_queue_meadmin","tags":["Linux"],"categories":["Linux"]},{"title":"æŸ¥æ‰¾å†…æ ¸ç¬¦å·","path":"/posts/æŸ¥æ‰¾å†…æ ¸ç¬¦å·.html","content":"ä¸€ã€&#x2F;proc&#x2F;kallsyms å†…æ ¸ç¬¦å·å¯ä»¥é€šè¿‡&#x2F;proc&#x2F;kallsymsæŸ¥çœ‹ã€‚ (1)ç¬¦å·ç±»å‹è¯´æ˜ åœ¨Linuxå†…æ ¸ä¸­ï¼Œkallsymsæ˜¯ä¸€ä¸ªç¬¦å·è¡¨ï¼Œå®ƒåŒ…å«äº†å†…æ ¸ä¸­æ‰€æœ‰çš„ç¬¦å·ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‡½æ•°ã€å˜é‡ã€å¸¸é‡ç­‰ç­‰ã€‚è¿™äº›ç¬¦å·ä¿¡æ¯å¯ä»¥è¢«å†…æ ¸æ¨¡å—å’Œå…¶ä»–ç¨‹åºä½¿ç”¨ï¼Œè¿™äº›ç¬¦å·ç±»å‹å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å†…æ ¸ä¸­çš„ç¬¦å·ä¿¡æ¯ï¼Œä»è€Œæ›´å¥½åœ°è¿›è¡Œå†…æ ¸å¼€å‘å’Œè°ƒè¯•ã€‚ åœ¨kallsymsä¸­ï¼Œæ¯ä¸ªç¬¦å·éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼Œè¡¨ç¤ºå®ƒçš„ç”¨é€”ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ç¬¦å·ç±»å‹ï¼š Tï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥è¢«å…¶ä»–ä»£ç è°ƒç”¨ã€‚ tï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå±€éƒ¨å‡½æ•°ï¼Œåªèƒ½åœ¨å½“å‰æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚ Dï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå¯ä»¥è¢«å…¶ä»–ä»£ç è®¿é—®å’Œä¿®æ”¹ã€‚ dï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œåªèƒ½åœ¨å½“å‰æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚ Rï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªåªè¯»å˜é‡ï¼Œä¸èƒ½è¢«ä¿®æ”¹ã€‚ rï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªåªè¯»å±€éƒ¨å˜é‡ï¼Œåªèƒ½åœ¨å½“å‰æ–‡ä»¶ä¸­ä½¿ç”¨ Aï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå¯è¯»å†™çš„å˜é‡ï¼Œå¯ä»¥è¢«å…¶ä»–ä»£ç è®¿é—®å’Œä¿®æ”¹ã€‚ aï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå¯è¯»å†™çš„å±€éƒ¨å˜é‡ï¼Œåªèƒ½åœ¨å½“å‰æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚ Bï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œå®ƒçš„å€¼åœ¨ç¨‹åºå¯åŠ¨æ—¶è¢«åˆå§‹åŒ–ä¸º0ã€‚ bï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–çš„å±€éƒ¨å˜é‡ï¼Œå®ƒçš„å€¼åœ¨ç¨‹åºå¯åŠ¨æ—¶è¢«åˆå§‹åŒ–ä¸º0ã€‚ Gï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä½†æ˜¯å®ƒçš„å€¼åœ¨ç¨‹åºè¿è¡Œæ—¶å¯èƒ½ä¼šè¢«ä¿®æ”¹ã€‚ Cï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå®ƒçš„å€¼åœ¨ç¨‹åºè¿è¡Œæ—¶ä¸èƒ½è¢«ä¿®æ”¹ã€‚ Wï¼šè¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå¼±ç¬¦å·ï¼Œ ?: è¡¨ç¤ºè¯¥ç¬¦å·çš„ç±»å‹æœªçŸ¥ã€‚ (2)å¼±ç¬¦å·å…³äºå¼±ç¬¦å·çš„ä¸€äº›è¯´æ˜ï¼š__weak æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºå£°æ˜ä¸€ä¸ªå¼±ç¬¦å·ã€‚åœ¨ C è¯­è¨€ä¸­ï¼Œå¦‚æœä¸€ä¸ªç¬¦å·è¢«å®šä¹‰äº†å¤šæ¬¡ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç¬¦å·è¢«å£°æ˜ä¸ºå¼±ç¬¦å·ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯åœ¨é“¾æ¥æ—¶é€‰æ‹©å…¶ä¸­ä¸€ä¸ªç¬¦å·ä½œä¸ºæœ€ç»ˆçš„ç¬¦å·ã€‚è¿™ä¸ªç‰¹æ€§åœ¨ç¼–å†™åº“æ—¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ç”¨æˆ·åœ¨é“¾æ¥æ—¶è¦†ç›–åº“ä¸­çš„å‡½æ•°ã€‚ å¦‚ä¸‹ä¸ºä¸€ä¸ªä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233/** * probe_kernel_read(): safely attempt to read from a location * @dst: pointer to the buffer that shall take the data * @src: address to read from * @size: size of the data chunk * * Safely read from address @src to the buffer at @dst. If a kernel fault * happens, handle that and return -EFAULT. * * We ensure that the copy_from_user is executed in atomic context so that * do_page_fault() doesn&#x27;t attempt to take mmap_sem. This makes * probe_kernel_read() suitable for use within regions where the caller * already holds mmap_sem, or other locks which nest inside mmap_sem. */long __weak probe_kernel_read(void *dst, const void *src, size_t size) __attribute__((alias(&quot;__probe_kernel_read&quot;)));long __probe_kernel_read(void *dst, const void *src, size_t size)&#123; long ret; mm_segment_t old_fs = get_fs(); set_fs(KERNEL_DS); pagefault_disable(); ret = __copy_from_user_inatomic(dst, (__force const void __user *)src, size); pagefault_enable(); set_fs(old_fs); return ret ? -EFAULT : 0;&#125;EXPORT_SYMBOL_GPL(probe_kernel_read); (3)å†…æ ¸é©±åŠ¨è·å–ç¬¦å·åœ°å€ç¬¦å·å­˜åœ¨äº&#x2F;proc&#x2F;kallsyms æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡kallsyms_lookup_nameè·å–å…¶ç¬¦å·çš„åœ°å€ã€‚åœ¨å†…æ ¸ç‰ˆæœ¬ 2.6.33 - 5.7.0 å¯ä»¥ç”¨kallsyms_lookup_nameæ¥è·å–è¯¥å‡½æ•°çš„åœ°å€ã€‚åœ¨å†…æ ¸2.6.33 ä»¥ä¸‹å’Œ 5.7.0 ä»¥ä¸Šå¯ä»¥ç”¨ kprobe æ¥è·å–è¯¥å‡½æ•°çš„åœ°å€ kallsyms_lookup_nameæ˜¯å†…æ ¸APIï¼Œæºç å¦‚ä¸‹ï¼š ä½¿ç”¨kallsyms_lookup_nameå‡½æ•°éœ€è¦#include &lt;linux/kallsyms.h&gt; 12345678910111213141516/* Lookup the address for this symbol. Returns 0 if not found. */unsigned long kallsyms_lookup_name(const char *name)&#123; char namebuf[KSYM_NAME_LEN]; unsigned long i; unsigned int off; for (i = 0, off = 0; i &lt; kallsyms_num_syms; i++) &#123; off = kallsyms_expand_symbol(off, namebuf, ARRAY_SIZE(namebuf)); if (strcmp(namebuf, name) == 0) return kallsyms_sym_address(i); &#125; return module_kallsyms_lookup_name(name);&#125;EXPORT_SYMBOL_GPL(kallsyms_lookup_name); ä¸Šè¿°å‡½æ•°å¯ä»¥ä½¿ç”¨ç¬¦å·åæ‰¾åˆ°åœ¨å†…æ ¸ä¸­çš„åœ°å€ï¼Œä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥ä½¿ç”¨å†…æ ¸ä¸­æœªå¯¼å‡ºçš„å†…æ ¸å‡½æ•°ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * text_poke - Update instructions on a live kernel * @addr: address to modify * @opcode: source of the copy * @len: length to copy * * Only atomic text poke/set should be allowed when not doing early patching. * It means the size must be writable atomically and the address must be aligned * in a way that permits an atomic write. It also makes sure we fit on a single * page. */void *text_poke(void *addr, const void *opcode, size_t len)&#123; unsigned long flags; char *vaddr; struct page *pages[2]; int i; /* * While boot memory allocator is runnig we cannot use struct * pages as they are not yet initialized. */ BUG_ON(!after_bootmem); lockdep_assert_held(&amp;text_mutex); if (!core_kernel_text((unsigned long)addr)) &#123; pages[0] = vmalloc_to_page(addr); pages[1] = vmalloc_to_page(addr + PAGE_SIZE); &#125; else &#123; pages[0] = virt_to_page(addr); WARN_ON(!PageReserved(pages[0])); pages[1] = virt_to_page(addr + PAGE_SIZE); &#125; BUG_ON(!pages[0]); local_irq_save(flags); set_fixmap(FIX_TEXT_POKE0, page_to_phys(pages[0])); if (pages[1]) set_fixmap(FIX_TEXT_POKE1, page_to_phys(pages[1])); vaddr = (char *)fix_to_virt(FIX_TEXT_POKE0); memcpy(&amp;vaddr[(unsigned long)addr &amp; ~PAGE_MASK], opcode, len); clear_fixmap(FIX_TEXT_POKE0); if (pages[1]) clear_fixmap(FIX_TEXT_POKE1); local_flush_tlb(); sync_core(); /* Could also do a CLFLUSH here to speed up CPU recovery; but that causes hangs on some VIA CPUs. */ for (i = 0; i &lt; len; i++) BUG_ON(((char *)addr)[i] != ((char *)opcode)[i]); local_irq_restore(flags); return addr;&#125; text_pokeä¸ºéå¯¼å‡ºå‡½æ•°ï¼Œåœ¨é©±åŠ¨ä¸­æ— æ³•ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨kallsyms_lookup_nameè·å–å‡½æ•°åœ°å€å¹¶èµ‹å€¼ç»™å‡½æ•°æŒ‡é’ˆï¼Œä¾¿å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°ã€‚ 12void *(*text_poke_fn)(void *addr, const void *opcode, size_t len);text_poke_fn = (void *(*)(void *, const void *, size_t))kallsyms_lookup_nama(&quot;text_poke&quot;);","tags":["Linux"],"categories":["Linux"]},{"title":"OOM","path":"/posts/OOM.html","content":"åœ¨Linuxæ“ä½œç³»ç»Ÿä¸­ï¼ŒOOMï¼ˆOut of Memoryï¼‰æŒ‡çš„æ˜¯ç³»ç»Ÿå¯ç”¨å†…å­˜è€—å°½ï¼Œæ— æ³•å†ä¸ºä»»ä½•è¿›ç¨‹åˆ†é…æ‰€éœ€çš„å†…å­˜ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿå¿…é¡»é‡‡å–æŸäº›æç«¯æªæ–½çš„æƒ…å†µã€‚å½“ç³»ç»Ÿé¢ä¸´OOMæ—¶ï¼Œå¯èƒ½ä¼šé€‰æ‹©æ€æ­»æŸäº›è¿›ç¨‹ä»¥é‡Šæ”¾å†…å­˜ï¼Œè¿™æ˜¯é€šè¿‡Linuxå†…æ ¸çš„OOM Killeræœºåˆ¶å®ç°çš„ã€‚ OOMå‘ç”Ÿçš„åŸå› ï¼š ç‰©ç†å†…å­˜ä¸è¶³ï¼šå®é™…ç‰©ç†å†…å­˜èµ„æºè€—å°½ï¼Œæ— æ³•æ»¡è¶³æ‰€æœ‰è¿›ç¨‹çš„å†…å­˜éœ€æ±‚ï¼Œå°¤å…¶æ˜¯å½“å¤§é‡è¿›ç¨‹åŒæ—¶è¿è¡Œä¸”å†…å­˜å ç”¨è¾ƒå¤§æ—¶æ›´å®¹æ˜“å‡ºç°ã€‚ äº¤æ¢ç©ºé—´ä¸è¶³ï¼šå³ä½¿æœ‰äº¤æ¢åˆ†åŒºï¼ˆSwapï¼‰ï¼Œä½†å½“ç³»ç»Ÿè¯•å›¾å°†ç‰©ç†å†…å­˜ä¸­çš„é¡µæ¢å‡ºåˆ°äº¤æ¢ç©ºé—´æ—¶ï¼Œå‘ç°äº¤æ¢ç©ºé—´ä¹Ÿå·²æ»¡ï¼Œæ— æ³•ç»§ç»­è¿›è¡Œå†…å­˜äº¤æ¢ã€‚ å†…å­˜æ³„æ¼ï¼šåº”ç”¨ç¨‹åºå­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜ï¼Œéšç€æ—¶é—´æ¨ç§»ä¸æ–­æ¶ˆè€—å†…å­˜ï¼Œç›´è‡³è€—å°½æ•´ä¸ªç³»ç»Ÿèµ„æºã€‚ ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®ï¼šæŸä¸ªè¿›ç¨‹ç¬é—´è¯·æ±‚å¤§é‡å†…å­˜ï¼Œè¶…å‡ºäº†ç³»ç»Ÿæ‰€èƒ½æä¾›çš„èŒƒå›´ã€‚ å†…å­˜é™åˆ¶ï¼šåœ¨å®¹å™¨ç¯å¢ƒä¸‹ï¼Œå•ä¸ªå®¹å™¨å¯èƒ½å­˜åœ¨ä¸¥æ ¼çš„å†…å­˜é™åˆ¶ï¼Œè¶…å‡ºé™åˆ¶åä¹Ÿä¼šè§¦å‘OOMã€‚","tags":["Linux"],"categories":["Linux"]},{"title":"ftpget","path":"/posts/ftpget.html","content":"ftpget -u username -p passwd IP source target ftpput -u username -p passwd IP target source ä¸¾ä¸ªä¾‹å­ï¼š 12ftpput -u zhangsan -p 000000 192.168.10.10 target.txt source.txt // å°†æœ¬åœ°çš„ source.txt æ–‡ä»¶ä¼ è¾“åˆ° 192.168.10.10 /home/zhangsan/ ç›®å½•ä¸‹ï¼Œå¹¶ä»¥target.txt ä¿å­˜","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"scp","path":"/posts/scp.html","content":"ä¸€ã€ä»æœ¬åœ°å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š scp &#x2F;path&#x2F;to&#x2F;local&#x2F;file.txt user@remote_host:&#x2F;path&#x2F;on&#x2F;remote&#x2F; è¿™ä¼šå°†æœ¬åœ°çš„ file.txt æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœº remote_host çš„ /path/on/remote/ ç›®å½•ä¸‹ã€‚ äºŒã€ä»è¿œç¨‹ä¸»æœºå¤åˆ¶åˆ°æœ¬åœ°ï¼ˆ1ï¼‰å‘½ä»¤è§£é‡Šå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼šscp user@remote_host:&#x2F;path&#x2F;on&#x2F;remote&#x2F;file.txt &#x2F;path&#x2F;to&#x2F;local&#x2F; è¿™ä¼šå°†è¿œç¨‹ä¸»æœº remote_host çš„ /path/on/remote/file.txt æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°çš„ /path/to/local/ ç›®å½•ä¸‹ã€‚ ï¼ˆ2ï¼‰å®é™…æ“ä½œå®æ“å‘½ä»¤å¦‚ä¸‹ï¼šscp &#114;&#x6f;&#111;&#116;&#x40;&#49;&#57;&#x32;&#x2e;&#x31;&#x36;&#x38;&#46;&#49;&#x2e;&#49;&#48;&#x39;:&#x2F;home&#x2F;DataBaseMysql.zip .&#x2F; è¿™ä¼šå°†è¿œç¨‹ä¸»æœº 192.168.1.109 çš„&#x2F;home&#x2F;DataBaseMysql.zip æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°çš„å½“å‰ç›®å½•ä¸‹ ä¸‰ã€é€’å½’å¤åˆ¶ç›®å½•å®æ“å‘½ä»¤å¦‚ä¸‹ï¼šscp -r user@remote_host:&#x2F;path&#x2F;on&#x2F;remote&#x2F;directory &#x2F;path&#x2F;to&#x2F;local&#x2F; è¿™ä¼šå°†è¿œç¨‹ä¸»æœº remote_host çš„ /path/on/remote/directory ç›®å½•åŠå…¶æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°æœ¬åœ°çš„ /path/to/local/ ç›®å½•ä¸‹ã€‚ å››ã€æŒ‡å®š SSH ç«¯å£å¦‚æœè¿œç¨‹ä¸»æœºçš„ SSH ç«¯å£ä¸æ˜¯é»˜è®¤çš„ 22ï¼Œå¯ä»¥ä½¿ç”¨ -P é€‰é¡¹æŒ‡å®šç«¯å£ï¼š scp -P 2222 user@remote_host:&#x2F;path&#x2F;on&#x2F;remote&#x2F;file.txt &#x2F;path&#x2F;to&#x2F;local&#x2F;","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"find","path":"/posts/find.html","content":"find . -name â€œmy_fileâ€ find . -name &#x2F;etc -type d","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"grep","path":"/posts/grep.html","content":"æ–‡æœ¬æœç´¢å·¥å…·ï¼Œæ ¹æ®ç”¨æˆ·æŒ‡å®šçš„â€œæ¨¡å¼â€ï¼ˆè¿‡æ»¤æ¡ä»¶ï¼‰ï¼Œå¯¹ç›®æ ‡æ–‡æœ¬é€è¡Œè¿›è¡ŒåŒ¹é…ï¼Œå¹¶æ‰“å°è¾“å‡ºåŒ¹é…åˆ°çš„è¡Œã€‚ å®Œæ•´è¯­æ³•ï¼š 123grep [options] [pattern] file å‘½ä»¤ å‚æ•° åŒ¹é…æ¨¡å¼ æ–‡ä»¶æ•°æ® å¸¸ç”¨å‚æ•°ï¼š å¸¸ç”¨å‚æ•° æè¿° -i å¿½ç•¥å¤§å°å†™ -n æ˜¾ç¤ºåŒ¹é…è¡Œä¸è¡Œå· -r é€’å½’æŸ¥æ‰¾å­ç›®å½• -v æ˜¾ç¤ºä¸èƒ½è¢«åŒ¹é…åˆ°çš„å­—ç¬¦ä¸² å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼ è¡¨è¾¾å¼\tè§£é‡Š ^\tç”¨äºæ¨¡å¼æœ€å·¦ä¾§ï¼Œå¦‚ â€œ^yuâ€ å³åŒ¹é…ä»¥yuå¼€å¤´çš„å•è¯ $\tç”¨äºæ¨¡å¼æœ€å³ä¾§ï¼Œå¦‚ â€œyu$â€ å³åŒ¹é…ä»¥yuç»“å°¾çš„å•è¯ ^$\tç»„åˆç¬¦ï¼Œè¡¨ç¤ºç©ºè¡Œ .\tåŒ¹é…ä»»æ„ä¸€ä¸ªä¸”åªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œä¸èƒ½åŒ¹é…ç©ºè¡Œ |\tä½¿ç”¨egrepå‘½ä»¤ é‡åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦è¿ç»­å‡ºç°0æ¬¡æˆ–1æ¬¡ä»¥ä¸Š .*\tåŒ¹é…ä»»æ„å­—ç¬¦ ^.*\tç»„åˆç¬¦ï¼ŒåŒ¹é…ä»»æ„å¤šä¸ªå­—ç¬¦å¼€å¤´çš„å†…å®¹ .*$\tç»„åˆç¬¦ï¼ŒåŒ¹é…ä»»æ„å¤šä¸ªå­—ç¬¦ç»“å°¾çš„å†…å®¹ [abc]\tåŒ¹é… [] å†…é›†åˆä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œaæˆ–bæˆ–cï¼Œä¹Ÿå¯ä»¥å†™æˆ [ac] [^abc]\tåŒ¹é…é™¤äº† ^åé¢çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œaæˆ–bæˆ–cï¼Œ[]å†… ^ è¡¨ç¤ºå–åæ“ä½œ å¸¸ç”¨ï¼š 1grep -nr &quot;xxx&quot; .","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"å†…å­˜æ£€æµ‹å·¥å…·","path":"/posts/å†…å­˜æ£€æµ‹å·¥å…·.html","content":"åœ¨å†™å¤§å‹C&#x2F;C++å·¥ç¨‹æ—¶éš¾å…ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ç°è±¡ï¼Œç³»ç»Ÿç¼–ç¨‹ä¸­ä¸€ä¸ªé‡è¦çš„æ–¹é¢å°±æ˜¯æœ‰æ•ˆåœ°å¤„ç†ä¸å†…å­˜ç›¸å…³çš„é—®é¢˜ã€‚ä½ çš„å·¥ä½œè¶Šæ¥è¿‘ç³»ç»Ÿï¼Œä½ å°±éœ€è¦é¢å¯¹è¶Šå¤šçš„å†…å­˜é—®é¢˜ã€‚æœ‰æ—¶è¿™äº›é—®é¢˜éå¸¸çç¢ï¼Œè€Œæ›´å¤šæ—¶å€™å®ƒä¼šæ¼”å˜æˆä¸€ä¸ªè°ƒè¯•å†…å­˜é—®é¢˜çš„æ¶æ¢¦ã€‚ å¸¸è§çš„å†…å­˜é—®é¢˜ä¸€å…±ä¸ƒç§ï¼š åŠ¨æ€å†…å­˜æ³„éœ²ï¼› èµ„æºæ³„éœ²ï¼Œæ¯”å¦‚æ–‡ä»¶æŒ‡é’ˆä¸å…³é—­ï¼› åŠ¨æ€å†…å­˜è¶Šç•Œï¼› 4.æ•°ç»„å†…å­˜è¶Šç•Œï¼› 5.åŠ¨æ€å†…å­˜double freeï¼› 6.ä½¿ç”¨é‡æŒ‡é’ˆï¼Œå³æœªåˆå§‹åŒ–çš„æŒ‡é’ˆï¼› 7.é‡Šæ”¾é‡æŒ‡é’ˆï¼Œå³æœªåˆå§‹åŒ–çš„æŒ‡é’ˆã€‚ å†…å­˜é—®é¢˜éå¸¸éš¾å®šä½ï¼Œå¯¹äºå°å·¥ç¨‹æ¥è¯´ï¼Œç®€å•å»æ£€æŸ¥ä»£ç ä¸­newå’Œdeleteçš„åŒ¹é…å¯¹æ•°å°±åŸºæœ¬èƒ½å®šä½åˆ°é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦ä»£ç é‡ä¸Šå‡åˆ°ä»¥ä¸‡å•ä½æ—¶ï¼Œä»…é è‚‰çœ¼æ£€æŸ¥æ¥å®šä½é—®é¢˜é‚£å°±éå¸¸å›°éš¾äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ©ç”¨å·¥å…·å¸®åŠ©æˆ‘ä»¬æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ã€‚åœ¨Linuxç³»ç»Ÿä¸‹å†…å­˜æ£€æµ‹å·¥å…·é¦–æ¨Valgrindï¼Œä¸€æ¬¾éå¸¸å¥½ç”¨çš„å¼€æºå†…å­˜ç®¡ç†æ¡†æ¶ã€‚Valgrindå…¶å®æ˜¯ä¸€ä¸ªå·¥å…·é›†ï¼Œå†…å­˜é”™è¯¯æ£€æµ‹åªæ˜¯å®ƒä¼—å¤šåŠŸèƒ½çš„ä¸€ä¸ªï¼Œä½†æˆ‘ä»¬ç”¨å¾—æœ€å¤šçš„åŠŸèƒ½æ­£æ˜¯å®ƒâ€”â€”memcheckã€‚ è¯¥å·¥å…·å¯ä»¥æ£€æµ‹ä¸‹åˆ—ä¸å†…å­˜ç›¸å…³çš„é—®é¢˜ : æœªé‡Šæ”¾å†…å­˜çš„ä½¿ç”¨ å¯¹é‡Šæ”¾åå†…å­˜çš„è¯»&#x2F;å†™ å¯¹å·²åˆ†é…å†…å­˜å—å°¾éƒ¨çš„è¯»&#x2F;å†™ å†…å­˜æ³„éœ² ä¸åŒ¹é…çš„ä½¿ç”¨malloc&#x2F;new&#x2F;new[] å’Œ free&#x2F;delete&#x2F;delete[] é‡å¤é‡Šæ”¾å†…å­˜ é¦–å…ˆå®‰è£…Valgrindéå¸¸ç®€å•ï¼š 123456789//valgrindä¸‹è½½ï¼šhttp://valgrind.org/downloads/valgrind-3.12.0.tar.bz2valgrindå®‰è£…ï¼š1. tar -jxvf valgrind-3.12.0.tar.bz22. cd valgrind-3.12.03. ./configure4. make5. sudo make install ä¸‹é¢å¼€å§‹è®²è§£Valgrindçš„åº”ç”¨åœºæ™¯ã€‚ æ³¨æ„: ä¸‹é¢è®¨è®ºçš„æ‰€æœ‰æµ‹è¯•ä»£ç éƒ½åº”è¯¥ä½¿ç”¨gcc&#x2F;g++å¹¶ä¸”åŠ ä¸Š-gé€‰é¡¹ã€‚ 1. ä½¿ç”¨æœªåˆå§‹åŒ–çš„å†…å­˜ï¼ˆä½¿ç”¨é‡æŒ‡é’ˆï¼‰è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆpï¼Œä½†å¹¶æœªç»™ä»–å¼€è¾Ÿç©ºé—´ï¼Œå³ä»–æ˜¯ä¸€ä¸ªé‡æŒ‡é’ˆï¼Œä½†æˆ‘ä»¬å´ä½¿ç”¨å®ƒäº†ã€‚ Valgrindæ£€æµ‹å‡ºæˆ‘ä»¬ç¨‹åºä½¿ç”¨äº†æœªåˆå§‹åŒ–çš„å˜é‡ï¼Œä½†å¹¶æœªæ£€æµ‹å‡ºå†…å­˜æ³„æ¼ã€‚ 2.åœ¨å†…å­˜è¢«é‡Šæ”¾åè¿›è¡Œè¯»&#x2F;å†™ï¼ˆä½¿ç”¨é‡æŒ‡é’ˆï¼‰pæ‰€æŒ‡å‘çš„å†…å­˜è¢«é‡Šæ”¾äº†ï¼Œpå˜æˆäº†é‡æŒ‡é’ˆï¼Œä½†æ˜¯æˆ‘ä»¬å´ç»§ç»­ä½¿ç”¨è¿™ç‰‡å†…å­˜ã€‚ Valgrindæ£€æµ‹å‡ºæˆ‘ä»¬ä½¿ç”¨äº†å·²ç»freeæ‰çš„å†…å­˜ï¼Œå¹¶ç»™å‡ºè¿™ç‰‡å†…å­˜æ˜¯å“ªé‡Œåˆ†é…å“ªé‡Œé‡Šæ”¾çš„ã€‚ 3.ä»å·²åˆ†é…å†…å­˜å—çš„å°¾éƒ¨è¿›è¡Œè¯»&#x2F;å†™ï¼ˆåŠ¨æ€å†…å­˜è¶Šç•Œï¼‰æˆ‘ä»¬åŠ¨æ€åœ°åˆ†é…äº†ä¸€æ®µæ•°ç»„ï¼Œä½†æˆ‘ä»¬åœ¨è®¿é—®ä¸ªæ•°ç»„æ—¶å‘ç”Ÿäº†è¶Šç•Œè¯»å†™ï¼Œç¨‹åºcrashæ‰ã€‚ Valgrindæ£€æµ‹å‡ºè¶Šç•Œçš„ä½ç½®ã€‚ æ³¨æ„ï¼šValgrindä¸æ£€æŸ¥é™æ€åˆ†é…æ•°ç»„çš„ä½¿ç”¨æƒ…å†µï¼æ‰€ä»¥å¯¹é™æ€åˆ†é…çš„æ•°ç»„ï¼ŒValgrindè¡¨ç¤ºæ— èƒ½ä¸ºåŠ›ï¼æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œç¨‹åºcrashæ‰ï¼Œæˆ‘ä»¬å´ä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ 4.å†…å­˜æ³„æ¼å†…å­˜æ³„æ¼çš„åŸå› åœ¨äºæ²¡æœ‰æˆå¯¹åœ°ä½¿ç”¨malloc&#x2F;freeå’Œnew&#x2F;deleteï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚ Valgrindä¼šç»™å‡ºç¨‹åºä¸­mallocå’Œfreeçš„å‡ºç°æ¬¡æ•°ä»¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œæ¯”å¦‚å¯¹ä¸Šé¢çš„ç¨‹åºè¿è¡Œmemcheckï¼ŒValgrindçš„è®°å½•æ˜¾ç¤ºä¸Šé¢çš„ç¨‹åºç”¨äº†1æ¬¡mallocï¼Œå´è°ƒç”¨äº†0æ¬¡freeï¼Œæ˜æ˜¾å‘ç”Ÿäº†å†…å­˜æ³„æ¼ï¼ ä¸Šé¢æç¤ºäº†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€“leak-check&#x3D;fullè¿›ä¸€æ­¥è·å–å†…å­˜æ³„æ¼çš„ä¿¡æ¯ï¼Œæ¯”å¦‚mallocå’Œfreeçš„å…·ä½“è¡Œå·ã€‚ 5. ä¸åŒ¹é…åœ°ä½¿ç”¨malloc&#x2F;new&#x2F;new[] å’Œ free&#x2F;delete&#x2F;delete[]æ­£å¸¸ä½¿ç”¨new&#x2F;deleteå’Œmalloc&#x2F;freeæ˜¯è¿™æ ·å­çš„ï¼š è€Œä¸åŒ¹é…åœ°ä½¿ç”¨malloc&#x2F;new&#x2F;new[] å’Œ free&#x2F;delete&#x2F;delete[]åˆ™ä¼šè¢«æç¤ºmismacthï¼š 6.ä¸¤æ¬¡é‡Šæ”¾å†…å­˜double freeçš„æƒ…å†µåŒæ ·æ˜¯æ ¹æ®malloc&#x2F;freeçš„åŒ¹é…å¯¹æ•°æ¥ä½“ç°çš„ï¼Œæ¯”å¦‚freeå¤šäº†ä¸€æ¬¡ï¼ŒValgrindä¹Ÿä¼šæç¤ºã€‚ å½“ç„¶ï¼ŒValgrindä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ã€‚Valgrindä¹Ÿæœ‰æ— æ³•æ‰¾åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œæœ‰äº›é—®é¢˜åªèƒ½é€šè¿‡ä¸æ–­çš„reviewä»£ç æ‰¾åˆ°äº†ç—‡ç»“ã€‚å‘ç°é—®é¢˜ï¼Œè§£å†³é—®é¢˜ï¼Œæ¯•ç«Ÿæ˜¯æœ«æµã€‚æœ€å¥½çš„æ–¹æ³•ï¼Œå°±æ˜¯ä¸å¼•å…¥å†…å­˜é—®é¢˜ã€‚è¿™å¯ä»¥é€šè¿‡è‰¯å¥½çš„ä»£ç é£æ ¼å’Œè®¾è®¡æ¥å®ç°çš„ã€‚","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"top","path":"/posts/top.html","content":"1ps -ef | grep xxx //xxxä¸ºè¿›ç¨‹åå­— é€šè¿‡psæ‰¾åˆ°è¿›ç¨‹å·ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¥è¿›ç¨‹ä¸‹çš„æ‰€æœ‰çº¿ç¨‹CPUåˆ©ç”¨ç‡ï¼Œæ³¨æ„è¿™é‡Œæ˜¯è¯¥è¿›ç¨‹PIDä¸‹å¯¹åº”çš„æ‰€æœ‰çº¿ç¨‹ 1top -H -p pid ä¾‹å¦‚è¿›ç¨‹pidä¸º5810ï¼Œåˆ™å‘½ä»¤ä¸ºï¼š 1top -H -p 5810 ä¸€ã€topå‘½ä»¤çš„ä½¿ç”¨å¸®åŠ©1ã€topå‘½ä»¤çš„é€‰é¡¹topå‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ï¼štop [-d number] | top [-bnp] é€‰é¡¹ è§£æ -b ä»¥æ‰¹å¤„ç†æ¨¡å¼æ“ä½œï¼› -c æ˜¾ç¤ºå®Œæ•´çš„æ²»å‘½ä»¤ï¼› -d å±å¹•åˆ·æ–°é—´éš”æ—¶é—´ï¼› -I å¿½ç•¥å¤±æ•ˆè¿‡ç¨‹ï¼› -s ä¿å¯†æ¨¡å¼ï¼› -S ç´¯ç§¯æ¨¡å¼ï¼› -i&lt;æ—¶é—´&gt; è®¾ç½®é—´éš”æ—¶é—´ï¼› -u&lt;ç”¨æˆ·å&gt; æŒ‡å®šç”¨æˆ·åï¼› -p&lt;è¿›ç¨‹å·&gt; æŒ‡å®šè¿›ç¨‹ï¼› -n&lt;æ¬¡æ•°&gt; å¾ªç¯æ˜¾ç¤ºçš„æ¬¡æ•°ã€‚ äºŒã€topå‘½ä»¤çš„äº¤æ¢å‘½ä»¤åœ¨topå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨çš„ä¸€äº›äº¤äº’å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤éƒ½æ˜¯å•å­—æ¯çš„ï¼Œå¦‚æœåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨äº†-sé€‰é¡¹ï¼Œ å…¶ä¸­ä¸€äº›å‘½ä»¤å¯èƒ½ä¼šè¢«å±è”½ã€‚ ä¹Ÿå°±æ˜¯åœ¨topå‘½ä»¤è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æŒ‰ä¸‹å¦‚ä¸‹æ¡ˆä»¶ï¼Œä¼šæŒ‰ç…§ç›¸åº”æŒ‡ä»¤æ˜¾ç¤º 1234567891011121314151617hï¼šæ˜¾ç¤ºå¸®åŠ©ç”»é¢ï¼Œç»™å‡ºä¸€äº›ç®€çŸ­çš„å‘½ä»¤æ€»ç»“è¯´æ˜ï¼›kï¼šç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ï¼›iï¼šå¿½ç•¥é—²ç½®å’Œåƒµæ­»è¿›ç¨‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€å…³å¼å‘½ä»¤ï¼›qï¼šé€€å‡ºç¨‹åºï¼›rï¼šé‡æ–°å®‰æ’ä¸€ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§åˆ«ï¼›Sï¼šåˆ‡æ¢åˆ°ç´¯è®¡æ¨¡å¼ï¼›sï¼šæ”¹å˜ä¸¤æ¬¡åˆ·æ–°ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼ˆå•ä½ä¸ºsï¼‰ï¼Œå¦‚æœæœ‰å°æ•°ï¼Œå°±æ¢ç®—æˆmsã€‚è¾“å…¥0å€¼åˆ™ç³»ç»Ÿå°†ä¸æ–­åˆ·æ–°ï¼Œé»˜è®¤å€¼æ˜¯5sï¼›fæˆ–è€…Fï¼šä»å½“å‰æ˜¾ç¤ºä¸­æ·»åŠ æˆ–è€…åˆ é™¤é¡¹ç›®ï¼›oæˆ–è€…Oï¼šæ”¹å˜æ˜¾ç¤ºé¡¹ç›®çš„é¡ºåºï¼›lï¼šåˆ‡æ¢æ˜¾ç¤ºå¹³å‡è´Ÿè½½å’Œå¯åŠ¨æ—¶é—´ä¿¡æ¯ï¼›mï¼šåˆ‡æ¢æ˜¾ç¤ºå†…å­˜ä¿¡æ¯ï¼›tï¼šåˆ‡æ¢æ˜¾ç¤ºè¿›ç¨‹å’ŒCPUçŠ¶æ€ä¿¡æ¯ï¼›cï¼šåˆ‡æ¢æ˜¾ç¤ºå‘½ä»¤åç§°å’Œå®Œæ•´å‘½ä»¤è¡Œï¼›Mï¼šä»¥å†…å­˜çš„ä½¿ç”¨èµ„æºæ’åºæ˜¾ç¤ºï¼›Pï¼šæ ¹æ®CPUä½¿ç”¨ç™¾åˆ†æ¯”å¤§å°è¿›è¡Œæ’åºï¼›Tï¼šæ ¹æ®æ—¶é—´/ç´¯è®¡æ—¶é—´è¿›è¡Œæ’åºï¼›wï¼šå°†å½“å‰è®¾ç½®å†™å…¥~/.toprcæ–‡ä»¶ä¸­ã€‚ ä¸‰ã€topæ˜¾ç¤ºä¿¡æ¯è§£é‡Š1ã€topçš„ç¬¬ä¸€è¡Œè§£é‡Šåœ¨å‘½ä»¤è¡Œè¾“å…¥topï¼Œè¿›å…¥ç³»ç»Ÿç›‘æ§ä¿¡æ¯çš„äº¤äº’ç•Œé¢ï¼Œç¬¬ä¸€è¡Œè§£é‡Šå¦‚ä¸‹ï¼š 123410:40:53 è¡¨ç¤ºå½“å‰æ—¶é—´up 7:09 ç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼Œæ ¼å¼ä¸ºæ—¶ï¼šåˆ†ã€‚3 users å½“å‰ç™»å½•ç”¨æˆ·æ•°load average: 0.05, 0.03, 0.05 ç³»ç»Ÿè´Ÿè½½ï¼Œå³ä»»åŠ¡é˜Ÿåˆ—çš„å¹³å‡é•¿åº¦ã€‚ ä¸‰ä¸ªæ•°å€¼åˆ†åˆ«ä¸º 1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿå‰åˆ°ç°åœ¨çš„å¹³å‡å€¼ã€‚ 2ã€topçš„ç¬¬äºŒã€ä¸‰è¡Œä¿¡æ¯è§£é‡Šåœ¨å‘½ä»¤è¡Œè¾“å…¥topï¼Œè¿›å…¥ç³»ç»Ÿç›‘æ§ä¿¡æ¯çš„äº¤äº’ç•Œé¢ï¼Œç¬¬2ã€3è¡Œä¸ºè¿›ç¨‹å’ŒCPUçš„ä¿¡æ¯ï¼Œå½“æœ‰å¤šä¸ªCPUæ—¶ï¼Œè¿™äº›å†…å®¹å¯èƒ½ä¼šè¶…è¿‡ä¸¤è¡Œï¼Œ ç¬¬äºŒè¡Œè§£é‡Šå¦‚ä¸‹ï¼š 12345678910111213216 total è¿›ç¨‹æ€»æ•°1 running æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°215 sleeping ç¡çœ çš„è¿›ç¨‹æ•°0 stopped åœæ­¢çš„è¿›ç¨‹æ•°0 zombie åƒµå°¸è¿›ç¨‹æ•°0.0 us ç”¨æˆ·ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”0.1 sy å†…æ ¸ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”0.0 ni ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨CPUç™¾åˆ†æ¯”99.9 id ç©ºé—²CPUç™¾åˆ†æ¯”0.0 wa ç­‰å¾…è¾“å…¥è¾“å‡ºçš„CPUæ—¶é—´ç™¾åˆ†æ¯”0.0 hi ç¡¬ä¸­æ–­ï¼ˆHardware IRQï¼‰å ç”¨CPUçš„ç™¾åˆ†æ¯”0.0 si è½¯ä¸­æ–­ï¼ˆSoftware Interruptsï¼‰å ç”¨CPUçš„ç™¾åˆ†æ¯”0.0 st è™šæ‹ŸCPUç­‰å¾…å®é™…CPUçš„æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚ 3ã€topçš„ç¬¬å››ã€äº”è¡Œä¿¡æ¯è§£é‡Šç¬¬å››è¡ŒåŠç¬¬äº”è¡Œä¸»è¦æ˜¾ç¤ºç³»ç»Ÿçš„å†…å­˜ä¿¡æ¯ã€‚ 123456789KiB Mem: 12119056 tota ç‰©ç†å†…å­˜æ€»é‡10016948 free ç©ºé—²å†…å­˜æ€»é‡923252 used ä½¿ç”¨çš„ç‰©ç†å†…å­˜æ€»é‡1178856 buff/cache ç”¨ä½œå†…æ ¸ç¼“å­˜çš„å†…å­˜é‡KiB Swap: 2093052 total äº¤æ¢åŒºæ€»é‡267544 used ä½¿ç”¨çš„äº¤æ¢åŒºæ€»é‡2093052 free ç©ºé—²äº¤æ¢åŒºæ€»é‡0 used ç¼“å†²çš„äº¤æ¢åŒºæ€»é‡ã€‚10742188 avail Mem ä»£è¡¨å¯ç”¨äºè¿›ç¨‹ä¸‹ä¸€æ¬¡åˆ†é…çš„ç‰©ç†å†…å­˜æ•°é‡ 4ã€topçš„è¿›ç¨‹ä¿¡æ¯topå‘½ä»¤çš„äº¤æ¢ç•Œé¢ä¸»è¦åŒºåŸŸï¼Œç›‘æ§ç³»ç»Ÿè¿›ç¨‹çš„å®æ—¶çŠ¶æ€ä¿¡æ¯ã€‚ 123456789101112PID è¿›ç¨‹idUSER è¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·åPR ä¼˜å…ˆçº§NI niceå€¼ï¼Œè´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½ä¼˜å…ˆçº§ã€‚VIRT è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT=SWAP+RESRES è¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES=CODE+DATASHR å…±äº«å†…å­˜å¤§å°ï¼Œå•ä½kbS è¿›ç¨‹çŠ¶æ€ã€‚D=ä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ R=è¿è¡Œ S=ç¡çœ  T=è·Ÿè¸ª/åœæ­¢ Z=åƒµå°¸è¿›ç¨‹%CPU ä¸Šæ¬¡æ›´æ–°åˆ°ç°åœ¨çš„CPUæ—¶é—´å ç”¨ç™¾åˆ†æ¯”%MEM è¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”TIME+ è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½1/100ç§’COMMAND å‘½ä»¤å/å‘½ä»¤è¡Œ å…¶ä½™ç›‘æ§é¡¹è§£é‡Š 1234567891011121314PPID çˆ¶è¿›ç¨‹idRUSER Real user nameUID è¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·idGROUP è¿›ç¨‹æ‰€æœ‰è€…çš„ç»„åTTY å¯åŠ¨è¿›ç¨‹çš„ç»ˆç«¯åã€‚ä¸æ˜¯ä»ç»ˆç«¯å¯åŠ¨çš„è¿›ç¨‹åˆ™æ˜¾ç¤ºä¸º ?P æœ€åä½¿ç”¨çš„CPUï¼Œä»…åœ¨å¤šCPUç¯å¢ƒä¸‹æœ‰æ„ä¹‰TIME è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½ç§’SWAP è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œè¢«æ¢å‡ºçš„å¤§å°ï¼Œå•ä½kbCODE å¯æ‰§è¡Œä»£ç å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbDATA å¯æ‰§è¡Œä»£ç ä»¥å¤–çš„éƒ¨åˆ†(æ•°æ®æ®µ+æ ˆ)å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbnFLT é¡µé¢é”™è¯¯æ¬¡æ•°nDRT æœ€åä¸€æ¬¡å†™å…¥åˆ°ç°åœ¨ï¼Œè¢«ä¿®æ”¹è¿‡çš„é¡µé¢æ•°ã€‚WCHAN è‹¥è¯¥è¿›ç¨‹åœ¨ç¡çœ ï¼Œåˆ™æ˜¾ç¤ºç¡çœ ä¸­çš„ç³»ç»Ÿå‡½æ•°åFlags ä»»åŠ¡æ ‡å¿— å››ã€topå‘½ä»¤çš„åŸºæœ¬ä½¿ç”¨1ã€æŸ¥çœ‹å½“å‰ç³»ç»Ÿcpuå ç”¨æœ€é«˜çš„è¿›ç¨‹ è¿›å…¥topäº¤äº’ç•Œé¢åï¼ŒæŒ‰Pé”®å¯¹CPUè´Ÿè½½çš„è¿›ç¨‹è¿›è¡Œæ’åˆ—ã€‚ 2ã€æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…å­˜ä½¿ç”¨æœ€é«˜çš„è¿›ç¨‹ è¿›å…¥topäº¤äº’ç•Œé¢åï¼ŒæŒ‰Mé”®å¯¹CPUè´Ÿè½½çš„è¿›ç¨‹è¿›è¡Œæ’åˆ—ã€‚ 3ã€å¯¹æ’åºçš„åˆ—è¿›è¡Œé«˜äº®æ˜¾ç¤º æ•²å‡»é”®ç›˜â€˜xâ€™ï¼ˆæ‰“å¼€&#x2F;å…³é—­æ’åºåˆ—çš„åŠ äº®æ•ˆæœï¼‰ 4ã€å¯¹è¿è¡Œçš„è¿›ç¨‹è¿›è¡Œé«˜äº®æ˜¾ç¤º æ•²å‡»é”®ç›˜â€˜bâ€™ï¼ˆæ‰“å¼€å…³é—­åŠ äº®æ•ˆæœï¼‰ï¼Œå¯¹è¿è¡Œçš„è¿›ç¨‹è¿›è¡Œé«˜äº®æ˜¾ç¤º","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"tcpdump","path":"/posts/tcpdump.html","content":"tmpdumpç”¨äºæŠ“åŒ…ï¼Œä¸€ä¸ªä¾‹å­ï¼š 1tcpdump -i any host 192.168.x.x -s0 -vvv -w 1.cap -i any ä»»ä½•ç½‘ç»œ -s0 é˜²æ­¢æˆªæ–­ -wå†™å…¥æ–‡ä»¶ -vvvè¯¦ç»†çš„ä¿¡æ¯ æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªåä¸º1.capçš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨wiresharkå·¥å…·æ‰“å¼€","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"sed","path":"/posts/sed.html","content":"https://blog.csdn.net/2301_78315274/article/details/133880462 1ã€å°†æ¯è¡Œç¬¬ä¸€ä¸ª111æ›¿æ¢ä¸ºAAA 1sed -i &quot;s/111/AAA/&quot; a.txt -iä½œç”¨ä¼šä¿®æ”¹æºæ–‡ä»¶ï¼Œå¦‚è¿™é‡Œçš„a.txtï¼Œå¦‚æœä¸åŠ -iå°±ä¸ä¼šä¿®æ”¹ï¼Œåªæ˜¯å‘½ä»¤å›æ˜¾æ”¹å˜äº† 2ã€æ›¿æ¢æ‰€æœ‰çš„111ä¸ºAAA 11. sed -i &quot;s/111/AAA/g&quot; a.txt 3ã€æ›¿æ¢ç¬¬ä¸€åˆ°å››è¡Œçš„æ‰€æœ‰111ä¸ºAAA 1sed &quot;1,4s/111/AAA/g&quot; a.txt","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"tar","path":"/posts/tar.html","content":"tarå…¨ç§°æ˜¯tape archiveï¼Œåˆè¡·æ˜¯å°†å¤šä¸ªæ–‡ä»¶å†™å…¥ç£å¸¦ã€‚é¦–å…ˆï¼Œéœ€è¦åˆ†æ¸…ä¸¤ä¸ªæ¦‚å¿µâ€”â€”æ‰“åŒ…ä¸å‹ç¼©ã€‚æ‰“åŒ…ï¼šå°†å¤šä¸ªæ–‡ä»¶æ±‡æ€»æˆä¸€ä¸ªæ–‡ä»¶ã€‚å‹ç¼©ï¼šå°†ä¸€ä¸ªå¤§æ–‡ä»¶é€šè¿‡å‹ç¼©ç®—æ³•å˜æˆä¸€ä¸ªå°æ–‡ä»¶ã€‚è€Œtarå‘½ä»¤æ‰§è¡Œçš„æ‰“åŒ…æµç¨‹ï¼ŒçœŸæ­£æ‰§è¡Œå‹ç¼©çš„æ˜¯ä½¿ç”¨çš„å‹ç¼©ç®—æ³•ï¼Œæ¯”å¦‚gzipã€bzip2ã€xzã€‚tarå‘½ä»¤åœ¨Linuxç¤¾åŒºå†…ååˆ†å—æ¬¢è¿ï¼Œå…¶ä¸­ä¸€ä¸ªåŸå› å°±æ˜¯çµæ´»æ€§å¼ºï¼Œå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä¸åŒçš„å‹ç¼©ç®—æ³•ã€‚ ä¸€ã€å¸¸ç”¨å‚æ•° æ‰“åŒ…è¿‡ç¨‹ -cæˆ–--createã€‚åˆ›å»ºæ¡£æ¡ˆæ–‡ä»¶ï¼ˆå¯ä»¥ç†è§£ä¸ºå‹ç¼©åŒ…åï¼‰ -xæˆ–--extractã€‚è§£å‹ï¼ˆæå–ï¼‰æ–‡ä»¶ -fæˆ–--fileã€‚æŒ‡å®šæ¡£æ¡ˆæ–‡ä»¶ï¼Œå‘Šè¯‰tarå‘½ä»¤ï¼Œåé¢æ˜¯æ–‡ä»¶å -tæˆ–--listã€‚åˆ—å‡ºæ¡£æ¡ˆæ–‡ä»¶çš„å†…å®¹ -væˆ–--verboseã€‚æ˜¾ç¤ºå¤„ç†æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ å½“å¤šä¸ªå‚æ•°ç®€å†™åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œå¯ä»¥åªç”¨ä¸€ä¸ª-ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæœ€å¸¸ä½¿ç”¨çš„å‚æ•°å°±æ˜¯-cvfï¼Œå³åˆ›å»ºå‹ç¼©åŒ…ï¼Œå¹¶ä»¥æ˜¾ç¤ºè¯¦ç»†å¤„ç†ä¿¡æ¯ã€‚ å‹ç¼©è¿‡ç¨‹ gzipï¼šå‚æ•°-zæˆ–--gzipï¼›æ–‡ä»¶æ‹“å±•åï¼š.tar.gzæˆ–.tgz bzip2ï¼š-jæˆ–--bzip2ï¼›.tar.bz2 xzï¼š-Jæˆ–--xzï¼›.tar.xz å‹ç¼©ç®—æ³•ä¹‹é—´çš„åŒºåˆ«ï¼š å‹ç¼©ç®—æ³• gzip bzip2 xz å‚æ•° -z -j -J æ–‡ä»¶æ‹“å±•å .tar.gz .tar.bz2 .tar.xz å‹ç¼©é€Ÿåº¦ å¿« ä¸­ æ…¢ è§£å‹é€Ÿåº¦ å¿« ä¸­ ä¸­ å‹ç¼©æ¯” ä½ ä¸­ é«˜ èµ„æºå ç”¨ å°‘ ä¸­ é«˜ é€‚ç”¨åœºæ™¯ å¿«é€Ÿå‹ç¼©&#x2F;è§£å‹ é«˜å‹ç¼©æ¯” æœ€å¤§å‹ç¼©æ¯” åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œä½¿ç”¨gzipå‹ç¼©å°±å¯ä»¥äº†ï¼Œè™½ç„¶å‹ç¼©æ¯”ä½ï¼Œä½†æ˜¯å®ƒååˆ†çš„å¿«ã€‚å¹¶ä¸”å¦‚æœè¢«å‹ç¼©çš„æ–‡ä»¶æœ¬èº«å°±æ¯”è¾ƒå°ï¼Œä½¿ç”¨xzå‹ç¼©çš„ç»“æœä¹Ÿä¸ä¼šå°‘å¤ªå¤šã€‚å› æ­¤ï¼Œæ—¥å¸¸ä½¿ç”¨å»ºè®®gzipï¼Œæ—¢æƒ³è¦é€Ÿåº¦ä¹Ÿæƒ³è¦å‹ç¼©æ¯”å»ºè®®bzip2ï¼Œè¶…å¤§æ–‡ä»¶å»ºè®®xzã€‚ äºŒã€ç¤ºä¾‹æµç¨‹ç›¸ä¼¼ï¼Œåªéœ€æ›´æ¢å‹ç¼©ç®—æ³•çš„å‚æ•°ã€‚ 1234567# å‹ç¼©ã€‚å‹ç¼©åŒ…å + è¢«å‹ç¼©çš„ç›®å½•æˆ–è€…æ–‡ä»¶è·¯å¾„tar -czvf archive_name.tar.gz path_to_compress# è§£å‹ã€‚ç”¨ä»€ä¹ˆå‹ç¼©ç®—æ³•å‹ç¼©çš„ï¼Œå°±ç”¨ä»€ä¹ˆå‹ç¼©ç®—æ³•è§£å‹tar -xzvf archive_name.tar.gz # è§£å‹åˆ°å½“å‰ç›®å½•tar -xzvf archive_name.tar.gz -C path_to_extract # è§£å‹è‡³æŒ‡å®šç›®å½•ã€‚ -C ï¼ˆchange directoryï¼‰æŒ‡å‡ºç›®å½•åœ°å€","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"objdump","path":"/posts/objdump.html","content":"objdumpæä¾›äº†å¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œåæ±‡ç¼–å’ŒæŸ¥çœ‹ç›®æ ‡æ–‡ä»¶ä¿¡æ¯çš„èƒ½åŠ›ã€‚ç”¨äºåˆ†æç›®æ ‡æ–‡ä»¶ï¼ˆobject fileï¼‰å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆexecutable fileï¼‰ã€‚å®ƒå¯ä»¥æ˜¾ç¤ºäºŒè¿›åˆ¶æ–‡ä»¶çš„æ±‡ç¼–ä»£ç ã€ç¬¦å·è¡¨ã€æ®µä¿¡æ¯ç­‰ï¼Œæ˜¯ç†è§£ç¨‹åºåº•å±‚å®ç°ã€è°ƒè¯•å’Œé€†å‘å·¥ç¨‹çš„æœ‰åŠ›åŠ©æ‰‹ã€‚ ä¸€ã€objdumpçš„åŸºæœ¬ç”¨æ³•æ˜¾ç¤ºç›®æ ‡æ–‡ä»¶çš„åæ±‡ç¼–ä»£ç ï¼š 1objdump -d your_binary è¯¥å‘½ä»¤ä¼šæ˜¾ç¤ºç›®æ ‡æ–‡ä»¶ä¸­æ‰€æœ‰æ®µçš„åæ±‡ç¼–ä»£ç ã€‚è¿™æ˜¯ä¸€ç§æ·±å…¥äº†è§£ç¨‹åºæ‰§è¡Œé€»è¾‘çš„æ–¹å¼ã€‚ æ˜¾ç¤ºç¬¦å·è¡¨ä¿¡æ¯ï¼š 1objdump -t your_binary è¯¥å‘½ä»¤ä¼šæ˜¾ç¤ºç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ï¼ŒåŒ…æ‹¬å‡½æ•°åã€å˜é‡åç­‰ä¿¡æ¯ã€‚ æ˜¾ç¤ºæ–‡ä»¶å¤´ä¿¡æ¯ï¼š 1objdump -f your_binary è¯¥å‘½ä»¤æ˜¾ç¤ºç›®æ ‡æ–‡ä»¶çš„æ–‡ä»¶å¤´ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ ¼å¼ã€å…¥å£ç‚¹åœ°å€ç­‰ã€‚objdump çš„ä½¿ç”¨è¿˜å¯ä»¥æ ¹æ®éœ€æ±‚åŠ å…¥ä¸€äº›å‚æ•°æ¥è·å–æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚ æ˜¾ç¤ºæ‰€æœ‰æ®µçš„è¯¦ç»†ä¿¡æ¯ï¼š 1objdump -p your_binary è¿™å°†æ˜¾ç¤ºç›®æ ‡æ–‡ä»¶ä¸­æ‰€æœ‰æ®µçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯ä¸ªæ®µçš„å¤§å°ã€åç§»é‡ç­‰ã€‚ æ˜¾ç¤ºç‰¹å®šæ®µçš„åæ±‡ç¼–ä»£ç ï¼š 1objdump -s -j section_name your_binary è¿™å°†æ˜¾ç¤ºæŒ‡å®šæ®µï¼ˆsection_nameï¼‰çš„åæ±‡ç¼–ä»£ç ã€‚ åªæ˜¾ç¤ºç¬¦å·è¡¨çš„ä¿¡æ¯ï¼š 1objdump -T your_binary è¯¥å‘½ä»¤æ˜¾ç¤ºç¬¦å·è¡¨çš„ä¿¡æ¯ï¼Œä½†ä¸æ˜¾ç¤ºåæ±‡ç¼–ä»£ç ã€‚ æ˜¾ç¤ºæºä»£ç å’Œåæ±‡ç¼–ä»£ç ï¼š 1objdump -S your_binary è¿™å°†æ˜¾ç¤ºæºä»£ç å’Œåæ±‡ç¼–ä»£ç çš„æ··åˆè§†å›¾ï¼Œæ–¹ä¾¿ç†è§£æºä»£ç å’Œæ±‡ç¼–ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ ä»¥æŒ‡å®šæ ¼å¼æ˜¾ç¤ºåæ±‡ç¼–ä»£ç ï¼š 1objdump -M intel -d your_binary -M å‚æ•°å…è®¸ä½ æŒ‡å®šåæ±‡ç¼–ä»£ç çš„è¾“å‡ºæ ¼å¼ï¼Œä¾‹å¦‚ intel æˆ– attã€‚ ä»¥ä¸Šæ˜¯ä¸€äº›å¸¸è§çš„ objdump ç”¨æ³•å’Œå‚æ•°ã€‚é€šè¿‡ç»„åˆä½¿ç”¨è¿™äº›å‚æ•°ï¼Œä½ å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚æ›´æ·±å…¥åœ°äº†è§£ç›®æ ‡æ–‡ä»¶çš„å†…éƒ¨ç»“æ„å’Œä»£ç æ‰§è¡Œé€»è¾‘ã€‚","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"objcopy","path":"/posts/objcopy.html","content":"objcopyè½¬æ¢elfæ–‡ä»¶ä¸ºbinæ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå°†boot.elfè½¬ä¸ºboot.binçš„å‘½ä»¤ 1arm-linux-objcopy -O binary -R .note -R .comment -S boot.elf boot.bin ä½¿ç”¨ -O binary (æˆ–â€“out-target&#x3D;binary) è¾“å‡ºä¸ºåŸå§‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ ä½¿ç”¨ -R .note (æˆ–â€“remove-section) è¾“å‡ºæ–‡ä»¶ä¸­ä¸è¦.noteè¿™ä¸ªsectionï¼Œç¼©å°äº†æ–‡ä»¶å°ºå¯¸ ä½¿ç”¨ -S (æˆ– â€“strip-all) è¾“å‡ºæ–‡ä»¶ä¸­ä¸è¦é‡å®šä½ä¿¡æ¯å’Œç¬¦å·ä¿¡æ¯ï¼Œç¼©å°äº†æ–‡ä»¶å°ºå¯¸","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"nm","path":"/posts/nm.html","content":"nmå‘½ä»¤æ˜¯linuxä¸‹é’ˆå¯¹æŸäº›ç‰¹å®šæ–‡ä»¶çš„åˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿåˆ—å‡ºåº“æ–‡ä»¶ï¼ˆ.aã€.libï¼‰ã€ç›®æ ‡æ–‡ä»¶ï¼ˆ*.oï¼‰ã€å¯æ‰§è¡Œæ–‡ä»¶çš„ç¬¦å·è¡¨ã€‚ ä¸€ã€nmå‘½ä»¤çš„å¸¸ç”¨å‚æ•° -A æˆ– -o æˆ– â€“print-file-nameï¼šæ‰“å°å‡ºæ¯ä¸ªç¬¦å·å±äºçš„æ–‡ä»¶ -a æˆ– â€“debug-symsï¼šæ˜¾ç¤ºè°ƒè¯•ç¬¦å·ã€‚ -Bï¼šç­‰åŒäºâ€“format&#x3D;bsdï¼Œç”¨æ¥å…¼å®¹MIPSçš„nmã€‚ -C æˆ– â€“demangleï¼šå°†ä½çº§ç¬¦å·åè§£ç (demangle)æˆç”¨æˆ·çº§åå­—ã€‚è¿™æ ·å¯ä»¥ä½¿å¾—C++å‡½æ•°åå…·æœ‰å¯è¯»æ€§ã€‚ -D æˆ– â€“dynamicï¼šæ˜¾ç¤ºåŠ¨æ€ç¬¦å·ã€‚è¯¥ä»»é€‰é¡¹ä»…å¯¹äºåŠ¨æ€ç›®æ ‡(ä¾‹å¦‚ç‰¹å®šç±»å‹çš„å…±äº«åº“)æœ‰æ„ä¹‰ã€‚ -f forma æˆ– â€“format&#x3D;formattï¼šä½¿ç”¨formatæ ¼å¼è¾“å‡ºã€‚formatå¯ä»¥é€‰å–bsdã€sysvæˆ–posixï¼Œè¯¥é€‰é¡¹åœ¨GNUçš„nmä¸­æœ‰ç”¨ã€‚é»˜è®¤ä¸ºbsdã€‚ -g æˆ– â€“extern-onlyï¼šä»…æ˜¾ç¤ºå¤–éƒ¨ç¬¦å·ã€‚ -n ã€-v æˆ– â€“numeric-sortï¼šæŒ‰ç¬¦å·å¯¹åº”åœ°å€çš„é¡ºåºæ’åºï¼Œè€ŒéæŒ‰ç¬¦å·åçš„å­—ç¬¦é¡ºåºã€‚ -p æˆ– â€“no-sortï¼šæŒ‰ç›®æ ‡æ–‡ä»¶ä¸­é‡åˆ°çš„ç¬¦å·é¡ºåºæ˜¾ç¤ºï¼Œä¸æ’åºã€‚ -P æˆ– â€“portabilityï¼šä½¿ç”¨POSIX.2æ ‡å‡†è¾“å‡ºæ ¼å¼ä»£æ›¿é»˜è®¤çš„è¾“å‡ºæ ¼å¼ã€‚ç­‰åŒäºä½¿ç”¨ä»»é€‰é¡¹-f posixã€‚ -s æˆ– â€“print-armapï¼šå½“åˆ—å‡ºåº“ä¸­æˆå‘˜çš„ç¬¦å·æ—¶ï¼ŒåŒ…å«ç´¢å¼•ã€‚ç´¢å¼•çš„å†…å®¹åŒ…å«ï¼šå“ªäº›æ¨¡å—åŒ…å«å“ªäº›åå­—çš„æ˜ å°„ã€‚ -r æˆ– â€“reverse-sortï¼šåè½¬æ’åºçš„é¡ºåº(ä¾‹å¦‚ï¼Œå‡åºå˜ä¸ºé™åº)ã€‚ â€“size-sortï¼šæŒ‰å¤§å°æ’åˆ—ç¬¦å·é¡ºåºã€‚è¯¥å¤§å°æ˜¯æŒ‰ç…§ä¸€ä¸ªç¬¦å·çš„å€¼ä¸å®ƒä¸‹ä¸€ä¸ªç¬¦å·çš„å€¼è¿›è¡Œè®¡ç®—çš„ã€‚ -t radix æˆ– â€“radix&#x3D;radixï¼šä½¿ç”¨radixè¿›åˆ¶æ˜¾ç¤ºç¬¦å·å€¼ã€‚radixåªèƒ½ä¸ºâ€œdâ€è¡¨ç¤ºåè¿›åˆ¶ã€â€œoâ€è¡¨ç¤ºå…«è¿›åˆ¶æˆ–â€œxâ€è¡¨ç¤ºåå…­è¿›åˆ¶ã€‚ â€“target&#x3D;bfdnameï¼šæŒ‡å®šä¸€ä¸ªç›®æ ‡ä»£ç çš„æ ¼å¼ï¼Œè€Œéä½¿ç”¨ç³»ç»Ÿçš„é»˜è®¤æ ¼å¼ã€‚ -u æˆ– â€“undefined-onlyï¼šä»…æ˜¾ç¤ºæ²¡æœ‰å®šä¹‰çš„ç¬¦å·(é‚£äº›å¤–éƒ¨ç¬¦å·)ã€‚ -l æˆ– â€“line-numbersï¼šå¯¹æ¯ä¸ªç¬¦å·ï¼Œä½¿ç”¨è°ƒè¯•ä¿¡æ¯æ¥è¯•å›¾æ‰¾åˆ°æ–‡ä»¶åå’Œè¡Œå·ã€‚å¯¹äºå·²å®šä¹‰çš„ç¬¦å·ï¼ŒæŸ¥æ‰¾ç¬¦å·åœ°å€çš„è¡Œå·ã€‚å¯¹äºæœªå®šä¹‰ç¬¦å·ï¼ŒæŸ¥æ‰¾æŒ‡å‘ç¬¦å·é‡å®šä½å…¥å£çš„è¡Œå·ã€‚å¦‚æœå¯ä»¥æ‰¾åˆ°è¡Œå·ä¿¡æ¯ï¼Œæ˜¾ç¤ºåœ¨ç¬¦å·ä¿¡æ¯ä¹‹åã€‚ -V æˆ– â€“versionï¼šæ˜¾ç¤ºnmçš„ç‰ˆæœ¬å·ã€‚ â€“helpï¼šæ˜¾ç¤ºnmçš„ä»»é€‰é¡¹ã€‚ ä¸¾ä¸ªæ —å­ ç¼–å†™æºæ–‡ä»¶test.c 1234567891011#include &lt;stdio.h&gt;const char ch = &#x27;x&#x27;;int uninit;int init = 10;void function() &#123; int *ref = &amp;init; static int sta_int = 10; printf(&quot;%c&quot;, ch);&#125; ç¼–è¯‘test.cæ–‡ä»¶ ç”Ÿæˆtest.o gcc -c test.c ç”¨nmå‘½ä»¤åˆ†æç¬¦å·è¡¨ nm -n test.oï¼ˆ-nä»¥åœ°å€æ’åºï¼Œæ–¹ä¾¿æŸ¥çœ‹ï¼‰ è¾“å‡ºç»“æœï¼š 123456 U putchar0000000000000000 R ch0000000000000000 T function0000000000000000 D init0000000000000004 d sta_int.21820000000000000004 C uninit äºŒã€nmä¿¡æ¯çš„å«ä¹‰ç¬¬ä¸€åˆ—ï¼šç¬¦å·å€¼ï¼Œå³è¯¥ç¬¦å·çš„èµ·å§‹åœ°å€ç¬¬äºŒåˆ—ï¼šç¬¦å·ç±»å‹ï¼Œå„å­—æ¯ä»£è¡¨ä»€ä¹ˆç±»å‹åœ¨ä¸‹ä¸€å°èŠ‚ä¸­ä»‹ç»ç¬¬ä¸‰åˆ—ï¼šç¬¦å·åç§° ä¸‰ã€è¾“å‡ºç¬¦å·ç±»å‹è¯¦è§£ç¬¦å·ç±»å‹å¤§å†™ä»£è¡¨å…¨å±€ç¬¦å·ï¼Œå°å†™ä»£è¡¨æœ¬åœ°ç¬¦å· A è¯¥ç¬¦å·çš„å€¼æ˜¯ç»å¯¹çš„ï¼Œåœ¨ä»¥åçš„é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œä¸å…è®¸è¿›è¡Œæ”¹å˜ã€‚è¿™æ ·çš„ç¬¦å·å€¼ï¼Œå¸¸å¸¸å‡ºç°åœ¨ä¸­æ–­å‘é‡è¡¨ä¸­ï¼Œä¾‹å¦‚ç”¨ç¬¦å·æ¥è¡¨ç¤ºå„ä¸ªä¸­æ–­å‘é‡å‡½æ•°åœ¨ä¸­æ–­å‘é‡è¡¨ä¸­çš„ä½ç½®ã€‚ B è¯¥ç¬¦å·çš„å€¼å‡ºç°åœ¨éåˆå§‹åŒ–æ•°æ®æ®µ(bss)ä¸­ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰å…¨å±€static int testã€‚åˆ™è¯¥ç¬¦å·testçš„ç±»å‹ä¸ºbï¼Œä½äºbss sectionä¸­ã€‚å…¶å€¼è¡¨ç¤ºè¯¥ç¬¦å·åœ¨bssæ®µä¸­çš„åç§»ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œbssæ®µåˆ†é…äºRAMä¸­ã€‚ C è¯¥ç¬¦å·ä¸ºcommonã€‚common symbolæ˜¯æœªåˆå§‹è¯æ•°æ®æ®µã€‚è¯¥ç¬¦å·æ²¡æœ‰åŒ…å«äºä¸€ä¸ªæ™®é€šsectionä¸­ã€‚åªæœ‰åœ¨é“¾æ¥è¿‡ç¨‹ä¸­æ‰è¿›è¡Œåˆ†é…ã€‚ç¬¦å·çš„å€¼è¡¨ç¤ºè¯¥ç¬¦å·éœ€è¦çš„å­—èŠ‚æ•°ã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ªcæ–‡ä»¶ä¸­ï¼Œå®šä¹‰int testï¼Œå¹¶ä¸”è¯¥ç¬¦å·åœ¨åˆ«çš„åœ°æ–¹ä¼šè¢«å¼•ç”¨ï¼Œåˆ™è¯¥ç¬¦å·ç±»å‹å³ä¸ºCã€‚å¦åˆ™å…¶ç±»å‹ä¸ºBã€‚ D è¯¥ç¬¦å·ä½äºåˆå§‹è¯æ•°æ®æ®µä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåˆ†é…åˆ°data sectionä¸­ã€‚ä¾‹å¦‚å®šä¹‰å…¨å±€int baud_table[5] &#x3D; {9600, 19200, 38400, 57600, 115200}ï¼Œåˆ™ä¼šåˆ†é…äºåˆå§‹åŒ–æ•°æ®æ®µä¸­ã€‚ G è¯¥ç¬¦å·ä¹Ÿä½äºåˆå§‹åŒ–æ•°æ®æ®µä¸­ã€‚ä¸»è¦ç”¨äºsmall objectæé«˜è®¿é—®small data objectçš„ä¸€ç§æ–¹å¼ã€‚ I è¯¥ç¬¦å·æ˜¯å¯¹å¦ä¸€ä¸ªç¬¦å·çš„é—´æ¥å¼•ç”¨ã€‚ N è¯¥ç¬¦å·æ˜¯ä¸€ä¸ªdebuggingç¬¦å·ã€‚ R è¯¥ç¬¦å·ä½äºåªè¯»æ•°æ®åŒºã€‚ä¾‹å¦‚å®šä¹‰å…¨å±€const int test[] &#x3D; {123, 123};åˆ™testå°±æ˜¯ä¸€ä¸ªåªè¯»æ•°æ®åŒºçš„ç¬¦å·ã€‚æ³¨æ„åœ¨cygwinä¸‹å¦‚æœä½¿ç”¨gccç›´æ¥ç¼–è¯‘æˆMZæ ¼å¼æ—¶ï¼Œæºæ–‡ä»¶ä¸­çš„testå¯¹åº”_testï¼Œå¹¶ä¸”å…¶ç¬¦å·ç±»å‹ä¸ºDï¼Œå³åˆå§‹åŒ–æ•°æ®æ®µä¸­ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨m6812-elf-gccè¿™æ ·çš„äº¤å‰ç¼–è¯‘å·¥å…·ï¼Œæºæ–‡ä»¶ä¸­çš„testå¯¹åº”ç›®æ ‡æ–‡ä»¶çš„test,å³æ²¡æœ‰æ·»åŠ ä¸‹åˆ’çº¿ï¼Œå¹¶ä¸”å…¶ç¬¦å·ç±»å‹ä¸ºRã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä½äºrodata sectionã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåœ¨ä¸€ä¸ªå‡½æ•°ä¸­å®šä¹‰const char *test &#x3D; â€œabcâ€, const char test_int &#x3D; 3ã€‚ä½¿ç”¨nméƒ½ä¸ä¼šå¾—åˆ°ç¬¦å·ä¿¡æ¯ï¼Œä½†æ˜¯å­—ç¬¦ä¸²â€œabcâ€åˆ†é…äºåªè¯»å­˜å‚¨å™¨ä¸­ï¼Œteståœ¨rodata sectionä¸­ï¼Œå¤§å°ä¸º4ã€‚ S ç¬¦å·ä½äºéåˆå§‹åŒ–æ•°æ®åŒºï¼Œç”¨äºsmall objectã€‚ T è¯¥ç¬¦å·ä½äºä»£ç åŒºtext sectionã€‚ U è¯¥ç¬¦å·åœ¨å½“å‰æ–‡ä»¶ä¸­æ˜¯æœªå®šä¹‰çš„ï¼Œå³è¯¥ç¬¦å·çš„å®šä¹‰åœ¨åˆ«çš„æ–‡ä»¶ä¸­ã€‚ä¾‹å¦‚ï¼Œå½“å‰æ–‡ä»¶è°ƒç”¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œåœ¨è¿™ä¸ªè¢«è°ƒç”¨çš„å‡½æ•°åœ¨å½“å‰å°±æ˜¯æœªå®šä¹‰çš„ï¼›ä½†æ˜¯åœ¨å®šä¹‰å®ƒçš„æ–‡ä»¶ä¸­ç±»å‹æ˜¯Tã€‚ä½†æ˜¯å¯¹äºå…¨å±€å˜é‡æ¥è¯´ï¼Œåœ¨å®šä¹‰å®ƒçš„æ–‡ä»¶ä¸­ï¼Œå…¶ç¬¦å·ç±»å‹ä¸ºCï¼Œåœ¨ä½¿ç”¨å®ƒçš„æ–‡ä»¶ä¸­ï¼Œå…¶ç±»å‹ä¸ºUã€‚ V è¯¥ç¬¦å·æ˜¯ä¸€ä¸ªweak objectã€‚ W è¯¥ç¬¦å·æ˜¯æ²¡æœ‰è¢«æ˜ç¡®æ ‡è®°ä¸ºweak objectçš„å¼±ç¬¦å·ç±»å‹ã€‚ è¯¥ç¬¦å·æ˜¯a.outæ ¼å¼æ–‡ä»¶ä¸­çš„stabs symbolã€‚ ? è¯¥ç¬¦å·ç±»å‹æ²¡æœ‰å®šä¹‰ã€‚","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"readelf","path":"/posts/readelf.html","content":"ä¸€ã€ä¸‰ç±»ç›®æ ‡æ–‡ä»¶ï¼ˆELFï¼‰ï¼š1.å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ (.o ) æ¯ä¸ª .o æ–‡ä»¶éƒ½æ˜¯ç”±å¯¹åº”çš„ .c æ–‡ä»¶é€šè¿‡ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨ç”Ÿæˆï¼›åŒ…å«ä»£ç å’Œæ•°æ®ï¼Œä»£ç å’Œæ•°æ®åœ°å€éƒ½ä»0å¼€å§‹ã€‚é€šè¿‡ gcc -c xxx.c å¾—åˆ°ã€‚ 2.å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼ˆé»˜è®¤ä¸ºa.outï¼‰ ç”±é“¾æ¥å™¨ç”Ÿæˆï¼ŒåŒ…å«çš„ä»£ç å’Œæ•°æ®å¯ä»¥ç›´æ¥é€šè¿‡åŠ è½½å™¨åŠ è½½åˆ°å†…å­˜ä¸­å¹¶è¢«æ‰§è¡Œã€‚é€šè¿‡gcc -o xxx.c å¾—åˆ°ã€‚ 3.å…±äº«ç›®æ ‡æ–‡ä»¶ (.soï¼‰ ç‰¹æ®Šçš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œå¯ä»¥åœ¨é“¾æ¥(é™æ€å…±äº«åº“)æ—¶åŠ å…¥ç›®æ ‡æ–‡ä»¶æˆ–åŠ è½½æ—¶æˆ–è¿è¡Œæ—¶(åŠ¨æ€å…±äº«åº“)è¢«åŠ¨æ€çš„åŠ è½½åˆ°å†…å­˜å¹¶æ‰§è¡Œã€‚åœ¨ windows ä¸­è¢«ç§°ä¸º Dynamic Link Libraries(DLLs)ã€‚ gcc xxx.c -fPIC -shared -o libxxx.so ï¼ˆ-fPIC ä½œç”¨äºç¼–è¯‘é˜¶æ®µï¼Œå‘Šè¯‰ç¼–è¯‘å™¨äº§ç”Ÿä¸ä½ç½®æ— å…³ä»£ç ã€‚ï¼‰ readelfå‘½ä»¤ï¼š é€šè¿‡readelfæ¥åŒºåˆ†ä¸Šé¢ä¸‰ç§ç±»å‹çš„ELFæ–‡ä»¶ï¼Œæ¯ç§ç±»å‹æ–‡ä»¶çš„å¤´éƒ¨ä¿¡æ¯æ˜¯ä¸ä¸€æ ·çš„ã€‚ äºŒã€readelf -hreadelf -h main.o -hç­‰ä»·äºâ€“file-header 1234567891011121314151617181920 1 ELF Header: 2 Magic: 7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 3 Class: ELF64 4 Data: 2&#x27;s complement, little endian 5 Version: 1 (current) 6 OS/ABI: UNIX - System V 7 ABI Version: 0 8 Type: REL (Relocatable file) 9 Machine: Advanced Micro Devices X86-6410 Version: 0x111 Entry point address: 0x012 Start of program headers: 0 (bytes into file)13 Start of section headers: 720 (bytes into file)14 Flags: 0x015 Size of this header: 64 (bytes)16 Size of program headers: 0 (bytes)17 Number of program headers: 018 Size of section headers: 64 (bytes)19 Number of section headers: 1220 Section header string table index: 11 ç¬¬ 1 è¡Œï¼ŒELF Header: æŒ‡å ELF æ–‡ä»¶å¤´å¼€å§‹ã€‚ ç¬¬ 2 è¡Œï¼ŒMagic é­”æ•°ï¼Œç”¨æ¥æŒ‡åè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ª ELF ç›®æ ‡æ–‡ä»¶ã€‚ç¬¬ä¸€ä¸ªå­—èŠ‚ 7F æ˜¯ä¸ªå›ºå®šçš„æ•°ï¼›åé¢çš„ 3 ä¸ªå­—èŠ‚æ­£æ˜¯ E, L, F ä¸‰ä¸ªå­—æ¯çš„ ASCII å½¢å¼ã€‚ ç¬¬ 3 è¡Œï¼ŒCLASS è¡¨ç¤ºæ–‡ä»¶ç±»å‹ï¼Œè¿™é‡Œæ˜¯ 64ä½çš„ ELF æ ¼å¼ã€‚ ç¬¬ 4 è¡Œï¼ŒData è¡¨ç¤ºæ–‡ä»¶ä¸­çš„æ•°æ®æ˜¯æŒ‰ç…§ä»€ä¹ˆæ ¼å¼ç»„ç»‡(å¤§ç«¯æˆ–å°ç«¯)çš„ï¼Œä¸åŒå¤„ç†å™¨å¹³å°æ•°æ®ç»„ç»‡æ ¼å¼å¯èƒ½å°±ä¸åŒï¼Œå¦‚x86å¹³å°ä¸ºå°ç«¯å­˜å‚¨æ ¼å¼ã€‚ ç¬¬ 5 è¡Œï¼Œå½“å‰ ELF æ–‡ä»¶å¤´ç‰ˆæœ¬å·ï¼Œè¿™é‡Œç‰ˆæœ¬å·ä¸º 1 ã€‚ ç¬¬ 6 è¡Œï¼ŒOS&#x2F;ABI ï¼ŒæŒ‡å‡ºæ“ä½œç³»ç»Ÿç±»å‹ï¼ŒABI æ˜¯ Application Binary Interface çš„ç¼©å†™ã€‚ ç¬¬ 7 è¡Œï¼ŒABI ç‰ˆæœ¬å·ï¼Œå½“å‰ä¸º 0 ã€‚ ç¬¬ 8 è¡Œï¼ŒType è¡¨ç¤ºæ–‡ä»¶ç±»å‹ã€‚ELF æ–‡ä»¶æœ‰ 3 ç§ç±»å‹ï¼Œä¸€ç§æ˜¯å¦‚ä¸Šæ‰€ç¤ºçš„ Relocatable file å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œä¸€ç§æ˜¯å¯æ‰§è¡Œæ–‡ä»¶(Executable)ï¼Œå¦å¤–ä¸€ç§æ˜¯å…±äº«åº“(Shared Library) ã€‚ [è¿™é‡Œå°±æ˜¯åŒºåˆ†ä¸Šé¢ä¸‰ç§ç±»å‹çš„ELFæ–‡ä»¶] ç¬¬ 9 è¡Œï¼Œæœºå™¨å¹³å°ç±»å‹ï¼Œè¿™é‡Œæ˜¯åœ¨X86-64ä½æœºå™¨ã€‚ ç¬¬ 10 è¡Œï¼Œå½“å‰ç›®æ ‡æ–‡ä»¶çš„ç‰ˆæœ¬å·ã€‚ ç¬¬ 11 è¡Œï¼Œç¨‹åºçš„è™šæ‹Ÿåœ°å€å…¥å£ç‚¹ï¼Œå› ä¸ºè¿™è¿˜ä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºï¼Œæ•…è€Œè¿™é‡Œä¸ºé›¶ã€‚å¦‚æœæ˜¯å¯è¿è¡Œç¨‹åºï¼Œè¿™ä¸ªåœ°å€å¹¶ä¸æ˜¯mainå‡½æ•°çš„åœ°å€ï¼Œè€Œæ˜¯_startå‡½æ•°çš„åœ°å€ï¼Œ_startç”±é“¾æ¥å™¨åˆ›å»ºï¼Œ_startæ˜¯ä¸ºäº†åˆå§‹åŒ–ç¨‹åºã€‚é€šè¿‡è¿™ä¸ªå‘½ä»¤å¯ä»¥çœ‹åˆ°_startå‡½æ•°ï¼Œobjdump -d -j .text a.out(é»˜è®¤ï¼Œæ”¹åä¹‹åéœ€æ›´æ”¹æ­¤å¤„)ã€‚ ç¬¬ 12 è¡Œï¼Œä¸ 11 è¡ŒåŒç†ï¼Œè¿™ä¸ªç›®æ ‡æ–‡ä»¶æ²¡æœ‰ Program Headersã€‚ ç¬¬ 13 è¡Œï¼Œsections å¤´å¼€å§‹å¤„ï¼Œè¿™é‡Œ 720 æ˜¯åè¿›åˆ¶ï¼Œè¡¨ç¤ºä»åœ°å€åç§» 0x450 å¤„å¼€å§‹ã€‚ ç¬¬ 14 è¡Œï¼Œæ˜¯ä¸€ä¸ªä¸å¤„ç†å™¨ç›¸å…³è”çš„æ ‡å¿—ï¼Œx86 å¹³å°ä¸Šè¯¥å¤„ä¸º 0 ã€‚ ç¬¬ 15 è¡Œï¼ŒELF æ–‡ä»¶å¤´çš„å­—èŠ‚æ•°ã€‚64bytes ç¬¬ 16 è¡Œï¼Œå› ä¸ºè¿™ä¸ªä¸æ˜¯å¯æ‰§è¡Œç¨‹åºï¼Œæ•…æ­¤å¤„å¤§å°ä¸º 0ã€‚ ç¬¬ 17 è¡Œï¼ŒåŒç†äºç¬¬ 16 è¡Œã€‚ ç¬¬ 18 è¡Œï¼Œsections header çš„å¤§å°ï¼Œè¿™é‡Œæ¯ä¸ª section å¤´å¤§å°ä¸º 64bytesã€‚ ç¬¬ 19 è¡Œï¼Œä¸€å…±æœ‰å¤šå°‘ä¸ª section å¤´ï¼Œè¿™é‡Œæ˜¯ 12ä¸ªã€‚ ç¬¬ 20 è¡Œï¼Œsection å¤´å­—ç¬¦ä¸²è¡¨ç´¢å¼•å·ã€‚åŒºä¸­å­˜å‚¨çš„ä¿¡æ¯æ˜¯ç”¨æ¥é“¾æ¥ä½¿ç”¨çš„ï¼Œä¸»è¦åŒ…æ‹¬ï¼šç¨‹åºä»£ç ã€ç¨‹åºæ•°æ®ï¼ˆå˜é‡ï¼‰ã€é‡å®šå‘ä¿¡æ¯ç­‰ã€‚æ¯”å¦‚ï¼šCode sectionä¿å­˜çš„æ˜¯ä»£ç ï¼Œdata sectionä¿å­˜çš„æ˜¯åˆå§‹åŒ–æˆ–æœªåˆå§‹åŒ–çš„æ•°æ®ï¼Œç­‰ç­‰ã€‚ ä¸‰ã€readelf -S mainåŠŸèƒ½ï¼šæŸ¥çœ‹åŒºå†…å®¹ 1234567891011121314151617181920212223242526272829303132333435361 There are 29 section headers, starting at offset 0x1948: 2 Section Headers: 3 [Nr] Name Type Address Offset Size EntSize Flags Link Info Align 4 [ 0] NULL 0000000000000000 00000000 0000000000000000 0000000000000000 0 0 0 5 [ 1] .interp PROGBITS 0000000000000238 00000238 000000000000001c 0000000000000000 A 0 0 1 6 [ 2] .note.ABI-tag NOTE 0000000000000254 00000254 0000000000000020 0000000000000000 A 0 0 4 7 [ 3] .note.gnu.build-i NOTE 0000000000000274 00000274 0000000000000024 0000000000000000 A 0 0 4 8 [ 4] .gnu.hash GNU_HASH 0000000000000298 00000298 000000000000001c 0000000000000000 A 5 0 8 9 [ 5] .dynsym DYNSYM 00000000000002b8 000002b8 0000000000000090 0000000000000018 A 6 1 810 [ 6] .dynstr STRTAB 0000000000000348 00000348 000000000000007d 0000000000000000 A 0 0 111 [ 7] .gnu.version VERSYM 00000000000003c6 000003c6 000000000000000c 0000000000000002 A 5 0 212 [ 8] .gnu.version_r VERNEED 00000000000003d8 000003d8 0000000000000020 0000000000000000 A 6 1 813 [ 9] .rela.dyn RELA 00000000000003f8 000003f8 00000000000000c0 0000000000000018 A 5 0 814 [10] .init PROGBITS 00000000000004b8 000004b8 0000000000000017 0000000000000000 AX 0 0 415 [11] .plt PROGBITS 00000000000004d0 000004d0 0000000000000010 0000000000000010 AX 0 0 1616 [12] .plt.got PROGBITS 00000000000004e0 000004e0 0000000000000008 0000000000000008 AX 0 0 817 [13] .text PROGBITS 00000000000004f0 000004f0 00000000000001e2 0000000000000000 AX 0 0 1618 [14] .fini PROGBITS 00000000000006d4 000006d4 0000000000000009 0000000000000000 AX 0 0 419 [15] .rodata PROGBITS 00000000000006e0 000006e0 0000000000000004 0000000000000004 AM 0 0 420 [16] .eh_frame_hdr PROGBITS 00000000000006e4 000006e4 0000000000000044 0000000000000000 A 0 0 421 [17] .eh_frame PROGBITS 0000000000000728 00000728 0000000000000128 0000000000000000 A 0 0 822 [18] .init_array INIT_ARRAY 0000000000200df0 00000df0 0000000000000008 0000000000000008 WA 0 0 823 [19] .fini_array FINI_ARRAY 0000000000200df8 00000df8 0000000000000008 0000000000000008 WA 0 0 824 [20] .dynamic DYNAMIC 0000000000200e00 00000e00 00000000000001c0 0000000000000010 WA 6 0 825 [21] .got PROGBITS 0000000000200fc0 00000fc0 0000000000000040 0000000000000008 WA 0 0 826 [22] .data PROGBITS 0000000000201000 00001000 0000000000000018 0000000000000000 WA 0 0 827 [23] .bss NOBITS 0000000000201018 00001018 0000000000000008 0000000000000000 WA 0 0 128 [24] .comment PROGBITS 0000000000000000 00001018 000000000000002b 0000000000000001 MS 0 0 129 [25] .symtab SYMTAB 0000000000000000 00001048 0000000000000600 0000000000000018 26 43 830 [26] .strtab STRTAB 0000000000000000 00001648 0000000000000200 0000000000000000 0 0 131 [27] .shstrtab STRTAB 0000000000000000 00001848 00000000000000f9 0000000000000000 0 0 132 Key to Flags:33 W (write), A (alloc), X (execute), M (merge), S (strings), I (info),34 L (link order), O (extra OS processing required), G (group), T (TLS),35 C (compressed), x (unknown), o (OS specific), E (exclude),36 l (large), p (processor specific) .textï¼šå·²ç¼–è¯‘ç¨‹åºçš„æœºå™¨ä»£ç ï¼ˆäºŒè¿›åˆ¶æŒ‡ä»¤ï¼‰ï¼Œè¯¥åŒºçš„æ ‡å¿—ä¸ºXè¡¨ç¤ºå¯æ‰§è¡Œã€‚ .rodataï¼šåªè¯»æ•°æ®ï¼Œæ¯”å¦‚printfè¯­å¥ä¸­çš„æ ¼å¼ä¸²å’Œå¼€å…³ï¼ˆswitchï¼‰è¯­å¥çš„è·³è½¬è¡¨ã€‚ .dataï¼šå·²åˆå§‹åŒ–çš„å…¨å±€Cå˜é‡ã€‚å±€éƒ¨Cå˜é‡åœ¨è¿è¡Œæ—¶è¢«ä¿å­˜åœ¨æ ˆä¸­ï¼Œæ—¢ä¸å‡ºç°åœ¨.dataä¸­ï¼Œä¹Ÿä¸å‡ºç°åœ¨.bssèŠ‚ä¸­ã€‚ .bssï¼šæœªåˆå§‹åŒ–çš„å…¨å±€Cå˜é‡ã€‚åœ¨ç›®æ ‡æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰åˆ†é…å®é™…çš„ç©ºé—´ç»™å®ƒï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå ä½ç¬¦ã€‚ç›®æ ‡æ–‡ä»¶æ ¼å¼åŒºåˆ†åˆå§‹åŒ–å’Œæœªåˆå§‹åŒ–å˜é‡æ˜¯ä¸ºäº†ç©ºé—´æ•ˆç‡åœ¨ï¼šåœ¨ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œæœªåˆå§‹åŒ–å˜é‡ä¸éœ€è¦å æ®ä»»ä½•å®é™…çš„ç£ç›˜ç©ºé—´ã€‚ .symtabï¼šä¸€ä¸ªç¬¦å·è¡¨ï¼ˆsymbol tableï¼‰ï¼Œå®ƒå­˜æ”¾åœ¨ç¨‹åºä¸­è¢«å®šä¹‰å’Œå¼•ç”¨çš„å‡½æ•°å’Œå…¨å±€å˜é‡çš„ä¿¡æ¯ã€‚ä¸€äº›ç¨‹åºå‘˜é”™è¯¯åœ°è®¤ä¸ºå¿…é¡»é€šè¿‡-gé€‰é¡¹æ¥ç¼–è¯‘ä¸€ä¸ªç¨‹åºï¼Œå¾—åˆ°ç¬¦å·è¡¨ä¿¡æ¯ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ªå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶åœ¨.symtabä¸­éƒ½æœ‰ä¸€å¼ ç¬¦å·è¡¨ã€‚ç„¶è€Œï¼Œå’Œç¼–è¯‘å™¨ä¸­çš„ç¬¦å·è¡¨ä¸åŒï¼Œ.symtabç¬¦å·è¡¨ä¸åŒ…å«å±€éƒ¨å˜é‡çš„è¡¨ç›®ã€‚ .rel.textï¼šå½“é“¾æ¥å™æŠŠè¿™ä¸ªç›®æ ‡æ–‡ä»¶å’Œå…¶ä»–æ–‡ä»¶ç»“åˆæ—¶ï¼Œ.textèŠ‚ä¸­çš„è®¸å¤šä½ç½®éƒ½éœ€è¦ä¿®æ”¹ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä»»ä½•è°ƒç”¨å¤–éƒ¨å‡½æ•°æˆ–è€…å¼•ç”¨å…¨å±€å˜é‡çš„æŒ‡ä»¤éƒ½éœ€è¦ä¿®æ”¹ã€‚å¦ä¸€æ–¹é¢è°ƒç”¨æœ¬åœ°å‡½æ•°çš„æŒ‡ä»¤åˆ™ä¸éœ€è¦ä¿®æ”¹ã€‚æ³¨æ„ï¼Œå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¸­å¹¶ä¸éœ€è¦é‡å®šä½ä¿¡æ¯ï¼Œå› æ­¤é€šå¸¸çœç•¥ï¼Œé™¤éä½¿ç”¨è€…æ˜¾å¼åœ°æŒ‡ç¤ºé“¾æ¥å™¨åŒ…å«è¿™äº›ä¿¡æ¯ã€‚ .rel.dataï¼šè¢«æ¨¡å—å®šä¹‰æˆ–å¼•ç”¨çš„ä»»ä½•å…¨å±€å˜é‡çš„ä¿¡æ¯ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä»»ä½•å·²åˆå§‹åŒ–å…¨å±€å˜é‡çš„åˆå§‹å€¼æ˜¯å…¨å±€å˜é‡æˆ–è€…å¤–éƒ¨å®šä¹‰å‡½æ•°çš„åœ°å€éƒ½éœ€è¦è¢«ä¿®æ”¹ã€‚ .strtabï¼šä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ï¼Œå…¶å†…å®¹åŒ…æ‹¬.symtabå’Œ.debugèŠ‚ä¸­çš„ç¬¦å·è¡¨ï¼Œä»¥åŠèŠ‚å¤´éƒ¨ä¸­çš„èŠ‚åå­—ã€‚å­—ç¬¦ä¸²è¡¨å°±æ˜¯ä»¥nullç»“å°¾çš„å­—ç¬¦ä¸²åºåˆ—ã€‚ .initå’Œ.finiä¿å­˜äº†è¿›ç¨‹åˆå§‹åŒ–å’Œç»“æŸæ‰€ç”¨çš„ä»£ç ï¼Œè¿™é€šå¸¸æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ çš„ã€‚ å››ã€readelf -sreadelf -s main.o åŠŸèƒ½ï¼šæŸ¥çœ‹ç¬¦å·è¡¨ï¼ŒValueçš„å€¼æ˜¯ç¬¦å·çš„åœ°å€ã€‚ 1234567891011121314Symbol table &#x27;.symtab&#x27; contains 12 entries: Num: Value Size Type Bind Vis Ndx Name 0: 0000000000000000 0 NOTYPE LOCAL DEFAULT UND 1: 0000000000000000 0 FILE LOCAL DEFAULT ABS main.c 2: 0000000000000000 0 SECTION LOCAL DEFAULT 1 3: 0000000000000000 0 SECTION LOCAL DEFAULT 3 4: 0000000000000000 0 SECTION LOCAL DEFAULT 4 5: 0000000000000000 0 SECTION LOCAL DEFAULT 6 6: 0000000000000000 0 SECTION LOCAL DEFAULT 7 7: 0000000000000000 0 SECTION LOCAL DEFAULT 5 8: 0000000000000000 8 OBJECT GLOBAL DEFAULT 3 array 9: 0000000000000000 33 FUNC GLOBAL DEFAULT 1 main 10: 0000000000000000 0 NOTYPE GLOBAL DEFAULT UND _GLOBAL_OFFSET_TABLE_ 11: 0000000000000000 0 NOTYPE GLOBAL DEFAULT UND sum ç¬¦å·è¡¨ä¿å­˜äº†ç¨‹åºå®ç°æˆ–ä½¿ç”¨çš„æ‰€æœ‰å…¨å±€å˜é‡å’Œå‡½æ•°ï¼Œå¦‚æœç¨‹åºå¼•ç”¨ä¸€ä¸ªè‡ªèº«ä»£ç æœªå®šä¹‰çš„ç¬¦å·ï¼Œåˆ™ç§°ä¹‹ä¸ºæœªå®šä¹‰ç¬¦å·ï¼Œè¿™ç±»å¼•ç”¨å¿…é¡»åœ¨é™æ€é“¾æ¥æœŸé—´ç”¨å…¶ä»–ç›®æ ‡æ¨¡å—æˆ–åº“è§£å†³ï¼Œæˆ–åœ¨åŠ è½½æ—¶é€šè¿‡åŠ¨æ€é“¾æ¥è§£å†³ã€‚","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"dm-verity","path":"/posts/dm-verity.html","content":"ä¸€ã€æŠ€æœ¯æ¨¡å—ç®€ä»‹ Dm-verity æ˜¯ device-mapper æ¶æ„ä¸‹çš„ä¸€ä¸ªç›®æ ‡è®¾å¤‡ç±»å‹ï¼Œ é€šè¿‡å®ƒæ¥ä¿éšœè®¾å¤‡æˆ–è€…è®¾å¤‡åˆ†åŒºçš„å®Œæ•´æ€§ã€‚ dm-verityé€šå¸¸ç”¨äºéªŒè¯é•œåƒçš„å®Œæ•´æ€§ã€‚æ¯”å¦‚å¸¸è§„çš„ç³»ç»Ÿå¯åŠ¨çš„å¯¹æ ¹æ–‡ä»¶ç³»ç»Ÿçš„éªŒç­¾ï¼Œè€—æ—¶å¾ˆé•¿ã€‚å¯ä»¥ä½¿ç”¨dm-verityæ›¿ä»£ï¼Œç”±äºdm-verityæ˜¯ä½¿ç”¨æ—¶æ‰è¿›è¡Œhashè®¡ç®—æ ¡éªŒï¼Œæ‰€ä»¥å¯¹å¯åŠ¨æ€§èƒ½çš„æé«˜æœ‰å¾ˆå¤§å¸®åŠ©ã€‚ Dm-verityç±»å‹çš„ç›®æ ‡è®¾å¤‡æœ‰ä¸¤ä¸ªåº•å±‚è®¾å¤‡ï¼Œä¸€ä¸ªæ˜¯æ•°æ®è®¾å¤‡(data device), æ˜¯ç”¨æ¥å­˜å‚¨å®é™…æ•°æ®çš„ï¼Œå¦ä¸€ä¸ªæ˜¯hashè®¾å¤‡(hash device), ç”¨æ¥å­˜å‚¨hashæ•°æ®çš„ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥æ ¡éªŒdata deviceæ•°æ®çš„å®Œæ•´æ€§çš„ã€‚ ç®€å•çš„æ¶æ„å›¾å¦‚ä¸‹ï¼š å›¾ä¸­æ˜ å°„è®¾å¤‡(Mapper Device)å’Œç›®æ ‡è®¾å¤‡(Target Device)æ˜¯ä¸€å¯¹ä¸€å…³ç³»ï¼Œå¯¹æ˜ å°„è®¾å¤‡çš„è¯»æ“ä½œè¢«æ˜ å°„æˆå¯¹ç›®æ ‡è®¾å¤‡çš„è¯»æ“ä½œï¼Œåœ¨ç›®æ ‡è®¾å¤‡ä¸­ï¼Œdm-verityåˆå°†è¯»æ“ä½œæ˜ å°„ä¸ºæ•°æ®è®¾å¤‡ï¼ˆData Deviceï¼‰çš„è¯»æ“ä½œã€‚ä½†æ˜¯åœ¨è¯»æ“ä½œçš„ç»“æŸå¤„ï¼Œdm-verityåŠ äº†ä¸€ä¸ªé¢å¤–çš„æ ¡éªŒæ“ä½œï¼Œå¯¹è¯»åˆ°çš„æ•°æ®è®¡ç®—ä¸€ä¸ªhashå€¼ï¼Œç”¨è¿™ä¸ªå“ˆå¸Œå€¼å’Œå­˜å‚¨åœ¨å“ˆå¸Œè®¾å¤‡(Hash Device) äºŒã€è®¾è®¡åŸç† å¯¹äºæœ¬æ–‡è¦ä»‹ç»çš„dm-verityåŠŸèƒ½æ¨¡å—ï¼Œç¬”è€…é€‰æ‹©åœ¨å½“å‰ç§»åŠ¨ç»ˆç«¯åº”ç”¨çš„è§’åº¦æ¥å±•å¼€è®²è§£ï¼Œä¹Ÿå°±æ˜¯Androidå¹³å°åœ¨dm-verityçš„åº”ç”¨ã€‚ Android ç«¯ä¸»è¦æ˜¯åœ¨é•œåƒå¯åŠ¨æ—¶éªŒè¯è¿™ä¸ªåŠŸèƒ½åœºæ™¯ä¸Šä½¿ç”¨åˆ°äº† dm-verity æŠ€æœ¯ï¼Œè¯¥æŠ€æœ¯å¯ä»¥å¯¹å—å­˜å‚¨è®¾å¤‡è¿›è¡Œå®Œæ•´æ€§æ£€æŸ¥ï¼Œæœ‰åŠ©äºé˜»æ­¢æŸäº›æ¶æ„ç¨‹åºå¯¹é•œåƒçš„ä¿®æ”¹ï¼Œæœ‰åŠ©äºAndroidç”¨æˆ·åœ¨å¯åŠ¨è®¾å¤‡æ—¶ç¡®è®¤è®¾å¤‡çŠ¶æ€ä¸ä¸Šæ¬¡ä½¿ç”¨æ—¶æ˜¯å¦ç›¸åŒã€‚åœ¨ç³»ç»Ÿé•œåƒ(æ¯”å¦‚ systemã€vendorç­‰)å¯åŠ¨æ—¶ä»¥åŠè¿è¡Œæ—¶å¯ä»¥å®æ—¶æ€§ç›‘æµ‹å½“å‰é•œåƒæ˜¯å¦è¢«ç¯¡æ”¹ã€‚ é€šè¿‡dm-verityæŠ€æœ¯ï¼Œå¯ä»¥ç¡®è®¤å—è®¾å¤‡å†…å®¹æ˜¯å¦è·Ÿé¢„æœŸä¸€è‡´ï¼Œå…·ä½“çš„å®ç°åŸç†æ˜¯åˆ©ç”¨å“ˆå¸Œæ ‘(hashtree)åšåˆ°çš„ã€‚ç”¨ä»¥ä¸‹å›¾æ¥å½¢è±¡è¯´æ˜ (å›¾æ¥è‡ªï¼šhttps://source.android.com/security/verifiedboot/dm-verity) ç®€å•è¯´æ˜ä¸€ä¸‹è¿™ä¸ªæ’å›¾èƒŒåçš„åŸç†ï¼š åœ¨ç¼–è¯‘(ä¸€èˆ¬åº”è¯¥æ˜¯è¿è¡Œopen)é˜¶æ®µï¼Œé¦–å…ˆä¼šå¯¹ç³»ç»Ÿé•œåƒ(æ¯”å¦‚system.imgã€vendor.img)æŒ‰ç…§æ¯4kå¤§å°è®¡ç®—å¯¹åº”hashï¼Œå°†è¿™äº›hashä¿¡æ¯å­˜èµ·æ¥ï¼Œå½¢æˆä¸Šé¢å›¾ä¸­çš„layer 0å±‚ï¼Œç´§æ¥ç€ä¼šå¯¹ layer 0 å±‚åŒæ ·æŒ‰ç…§æ¯4kå¤§å°è®¡ç®—hashï¼Œå¹¶å°†è¿™å±‚çš„hashä¿¡æ¯å­˜èµ·æ¥ï¼Œå½¢æˆlayer 1å±‚ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´è‡³æœ€åçš„hashä¿¡æ¯å­˜æ”¾åœ¨ä¸€ä¸ª4kå¤§å°çš„å—ä¸­(æœªå¡«æ»¡ä½¿ç”¨0å¡«å……)ï¼Œè¿™é‡Œè¾¹å­˜å‚¨çš„hashä¿¡æ¯ç§°ä¸º root hashã€‚ åœ¨è¿è¡Œé˜¶æ®µï¼Œå¯¹äºé•œåƒé‡Œçš„æ–‡ä»¶è¿›è¡Œè®¿é—®æ—¶ï¼Œæ“ä½œå¯¹åº”æ‰€åœ¨å—è®¾å¤‡çš„å­˜å‚¨åŒºåŸŸæ—¶ï¼Œä¼šè®¡ç®—å½“å‰å­˜å‚¨å—(æŒ‰4kå¤§å°)çš„hashå€¼ï¼Œç„¶åä¼šè·Ÿå­˜å‚¨åœ¨å“ˆå¸Œæ ‘ä¸Šå¯¹åº”å—çš„hashå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœåŒ¹é…ä¸ä¸Šï¼Œåˆ™è®¤ä¸ºå½“å‰è¯¥æ–‡ä»¶åœ¨åº•å±‚å­˜å‚¨è¢«ç¯¡æ”¹æˆ–æ˜¯æŸåäº†ã€‚ ä¸ºäº†æ›´å½¢è±¡çš„æè¿°ä¸‹é•œåƒè¿è¡Œæ—¶å¦‚ä½•åˆ©ç”¨å“ˆå¸Œæ ‘åšæ ¡éªŒçš„ï¼Œä¸‹é¢ä»¥ä¸€ä¸ª1Gå¤§å°çš„é•œåƒä¸ºä¾‹ï¼Œæ¥è¯´æ˜ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š æ ¹æ® hashtree çš„ç”Ÿæˆæ–¹å¼ï¼Œä»¥ 1G çš„é•œåƒä¸ºä¾‹ï¼š 1ï¼‰æŒ‰ç…§ 4K å¤§å°åˆ’åˆ†ï¼Œå°†1G å¤§å°çš„é•œåƒä¾é¡ºåºåˆ’åˆ†å¯å¾—åˆ° 262144 ä¸ª 4k å¤§å°çš„å— 2ï¼‰å¯¹è¿™ 262144 å—æ•°æ®å—è¿›è¡Œç¬¬ä¸€å±‚(Level 0) hash è®¡ç®—ï¼Œç”±äº SHA256(å…·ä½“çš„hashç®—æ³•å¯é…ç½®ï¼Œæ­¤ä¾‹ä»¥SHA256ä¸ºå‚è€ƒ) è®¡ç®—å‡ºæ¥çš„hashå€¼å  256 ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ª 4K çš„å—å¯ä»¥å­˜å‚¨ 128 ä¸ªhashå€¼ï¼Œæ‰€ä»¥å­˜å‚¨è¿™ 262144 å—æ•°æ®å—çš„hashå€¼éœ€è¦èŠ±è´¹ 2048 å— 3ï¼‰å¯¹ç¬¬ä¸€å±‚å­˜å‚¨ hash å€¼çš„æ•°æ®å—è¿›è¡Œç¬¬äºŒå±‚(Level 1) çš„ hash è®¡ç®—ï¼ŒåŒç†ï¼Œè®¡ç®—è¿™ 2048 å—hashæ•°æ®å—éœ€è¦èŠ±è´¹ 16 å— 4ï¼‰å¯¹ç¬¬äºŒå±‚å­˜å‚¨ hash å€¼çš„æ•°æ®å—è¿›è¡Œç¬¬ä¸‰å±‚(Level 2) çš„ hash è®¡ç®—ï¼Œç”±äºç¬¬äºŒå±‚çš„hashæ•°æ®å—å°äº128å—ï¼Œæ‰€ä»¥ç¬¬ä¸‰å±‚æ˜¯æœ€åä¸€å±‚ï¼Œç›´æ¥è®¡ç®—å¾—åˆ° root hash æ•°æ®å—(ä¸å¤Ÿ4Kå¤§å°è¡¥é½0)ã€‚ ç»†å¿ƒçš„è¯»è€…å¯èƒ½å·²ç»å‘ç°äº†ï¼ŒLevel 0 å±‚å…¶å®å·²ç»åŒ…å«äº†æ‰€æœ‰raw dataæ•°æ®å—çš„hashä¿¡æ¯äº†ï¼Œä¹Ÿå°±è¯´æ˜Level 0 å±‚å·²ç»å…·å¤‡å¯ä»¥éªŒè¯ raw data çš„èƒ½åŠ›äº†ï¼Œä¸ºä½•è¿˜éœ€è¦åœ¨ Level 0 çš„åŸºç¡€ä¸Šç»§ç»­ç®—hashç»„è£…ä¸‹ä¸€ä¸ª Level å±‚çº§å‘¢ï¼Ÿ è¿™é‡Œè¦å¼•å…¥ä¸€ä¸ªå®‰å…¨ç­–ç•¥è®¾è®¡é—®é¢˜ï¼Œé•œåƒraw dataæ•°æ®å—æ˜¯ç”±å¯¹åº”çš„hashä¿¡æ¯æ¥æ ¡éªŒä¿è¯çš„ï¼Œä¸ºäº†ä¿è¯é•œåƒraw dataæ˜¯æˆ‘ä»¬â€œæƒ³è¦çš„â€ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹ hash ä¿¡æ¯è¿›è¡Œåˆæ³•æ€§éªŒè¯ï¼Œç®€å•ç†è§£å°±æ˜¯è¦ç¡®è®¤è¿™ä¸ªhashä¿¡æ¯æ˜¯æˆ‘ä»¬â€œæƒ³è¦çš„â€ï¼Œ æ–¹æ³•å°±æ˜¯å¯¹è¿™ä¸ªhashä¿¡æ¯å†æ¬¡è®¡ç®—ä¸€æ¬¡hashå€¼ï¼Œè¿™é‡Œç§°ä¸º root hashï¼Œç„¶åæ·»åŠ ä¸€äº›ç±»ä¼¼äºç­¾åä¿æŠ¤å¹¶ä¿å­˜èµ·æ¥ï¼ˆé€šå¸¸åœ¨å®é™…å·¥ä½œä¸­ï¼Œåœ¨é•œåƒç¼–è¯‘é˜¶æ®µå°†root hashè®¡ç®—å‡ºæ¥ï¼Œä¿å­˜åœ¨é•œåƒçš„æŸä¸ªåœ°æ–¹ï¼Œé€šè¿‡cmsç­‰ç­¾åæ–¹å¼ä¿å­˜ï¼Œå¯åŠ¨é˜¶æ®µä¼šè¿›è¡ŒcmséªŒç­¾ä»¥ä¿è¯root_hashçš„æ­£ç¡®æ€§ï¼‰ï¼Œä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢ root hash è¢«éæ³•ç¯¡æ”¹ã€‚åœ¨ä¸€æ¬¡ raw data æ•°æ®å—çš„æ ¡éªŒè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¯¹ hash ä¿¡æ¯è®¡ç®—ä¸€æ¬¡ hashï¼Œç„¶åè·Ÿä¿å­˜çš„ root hash è¿›è¡Œæ¯”è¾ƒï¼ŒéªŒè¯äº† hash ä¿¡æ¯çš„åˆæ³•æ€§ä¹‹åï¼Œå†æ¥æ ¡éªŒå¯¹åº”çš„ raw data æ•°æ®å—ã€‚ æœ‰äº†ä»¥ä¸ŠèƒŒæ™¯ï¼Œå†å›åˆ°åˆšåˆšè¿™ä¸ªâ€œä¸ºä½•è¿˜éœ€è¦åœ¨ Level 0 çš„åŸºç¡€ä¸Šç»§ç»­ç®—hashç»„è£…ä¸‹ä¸€ä¸ª Level å±‚çº§â€çš„é—®é¢˜ï¼ŒæŒ‰ç…§ä¸Šé¢çš„å®‰å…¨ç­–ç•¥ï¼Œå¦‚æœ hash ä¿¡æ¯åªæœ‰ Level 0 ä¸€å±‚çš„è¯ï¼Œæ¥ä¸‹æ¥å¯¹ raw data æ•°æ®å—çš„æ ¡éªŒå°†ä¼šæ˜¯è¿™æ ·ï¼šæ¯æ“ä½œä¸€ä¸ªraw dataæ•°æ®å—ï¼Œéƒ½éœ€è¦è®¡ç®—ä¸€æ¬¡ Level 0 çš„ hash å€¼ï¼Œè·Ÿ root hash è¿›è¡Œæ¯”è¾ƒï¼ŒéªŒè¯åˆæ³•ä¹‹åå†å¯¹ raw data æ•°æ®å—è¿›è¡Œæ ¡éªŒã€‚æœ¬æ–‡ä¸­ä¸¾ä¾‹æ˜¯ 1G çš„é•œåƒï¼ŒLevel 0ç”¨æ¥ä¿å­˜ hash ä¿¡æ¯çš„æ•°æ®å—å·²ç»è¾¾åˆ° 2048 å—ï¼Œå¦‚æœå¯¹é¢å¯¹æ›´å¤§çš„é•œåƒï¼ŒLevel 0 æ‰€å çš„æ•°æ®å—ä¹Ÿä¼šæ›´å¤§ï¼Œå¦‚æœæ˜¯æŒ‰ç…§ä¸Šé¢çš„è®¡ç®—æ–¹æ³•ï¼Œå¯¹ raw data æ•°æ®å—çš„æ ¡éªŒæ•ˆç‡å°†ä¼šéå¸¸éå¸¸ä½ã€‚ ä½œä¸ºå¯¹æ¯”ï¼Œå“ˆå¸Œæ ‘æœºåˆ¶æ˜¯å¦‚ä½•ä½“ç°å‡ºæ•ˆç‡å‘¢ï¼Œä¸‹é¢ä»¥å…·ä½“æŸä¸€å— raw data æ•°æ®å—çš„è¯»å–è¿‡ç¨‹æ¥è¯´æ˜å…¶è®¾è®¡åŸç†ï¼š 1ï¼‰å‡è®¾ç›®å‰æ­£éœ€è¦è¯»å–ç¬¬ 200000 å—çš„æ•°æ®å—ï¼Œé€šè¿‡å‰é¢å“ˆå¸Œæ ‘çš„æ„é€ ï¼Œå¯ä»¥æ¯”è¾ƒå¿«é€Ÿçš„è®¡ç®—å‡ºåœ¨ Level 0 å±‚ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥å¯¹åº”è¿™ä¸ªæ•°æ®å—çš„hashå€¼å­˜å‚¨ä½ç½®ï¼Œé€šè¿‡å¯¹ 128 ç›¸é™¤ä»¥åŠæ±‚ä½™çš„æ–¹å¼å°±å¯ä»¥åˆ†åˆ«è®¡ç®—å‡ºè¯¥ hash å€¼å­˜å‚¨åœ¨å…·ä½“æŸä¸€å—(å—A)ä»¥åŠè¿™ä¸€å—ä¸Šçš„åç§»(åç§»A)ã€‚ 2ï¼‰ç¡®å®šäº† Level 0 å±‚çš„å…·ä½“å—Aåï¼Œåˆ©ç”¨ç›¸åŒçš„æ–¹å¼å¯ä»¥å¾—åˆ° Level 0 å—Aåœ¨ Level 1 å±‚å­˜å‚¨å…¶ hash å€¼çš„å—Bä½ç½®ä»¥åŠå—Bä¸Šçš„åç§»(åç§»B) 3ï¼‰åŒä¸Šè¿°åŸç†ï¼Œå¯ä»¥æœ€ç»ˆå®šä½åˆ° Level 1 å±‚å— B åœ¨ Level 2 ä¸Šçš„æ•°æ®å—(åªæœ‰ä¸€å—)ä¸Šåç§»(åç§»C) 4ï¼‰åœ¨è·å–åˆ°è¯¥æ•°æ®å—å¯¹åº”hashtreeå…³è”çš„å„ä¸ªå±‚çº§çš„å—ä»¥åŠåç§»åï¼Œæ¥ä¸‹æ¥å°±æ˜¯åšä¸€å±‚ä¸€å±‚çš„éªŒè¯ï¼š æ­¥éª¤1. ä¼˜å…ˆéªŒè¯çš„æ˜¯Level 2 ä¸­çš„æ•°æ®å—(åªæœ‰ä¸€ä¸ª4kçš„æ•°æ®å—)ï¼Œ è®¡ç®—è¿™ä¸ªæ•°æ®å—çš„hashï¼Œè·Ÿä¿å­˜çš„ root hashè¿›è¡Œæ¯”å¯¹ï¼ŒéªŒè¯Level 2çš„æ•°æ®å—å—æ˜¯å¦æ­£ç¡®ã€‚ æ­¥éª¤2. åœ¨Level 2ä¸­çš„æ•°æ®å—å¾—åˆ°éªŒè¯åï¼Œç”±ä¸Šé¢è®¡ç®—åˆ°çš„Level 2ä¸­æ•°æ®å—ä¸Šçš„åç§» C å»æ ¡éªŒ Level 1 å±‚çš„ B å—ã€‚ æ­¥éª¤3. åœ¨ Level 1 å±‚çš„ B æ•°æ®å—å¾—åˆ°éªŒè¯åï¼Œç”±ä¸Šé¢è®¡ç®—åˆ°çš„ Level 1 ä¸­ B æ•°æ®å—ä¸Šçš„åç§»Bå»éªŒè¯ Level 0 å±‚çš„ Aå—ã€‚ æ­¥éª¤4. Level 0å±‚ä¸­çš„ A æ•°æ®å—å¾—åˆ°éªŒè¯åï¼Œæœ€ç»ˆä¼šç”± Level 0 å±‚çš„åç§»Aæ¥æ ¡éªŒæœ€ç»ˆçš„ raw dataæ•°æ®å—(ç¬¬ 200000 å—). å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨å“ˆå¸Œæ ‘çš„è®¾è®¡ä¹‹åï¼Œå¯¹æ•°æ®å—éªŒè¯æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠåˆ°çš„æ•°æ®å—hashè®¡ç®—åªæœ‰3å—(æœ‰Nå±‚å°±è®¡ç®—Nå—)ï¼Œç›¸æ¯”äºä¸€å±‚æ ¡éªŒæ¨¡å¼ï¼Œæ•ˆç‡è¦é«˜å¾ˆå¤šã€‚ ä¸‰ã€åº”ç”¨å±‚é¢ è¯»è€…åˆ°ç›®å‰ä¸ºæ­¢åº”è¯¥å¤§è‡´äº†è§£åˆ°äº†ç§»åŠ¨ç»ˆç«¯åœ¨é•œåƒå®Œæ•´æ€§æ ¡éªŒä¸Šç›¸å…³çš„è®¾è®¡åŸç†ï¼Œæ¥ä¸‹æ¥ä¼šä»åº”ç”¨ç«¯å±‚é¢æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ dm-verity åº•å±‚æä¾›çš„æ¥å£æ¥åˆå§‹åŒ– dm è®¾å¤‡ï¼Œå¹¶ä¸ºåç»­å®æ—¶æ ¡éªŒåšå¥½å‡†å¤‡ï¼Œå†…æ ¸ç»å¤§å¤šæ•°åŠŸèƒ½æ¨¡å—å­˜åœ¨çš„æ„ä¹‰éƒ½è¦é è·Ÿåº”ç”¨ç«¯çš„äº¤äº’æ¥ä½“ç°ï¼Œä½œä¸ºå¯¹å†…æ ¸æŸä¸ªæ¨¡å—çš„ç ”ç©¶ï¼Œåˆæ­¥ä»åº”ç”¨å±‚å‡ºå‘ä¸ä¹æ˜¯ä¸€ä¸ªå¥½åŠæ³•ã€‚ é€šå¸¸ç³»ç»Ÿå¯åŠ¨é˜¶æ®µï¼Œä½¿ç”¨veritysetupå·¥å…·æŒ‡å®šdata deviceå’Œhash deviceï¼Œä»¥åŠæŒ‡å®šçš„root hashå€¼ï¼Œhash deviceçš„å…·ä½“ä½ç½®ï¼Œhash deviceé€šå¸¸ä½äºdata deviceçš„åé¢ä¸€éƒ¨åˆ†ã€‚é€šè¿‡veritysetupå·¥å…·æ‰§è¡Œåï¼Œä¼šç”Ÿæˆdmè®¾å¤‡ï¼Œå¦‚æˆ‘ä»¬åŸæ¥ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿä¸º&#x2F;dev&#x2F;sda3ï¼Œåˆ™æ­¤æ—¶å¯ä»¥ç”Ÿæˆä¸€ä¸ªdmè®¾å¤‡ä¸ºsda3-dmï¼Œåç»­é€šè¿‡mountæŒ‚è½½sda3-dmåˆ°&#x2F;sysrootå³å¯å®ç°æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œåç»­è¯»å–æ ¹æ–‡ä»¶ç³»ç»Ÿæ•°æ®ï¼Œå‡ä¼šé€šè¿‡sda3-dmè®¾å¤‡ä¸­è½¬ï¼Œé€šè¿‡IOå®šå‘æ˜ å°„è®¿é—®&#x2F;dev&#x2F;sda3ï¼Œå¹¶è¿›è¡Œhashæ ¡éªŒ å¦‚ä¸‹ä¸ºveritysetupåº”ç”¨å±‚çš„3ä¸ªå¸¸è§„æ­¥éª¤ï¼š æ­¥éª¤ä¸€. Create dm device åˆ›å»º dm è®¾å¤‡ä¸»è¦æœ‰å¦‚ä¸‹å°æ­¥éª¤ï¼š open &#x2F;dev&#x2F;device-mapper è®¾å¤‡èŠ‚ç‚¹ ä¼ å…¥é€»è¾‘åˆ†åŒºnameã€éšæœºç”Ÿæˆçš„uuidå‚æ•°ï¼Œè°ƒç”¨ DM_DEV_CREATE ioctl å‘½ä»¤ æ­¥éª¤äºŒ. Load verity table è¿™é‡Œéœ€è¦å¼•å…¥ä¸€ä¸ª verity table çš„æ¦‚å¿µï¼Œå…ˆç®€å•ä»‹ç»ä»¥ä¸‹ verity table æ‰€åŒ…å«çš„å†…å®¹ï¼š 1ï¼‰Verity target version(verity target ç‰ˆæœ¬å·) 2ï¼‰Data block device(å­˜å‚¨å®é™…å¾…æ ¡éªŒæ•°æ®çš„å—è®¾å¤‡) 3ï¼‰Hash block device(å­˜å‚¨æ ¡éªŒä½¿ç”¨åˆ°hashçš„å—è®¾å¤‡ï¼Œä¸€èˆ¬æƒ…å†µè·Ÿdata block deviceæ˜¯åŒä¸€ä¸ª) 4ï¼‰Data block size(æ•°æ®å—è®¾å¤‡çš„æ¯å—å­˜å‚¨size) 5ï¼‰Hash block sizeï¼ˆhashå—è®¾å¤‡çš„æ¯å—å­˜å‚¨sizeï¼‰ 6ï¼‰Num data block(æ•°æ®å—è®¾å¤‡å ç”¨çš„å—æ•°é‡) 7ï¼‰Hash start block(hashè®¾å¤‡åœ¨å­˜å‚¨è®¾å¤‡çš„èµ·å§‹ä½ç½®) 8ï¼‰Hash algo(hashç®—æ³•) 9ï¼‰root digest(å¯¹åº”ä¸Šé¢è¯´çš„ root hash) 10ï¼‰Salt(ç”¨äºè®¡ç®—hashçš„ç›å€¼) è¿™äº›ä¿¡æ¯ä¸»è¦æ˜¯è·Ÿæœ€ç»ˆæ•°æ®å—åœ¨æ ¡éªŒè®¡ç®—è¿‡ç¨‹ä¸­ä¼šè¢«ä½¿ç”¨åˆ°çš„ï¼Œæ¯”å¦‚è¯´ hash è®¾å¤‡çš„èµ·å§‹ä½ç½®ã€hashç®—æ³•ã€root hashã€saltï¼Œè¿™äº›éƒ½åœ¨å®é™…è¿è¡Œæ—¶æ ¡éªŒæ•°æ®å—æ—¶ä¼šç”¨åˆ°ï¼Œè¿™äº›ä¿¡æ¯æ˜¯å­˜å‚¨æ˜¯é•œåƒçš„å›ºå®šä½ç½®ä¸Šï¼Œè¿™äº›ä¿¡æ¯åœ¨ç¼–è¯‘é˜¶æ®µæ„å»ºé•œåƒçš„æ—¶å€™å°±å·²ç»è®¡ç®—å¥½çš„ï¼Œå¹¶å­˜å‚¨åœ¨é•œåƒçš„å›ºå®šä½ç½®ã€‚ Verity table åˆå§‹åŒ–ä»£ç å…·ä½“å¦‚ä¸‹ï¼š ä¸Šå±‚é€šè¿‡ä»é•œåƒå›ºå®šä½ç½®è·å–åˆ°ä¿¡æ¯å¹¶åˆå§‹åŒ–å¥½ verity tableï¼Œ é€šè¿‡è°ƒç”¨DM_TABLE_LOAD Ioctl å‘½ä»¤å°† verity table ä¼ é€’è‡³kernelã€‚ æ­¥éª¤ä¸‰. Active dm device è°ƒç”¨DM_DEV_SUSPEND ioctl æŒ‡ä»¤æ¿€æ´» dm deviceï¼Œå¯¹åº”åº•å±‚ï¼Œè¯¥ cmd å¯¹åº” suspend &amp; resumeçš„å®ç°ï¼Œå¦‚æœä¸è®¾ç½® DM_SUSPEND_FLAG æ ‡å¿—ä½ï¼Œé»˜è®¤èµ° resume æµç¨‹ã€‚ åº”ç”¨ç«¯åœ¨å®ç°ä¸Šæ¯”è¾ƒç®€å•ï¼Œä¸»è¦é€šè¿‡ create -&gt; load verity table -&gt; active dm device çš„æµç¨‹å®Œæˆäº†å¯¹dmè®¾å¤‡çš„åˆ›å»ºã€verity tableçš„è¯»å–ä»¥åŠä¼ é€’ä»¥åŠdmè®¾å¤‡çš„æ¿€æ´»ï¼Œä¸ºåç»­å®æ—¶è¿›è¡Œçš„æ•°æ®å—æ ¡éªŒåšå¥½äº†åˆå§‹åŒ–å·¥ä½œã€‚ å››ã€å†…æ ¸å±‚é¢ æœ‰äº†ä»¥ä¸Šåº”ç”¨å±‚é¢çš„æµç¨‹è®²è§£ï¼Œé‚£å¯¹åº”å†…æ ¸ï¼Œè‡ªç„¶è€Œç„¶å°±æ˜¯å¯¹æ¯ä¸€æ­¥åº”ç”¨ç«¯çš„ç³»ç»Ÿè°ƒç”¨åšå¯¹åº”çš„å†…æ ¸å®ç°åšè®²è§£ã€‚ ç›¸åº”çš„ï¼Œå†…æ ¸å±‚é¢ä¹Ÿæœ‰ä»¥ä¸‹3ä¸ªæ­¥éª¤ï¼š æ­¥éª¤ä¸€. dev_create å¯¹åº”åº”ç”¨ç«¯çš„DM_DEV_CREATE ioctl cmdï¼Œkernelç«¯çš„å¤§è‡´å®ç°å¦‚ä¸‹ï¼š è¿™éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼š 1). æ£€æµ‹ä¼ å…¥å‚æ•°çš„partition nameæ˜¯å¦åˆæ³• 2). å¼€å§‹å°è¯•åˆ†é…å†…å­˜åˆå§‹åŒ– mapped device ç»“æ„ä½“ä»¥åŠåˆ†é…è®¾å¤‡minorå·ï¼ˆæœ€ç»ˆç”¨äº dm è®¾å¤‡çš„è®¾å¤‡å·ï¼Œæ¯”å¦‚ dm-1ï¼‰ï¼Œä½¿ç”¨å†…æ ¸æä¾›çš„blk_queue_make_requestå‡½æ•°æ³¨å†Œè¯¥mapped deviceå¯¹åº”çš„è¯·æ±‚é˜Ÿåˆ—dm_make_request, è¯¥è¯·æ±‚é˜Ÿåˆ—æœ€ç»ˆä¼šåœ¨IOé‡å®šå‘ä¸­è¢«ä½¿ç”¨åˆ°ã€‚å¹¶å°†è¯¥mapped deviceä½œä¸ºç£ç›˜å—è®¾å¤‡æ³¨å†Œåˆ°å†…æ ¸ä¸­ã€‚ 3). å°†åˆ›å»ºå¥½çš„mapped deviceæ’å…¥åˆ°ä¸€ä¸ªå…¨å±€hashè¡¨ä¸­ï¼Œè¯¥è¡¨ä¸­ä¿å­˜äº†å†…æ ¸ä¸­å½“å‰åˆ›å»ºçš„æ‰€æœ‰mapped deviceã€‚ æ­¥éª¤äºŒ. dm_ctl_ioctl(DM_TABLE_LOAD_CMD(table_load)) å¯¹åº”åº”ç”¨ç«¯çš„DM_TABLE_LOAD ioctl cmdï¼Œkernelç«¯çš„å¤§è‡´å®ç°å¯çœ‹ä¸‹é¢çš„æ€ç»´å¯¼å›¾ï¼š æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ­¥éª¤ä¸»è¦æ˜¯æ ¹æ®å…¥å‚åˆå§‹åŒ–ç›¸åº”çš„dm_tableã€dm_targetç»“æ„ï¼Œå¹¶ä¸”æ ¹æ®å‚æ•°æ‰€æŒ‡å®šçš„targetç±»å‹ï¼Œè°ƒç”¨ç›¸åº”çš„targetç±»å‹çš„æ„å»ºå‡½æ•°ctråœ¨å†…å­˜ä¸­æ„å»ºtarget deviceï¼Œ åœ¨ç»“æ„ä¸Šå½¢æˆ dm_table â€“&gt; dm_target â€“&gt; target type â€“&gt; target device çš„é“¾è·¯ç»“æ„ã€‚ æ­¥éª¤ä¸‰. dm_ctl_ioctl(DM_DEV_SUSPEND_CMD(dev_suspend)) å¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸€ä¸ªæ­¥éª¤ä¸»è¦æ˜¯å»ºç«‹ mapped device ä¸ dm_table çš„å…³è”ã€‚ é€šè¿‡ä»¥ä¸Šå‡ ä¸ªæ­¥éª¤ï¼Œåœ¨å†…æ ¸ä¸­å°±å»ºç«‹ä¸€ä¸ªå¯ä»¥æä¾›ç»™ç”¨æˆ·ä½¿ç”¨çš„mapped deviceé€»è¾‘å—è®¾å¤‡ ç»¼ä¸Šæ¶‰åŠåˆ°äº†å‡ ä¸ªå…³é”®çš„æ•°æ®ç»“æ„ï¼š mapped deviceã€dm_tableã€dm_targetã€target_typeã€target device(ä»¥dm-verityä¸ºä¾‹) å…¶å®è¿™å‡ ä¸ªæ­¥éª¤ä¸»è¦æ˜¯å¯¹ä¸Šè¿°æ•°æ®ç»“æ„è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸”æ›´é‡è¦æ˜¯äº’ç›¸å»ºç«‹äº†å…³è”å…³ç³»ã€‚ä»–ä»¬ä¹‹é—´çš„å…³è”å…³ç³»å¦‚ä¸‹ï¼š å†…æ ¸ç»è¿‡äº†è¿™3ä¸ªæ­¥éª¤ï¼Œä¸€æ–¹é¢æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥æä¾›ç»™åº”ç”¨ç«¯ä½¿ç”¨çš„ mapped device é€»è¾‘å—è®¾å¤‡ï¼Œå¦ä¸€æ–¹é¢æ˜¯å†…éƒ¨å»ºç«‹äº† mapped device - target device çš„è”ç³»ï¼Œ åº”ç”¨å±‚å¯ä»¥é€šè¿‡å¯¹ mapped device è¿›è¡Œç­–ç•¥é€»è¾‘æ“ä½œï¼Œæœ€ç»ˆä¼šé€šè¿‡ mapped device - target device çš„è”ç³»ä½œç”¨åˆ° å¯¹åº”çš„target device ä¸Šã€‚ äº”ã€æ ¸å¿ƒæ•°æ®æµ åœ¨ä¸Šé¢ä»‹ç»äº†dm-verityçš„è®¾è®¡åŸç†ã€åº”ç”¨å±‚é¢ä»¥åŠå†…æ ¸å±‚é¢çš„å®ç°ä¹‹åï¼Œè¯»è€…å¯èƒ½æ¯”è¾ƒå…³å¿ƒæ•´ä¸ªé“¾è·¯çš„æ•°æ®æµï¼Œæˆ–è€…è¯´é•œåƒåœ¨æ ¡éªŒé“¾è·¯å…·ä½“æµç¨‹æ˜¯å¦‚ä½•çš„ï¼Œæ¥ä¸‹æ¥ä»¥ä¸‹ä¸»è¦æ˜¯å›´ç»•ç€è®¿é—®é•œåƒæ–‡ä»¶æ—¶çš„IOæµæ˜¯å¦‚ä½•çš„ã€‚ ä¸Šé¢è¯´åˆ°ï¼Œåº”ç”¨å±‚åœ¨ç»è¿‡ create -&gt; load verity table -&gt; active dm device çš„æµç¨‹å®Œæˆäº†dmå—è®¾å¤‡çš„åˆå§‹åŒ–å·¥ä½œï¼Œä¹‹ååº”ç”¨å±‚ä¼šå¯¹è¯¥é€»è¾‘å—è®¾å¤‡è¿›è¡Œæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼Œåœ¨æŒ‚è½½çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è®¿é—®åˆ°å®é™…å­˜å‚¨è®¾å¤‡(è¯»å–æ–‡ä»¶ç³»ç»Ÿçš„super blockç­‰)ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å°±éœ€è¦é€è¿‡è¿™ä¸ªé€»è¾‘å—è®¾å¤‡ï¼Œæœ€ç»ˆæ“ä½œåˆ°ä¸å…¶å…³è”çš„target deviceã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ å¯¹å—è®¾å¤‡çš„IOè¯·æ±‚ä¼šä»é€»è¾‘è®¾å¤‡mapped deviceè½¬å‘ç›¸åº”çš„target deviceä¸Šï¼Œå¹¶ä¸”ä¼šæ ¹æ®å¯¹åº”target_typeæè¿°çš„IOå¤„ç†è§„åˆ™å¯¹IOè¯·æ±‚è¿›è¡Œå¤„ç†ã€‚ä»¥æœ¬æ–‡è®¨è®ºçš„ dm-verity ç±»å‹çš„ target device æ¥è¯´ï¼Œå¯¹äº mapped device è½¬å‘è¿‡æ¥çš„IOï¼Œä¼šåœ¨ hashtree é‡Œæ‰¾åˆ°è¯¥ IO data å¯¹åº”çš„ hash æ•°æ®ï¼Œå¹¶è¿›è¡Œæ¯”è¾ƒï¼Œå®Œæˆæ ¡éªŒï¼Œè¿”å›æ­¤æ¬¡çš„æ ¡éªŒç»“æœå¹¶ç»“æŸæœ¬æ¬¡IOè¯·æ±‚ã€‚ åŒæ—¶dm-verityé€šå¸¸æœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡ä¸Šè¿°è¯´çš„veritysetupå·¥å…·æˆ–è‡ªç ”å·¥å…·æŒ‡å®šï¼Œä¸¤ç§æ¨¡å¼ä¸ºEIOæ¨¡å¼å’ŒLogginæ¨¡å¼ï¼ŒEIOæ¨¡å¼åœ¨æ ¡éªŒåˆ°æ•°æ®å—çš„hashä¸å¯¹æ—¶ç›´æ¥è¿”å›é”™è¯¯ï¼Œè€ŒLogginæ¨¡å¼åœ¨æ ¡éªŒé”™è¯¯è¿˜å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼ŒLogginä¸€èˆ¬ä¸ºdebugä½¿ç”¨","tags":["dm-verity"],"categories":["dm-verity"]},{"title":"98ã€éªŒè¯äºŒå‰æœç´¢æ ‘","path":"/posts/98ã€éªŒè¯äºŒå‰æœç´¢æ ‘.html","content":"ä¸€ã€é¢˜ç›®æè¿°ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚ æœ‰æ•ˆ äºŒå‰æœç´¢æ ‘å®šä¹‰å¦‚ä¸‹ï¼š èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å« å°äº å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å« å¤§äº å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼šroot &#x3D; [2,1,3]è¾“å‡ºï¼štrue ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼šroot &#x3D; [5,1,4,null,null,3,6]è¾“å‡ºï¼šfalseè§£é‡Šï¼šæ ¹èŠ‚ç‚¹çš„å€¼æ˜¯ 5 ï¼Œä½†æ˜¯å³å­èŠ‚ç‚¹çš„å€¼æ˜¯ 4 ã€‚ æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®èŒƒå›´åœ¨[1, 10^4] å†…-2^31 &lt;&#x3D; Node.val &lt;&#x3D; 2^31 - 1 äºŒã€Cè¯­è¨€ä»£ç æ ¹æ®äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ï¼ŒäºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†åï¼Œç»“æœä¸ºæœ‰åºä¸”ä»å°åˆ°å¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬éå†äºŒå‰æ ‘ï¼Œå°†ç»“æœä¿å­˜åˆ°æ•°ç»„ä¸­ï¼Œç„¶ååˆ¤æ–­æ•°ç»„æ˜¯å¦æœ‰åºå³å¯ã€‚ 12345678910111213141516171819202122232425262728293031323334/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * struct TreeNode *left; * struct TreeNode *right; * &#125;; */bool isValidBST(struct TreeNode* root) &#123; int returnSize = 0; int *res = (int *)malloc(10000 * sizeof(int)); if (res == NULL) &#123; return false; &#125; traverse(root, res, &amp;returnSize); for (int i = 0; i &lt; returnSize - 1; i++) &#123; if (res[i] &gt;= res[i + 1]) &#123; return false; &#125; &#125; return true;&#125;void traverse(struct TreeNode* root, int *res, int *returnSize) &#123; if (root == NULL) &#123; return; &#125; traverse(root-&gt;left, res, returnSize); res[*returnSize] = root-&gt;val; (*returnSize)++; traverse(root-&gt;right, res, returnSize);&#125;","tags":["äºŒå‰æ ‘"],"categories":["äºŒå‰æ ‘"]},{"title":"96ã€ä¸åŒçš„äºŒå‰æœç´¢æ ‘","path":"/posts/96ã€ä¸åŒçš„äºŒå‰æœç´¢æ ‘.html","content":"ä¸€ã€é¢˜ç›®æè¿°ç»™ä½ ä¸€ä¸ªæ•´æ•° n ï¼Œæ±‚æ°ç”± n ä¸ªèŠ‚ç‚¹ç»„æˆä¸”èŠ‚ç‚¹å€¼ä» 1 åˆ° n äº’ä¸ç›¸åŒçš„ äºŒå‰æœç´¢æ ‘ æœ‰å¤šå°‘ç§ï¼Ÿè¿”å›æ»¡è¶³é¢˜æ„çš„äºŒå‰æœç´¢æ ‘çš„ç§æ•°ã€‚ ç¤ºä¾‹ 1ï¼šè¾“å…¥ï¼šn &#x3D; 3è¾“å‡ºï¼š5ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼šn &#x3D; 1è¾“å‡ºï¼š1 æç¤ºï¼š1 &lt;&#x3D; n &lt;&#x3D; 19 äºŒã€C++ä»£ç è§£æ³•ä¸€ï¼š è¿™ç§é¢˜ç›®ï¼Œæˆ‘ä¸€èˆ¬æ˜¯è®¡ç®—å‡ºå‰é¢å¤šä¸ªä¾‹å­ï¼Œæ ¹æ®è®¡ç®—å‡ºæ¥çš„å¤šä¸ªä¾‹å­ï¼Œè¿›è¡Œå½’çº³æ€»ç»“ï¼Œåˆ©ç”¨æ•°å­¦å½’çº³æ³•ï¼Œæ‰¾è§„å¾‹ï¼Œæ¨ç®—å‡ºç¬¬nä¸ªçš„ç»“æœï¼Œç„¶ååˆ©ç”¨ç±»ä¼¼å¦‚ä¸‹æ–¹æ³•ï¼Œæ ¹æ®ç¬¬0ä¸ªï¼Œç¬¬1ä¸ªï¼Œç¬¬2ä¸ªâ€¦â€¦ï¼Œä»¥æ­¤è®¡ç®—å‡ºç¬¬nä¸ªã€‚ n&#x3D;1,æœç´¢äºŒå‰æ ‘ç§æ•°ï¼š1 ,åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸º1 n&#x3D;2,æœç´¢äºŒå‰æ ‘ç§æ•°ï¼š2 ,åªæœ‰äºŒä¸ªèŠ‚ç‚¹ï¼Œè¦ä¹ˆ1ä¸ºæ ¹èŠ‚ç‚¹ï¼Œè¦ä¹ˆ2ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç»“æœä¸º2 n&#x3D;3,æœç´¢äºŒå‰æ ‘ç§æ•°ï¼š5 ,æœ‰ä¸‰ä¸ªèŠ‚ç‚¹(1)ã€1ä¸ºæ ¹èŠ‚ç‚¹ï¼Œå¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå‡å¤§äº1ï¼Œæ ¹æ®äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ï¼Œå¤§äºæ ¹èŠ‚ç‚¹çš„æ•°å­—ï¼Œå³å¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹2å’Œ3åªèƒ½ä½œä¸ºå³å­æ ‘ï¼Œå†ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œæ„æˆäºŒå‰æœç´¢æ ‘ï¼Œæ­¤æ—¶å¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹æ„æˆç»“æœç­‰åŒäºn&#x3D;2æ—¶çš„ç»“æœï¼Œä¸º2(2)ã€2ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ ¹æ®äºŒå‰æœç´¢æ ‘æ€§è´¨ï¼Œ1åªèƒ½ä½œä¸ºå·¦å­æ ‘ï¼Œ3åªèƒ½ä½œä¸ºå³å­æ ‘ï¼Œåªæœ‰ä¸€ç§æƒ…å†µï¼Œæ‰€ä»¥ç»“æœä¸º1(3)ã€3ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ ¹æ®äºŒå‰æœç´¢æ ‘æ€§è´¨ï¼Œ1å’Œ2åªèƒ½ä½œä¸ºå·¦å­æ ‘,1å’Œ2ä½œä¸ºä¸€ä¸ªæ•´ä½“å†æ„æˆäºŒå‰æœç´¢æ ‘ï¼Œæ­¤æ—¶ä¸(1)ä¸€æ ·ï¼Œç»“æœç­‰äºn&#x3D;2æ—¶çš„ç»“æœä¸º2æ‰€ä»¥n&#x3D;3æ—¶ï¼Œæœç´¢äºŒå‰æ ‘ç§æ•°ä¸º2+1+2&#x3D;5 n&#x3D;4,æœç´¢äºŒå‰æ ‘ç§æ•°ï¼š14(1)ã€1ä¸ºæ ¹èŠ‚ç‚¹ï¼Œå¦å¤–ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå‡å¤§äº1ï¼Œå¦å¤–èŠ‚ç‚¹åªèƒ½ä½œä¸ºå³å­æ ‘ï¼Œå…¶ä»–èŠ‚ç‚¹å†ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œæ„æˆäºŒå‰æœç´¢æ ‘ï¼Œæ­¤æ—¶å¦å¤–ä¸‰ä¸ªèŠ‚ç‚¹æ„æˆç»“æœç­‰åŒäºn&#x3D;3æ—¶çš„ç»“æœï¼Œä¸º5(2)ã€2ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ ¹æ®äºŒå‰æœç´¢æ ‘æ€§è´¨ï¼Œ1åªèƒ½ä½œä¸ºå·¦å­æ ‘ï¼Œ3,4åªèƒ½ä½œä¸ºå³å­æ ‘ï¼Œæ­¤æ—¶è¿›è¡Œæ’åˆ—ç»„åˆï¼Œå³ä¸ºn&#x3D;1å’Œn&#x3D;2çš„ç»“æœç›¸ä¹˜ï¼Œä¸º2(3)ã€3ä¸ºæ ¹èŠ‚ç‚¹ï¼Œç»“æœç­‰äº(2)æ—¶çš„ç»“æœä¸º2(3)ã€4ä¸ºæ ¹èŠ‚ç‚¹ï¼Œç»“æœç­‰äº(1)æ—¶çš„ç»“æœä¸º5 n&#x3D;5,æœç´¢äºŒå‰æ ‘ç§æ•°ï¼š42â€¦â€¦æ‰€ä»¥æˆ‘æ€»ç»“è§„å¾‹ä¸ºå½“è¾“å…¥æ•°å­—ä¸º100,ç»“æœåº”è¯¥ä¸ºn=0 * n=99 + n=1 * n=98 + â€¦â€¦ + n=99 * n=0, n&#x3D;0æ—¶ä¸º1 1234567891011121314151617181920212223242526class Solution &#123;public: int numTrees(int n) &#123; int i = 0; int res = 0; if (n == 0) &#123; return 1; &#125; if (n == 1) &#123; return 1; &#125; if (n == 2) &#123; return 2; &#125; if (n == 3) &#123; return 5; &#125; for (i = 0; i &lt; n; ++i) &#123; res += (numTrees(i) * numTrees(n- 1 - i)); &#125; return res; &#125;&#125;; è§£æ³•äºŒï¼šè§£æ³•ä¸€æ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥åœ¨è§£æ³•ä¸€åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œå¯ä»¥æŠŠä¸­é—´çš„ç»“æœéƒ½ä¿å­˜åˆ°æ•°ç»„numsä¸­ï¼Œåç»­å°±ä¸éœ€è¦æ¯æ¬¡éƒ½éå†æ‰æ‹¿åˆ°ç»“æœäº†ã€‚ 1234567891011121314151617181920212223class Solution &#123;public: int numTrees(int n) &#123; vector&lt;int&gt; nums(20, 0); nums[0] = 1; traverse(n, nums); return nums[n]; &#125; int traverse(int n, vector&lt;int&gt; &amp;nums) &#123; int res = 0; int i = 0; if (nums[n] != 0) &#123; return nums[n]; &#125; for (i = 0; i &lt; n; ++i) &#123; nums[n] += (traverse(i, nums) * traverse(n- 1 - i, nums)); &#125; return nums[n]; &#125;&#125;; è§£æ³•3ï¼šåŠ¨æ€è§„åˆ’ï¼Œåç»­å†å†™å…·ä½“æ€è·¯å§ï¼š 123456789101112class Solution &#123;public: int numTrees(int n) &#123; // äºŒå‰æœç´¢æ•°çš„ç‰¹å¾ï¼Œå·¦å­æ ‘å°äºæ ¹ï¼Œå³å­æ ‘å¤§äºæ ¹ vector&lt;int&gt; dp(n+1, 0); dp[0]=1; // dp[0]åˆå§‹åŒ–ä¸º1 for(int i=1; i&lt;=n; i++) // ä»1...nçš„äºŒå‰æœç´¢æ•°æ•°ç›® for(int j=1; j&lt;=i; j++) // é€æ­¥é€‰ç”¨1...nä½œä¸ºæ ¹èŠ‚ç‚¹ dp[i]+=dp[j-1]*dp[i-j]; // å·¦ä¾§j-1ä¸ªæ•°ï¼Œå³ä¾§i-jä¸ªæ•° return dp[n]; &#125;&#125;;","tags":["äºŒå‰æ ‘"],"categories":["äºŒå‰æ ‘"]},{"title":"94ã€äºŒå‰æ ‘çš„ä¸­åºéå†","path":"/posts/94ã€äºŒå‰æ ‘çš„ä¸­åºéå†.html","content":"ä¸€ã€é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹rootï¼Œè¿”å›å®ƒçš„ä¸­åºéå† ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼šroot &#x3D; [1,null,2,3]è¾“å‡ºï¼š[1,3,2]ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼šroot &#x3D; []è¾“å‡ºï¼š[]ç¤ºä¾‹ 3ï¼š è¾“å…¥ï¼šroot &#x3D; [1]è¾“å‡ºï¼š[1] æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [0, 100] å†…-100 &lt;&#x3D; Node.val &lt;&#x3D; 100 è¿›é˜¶: é€’å½’ç®—æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥é€šè¿‡è¿­ä»£ç®—æ³•å®Œæˆå—ï¼Ÿ äºŒã€Cè¯­è¨€é¢˜è§£é€’å½’ç®—æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦æŒ‰ç…§å·¦å³æ ¹çš„é¡ºåºé€’å½’å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼šä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œleetcodeä¸­å°½é‡æœ€å¥½ä¸è¦ä½¿ç”¨å…¨å±€å˜é‡å§ï¼Œå› ä¸ºleetcodeç½‘ç«™çš„é¢˜ç›®ï¼Œæ‰€æœ‰çš„ç”¨ä¾‹æ˜¯å…±äº«å…¨å±€å˜é‡çš„ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªç”¨ä¾‹æ‰§è¡Œå®Œåï¼Œç¬¬äºŒä¸ªç”¨ä¾‹ä¼šç»§æ‰¿ç¬¬ä¸€ä¸ªç”¨ä¾‹æ‰§è¡Œåçš„å…¨å±€å˜é‡çš„å€¼ï¼Œå¯¼è‡´åç»­çš„ç”¨ä¾‹æ‰§è¡Œå¤±è´¥ 123456789101112131415161718192021222324252627282930313233/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * struct TreeNode *left; * struct TreeNode *right; * &#125;; *//** * Note: The returned array must be malloced, assume caller calls free(). */int* inorderTraversal(struct TreeNode* root, int* returnSize) &#123; int* res = (int *)malloc(100 * sizeof(int)); if (res == NULL) &#123; return NULL; &#125; *returnSize = 0; traverse(root, res, returnSize); return res;&#125;void traverse(struct TreeNode* root, int* res, int* returnSize)&#123; if (root == NULL) &#123; return; &#125; traverse(root-&gt;left, res, returnSize); res[*returnSize] = root-&gt;val; (*returnSize)++; traverse(root-&gt;right, res, returnSize);&#125; è¿­ä»£æ–¹æ³•ï¼š ä¸‰ã€C++é¢˜è§£é€’å½’æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125; * TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125; * TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) &#123;&#125; * &#125;; */class Solution &#123;public: vector&lt;int&gt; inorderTraversal(TreeNode* root) &#123; vector&lt;int&gt; res; traverse(root, res); return res; &#125; void traverse(TreeNode* root, vector&lt;int&gt; &amp;res) &#123; if (root == nullptr) &#123; return; &#125; traverse(root-&gt;left, res); res.push_back(root-&gt;val); traverse(root-&gt;right, res); &#125;&#125;;","tags":["äºŒå‰æ ‘"],"categories":["äºŒå‰æ ‘"]},{"title":"äºŒå‰æ ‘ç®—æ³•æ ¸å¿ƒçº²é¢†","path":"/posts/äºŒå‰æ ‘ç®—æ³•æ ¸å¿ƒçº²é¢†.html","content":"ä¸€ã€äºŒå‰æ ‘åŸºæœ¬æ¦‚å¿µäºŒå‰æ ‘äºŒå‰æœç´¢æ ‘å®Œå…¨äºŒå‰æ ‘ äºŒã€äºŒå‰æ ‘çš„å‰ä¸­ååºéå†äºŒå‰æ ‘çš„å‰ä¸­ååºå¯¹åº”çš„ä¸åªæ˜¯ä¸‰ç§é¡ºåºä¸åŒçš„åˆ—è¡¨ã€‚å‰ä¸­ååºæ˜¯éå†äºŒå‰æ ‘è¿‡ç¨‹ä¸­å¤„ç†æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‰ä¸ªç‰¹æ®Šæ—¶é—´ç‚¹ï¼Œç»ä¸ä»…ä»…æ˜¯ä¸‰ä¸ªé¡ºåºä¸åŒçš„ Listï¼šå‰åºä½ç½®çš„ä»£ç åœ¨åˆšåˆšè¿›å…¥ä¸€ä¸ªäºŒå‰æ ‘èŠ‚ç‚¹çš„æ—¶å€™æ‰§è¡Œï¼›ååºä½ç½®çš„ä»£ç åœ¨å°†è¦ç¦»å¼€ä¸€ä¸ªäºŒå‰æ ‘èŠ‚ç‚¹çš„æ—¶å€™æ‰§è¡Œï¼›ä¸­åºä½ç½®çš„ä»£ç åœ¨ä¸€ä¸ªäºŒå‰æ ‘èŠ‚ç‚¹å·¦å­æ ‘éƒ½éå†å®Œï¼Œå³å°†å¼€å§‹éå†å³å­æ ‘çš„æ—¶å€™æ‰§è¡Œã€‚ ä¸‰ã€äºŒå‰æ ‘è§£é¢˜çš„æ€ç»´æ–¹å¼1ã€æ˜¯å¦å¯ä»¥é€šè¿‡éå†ä¸€éäºŒå‰æ ‘å¾—åˆ°ç­”æ¡ˆï¼Ÿå¦‚æœå¯ä»¥ï¼Œç”¨ä¸€ä¸ª traverse å‡½æ•°é…åˆå¤–éƒ¨å˜é‡æ¥å®ç°ï¼Œè¿™å«ã€Œéå†ã€çš„æ€ç»´æ¨¡å¼ã€‚ 2ã€æ˜¯å¦å¯ä»¥å®šä¹‰ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œé€šè¿‡å­é—®é¢˜ï¼ˆå­æ ‘ï¼‰çš„ç­”æ¡ˆæ¨å¯¼å‡ºåŸé—®é¢˜çš„ç­”æ¡ˆï¼Ÿå¦‚æœå¯ä»¥ï¼Œå†™å‡ºè¿™ä¸ªé€’å½’å‡½æ•°çš„å®šä¹‰ï¼Œå¹¶å……åˆ†åˆ©ç”¨è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œè¿™å«ã€Œåˆ†è§£é—®é¢˜ã€çš„æ€ç»´æ¨¡å¼ã€‚ æ— è®ºä½¿ç”¨å“ªç§æ€ç»´æ¨¡å¼ï¼Œä½ éƒ½éœ€è¦æ€è€ƒï¼š å¦‚æœå•ç‹¬æŠ½å‡ºä¸€ä¸ªäºŒå‰æ ‘èŠ‚ç‚¹ï¼Œå®ƒéœ€è¦åšä»€ä¹ˆäº‹æƒ…ï¼Ÿéœ€è¦åœ¨ä»€ä¹ˆæ—¶å€™ï¼ˆå‰&#x2F;ä¸­&#x2F;ååºä½ç½®ï¼‰åšï¼Ÿå…¶ä»–çš„èŠ‚ç‚¹ä¸ç”¨ä½ æ“å¿ƒï¼Œé€’å½’å‡½æ•°ä¼šå¸®ä½ åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ å››ã€ååºä½ç½®çš„ç‰¹æ®Šä¹‹å¤„äº”ã€äºŒå‰æ ‘çš„å±‚åºéå†å…­ã€Nå‰æ ‘","tags":["äºŒå‰æ ‘"],"categories":["äºŒå‰æ ‘"]},{"title":"ddå‘½ä»¤","path":"/posts/ddå‘½ä»¤.html","content":"ddå‘½ä»¤å¯ä»¥ä»ä¸€ä¸ªæ–‡ä»¶æˆ–è®¾å¤‡å‘å¦ä¸€ä¸ªæ–‡ä»¶æˆ–è®¾å¤‡è¿›è¡Œå¤åˆ¶ ä¸€ã€ddå‘½ä»¤å¸¸ç”¨è¯­æ³•1dd if=input_file of=output_file [options] optionsæ˜¯ä¸€äº›å¯é€‰å‚æ•°ï¼Œifå’Œofæ˜¯å¿…é¡»æœ‰çš„ if è¡¨ç¤ºè¾“å…¥æ–‡ä»¶ of è¡¨ç¤ºè¾“å‡ºæ–‡ä»¶ bsï¼šè®¾ç½®æ¯æ¬¡è¯»å–å’Œå†™å…¥çš„å—å¤§å°ï¼ˆå•ä½ä¸ºå­—èŠ‚æˆ–è€…æ˜¯å¯ä»¥æ·»åŠ çš„åç¼€ï¼Œå¦‚bã€kã€mç­‰ï¼‰ï¼Œé»˜è®¤ä¸º512å­—èŠ‚ã€‚ countï¼šè®¾ç½®è¦å¤åˆ¶çš„å—æ•°ã€‚ iflagï¼šè®¾ç½®è¾“å…¥é€‰é¡¹ï¼Œå¸¸ç”¨çš„é€‰é¡¹æœ‰directï¼ˆç»•è¿‡ç¼“å­˜ç›´æ¥è¯»å–ï¼‰å’Œsyncï¼ˆåŒæ­¥æ•°æ®åˆ°ç£ç›˜ï¼‰ã€‚ oflagï¼šè®¾ç½®è¾“å‡ºé€‰é¡¹ï¼Œå¸¸ç”¨çš„é€‰é¡¹æœ‰directï¼ˆç»•è¿‡ç¼“å­˜ç›´æ¥å†™å…¥ï¼‰å’Œsyncï¼ˆåŒæ­¥æ•°æ®åˆ°ç£ç›˜ï¼‰ã€‚ skip&#x3D;xxx æ˜¯åœ¨å¤‡ä»½æ—¶å¯¹if åé¢çš„éƒ¨åˆ†ä¹Ÿå°±æ˜¯åŸæ–‡ä»¶è·³è¿‡å¤šå°‘å—å†å¼€å§‹å¤‡ä»½ï¼› seek&#x3D;xxxåˆ™æ˜¯åœ¨å¤‡ä»½æ—¶å¯¹of åé¢çš„éƒ¨åˆ†ä¹Ÿå°±æ˜¯ç›®æ ‡æ–‡ä»¶è·³è¿‡å¤šå°‘å—å†å¼€å§‹å†™ äºŒã€ddå¸¸ç”¨å‘½ä»¤-è¯»ç£ç›˜1dd if=/dev/sde1 of=tee-test.img bs=1M skip=4 count=16 å«ä¹‰ä¸ºä»&#x2F;dev&#x2F;sde1è®¾å¤‡èµ·å§‹ä½ç½®ï¼Œè·³è¿‡4Mï¼Œè¯»å–16Må†…å®¹åˆ°tee-test.imgä¸­æƒ³è¦æŸ¥çœ‹tee-test.imgï¼Œå¯ä»¥ä½¿ç”¨hexdumpå‘½ä»¤ 1hexdump -C tee-test.img åªæŸ¥çœ‹éƒ¨åˆ†å†…å®¹ï¼Œä¾‹å¦‚å‰100ä¸ªå­—èŠ‚ï¼š 1hexdump -C -n 100 tee-test.img ä¸‰ã€ddå¸¸ç”¨å‘½ä»¤-å†™ç£ç›˜1dd if=/dev/zero of=/dev/sda bs=1k seek=8224 count=32 å«ä¹‰ä¸ºä»&#x2F;dev&#x2F;zeroä¸­ä¹Ÿå°±æ˜¯å°†åé¢çš„ofç›®æ ‡æ–‡ä»¶å†™0ï¼Œå°†&#x2F;dev&#x2F;sdaè®¾å¤‡çš„èµ·å§‹åœ°å€ï¼Œè·³è¿‡8224KBåï¼Œè¿ç»­å†™å…¥32KB 0æ•°æ® å››ã€é€šè¿‡fdisk -lç¡®è®¤åˆ†åŒºçš„å®é™…èµ·å§‹åœ°å€ä½¿ç”¨fdisk -læ˜¾ç¤ºç£ç›˜åˆ†åŒºæƒ…å†µ 12345678# fdisk -lDisk /dev/sde: 19.16 GB, 20577255424 bytes, 5023744 sectorsSector size (logical/physical): 4096 bytes / 4096 bytes Device Start End/dev/sde1 256 131327 è¿™é‡Œæ˜¾ç¤ºsde1çš„èµ·å§‹åœ°å€ä¸º256ï¼Œé‚£ä¹ˆå®é™…åœ°å€ä¸ºï¼š256 âœ–ï¸ 4096 &#x3D; 1048576 &#x3D; 1024 âœ–ï¸ 1024 &#x3D; 1MBï¼Œæ‰€ä»¥sde1çš„ä½ç½®ä¸º&#x2F;dev&#x2F;sdeçš„èµ·å§‹åœ°å€åç§»1Mï¼Œå…¶å®èµ·å§‹1Mï¼Œå­˜æ”¾çš„åº”è¯¥æ˜¯ç£ç›˜åˆ†åŒºä¿¡æ¯","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"MakefileåŸºç¡€è¯­æ³•","path":"/posts/MakefileåŸºç¡€è¯­æ³•.html","content":"ä¸€ã€Makefileè§„åˆ™ä¸€ä¸ªç®€å•çš„ Makefile æ–‡ä»¶åŒ…å«ä¸€ç³»åˆ—çš„â€œè§„åˆ™â€ï¼Œå…¶æ ·å¼å¦‚ä¸‹ï¼š 12ç›®æ ‡(target)â€¦: ä¾èµ–(prerequiries)â€¦&lt;tab&gt;å‘½ä»¤(command) ç›®æ ‡(target)é€šå¸¸æ˜¯è¦ç”Ÿæˆçš„æ–‡ä»¶çš„åç§°ï¼Œå¯ä»¥æ˜¯å¯æ‰§è¡Œæ–‡ä»¶æˆ–OBJæ–‡ä»¶ï¼Œ ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ‰§è¡Œçš„åŠ¨ä½œåç§°ï¼Œè¯¸å¦‚â€˜ clean â€™ã€‚ä¾èµ–æ˜¯ç”¨æ¥äº§ç”Ÿç›®æ ‡çš„ææ–™(æ¯”å¦‚æºæ–‡ä»¶)ï¼Œä¸€ä¸ªç›®æ ‡ç»å¸¸æœ‰å‡ ä¸ªä¾èµ–ã€‚å‘½ä»¤æ˜¯ç”Ÿæˆç›®æ ‡æ—¶æ‰§è¡Œçš„åŠ¨ä½œï¼Œä¸€ä¸ªè§„åˆ™å¯ä»¥å«æœ‰å‡ ä¸ªå‘½ä»¤ï¼Œæ¯ä¸ªå‘½ä»¤å ä¸€è¡Œã€‚æ³¨æ„ï¼šæ¯ä¸ªå‘½ä»¤è¡Œå‰é¢å¿…é¡»æ˜¯ä¸€ä¸ª Tab å­—ç¬¦ï¼Œå³å‘½ä»¤è¡Œç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ Tabã€‚è¿™æ˜¯å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ã€‚é€šå¸¸ï¼Œå¦‚æœä¸€ä¸ªä¾èµ–å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±éœ€è¦è§„åˆ™è°ƒç”¨å‘½ä»¤ä»¥æ›´æ–°æˆ–åˆ›å»ºç›®æ ‡ã€‚ ä½†æ˜¯å¹¶éæ‰€æœ‰çš„ç›®æ ‡éƒ½æœ‰ä¾èµ–ï¼Œä¾‹å¦‚ï¼Œç›®æ ‡â€œ clean â€çš„ä½œç”¨æ˜¯æ¸…é™¤æ–‡ä»¶ï¼Œå®ƒæœ‰ä¾èµ–ã€‚ ä¸€ä¸ª Makefile æ–‡ä»¶å¯ä»¥åŒ…å«è§„åˆ™ä»¥å¤–çš„å…¶ä»–æ–‡æœ¬ï¼Œä½†ä¸€ä¸ªç®€å•çš„ Makefile æ–‡ä»¶ä»…ä»…éœ€è¦åŒ…å«è§„åˆ™ã€‚è™½ç„¶çœŸæ­£çš„è§„åˆ™æ¯”è¿™é‡Œå±•ç¤ºçš„ä¾‹å­å¤æ‚ï¼Œä½†æ ¼å¼æ˜¯å®Œå…¨ä¸€æ ·çš„ äºŒã€makeå‘½ä»¤ä»‹ç»make å‘½ä»¤çš„ä½¿ç”¨ï¼š æ‰§è¡Œ make å‘½ä»¤æ—¶ï¼Œå®ƒä¼šå»å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾åä¸ºâ€œMakefileâ€çš„æ–‡ä»¶ï¼Œå¹¶æ ¹ æ®å®ƒçš„æŒ‡ç¤ºå»æ‰§è¡Œæ“ä½œï¼Œç”Ÿæˆç¬¬ä¸€ä¸ªç›®æ ‡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œ -f â€é€‰é¡¹æŒ‡å®šæ–‡ä»¶ï¼Œä¸å†ä½¿ç”¨åä¸ºâ€œMakefileâ€çš„æ–‡ä»¶ï¼Œæ¯” å¦‚ï¼š 1make -f Makefile.build æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œ -C â€é€‰é¡¹æŒ‡å®šç›®å½•ï¼Œåˆ‡æ¢åˆ°å…¶ä»–ç›®å½•é‡Œå»ï¼Œæ¯”å¦‚ï¼š 1make -C a/ -f Makefile.build æˆ‘ä»¬å¯ä»¥æŒ‡å®šç›®æ ‡ï¼Œä¸å†é»˜è®¤ç”Ÿæˆç¬¬ä¸€ä¸ªç›®æ ‡ï¼š 1make -C a/ -f Makefile.build other_target ä¸‰ã€Makefileå˜é‡ä»‹ç»1234A = xxx // å»¶æ—¶å˜é‡B ?= xxx // å»¶æ—¶å˜é‡ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡å®šä¹‰æ—¶èµ‹å€¼æ‰æˆåŠŸï¼›å¦‚æœæ›¾å®šä¹‰è¿‡ï¼Œæ­¤èµ‹å€¼æ— æ•ˆC := xxx // ç«‹å³å˜é‡D += yyy // å¦‚æœ D åœ¨å‰é¢æ˜¯å»¶æ—¶å˜é‡ï¼Œé‚£ä¹ˆç°åœ¨å®ƒè¿˜æ˜¯å»¶æ—¶å˜é‡ï¼›// å¦‚æœ D åœ¨å‰é¢æ˜¯ç«‹å³å˜é‡ï¼Œé‚£ä¹ˆç°åœ¨å®ƒè¿˜æ˜¯ç«‹å³å˜é‡ å››ã€Makefileé€šé…ç¬¦&amp;ä¸€äº›ç¬¦å·%é€šé…ç¬¦ %.oï¼šè¡¨ç¤ºæ‰€ç”¨çš„.oæ–‡ä»¶%. %.cï¼šè¡¨ç¤ºæ‰€æœ‰çš„.cæ–‡ä»¶ $@ï¼šè¡¨ç¤ºç›®æ ‡$&lt;ï¼šè¡¨ç¤ºç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶$^ï¼šè¡¨ç¤ºæ‰€æœ‰ä¾èµ–æ–‡ä»¶ äº”ã€Makefileå‡æƒ³ç›®æ ‡æˆ‘ä»¬çš„ Makefile ä¸­æœ‰è¿™æ ·çš„ç›®æ ‡ï¼š 123clean: rm -f $(shell find -name &quot;\\*.o&quot;) rm -f $(TARGET) å¦‚æœå½“å‰ç›®å½•ä¸‹æ°å¥½æœ‰åä¸ºâ€œcleanâ€çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæ‰§è¡Œâ€œ make clean â€æ—¶å®ƒ å°±ä¸ä¼šæ‰§è¡Œé‚£äº›åˆ é™¤å‘½ä»¤ã€‚è¿™æ—¶æˆ‘ä»¬éœ€è¦æŠŠâ€œ clean â€è¿™ä¸ªç›®æ ‡ï¼Œè®¾ç½®ä¸ºâ€œå‡æƒ³ç›®æ ‡â€ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ‰§è¡Œâ€œ make clean â€æ—¶é‚£äº›åˆ é™¤å‘½ä»¤è‚¯å®šå¯ä»¥å¾—åˆ°æ‰§è¡Œã€‚ ä½¿ç”¨ä¸‹é¢çš„è¯­å¥æŠŠâ€œcleanâ€è®¾ç½®ä¸ºå‡æƒ³ç›®æ ‡ï¼š 1.PHONY : clean å…­ã€Makefileå¸¸ç”¨å‡½æ•°1.$(foreach var,list,text)ç®€å•åœ°è¯´ï¼Œå°±æ˜¯ for each var in list, change it to textã€‚å¯¹ list ä¸­çš„æ¯ä¸€ä¸ª å…ƒç´ ï¼Œå–å‡ºæ¥èµ‹ç»™ varï¼Œç„¶åæŠŠ var æ”¹ä¸º text æ‰€æè¿°çš„å½¢å¼ã€‚ 2.$(wildcard pattern)pattern æ‰€åˆ—å‡ºçš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ŒæŠŠå­˜åœ¨çš„æ–‡ä»¶éƒ½åˆ—å‡ºæ¥ã€‚ 3.$(filter patternâ€¦,text)æŠŠ text ä¸­ç¬¦åˆ pattern æ ¼å¼çš„å†…å®¹ï¼Œfilter(è¿‡æ»¤)å‡ºæ¥ã€ç•™ä¸‹æ¥ã€‚ 4.$(filter-out patternâ€¦,text)æŠŠ text ä¸­ç¬¦åˆ pattern æ ¼å¼çš„å†…å®¹ï¼Œfilter-out(è¿‡æ»¤)å‡ºæ¥ã€æ‰”æ‰ã€‚ 5.$(patsubst pattern,replacement,text)å¯»æ‰¾â€™ text â€˜ä¸­ç¬¦åˆæ ¼å¼â€™ pattern â€˜çš„å­—ï¼Œç”¨â€™ replacement â€˜æ›¿æ¢å®ƒä»¬ã€‚ â€˜ pattern â€˜å’Œâ€™ replacement â€˜ä¸­å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ã€‚ ä¸ƒã€Makefileçš„ä¾‹å­ï¼ŒåŒ…å«å­ç›®å½•å…«ã€Makefileä¸­çš„EXTRA_CFLAGSEXTRA_CFLAGSæ˜¯Makefileä¸­é¢„å®šä¹‰çš„ä¸€ä¸ªå˜é‡ï¼Œä½œä¸ºCFLGASï¼Œåœ¨makeæ—¶å¯ä»¥ä¼ é€’ç»™gccä¸€äº›ç¼–è¯‘é€‰é¡¹ç­‰ï¼Œå¦‚â€”O2 EXTRA_CFLAGS +&#x3D; -Dç­‰ä»·äºgcc -Dï¼Œç›¸å½“äºåœ¨æºä»£ç ä¸­å®šä¹‰ä¸€ä¸ªå®å‡å¦‚å®šä¹‰ä¸€ä¸ªå®CONFIG_DEBUGåœ¨.cé‡Œé¢å®šä¹‰ä¸ºï¼š#define CONFIG_DEBUGåœ¨makefileé‡Œå®šä¹‰ä¸º: CONFIG_DEBUG&#x3D;y å‡å¦‚è¯´æˆ‘ä»¬æƒ³åœ¨makefileé‡Œä¸º.cæ–‡ä»¶è¿›å…¥ä¸€ä¸ªå®å®šä¹‰ï¼Œå°±ç”¨EXTRA_CFLAGS +&#x3D; DCONFIG_DEBUG( ç­‰ä»·äºåœ¨.cæ–‡ä»¶é‡Œå®šä¹‰#define CONFIG_DEBUG) è¿™æ—¶CONFIG_DEBUG&#x3D;yä¸EXTRA_CFLAGS +&#x3D; DCONFIG_DEBUGçš„åŒºåˆ«åº”è¯¥ä½ å·²ç»çœ‹å‡ºæ¥çš„ï¼Œå‰è€…æ˜¯å¯¹makefileç¼–è¯‘æ—¶ç”¨çš„ï¼Œæ¯”å¦‚è¯´obj-(CONFIG_DEBUG) +&#x3D; test.o,è€Œåè€…åˆ™æ˜¯å¯¹.cæºæ–‡ä»¶é‡Œçš„ç”¨çš„ ä¹ã€Makefileç¼–è¯‘å†…æ ¸é©±åŠ¨koå†…æ ¸æºä»£ç ä¸­obj-mè¡¨ç¤ºä»¥æ¨¡å—koçš„æ–¹å¼ç¼–è¯‘obj-yè¡¨ç¤ºå°†æºä»£ç ç¼–è¯‘åˆ°å†…æ ¸æºç ä¸­åœ¨å·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦ç¼–è¯‘ä¸€äº›Koæ¨¡å—ï¼Œå¦‚æœæ˜¯å•ä¸ªçš„cæ–‡ä»¶ç¼–è¯‘ç›´æ¥åœ¨å†…æ ¸æºç é‡Œé¢ obj-y&#x3D;xxx.oå°±å¥½å¦‚æœè¿™ä¸ªkoæ–‡ä»¶éœ€è¦å¤šä¸ªcæ–‡ä»¶å…±åŒç¼–è¯‘ç”Ÿæˆçš„è¯ï¼Œæœ€å¥½ä»¥å¦‚ä¸‹çš„æ¨¡æ¿æ¥å®Œæˆç¼–è¯‘è¾ƒå¥½ 1234567891011121314151617181920212223242526272829303132#é¦–å…ˆæŒ‡å®šå¥½ç¼–è¯‘é“¾å·¥å…·CROSS_COMPILE=/opt/gcc-linaro-7.3.1-2018.05-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-#æŒ‡å®šç”¨å“ªä¸ªå†…æ ¸å»ç¼–è¯‘KDIR=/mnt/nfsroot/zhengshuai.zhu/IPCSDK/ipc-sdk-full-release/kernel-4.19#ç›®æ ‡æ˜¯ç¼–è¯‘æˆä¸€ä¸ªtest.koæ–‡ä»¶obj-m += test.o#test.oæ–‡ä»¶ç”±å½“å‰ç›®å½•ä¸‹nä¸ªcæ–‡ä»¶ç¼–è¯‘æˆtest-objs += ./*.o#åŒ…å«å½“å‰ç›®å½•ä¸‹çš„å¤´æ–‡ä»¶INCLUDE_DIRS := $(addprefix -I,$(shell find ../ -type d ))#åŒ…å«å½“å‰ç›®å½•ä¸‹ï¼Œå†…æ ¸ç›®å½•ä¸‹çš„å¤´æ–‡ä»¶ccflags-y:= -I$(_KDIR)/include/linux/ -I$(PWD)/platform/#å¿½ç•¥ä¸€äº›ç¼–è¯‘è­¦å‘Šï¼Œç±»å¦‚ä»€ä¹ˆå˜é‡æœªä½¿ç”¨ccflags-y += -Wno-declaration-after-statement#æ·»åŠ cæ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚åœ¨ä»£ç ä¸­ä¼šæœ‰#ifdef CONFIG_ANDROID #xxxx#endififeq ($(SYSTEM_VERSION),) ccflags-y += -DCONFIG_LINUX_OSelse ccflags-y += -DCONFIG_ANDROIDendifall: make ARCH=$&#123;ARCH&#125; -C $(KDIR) M=$(PWD) modulesclean: make ARCH=$&#123;ARCH&#125; -C $(KDIR) M=$(PWD) clean make ARCH=$&#123;ARCH&#125; -C ( K D I R ) M = (KDIR) M=(KDIR)M=(PWD) moduleså¦‚ä½•ç†è§£è¿™å¥è¯?-Cçš„é€‰é¡¹å¯ä»¥ç†è§£ä¸º:è¿›å…¥æ‰€æŒ‡å®šçš„ä½ç½®ï¼Œ$(KDIR)ï¼Œä¹Ÿå°±æ˜¯å†…æ ¸ç›®å½•ä¸­ï¼Œç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ å»è¯»å–å†…æ ¸ç›®å½•é¡¶å±‚çš„Makefileæ–‡ä»¶ï¼Œç›¸å½“äºç¼–è¯‘çš„æ—¶å€™ é€‰æ‹©ä¸€ä¸ªå†…æ ¸ï¼Œæˆ‘è¦ç”¨è¿™ä¸ªå†…æ ¸å»ç¼–è¯‘ã€‚å› ä¸ºä½ è¿™ä¸ªç›®å½•æ²¡æœ‰è¢«é…ç½®åˆ°kernel configé‡Œé¢å»ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰æŒ‡å®šç”¨å“ªä¸ªå†…æ ¸ç‰ˆæœ¬ï¼Œæœ‰äº† -C $(KDIR),å°±ç›¸å½“äºé€‰äº†å†…æ ¸ï¼Œå¦‚æœä½ é€‰æ‹©äº†kernel-4.19ç›®å½•ä¸‹ï¼Œæˆ–è€… kernel-5.0ç›®å½•ä¸‹ï¼Œ M&#x3D;çš„é€‰é¡¹å¯ä»¥ç†è§£ä¸º:å½“æˆ‘é€‰å¥½å†…æ ¸ç‰ˆæœ¬åï¼Œæˆ‘ç”¨è¿™ä¸ª ç‰ˆæœ¬çš„å†…æ ¸ è¦å»ç¼–è¯‘å“ªä¸ªç›®å½•ï¼Œç„¶åè¿›å…¥$(PWD)ç›®å½•å»ç¼–è¯‘å½“å‰æŒ‡å®šçš„æ–‡ä»¶ï¼Œå°†å…¶ç¼–è¯‘æˆkoæ–‡ä»¶","tags":["Makefile"],"categories":["Makefile"]},{"title":"gitæäº¤æµç¨‹","path":"//posts/1.html","content":"ä¸€ã€Gitä¸‹è½½åŠé…ç½®æˆ‘ä»¬ç¬¬ä¸€æ¬¡ç”¨gitæˆ–è€…æ˜¯æ–°ç”µè„‘ä¸Šé‡æ–°å®‰è£…gitå·¥å…·çš„æ—¶å€™ï¼Œéƒ½éœ€è¦é‡æ–°é…ç½®ä¸€ä¸‹è¿™ä¸ªå·¥å…·ã€‚ Windowså®‰è£…gitå®˜ç½‘ç½‘å€https://git-scm.com/downloadsä¸‹è½½é€Ÿåº¦æ…¢ï¼Œä¸”æœ‰å¯èƒ½å®‰è£…ä¸æˆåŠŸã€‚ é™„å¿«é€Ÿä¸‹è½½åœ°å€ï¼ˆå›½å†…ä¸‹è½½ç«™ï¼‰ï¼šhttps://github.com/waylau/git-for-winÂ ã€‚ ä¸‹è½½å®Œä¹‹åï¼ŒWindowsä¸­ä½ åœ¨æ¡Œé¢ä¸Šæˆ–è€…æ–‡ä»¶ç®¡ç†å™¨ä¸­é¼ æ ‡å³é”®å°±å¯ä»¥çœ‹è§Git Bash hereï¼Œå°±æ˜¯ç”¨æ¥æ‰“å¼€git bashçš„ã€‚ Linuxå®‰è£…gitlinuxåœ¨ç»ˆç«¯ä¸­ï¼Œè¾“å…¥sudo apt-get install git ä¸‹è½½å®Œå¯ä»¥ç”¨å‘½ä»¤git --versionæ‰“å°å½“å‰çš„gitç‰ˆæœ¬éªŒè¯æ˜¯å¦æˆåŠŸã€‚ä¸‹é¢æ­£å¼å¼€å§‹Gitçš„é…ç½®ã€‚ é…ç½®gitåŸºæœ¬ä¿¡æ¯æ¥ä¸‹æ¥å°±æ˜¯ä¸ç®¡æˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨gitå·¥å…·ï¼Œè¿˜æ˜¯åæ¥æ¢ç”µè„‘äº†ï¼Œè¿˜æ˜¯æ¢æˆlinuxç³»ç»Ÿäº†ï¼Œè¦æƒ³ä½¿ç”¨gitéƒ½æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•é…ç½®ä¸€éï¼Œæ‰å¯ä»¥ä½¿ç”¨ã€‚ å®‰è£…æˆåŠŸä¹‹åï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ•²ä¸‹å¦‚ä¸‹å‘½ä»¤Â git config --list,æ˜¾ç¤ºå½“å‰çš„é…ç½®ä¿¡æ¯ã€‚ æ¥ä¸‹æ¥è®¾ç½®æäº¤ä»“åº“æ—¶çš„ç”¨æˆ·åä¿¡æ¯Â git config --global user.name &quot;å¼ ä¸‰&quot;Â è®¾ç½®æäº¤ä»“åº“æ˜¯çš„é‚®ç®±ä¿¡æ¯Â git config --global user.email &quot;xxxxxxxx@qq.com&quot;Â gitè®¾ç½®å…³é—­è‡ªåŠ¨æ¢è¡Œgit config --global core.autocrlf falseÂ ä¸ºäº†ä¿è¯æ–‡ä»¶çš„æ¢è¡Œç¬¦æ˜¯ä»¥å®‰å…¨çš„æ–¹æ³•ï¼Œé¿å…windowsä¸unixçš„æ¢è¡Œç¬¦æ··ç”¨çš„æƒ…å†µï¼Œæœ€å¥½ä¹ŸåŠ ä¸Šè¿™ä¹ˆä¸€å¥Â git config --global core.safecrlf true å…¶å®è¿™äº›ä¿¡æ¯éƒ½åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œå°±åœ¨å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•ä¸‹è¾¹çš„**.gitconfig**æ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰“å¼€è¿™ä¸ªæ–‡ä»¶cd ~,vim .gitconfigè¿›è¡Œç¼–è¾‘ã€‚ gitåè®®åŠç§˜é’¥é…ç½®gitæœ‰å››ç§åè®®ï¼šGitåè®®ï¼Œhttpåè®®ï¼Œæœ¬åœ°åè®®ï¼Œsshåè®®ã€‚ä½¿ç”¨httpsé™¤äº†é€Ÿåº¦æ…¢ä»¥å¤–ï¼Œè¿˜æœ‰ä¸ªæœ€å¤§çš„éº»çƒ¦æ˜¯æ¯æ¬¡æ¨é€éƒ½å¿…é¡»è¾“å…¥å£ä»¤ï¼Œä½†æ˜¯åœ¨æŸäº›åªå¼€æ”¾httpç«¯å£çš„å…¬å¸å†…éƒ¨å°±æ— æ³•ä½¿ç”¨sshåè®®è€Œåªèƒ½ç”¨httpsã€‚å¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨sshåè®®ã€‚è¿™ä¸ªä¸ä»…é€Ÿåº¦å¿«ï¼Œè€Œä¸”ä¸ç”¨æ¯æ¬¡æäº¤è¾“å…¥å¯†ç ï¼Œå¯è°“æ˜¯çœå¿ƒçœåŠ›ã€‚ ä¸‹é¢å°±è¯´ä¸€ä¸‹sshé…ç½®è¿‡ç¨‹ã€‚(è¿™ä¸ªåè®®é…ç½®çš„è¿‡ç¨‹ä¸å¯ç¼ºå°‘ï¼Œä¸ç„¶å°±ç”¨ä¸äº†è¿™ç§åè®®ã€‚) é¦–å…ˆç”Ÿæˆ RSA å¯†é’¥å¯¹ : ssh-keygen -t rsa -C &quot;xxxxxxxx@qq.com&quot;æ³¨æ„æ ¼å¼ï¼Œä¸€å®šè¦æ­£ç¡®ã€‚ sshå’Œ-keygenæ— ç©ºæ ¼ æ­¤æ—¶åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹å°±ä¼šæœ‰ä¸€ä¸ª.sshéšè—æ–‡ä»¶ï¼Œè¿›å…¥è¯¥ç›®å½•æœ‰ä¸€ä¸ªid_rsa.pubæ–‡ä»¶ï¼Œcatå‘½ä»¤æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œå¤åˆ¶ä¸‹æ¥ç„¶ååœ¨ githubç½‘ç«™æ·»åŠ å…¬é’¥ ï¼Œæ–¹æ³•å¦‚ä¸‹ åœ¨ Github ç½‘ç«™æ·»åŠ å…¬é’¥ï¼šåœ¨å³ä¸Šè§’å¤´åƒå¤„ç‚¹settingsè¿›å…¥è®¾ç½®ï¼Œç„¶åç‚¹SSH and GPG keys,è¿›å…¥ä¹‹åç‚¹å‡»New SSH key ç²˜è´´è¿›å»ï¼Œéšä¾¿ç»™è¿™ä¸ªç§˜é’¥å‘½ä¸ªåï¼Œæ–¹ä¾¿ç®¡ç†å°±è¡Œäº†ã€‚é’¥åŒ™æ˜¾ç¤ºé»‘è‰²å³å¯ã€‚ æ­¤æ—¶é…ç½®å°±å®Œæˆäº†ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨gitäº†ã€‚ æ‰§è¡Œæ­¤å‘½ä»¤éªŒè¯æ˜¯å¦æˆåŠŸssh -T git@github.comÂ æˆåŠŸæ˜¾ç¤ºä¸ºï¼šHi XXX! Youâ€™ve successfully authenticated, but GitHub does not provide shell access. äºŒã€å…ˆæœ‰æœ¬åœ°åº“ï¼Œåæœ‰è¿œç¨‹åº“åˆ›å»ºç‰ˆæœ¬åº“å¯ä»¥ç†è§£ä¸ºç‰ˆæœ¬åº“å°±æ˜¯æœ¬åœ°æ–‡ä»¶çš„ä¸€ä¸ªç›®å½•ï¼Œä¹Ÿå«ä»“åº“ã€‚å¯ä»¥ç”¨gitæ¥ç®¡ç†å’Œå›é€€ç­‰ åˆ›å»ºç‰ˆæœ¬åº“ï¼šæ‰¾åˆ°ä¸€ä¸ªæƒ³è¢«ç®¡ç†çš„æ–‡ä»¶å¤¹ï¼Œè¿›å…¥åˆ°æ–‡ä»¶å¤¹é‡Œï¼Œè¾“å…¥å‘½ä»¤git init,æ­¤æ—¶gitå°±å¯ä»¥ç®¡ç†è¿™ä¸ªç›®å½•äº†ï¼Œå¹¶ä¸”åœ¨æ–‡ä»¶å¤¹ä¸‹å¤šå‡ºæ¥äº†ä¸€ä¸ª.gitçš„éšè—æ–‡ä»¶å¤¹ã€‚è¿™ä¸ª.gitå°±æ˜¯ç‰ˆæœ¬åº“ã€‚ Gitçš„ç‰ˆæœ¬åº“é‡Œå­˜äº†å¾ˆå¤šä¸œè¥¿ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ç§°ä¸ºstageï¼ˆæˆ–è€…å«indexï¼‰çš„æš‚å­˜åŒºï¼Œè¿˜æœ‰Gitä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºçš„ç¬¬ä¸€ä¸ªåˆ†æ”¯masterï¼Œä»¥åŠæŒ‡å‘masterçš„ä¸€ä¸ªæŒ‡é’ˆå«HEADã€‚ å·¥ä½œåŒºï¼šå°±æ˜¯ä½ åœ¨ç”µè„‘é‡Œèƒ½çœ‹åˆ°çš„ç›®å½•ï¼Œæ¯”å¦‚åˆšæ‰çš„æ–‡ä»¶å¤¹å°±æ˜¯ä¸€ä¸ªå·¥ä½œåŒº ç¬¬ä¸€æ­¥ï¼šå°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºå½“æˆ‘ä»¬æƒ³æ·»åŠ æ–‡ä»¶æˆ–è€…ä¿®æ”¹æ–‡ä»¶æ˜¯éœ€è¦æ·»åŠ åˆ°ç‰ˆæœ¬åº“ä¸­çš„ï¼Œå¦åˆ™æ— æ³•è¢«gitè·Ÿè¸ªç®¡ç†å‘€ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æ·»åŠ æˆ–è€…ä¿®æ”¹æ–‡ä»¶æ—¶ï¼Œå…ˆè¦ç”¨git add filenameæ·»åŠ åˆ°æš‚å­˜åŒºä¸­ï¼Œfilenameä¸º.çš„æ—¶å€™ä»£è¡¨å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶éƒ½æ·»åŠ åˆ°æš‚å­˜åŒº ç¬¬äºŒæ­¥ï¼šå°†æ–‡ä»¶æäº¤åˆ°åˆ†æ”¯git commit -m &quot;message&quot;ï¼Œå°†æ–‡ä»¶æäº¤åˆ°äº†åˆ†æ”¯ã€‚ æ·»åŠ è¿œç¨‹åº“æˆ‘ä»¬å·²ç»åœ¨æœ¬åœ°åˆ›å»ºäº†ä¸€ä¸ªGitä»“åº“åï¼Œåˆæƒ³åœ¨GitHubåˆ›å»ºä¸€ä¸ªGitä»“åº“ï¼Œå¹¶ä¸”è®©è¿™ä¸¤ä¸ªä»“åº“è¿›è¡Œè¿œç¨‹åŒæ­¥ï¼Œè¿™æ ·ï¼ŒGitHubä¸Šçš„ä»“åº“æ—¢å¯ä»¥ä½œä¸ºå¤‡ä»½ï¼Œåˆå¯ä»¥è®©å…¶ä»–äººé€šè¿‡è¯¥ä»“åº“æ¥åä½œï¼ŒçœŸæ˜¯ä¸€ä¸¾å¤šå¾—ã€‚ é¦–å…ˆï¼Œç™»é™†GitHubï¼Œç„¶åï¼Œåœ¨å³ä¸Šè§’æ‰¾åˆ°â€œCreate a new repoâ€æŒ‰é’®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ï¼Œåœ¨Repository nameå¡«å…¥é¡¹ç›®åå­—ï¼Œæ¯”å¦‚æˆ‘ä»¬å«learngitï¼Œå…¶ä»–ä¿æŒé»˜è®¤è®¾ç½®ï¼Œç‚¹å‡»â€œCreate repositoryâ€æŒ‰é’®ï¼Œå°±æˆåŠŸåœ°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Gitä»“åº“ ç›®å‰ï¼Œåœ¨GitHubä¸Šçš„è¿™ä¸ªlearngitä»“åº“è¿˜æ˜¯ç©ºçš„ï¼ŒGitHubå‘Šè¯‰æˆ‘ä»¬ï¼Œå¯ä»¥ä»è¿™ä¸ªä»“åº“å…‹éš†å‡ºæ–°çš„ä»“åº“ï¼Œä¹Ÿå¯ä»¥æŠŠä¸€ä¸ªå·²æœ‰çš„æœ¬åœ°ä»“åº“ä¸ä¹‹å…³è”ï¼Œç„¶åï¼ŒæŠŠæœ¬åœ°ä»“åº“çš„å†…å®¹æ¨é€åˆ°GitHubä»“åº“ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬æ ¹æ®GitHubçš„æç¤ºï¼Œåœ¨æœ¬åœ°çš„learngitä»“åº“ä¸‹è¿è¡Œå‘½ä»¤ï¼šÂ git remote add origin git@github.com:mengchao666/learngit.gitÂ è¯·åƒä¸‡æ³¨æ„ï¼ŒæŠŠä¸Šé¢çš„mengchao666æ›¿æ¢æˆä½ è‡ªå·±çš„GitHubè´¦æˆ·åï¼Œå¦åˆ™ï¼Œä½ åœ¨æœ¬åœ°å…³è”çš„å°±æ˜¯æˆ‘çš„è¿œç¨‹åº“ï¼Œä½ ä»¥åæ¨é€æ˜¯æ¨ä¸ä¸Šå»çš„ï¼Œå› ä¸ºä½ çš„SSH Keyå…¬é’¥ä¸åœ¨æˆ‘çš„è´¦æˆ·åˆ—è¡¨ä¸­ã€‚ æ·»åŠ åï¼Œè¿œç¨‹åº“çš„åå­—å°±æ˜¯originï¼Œè¿™æ˜¯Gité»˜è®¤çš„å«æ³•ï¼Œä¹Ÿå¯ä»¥æ”¹æˆåˆ«çš„ï¼Œä½†æ˜¯originè¿™ä¸ªåå­—ä¸€çœ‹å°±çŸ¥é“æ˜¯è¿œç¨‹åº“ã€‚ä¸‹ä¸€æ­¥ï¼Œå°±å¯ä»¥æŠŠæœ¬åœ°åº“çš„æ‰€æœ‰å†…å®¹æ¨é€åˆ°è¿œç¨‹åº“ä¸Šï¼šÂ git push -u origin masteræŠŠæœ¬åœ°åº“çš„å†…å®¹æ¨é€åˆ°è¿œç¨‹ï¼Œç”¨git pushå‘½ä»¤ï¼Œå®é™…ä¸Šæ˜¯æŠŠå½“å‰åˆ†æ”¯masteræ¨é€åˆ°è¿œç¨‹ã€‚ ç”±äºè¿œç¨‹åº“æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡æ¨é€masteråˆ†æ”¯æ—¶ï¼ŒåŠ ä¸Šäº†-uå‚æ•°ï¼ŒGitä¸ä½†ä¼šæŠŠæœ¬åœ°çš„masteråˆ†æ”¯å†…å®¹æ¨é€çš„è¿œç¨‹æ–°çš„masteråˆ†æ”¯ï¼Œè¿˜ä¼šæŠŠæœ¬åœ°çš„masteråˆ†æ”¯å’Œè¿œç¨‹çš„masteråˆ†æ”¯å…³è”èµ·æ¥ï¼Œåœ¨ä»¥åçš„æ¨é€æˆ–è€…æ‹‰å–æ—¶å°±å¯ä»¥ç®€åŒ–å‘½ä»¤ã€‚ æ¨é€æˆåŠŸåï¼Œå¯ä»¥ç«‹åˆ»åœ¨GitHubé¡µé¢ä¸­çœ‹åˆ°è¿œç¨‹åº“çš„å†…å®¹å·²ç»å’Œæœ¬åœ°ä¸€æ¨¡ä¸€æ ·,ä»ç°åœ¨èµ·ï¼Œåªè¦æœ¬åœ°ä½œäº†æäº¤ï¼Œå°±å¯ä»¥é€šè¿‡å‘½ä»¤ï¼šÂ git push origin master ä¸‰ã€å…ˆæœ‰è¿œç¨‹åº“ï¼Œåæœ‰æœ¬åœ°åº“ç°åœ¨ï¼Œè¿œç¨‹åº“å·²ç»å‡†å¤‡å¥½äº†ï¼Œä¸‹ä¸€æ­¥æ˜¯ç”¨å‘½ä»¤git cloneå…‹éš†ä¸€ä¸ªæœ¬åœ°åº“ï¼šÂ git clone git@github.com:mengchao666/learngit.git å¯ä»¥ä½¿ç”¨git clone -b branchå…‹éš†æŒ‡å®šçš„åˆ†æ”¯åç»­ä¿®æ”¹å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æäº¤ 123git add .git commit -m &quot;message&quot;git push å››ã€ä¼ä¸šå¼€å‘æµç¨‹åœ¨å…¬å¸ä¸­åšé¡¹ç›®ï¼Œä¸€èˆ¬é¡¹ç›®ä»£ç éƒ½åœ¨å…¬å…±ä»“åº“ä¸­ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºè¿œç¨‹ä»“ï¼Œä¸€èˆ¬æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤å¼€å‘1ã€å°†è¿œç¨‹ä»“forkä¸€ä»½åˆ°ä¸ªäººä»“2ã€git cloneä¸ªäººä»“ä»£ç åˆ°æœ¬åœ°3ã€ä½¿ç”¨git remote -vå‘½ä»¤æŸ¥çœ‹ï¼Œæ­¤æ—¶æœ¬åœ°å…³è”çš„originä¸ºä¸ªäººä»“4ã€å°†æœ¬åœ°ä»£ç å…³è”åˆ°å…¬å¸çš„è¿œç¨‹ä»“ï¼Œæ–¹ä¾¿æ‹‰å–æœ€æ–°ä»£ç ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 1git remote add upstream å…¬å…±ä»“åœ°å€ æ­¤æ—¶å†æ¬¡ä½¿ç”¨git remote -vå¯ä»¥çœ‹åˆ°å·²ç»å…³è”äº†upstreamä¸ºè¿œç¨‹ä»“5ã€åœ¨å¼€å‘éœ€æ±‚å’Œé—®é¢˜å•ä¿®æ”¹ä¹‹å‰ï¼Œä¸€èˆ¬ä½¿ç”¨git pull upstreamå‘½ä»¤å°†è¿œç¨‹ä»“ä»£ç æ›´æ–°è‡³æœ¬åœ°6ã€ä¿®æ”¹ä»£ç åæäº¤ 123git add .git commit -m &quot;message&quot;git push origin branch 7ã€åœ¨github&#x2F;gitlabé¡µé¢åˆ›å»ºMRç”³è¯·ï¼Œä¸€èˆ¬æ­¤æ—¶å°±å¯ä»¥äº†ï¼Œæ‰¾äººåŠ åˆ†å°±åˆå…¥äº†8ã€ä½†æ˜¯å¦‚æœåœ¨åˆ›å»ºMRç”³è¯·æ—¶ï¼Œæç¤ºå†²çªï¼Œæ­¤æ—¶éœ€è¦è§£å†³å†²çªï¼Œè§£å†³å¦‚ä¸‹ï¼š 1git pull upstream æ­¤æ—¶ä¼šæç¤ºå“ªäº›æ–‡ä»¶æœ‰å†²çªï¼Œä½¿ç”¨ctrl + Fæœç´¢&gt;&gt;&gt;,æœ‰æ­¤æ ‡å¿—çš„å³ä¸ºå†²çªçš„åœ°æ–¹ï¼Œä¿ç•™è‡ªå·±æƒ³è¦çš„ä»£ç ï¼Œé‡æ–°æäº¤add commit pushå³å¯ã€‚ ä¼ä¸šå¼€å‘æµç¨‹ä¸­ï¼Œé€šå¸¸æœ‰è¿œç¨‹ä»“æ–°å»ºäº†ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸ªäººè¿œç¨‹ä»“æ²¡æœ‰æ­¤åˆ†æ”¯ï¼Œéœ€è¦æ›´æ–°ï¼Œå¯æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ›´æ–°ä¸ªäººä»“ä»£ç åˆ†æ”¯ 123git checkout -b æ–°åˆ†æ”¯åç§° upstream/æ–°åˆ†æ”¯åç§°git pull upstream æ–°åˆ†æ”¯åç§°git push origin æ–°åˆ†æ”¯åç§° äº”ã€ä»£ç å›é€€ç­‰æ“ä½œå·¥ä½œåŒºçš„æ¢å¤(æ­¤æ—¶è¿˜æ²¡æœ‰addï¼Œä»£ç å›é€€)ä½¿ç”¨checkoutæ¢å¤å·¥ä½œåŒºÂ git checkout .Â ï¼ˆå…¨éƒ¨ä¿®æ”¹ï¼‰ï¼Œgit checkout --fileæ”¹å›ä¸€ä¸ªæ–‡ä»¶,å·¥ä½œåŒºâ€”&gt;è¿˜æ²¡add addçš„æ’¤é”€git resetå°±æ˜¯å›é€€åˆ°æŒ‡å®šçš„commitID,,ä½¿ç”¨git commit â€“amendæ—¶è¿½åŠ ï¼Œä¸ä¼šç”Ÿæˆæ–°çš„commitID,æ˜¯åœ¨åŸæ¥çš„commitIDåŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹çš„ã€‚ HEADæŒ‡å‘å½“å‰æœ€æ–°çš„commitIDï¼Œæ‰€ä»¥ä»…ä»…add,æ²¡æœ‰commitï¼Œæ­¤æ—¶çš„æœ€æ–°çš„commitIDè¿˜æ˜¯ä¹‹å‰çš„ 12git reset --hard HEAD // ä¸ä¿ç•™æœ¬åœ°ä¿®æ”¹ï¼Œå›é€€git reset --mixed HEAD //ä¿ç•™æœ¬åœ°ä¿®æ”¹ï¼Œå¯ä»¥é‡æ–°git add ç®€å•ç†è§£git reset â€“xxx HEADå‘½ä»¤ï¼Œå°±æ˜¯å°†ä»£ç å›é€€åˆ°äº†æœ€æ–°çš„ä¸€æ¬¡commitIDçš„ä»£ç çŠ¶æ€ï¼Œhardä¸ä¿ç•™æœ¬åœ°ä»£ç å·¥ä½œç©ºé—´çš„ä¿®æ”¹ï¼Œè€Œmixedä¿ç•™ commitåçš„æ’¤é”€123git reset --hard HEAD^ // ä¸ä¿ç•™æœ¬åœ°ä¿®æ”¹ï¼Œå›é€€åˆ°ä¸Šä¸€æ¬¡çš„commitIDçŠ¶æ€git reset --mixed HEAD^ // ä¿ç•™æœ¬åœ°ä¿®æ”¹ï¼Œæ’¤é”€git commit,å¹¶ä¸”æ’¤é”€git addgit reset --soft HEAD^ //ä¿ç•™æœ¬åœ°ä¿®æ”¹ï¼Œæ’¤é”€commit,ä¸æ’¤é”€add å…­ã€gitçš„ä¸€äº›å…¶ä»–æ“ä½œæŸ¥çœ‹åˆ†æ”¯ï¼šgit branchÂ åˆ›å»ºåˆ†æ”¯ï¼šgit branch &lt;name&gt;Â åˆ‡æ¢åˆ†æ”¯ï¼šgit checkout &lt;name&gt;æˆ–è€…git switch &lt;name&gt;Â åˆ›å»º+åˆ‡æ¢åˆ†æ”¯ï¼šgit checkout -b &lt;name&gt;æˆ–è€…git switch -c &lt;name&gt;Â åˆå¹¶æŸåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ï¼šgit merge &lt;name&gt;Â åˆ é™¤åˆ†æ”¯ï¼šgit branch -d &lt;name&gt; å½“ä»£ç ä»“æœ‰å­ä»“æƒ…å½¢ä¸‹çš„ä¸€äº›å‘½ä»¤ï¼šgit submodule update --init --remotegit submodule foreach git checkout branchgit submodule foreach --recursive ä¸ƒã€åŒæ—¶æäº¤ä¸¤ä¸ªMRå½“æˆ‘ä»¬åŒæ—¶ä¿®æ”¹å¤šä¸ªé—®é¢˜å•ï¼Œæˆ–è€…åŒæ—¶å¤„ç†éœ€æ±‚æ—¶ï¼Œå¯èƒ½éœ€è¦åŒæ—¶æäº¤å¤šåˆ†ä¸åŒä»£ç ï¼Œæ­¤æ—¶å¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š 1ã€æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯æ¥å¤„ç†ç¬¬ä¸€ä¸ªMR 1git checkout -b mr1-branch 2ã€æäº¤ç¬¬ä¸€ä¸ªMRã€‚ä¿®æ”¹ä»£ç ï¼Œgit addã€git commitï¼Œgit push 1git push -u origin mr1-branch 3ã€åˆ‡æ¢å›åŸæ¥çš„åˆ†æ”¯ï¼Œä»¥mainåˆ†æ”¯ä¸ºä¾‹ 1git checkout main 4ã€åˆ›å»ºç¬¬äºŒä¸ªåˆ†æ”¯å¤„ç†ç¬¬äºŒä¸ªMR 1git checkout -b mr2-branch 5ã€æäº¤ç¬¬äºŒä¸ªMRã€‚ä¿®æ”¹ä»£ç ï¼Œgit addã€git commitï¼Œgit push 1git push -u origin mr2-branch","tags":["git"],"categories":["git"]},{"title":"addr2line","path":"/posts/addr2line.html","content":"addr2lineæ˜¯ä¸€ä¸ªå°†åœ°å€è½¬æ¢ä¸ºæ–‡ä»¶åå’Œè¡Œå·çš„å·¥å…·ã€‚ç»™å®šå¯æ‰§è¡Œæ–‡ä»¶(å¦‚exe&#x2F;a.outç­‰)ä¸­çš„åœ°å€æˆ–å¯é‡å®šä½å¯¹è±¡(å¦‚so,koç­‰)éƒ¨åˆ†ä¸­çš„åç§»é‡ï¼Œå®ƒä¼šä½¿ç”¨è°ƒè¯•ä¿¡æ¯æ¥ç¡®å®šä¸ä¹‹ç›¸å…³çš„æ–‡ä»¶åå’Œè¡Œæ•°ã€‚ ç”¨æˆ·æ€coredumpï¼Œä¸€èˆ¬ä½¿ç”¨gdbè°ƒè¯•æ¥å£ï¼Œgdbä¸€èˆ¬å°è£…äº†addr2lineï¼Œå¯ä»¥è§£ææ–‡ä»¶åå’Œè¡Œå·ã€‚å¦‚æœç¯å¢ƒé…ç½®äº†ä¸ç”Ÿæˆcoredumpï¼Œå¯ä»¥ä½¿ç”¨addr2lineè°ƒè¯•ã€‚æ‰€ä»¥addr2lineä¸€èˆ¬è§£æå†…æ ¸Call traceä½¿ç”¨è¾ƒå¤šã€‚ ä¸€ã€ä½¿ç”¨æ–¹æ³•12åŸºæœ¬ç”¨æ³•ï¼šaddr2line [é€‰é¡¹] [åœ°å€] å¸¸ç”¨é€‰é¡¹å¦‚ä¸‹ï¼š é€‰é¡¹ æè¿° -e è®¾ç½®è¾“å…¥æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸ºa.out -i è§£æå†…è”å‡½æ•° -f æ˜¾ç¤ºå‡½æ•°å -C è§£æå‡½æ•°å -p ä»¥å¥½è¯»çš„æ–¹å¼æ˜¾ç¤º éœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨addr2lineçš„æ—¶å€™ï¼Œå¯æ‰§è¡Œæ–‡ä»¶æˆ–é‡å®šä½æ–‡ä»¶ä¸€å®šæ˜¯è¦å¸¦è°ƒè¯•ä¿¡æ¯çš„ äºŒã€ç”¨æˆ·æ€æ™®é€šç¨‹åºå´©æºƒä½¿ç”¨æ–¹æ³• 1addr2line -e è¿›ç¨‹å IPæŒ‡ä»¤åœ°å€ -f ç”¨æˆ·æ€ç¨‹åºå´©æºƒï¼Œå½“æ²¡æœ‰coredumpäº§ç”Ÿæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•å‡è®¾æˆ‘ä»¬çš„ç¨‹åºåç§°ä¸ºsegfault,å½“ç¨‹åºå´©æºƒæ˜¯ï¼Œdmesgæ—¥å¿—ä¸­ä¼šæœ‰æŠ¥é”™ä¿¡æ¯: 123[root@localhost ~]# dmesg[134563.793925] segfault[53791]: segfault at 0 ip 0000000000400546 sp 00007fff7956af70 error 6 in segfault[400000+1000][134563.793946] Code: 01 5d c3 90 c3 66 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 40 00 f3 0f 1e fa eb 8a 55 48 89 e5 48 c7 45 f8 00 00 00 00 48 8b 45 f8 &lt;c7&gt; 00 00 00 00 00 b8 00 00 00 00 5d c3 66 2e 0f 1f 84 00 00 00 00 æ­¤æ—¶æˆ‘ä»¬æ³¨æ„åˆ°IPæŒ‡ä»¤åœ°å€ä¸º0000000000400546ä½¿ç”¨addr2lineæŸ¥çœ‹ç¨‹åºæŒ‚çš„ä½ç½®ï¼š 1addr2line -e segfault 0x0000000000400546 -f ä¸‰ã€åŠ¨æ€é“¾æ¥åº“ç¨‹åºå´©æºƒä½¿ç”¨æ–¹æ³• 1addr2line -e åŠ¨æ€é“¾æ¥åº“åç§° IPæŒ‡ä»¤åœ°å€-åŸºåœ°å€ -f å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç¨‹åºåä¸ºtestï¼Œé“¾æ¥äº†ä¸€ä¸ªlibfoo.soï¼Œç¨‹åºè¿è¡Œæ—¶å´©æºƒï¼ŒdmesgæŸ¥çœ‹æ—¥å¿—å¦‚ä¸‹ï¼š 123[root@localhost ~]# dmesg[70567.416655] test[27722]: segfault at 0 ip 00007ffa1f588580 sp 00007fffa964e698 error 6 in libfoo.so[7ffa1f588000+1000][70567.427374] Code: ff e8 64 ff ff ff c6 05 bd 0a 20 00 01 5d c3 0f 1f 00 c3 0f 1f 80 00 00 00 00 f3 0f 1e fa e9 77 ff ff ff 0f 1f 80 00 00 00 00 &lt;c7&gt; 04 25 00 00 00 00 00 00 00 00 0f 0b 00 00 00 f3 0f 1e fa 48 83 æ ¹æ®æ—¥å¿—å¯çŸ¥ï¼Œæ®µé”™è¯¯å‘ç”Ÿçš„ä½ç½®æ˜¯åœ¨testè¿›ç¨‹è°ƒç”¨çš„libfoo.soåº“é‡Œï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨lddæ‰¾åˆ°åŠ¨æ€åº“çš„ä½ç½®ï¼Œå¦‚ä¸‹ï¼š 12345[root@localhost 69]# ldd test linux-vdso.so.1 (0x00007ffd15b24000) libfoo.so =&gt; ./libfoo.so (0x00007f8c01879000) libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f8c014b4000) /lib64/ld-linux-x86-64.so.2 (0x00007f8c01a7b000) 00007ffa1f588580ä¸ºç¨‹åºå´©æºƒç‚¹IPæŒ‡ä»¤åœ°å€ï¼Œä½¿ç”¨dmesgæ¶ˆæ¯ä¸­ipæŒ‡ä»¤åœ°å€å‡å»åŠ¨æ€åº“åŸºå€å€¼(00007ffa1f588580 -7ffa1f588000&#x3D;580), å·®å€¼0x580ä¸ºé”™è¯¯ç‚¹åœ¨åŠ¨æ€åº“çš„åœ°å€ï¼Œè°ƒç”¨addr2line, æ³¨æ„-eå‚æ•°åæ–‡ä»¶åæ”¹ä¸ºåŠ¨æ€åº“å: 1addr2line -e libfoo.so 580 -f -p å››ã€å†…æ ¸é©±åŠ¨ç¨‹åºè¿è¡Œå´©æºƒä½¿ç”¨æ–¹æ³•ï¼š 1addr2line -e xxx.ko åœ°å€åç§»é‡ -f æœ¬äººæ‰€ç”¨ä¸»æœºå³å±äºä¸€æ—¦å‘ç”ŸOopsï¼Œå°±ä¼šè§¦å‘panicï¼Œå› æ­¤æ€»æ˜¯æ— æ³•æŸ¥çœ‹Oopsæ—¶çš„dmesgæ—¥å¿—ï¼Œç»æŸ¥é˜…èµ„æ–™ï¼Œå‘ç°æ˜¯å†…æ ¸å‚æ•°panic_on_oopsçš„åŸå› å¯¼è‡´çš„ï¼Œå› ä¸ºè¯¥å‚æ•°è¢«è®¾ç½®ä¸º1ï¼Œæ‰€ä»¥Oopsä¼šè§¦å‘panicï¼Œä»è€Œå¯¼è‡´æœºå™¨æ€»æ˜¯æ­»æœºé‡å¯ï¼Œæ— æ³•æŸ¥çœ‹Oopsæ—¶çš„dmesgæ—¥å¿—ã€‚ä¸‹é¢æä¾›ä¸¤ç§æ–¹æ³•ä¿®æ”¹Oopså†…æ ¸å‚æ•°ï¼Œä½¿å…¶ä¸ä¼šåœ¨Oopsçš„æ—¶å€™è§¦å‘panicå¯¼è‡´æ­»æœºé‡å¯ã€‚ æ–¹æ³•ä¸€ï¼šä¿®æ”¹ &#x2F;procä¸‹å†…æ ¸å‚æ•°æ–‡ä»¶å†…å®¹ï¼Œä¸´æ—¶ç”Ÿæ•ˆï¼Œé‡å¯åå¤±æ•ˆã€‚ 1echo 0 &gt; /proc/sys/kernel/panic_on_oops æ–¹æ³•äºŒï¼šä¿®æ”¹&#x2F;etc&#x2F;sysctl.conf æ–‡ä»¶çš„å†…æ ¸å‚æ•°æ¥æ°¸ä¹…æ›´æ”¹ã€‚ 1234567891011121314151617181920[root@localhost ~]# vi /etc/sysctl.conf[root@localhost ~]# cat /etc/sysctl.conf# sysctl settings are defined through files in# /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.## Vendors settings live in /usr/lib/sysctl.d/.# To override a whole file, create a new file with the same in# /etc/sysctl.d/ and put new settings there. To override# only specific settings, add a file with a lexically later# name in /etc/sysctl.d/ and put new settings there.## For more information, see sysctl.conf(5) and sysctl.d(5).kernel.panic_on_oops=0[root@localhost ~]# cat /proc/sys/kernel/panic_on_oops1 [root@localhost ~]# sysctl -pkernel.panic_on_oops = 0[root@localhost ~]#[root@localhost ~]# cat /proc/sys/kernel/panic_on_oops0 å‡è®¾å†…æ ¸æŸkoè¿è¡Œåå‘ç”Ÿå¦‚ä¸‹é”™è¯¯ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051[root@localhost ~]# dmesg[ 1039.918606] my_oops_init[ 1039.918616] BUG: unable to handle kernel NULL pointer dereference at 0000000000000000[ 1039.926442] PGD 0 P4D 0[ 1039.928979] Oops: 0002 [#1] SMP NOPTI[ 1039.932637] CPU: 34 PID: 3843 Comm: insmod Kdump: loaded Tainted: G OE --------- - - 4.18.0-394.el8.x86_64 #1[ 1039.943756] Hardware name: New H3C Technologies Co., Ltd. H3C UniServer R4950 G5/RS45M2C9SB, BIOS 5.37 09/30/2021[ 1039.954000] RIP: 0010:do_oops+0x5/0x11 [oops][ 1039.958364] Code: Unable to access opcode bytes at RIP 0xffffffffc02e6fdb.[ 1039.965231] RSP: 0018:ffffb9d40a8c7cb0 EFLAGS: 00010246[ 1039.970449] RAX: 000000000000000c RBX: 0000000000000000 RCX: 0000000000000000[ 1039.977573] RDX: 0000000000000000 RSI: ffff98942ee96758 RDI: ffff98942ee96758[ 1039.984697] RBP: ffffffffc02e7011 R08: 0000000000000000 R09: c0000000ffff7fff[ 1039.991822] R10: 0000000000000001 R11: ffffb9d40a8c7ad8 R12: ffffffffc02e9000[ 1039.998944] R13: ffffffffc02e9018 R14: ffffffffc02e91d0 R15: 0000000000000000[ 1040.006069] FS: 00007f1b8d93b740(0000) GS:ffff98942ee80000(0000) knlGS:0000000000000000[ 1040.014145] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033[ 1040.019884] CR2: ffffffffc02e6fdb CR3: 0000000145c02000 CR4: 0000000000350ee0[ 1040.027008] Call Trace:[ 1040.029454] my_oops_init+0x16/0x19 [oops][ 1040.033550] do_one_initcall+0x46/0x1d0[ 1040.037390] ? do_init_module+0x22/0x220[ 1040.041318] ? kmem_cache_alloc_trace+0x142/0x280[ 1040.046023] do_init_module+0x5a/0x220[ 1040.049777] load_module+0x14ba/0x17f0[ 1040.053530] ? __do_sys_finit_module+0xb1/0x110[ 1040.058059] __do_sys_finit_module+0xb1/0x110[ 1040.062411] do_syscall_64+0x5b/0x1a0[ 1040.066077] entry_SYSCALL_64_after_hwframe+0x65/0xca[ 1040.071130] RIP: 0033:0x7f1b8c8509bd[ 1040.074701] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 &lt;48&gt; 3d 01 f0 ff ff 73 01 c3 48 8b 0d 9b 54 38 00 f7 d8 64 89 01 48[ 1040.093446] RSP: 002b:00007ffc4df0a968 EFLAGS: 00000246 ORIG_RAX: 0000000000000139[ 1040.101004] RAX: ffffffffffffffda RBX: 00005653fb1997d0 RCX: 00007f1b8c8509bd[ 1040.108126] RDX: 0000000000000000 RSI: 00005653f980c8b6 RDI: 0000000000000003[ 1040.115251] RBP: 00005653f980c8b6 R08: 0000000000000000 R09: 00007f1b8cbd9760[ 1040.122375] R10: 0000000000000003 R11: 0000000000000246 R12: 0000000000000000[ 1040.129498] R13: 00005653fb1997b0 R14: 0000000000000000 R15: 0000000000000000[ 1040.136623] Modules linked in: oops(OE+) binfmt_misc xt_CHECKSUM ipt_MASQUERADE xt_conntrack ipt_REJECT nf_reject_ipv4 nft_compat nft_counter nft_chain_nat nf_nat nf_conntrack nf_defrag_ipv6 nf_defrag_ipv4 nf_tables nfnetlink rpcsec_gss_krb5 auth_rpcgss nfsv4 dns_resolver nfs lockd grace fscache bridge stp llc intel_rapl_msr intel_rapl_common amd64_edac_mod edac_mce_amd amd_energy kvm_amd kvm irqbypass ipmi_ssif pcspkr crct10dif_pclmul crc32_pclmul ghash_clmulni_intel rapl joydev ccp sp5100_tco i2c_piix4 k10temp ptdma acpi_ipmi ipmi_si sunrpc vfat fat xfs libcrc32c sd_mod t10_pi sg crc32c_intel ast drm_vram_helper drm_kms_helper syscopyarea sysfillrect sysimgblt fb_sys_fops drm_ttm_helper ttm ahci drm libahci nfp(OE) igb libata dca i2c_algo_bit dm_mirror dm_region_hash dm_log dm_mod ipmi_devintf ipmi_msghandler[ 1040.208357] CR2: 0000000000000000[ 1040.211668] ---[ end trace b69c1e8998070273 ]---[ 1040.230185] RIP: 0010:do_oops+0x5/0x11 [oops][ 1040.234540] Code: Unable to access opcode bytes at RIP 0xffffffffc02e6fdb.[ 1040.241409] RSP: 0018:ffffb9d40a8c7cb0 EFLAGS: 00010246[ 1040.246626] RAX: 000000000000000c RBX: 0000000000000000 RCX: 0000000000000000[ 1040.253750] RDX: 0000000000000000 RSI: ffff98942ee96758 RDI: ffff98942ee96758[ 1040.260876] RBP: ffffffffc02e7011 R08: 0000000000000000 R09: c0000000ffff7fff[ 1040.267998] R10: 0000000000000001 R11: ffffb9d40a8c7ad8 R12: ffffffffc02e9000[ 1040.275124] R13: ffffffffc02e9018 R14: ffffffffc02e91d0 R15: 0000000000000000[ 1040.282247] FS: 00007f1b8d93b740(0000) GS:ffff98942ee80000(0000) knlGS:0000000000000000[ 1040.290323] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033[ 1040.296061] CR2: ffffffffc02e6fdb CR3: 0000000145c02000 CR4: 0000000000350ee0 Oops: 0002 â€“ é”™è¯¯ç Oops: [#1] â€“ Oopså‘ç”Ÿçš„æ¬¡æ•°CPU: 34 â€“ è¡¨ç¤ºOopsæ˜¯å‘ç”Ÿåœ¨CPU34ä¸Šå…³é”®ä¿¡æ¯å¦‚ä¸‹ï¼Œè¿™é‡Œæç¤ºåœ¨æ“ä½œå‡½æ•°do_oopsçš„æ—¶å€™å‡ºç°å¼‚å¸¸ï¼Œåœ°å€åç§»é‡0x5ï¼š 1[ 1039.954000] RIP: 0010:do_oops+0x5/0x11 [oops] ä¸ºä»€ä¹ˆè¿™æ¡ä¿¡æ¯å…³é”®? å› ä¸ºå…¶å«æœ‰æŒ‡ä»¤æŒ‡é’ˆRIPï¼›æŒ‡ä»¤æŒ‡é’ˆIP&#x2F;EIP&#x2F;RIPçš„åŸºæœ¬åŠŸèƒ½æ˜¯æŒ‡å‘è¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡åœ°å€ã€‚åœ¨8080 8ä½å¾®å¤„ç†å™¨ä¸Šçš„å¯„å­˜å™¨åç§°æ˜¯PCï¼ˆprogram counterï¼Œç¨‹åºè®¡æ•°å™¨ï¼‰ï¼Œä»8086èµ·ï¼Œè¢«ç§°ä¸ºIPï¼ˆinstruction pointerï¼ŒæŒ‡ä»¤æŒ‡é’ˆï¼‰ã€‚ä¸»è¦åŒºåˆ«åœ¨ä¸PCæŒ‡å‘æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œè€ŒIPæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚åœ¨64ä½æ¨¡å¼ä¸‹ï¼ŒæŒ‡ä»¤æŒ‡é’ˆæ˜¯RIPå¯„å­˜å™¨ã€‚è¿™ä¸ªå¯„å­˜å™¨ä¿å­˜ç€ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„64ä½åœ°å€åç§»é‡ã€‚64ä½æ¨¡å¼æ”¯æŒä¸€ç§æ–°çš„å¯»å€æ¨¡å¼ï¼Œè¢«ç§°ä¸ºRIPç›¸å¯¹å¯»å€ã€‚ä½¿ç”¨è¿™ä¸ªæ¨¡å¼ï¼Œæœ‰æ•ˆåœ°å€çš„è®¡ç®—æ–¹å¼å˜ä¸ºRIPï¼ˆæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼‰åŠ ä¸Šä½ç§»é‡ã€‚ ç”±æ­¤å¯ä»¥çœ‹å‡ºå†…æ ¸æ‰§è¡Œåˆ°do_oops+0x5&#x2F;0x11è¿™ä¸ªåœ°å€çš„æ—¶å€™å‡ºç°å¼‚å¸¸ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°è¿™ä¸ªåœ°å€å¯¹åº”çš„ä»£ç å³å¯ã€‚ do_oopsæŒ‡ç¤ºäº†æ˜¯åœ¨do_oopså‡½æ•°ä¸­å‡ºç°çš„å¼‚å¸¸ï¼Œ 0x5è¡¨ç¤ºå‡ºé”™çš„åœ°å€åç§»é‡ï¼Œ 0x11è¡¨ç¤ºdo_oopså‡½æ•°çš„å¤§å°ã€‚ 123æ‰“å°æ ¼å¼ï¼šdo_oops+0x5/0x11 [oops] å³ï¼šsymbol+offset/size [module] symbol: ç¬¦å· offsetï¼šåœ°å€åç§»é‡ sizeï¼šå‡½æ•°çš„é•¿åº¦ module: æ‰€å±å†…æ ¸æ¨¡å— ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è§£æ 1addr2line -e oops.ko 0x5 -f -p","tags":["Linuxå·¥å…·"],"categories":["Linuxå·¥å…·"]},{"title":"ä¸ªäººåšå®¢ç½‘ç«™éƒ¨ç½²&æ–‡ç« æäº¤","path":"/posts/ç½‘ç«™éƒ¨ç½²-å†™ä½œ.html","content":"ä¸€ã€ç½‘ç«™éƒ¨ç½²1ã€é¦–å…ˆåœ¨githubä¸Šåˆ›å»ºè‡ªå·±çš„ä¸€ä¸ªä»“åº“ï¼Œä»“åº“åå­—ä¸ºmengchao666.github.io 2ã€å°†https://github.com/mengchao666/blog-demoä»£ç ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç”¨VScodeæ‰“å¼€ 3ã€å®‰è£…node.jsï¼Œpnpmï¼Œhexo 123node.jså®˜ç½‘å®‰è£…ï¼šhttps://nodejs.cn/download/pnpmå®‰è£…ï¼šnpm install pnpm -ghexoå®‰è£…ï¼šnpm install hexo-cli -g 4ã€åœ¨Vscodeæ‰“å¼€çš„é¡¹ç›®ç»ˆç«¯ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 12pnpm ipnpm dev 5ã€ä½¿ç”¨hexo deployå‘½ä»¤éƒ¨ç½²ï¼Œæ‰“å¼€mengchao666.github.ioå³å¯ 6ã€æ–°å¢æ–‡ç« ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ–°å¢ ä¾‹å¦‚ï¼šhexo new post â€œç½‘ç«™éƒ¨ç½²â€ 1hexo new post &lt;title&gt; 7ã€æ–°å¢æ–‡ç« åï¼Œä½¿ç”¨å‘½ä»¤éƒ¨ç½²æäº¤åˆ°github 12hexo cleanhexo deploy æ›´å¤šæ“ä½œå¯ä»¥å‚è€ƒï¼šhttps://xaoxuu.com/wiki/stellar/topic.html","tags":["ç½‘ç«™"],"categories":["ç½‘ç«™"]},{"title":"å‹é“¾","path":"/about/index.html","content":"æˆ‘çš„å°ä¼™ä¼´ä»¬ github å¦‚ä½•äº¤æ¢å‹é“¾ï¼Ÿ æ‚¨çš„ç½‘ç«™åº”æ»¡è¶³ä»¥ä¸‹å…¨éƒ¨æ¡ä»¶ï¼š å®‰å…¨åˆè§„ï¼šåˆæ³•çš„ã€éè¥åˆ©æ€§ã€æ— æœ¨é©¬æ¤å…¥çš„ HTTPS ç«™ç‚¹ã€‚ éç©ºå£³ç½‘ç«™ï¼šç½‘ç«™å†…å‘å¸ƒè‡³å°‘ äº”ç¯‡ åŸåˆ›æ–‡ç« ï¼Œå†…å®¹é¢˜æä¸é™ã€‚ æˆ‘ä»¬éœ€è¦æœ‰ä¸€å®šçš„æœ‰æ•ˆäº’åŠ¨ï¼š å…ˆå‹åé“¾ï¼šä¸ æˆ‘ æœ‰è‡³å°‘ åŠå¹´ çš„æœ‰æ•ˆäº’åŠ¨"},{"title":"æ¢ç´¢è€…ç¬”è®°","path":"/explore/notes/æ¢ç´¢è€…ç¬”è®°.html","content":"memos è¯´è¯´ æœ¬é¡µé¢æ•°æ®æ¥æºäºï¼šmemos"},{"path":"/static/js/snow.js","content":"const message = { toast: (msg, duration) => { const d = Number(isNaN(duration) ? 2000 : duration); var el = document.createElement('div'); el.classList.add('toast'); el.classList.add('show'); el.innerHTML = msg; document.body.appendChild(el); setTimeout(function () { document.body.removeChild(el) }, d); }, } const Config = { snow: ['â„ï¸', 'â˜ƒï¸', 'â„', 'â€»', 'â…', 'â†', 'âˆ', 'â‰', 'âŠ', 'â‹'], color: '#d9e2e7', speed: 10, dom: document.getElementsByTagName('body')[0], interval: 800, active: false }; // ä» localStorage è·å–é›ªèŠ±æ¨¡å¼çŠ¶æ€ const storedSnowActive = localStorage.getItem('snowActive'); Config.active = storedSnowActive === 'true'; // ç¡®ä¿ DOM å…ƒç´ å­˜åœ¨ if (!Config.dom) { throw Error('è¯·è·å–å­˜åœ¨çš„DOM'); } const $canvas = document.createElement('div'); function useStyle(dom, style) { for (let sKey in style) { dom.style[sKey] = style[sKey]; } } useStyle($canvas, { width: '100%', height: '100%', position: 'fixed', top: 0, left: 0, pointerEvents: 'none', zIndex: 100 }); const matchDarkMode = window.matchMedia('(prefers-color-scheme: dark)'); function handleColorSchemeChange(e) { Config.color = e.matches ? 'rgb(255, 255, 255)' : 'rgb(149, 141, 186)'; } matchDarkMode.addEventListener('change', handleColorSchemeChange); handleColorSchemeChange(matchDarkMode); let snowInterval; function startSnowInterval() { return setInterval(() => { const $snow = document.createElement('div'); $snow.innerText = Config.snow[Math.floor(Math.random() * Config.snow.length)]; useStyle($snow, { display: 'inline-block', color: Config.color, fontSize: Math.floor(Math.random() * (25 - 14 + 1) + 14) + 'px', position: 'absolute', top: 0, left: Math.floor(Math.random() * 100) + '%', transition: 'transform ' + Config.speed + 's linear,opacity ' + Config.speed + 's linear', transform: 'translateY(-100%)', opacity: Math.random() + 0.3 }); setTimeout(() => { useStyle($snow, { transform: 'translate(0, ' + window.innerHeight + 'px) rotate(480deg)', opacity: 0 }); $snow.addEventListener('transitionend', () => { $snow.remove(); }); }, 100); $canvas.appendChild($snow); }, Config.interval); } function toggleSnow() { if (Config.active) { clearInterval(snowInterval); $canvas.innerHTML = ''; Config.active = false; message.toast(\"åˆ‡æ¢åˆ°æ™´å¤©æ¨¡å¼\"); } else { snowInterval = startSnowInterval() Config.active = true; message.toast(\"åˆ‡æ¢åˆ°ä¸‹é›ªæ¨¡å¼\"); } localStorage.setItem('snowActive', Config.active); } // åœ¨é¡µé¢åŠ è½½æ—¶åº”ç”¨ä¹‹å‰çš„çŠ¶æ€ if (Config.active) { snowInterval = startSnowInterval() } Config.dom.appendChild($canvas);"},{"title":"å·¥å…·åº“","path":"/explore/sites/å·¥å…·åº“.html","content":"å·¥å…·åº“ VIPç”µå½±åœ¨çº¿è§‚çœ‹https://vip1280.net/æ–‡ä»¶æ ¼å¼è½¬æ¢https://convertio.co/zh/"},{"title":"ç‰›å®¢é›¶åŸºç¡€å…¥é—¨å‰ç«¯","path":"/wiki/niuke/ç‰›å®¢é›¶åŸºç¡€å…¥é—¨å‰ç«¯.html","content":"01 HTMLFED1 è¡¨å•ç±»å‹æè¿°è¯·ä¾æ¬¡å†™å‡ºä»¥ä¸‹ç±»å‹çš„è¾“å…¥æ¡†ã€‚ ç±»å‹ä¸ºå¯†ç ï¼Œé»˜è®¤å€¼ä¸º â€œnowcoderâ€ ç±»å‹ä¸ºå¤é€‰æ¡†ï¼Œä¸”çŠ¶æ€ä¸ºå·²å‹¾é€‰ æˆ‘çš„è§£ç­”1234&lt;form&gt; &lt;input type=&quot;password&quot; value=&quot;nowcoder&quot; /&gt; &lt;input type=&quot;checkbox&quot; checked=&quot;checked&quot; /&gt;&lt;/form&gt; æ³¨æ„ç‚¹ï¼š ç±»å‹ä¸ºå¤é€‰æ¡†ï¼Œinput å±æ€§çš„ checked &#x3D; â€œcheckedâ€ FED2 è¡¨æ ¼ç»“æ„æè¿°è¯·å†™å‡ºå…·æœ‰è¡¨æ ¼æ ‡é¢˜ä¸º â€œnowcoderâ€ çš„ 2 è¡Œ 3 åˆ—è¡¨æ ¼ç»“æ„ã€‚ æˆ‘çš„è§£ç­”1234567891011121314151617&lt;table&gt; &lt;caption&gt; nowcoder &lt;/caption&gt; &lt;tbody&gt; &lt;tr&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt;&lt;/table&gt; mdn ç¤ºä¾‹ Council budget (in Â£) 2018 Items Expenditure Donuts 3,000 Stationery 18,000 Totals 21,000 FED3 å›¾åƒæ ‡ç­¾å±æ€§æè¿°è¯·å†™å‡ºå…·æœ‰æ ‡é¢˜å±æ€§å’Œä»£æ›¿æ–‡æœ¬å±æ€§çš„å›¾ç‰‡æ ‡ç­¾ã€‚ æˆ‘çš„è§£ç­”1&lt;img src=&quot;&quot; alt=&quot;&quot; title=&quot;&quot; /&gt; FED4 æ–°çª—å£æ‰“å¼€æ–‡æ¡£æè¿°è¯·å†™å‡ºå¯ä»¥åœ¨æ–°çª—å£æ‰“å¼€æ–‡æ¡£çš„ a æ ‡ç­¾ã€‚ æˆ‘çš„è§£ç­”1&lt;a href=&quot;&quot; target=&quot;_blank&quot;&gt;&lt;/a&gt; æ³¨æ„ç‚¹target è§„å®šåœ¨ä½•å¤„æ‰“å¼€ç›®æ ‡ URLã€‚ä»…åœ¨ href å±æ€§å­˜åœ¨æ—¶ä½¿ç”¨ _blankï¼šæ–°çª—å£æ‰“å¼€ã€‚ _parentï¼šåœ¨çˆ¶çª—å£ä¸­æ‰“å¼€é“¾æ¥ã€‚ _selfï¼šé»˜è®¤ï¼Œå½“å‰é¡µé¢è·³è½¬ã€‚ _topï¼šåœ¨å½“å‰çª—ä½“æ‰“å¼€é“¾æ¥ï¼Œå¹¶æ›¿æ¢å½“å‰çš„æ•´ä¸ªçª—ä½“(æ¡†æ¶é¡µ)ã€‚ FED5 è‡ªå®šä¹‰åˆ—è¡¨æè¿°è¯·å†™å‡ºåˆ—è¡¨é¡¹ä¸º â€œnowcoderâ€ ä¸”åˆ—è¡¨é¡¹å†…å®¹ä¹Ÿä¸º â€œnowcoderâ€ çš„è‡ªå®šä¹‰åˆ—è¡¨ã€‚ æˆ‘çš„è§£ç­”1234&lt;dl&gt; &lt;dt&gt;nowcoder&lt;/dt&gt; &lt;dd&gt;nowcoder&lt;/dd&gt;&lt;/dl&gt; æ³¨æ„ç‚¹ html5 å‰ç”¨å¾—å¤šï¼Œæ™®é€šåˆ—è¡¨æ ‡ç­¾ï¼Œæ—¢ä¸æ˜¯ ulï¼Œä¹Ÿä¸æ˜¯ ol FED6 è¯­ä¹‰åŒ–æ ‡ç­¾æè¿°è¯·ä½¿ç”¨è¯­ä¹‰åŒ–æ ‡ç­¾åˆ›å»ºå¤´éƒ¨æ ‡ç­¾ä¸”åŒ…å«å¯¼èˆªæ ‡ç­¾ã€‚æ³¨æ„ï¼šåªéœ€åœ¨ html æ¨¡å—å¡«å†™æ ‡ç­¾ç»“æ„ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¤´éƒ¨æ ‡ç­¾å’Œä¸€ä¸ªå¯¼èˆªæ ‡ç­¾ã€‚ æˆ‘çš„è§£ç­”123&lt;header&gt; &lt;nav&gt;&lt;/nav&gt;&lt;/header&gt; æ³¨æ„ç‚¹ å°±æ™®é€šåµŒå¥—ï¼Œçœ‹æŠ¥é”™æ‰çŸ¥é“æ ‡ç­¾å FED7 éŸ³é¢‘åª’ä½“æ ‡ç­¾å±æ€§æè¿°è¯·å†™å‡ºå…·æœ‰æ§ä»¶åŠŸèƒ½çš„éŸ³é¢‘åª’ä½“æ ‡ç­¾ã€‚ æˆ‘çš„è§£ç­”1&lt;audio src=&quot;&quot; controls&gt;&lt;/audio&gt; æ³¨æ„ç‚¹ controlsï¼šå¦‚æœå£°æ˜äº†è¯¥å±æ€§ï¼Œæµè§ˆå™¨å°†æä¾›ä¸€ä¸ªåŒ…å«å£°éŸ³ï¼Œæ’­æ”¾è¿›åº¦ï¼Œæ’­æ”¾æš‚åœçš„æ§åˆ¶é¢æ¿ï¼Œè®©ç”¨æˆ·å¯ä»¥æ§åˆ¶éŸ³é¢‘çš„æ’­æ”¾ã€‚ FED8 è§†é¢‘åª’ä½“æ ‡ç­¾å±æ€§æè¿°è¯·å†™å‡ºå…·æœ‰å½“è§†é¢‘çš„åª’ä½“æ•°æ®åŠ è½½æœŸé—´å‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡ŒæŸä¸ªæ–¹æ³•äº‹ä»¶çš„è§†é¢‘åª’ä½“æ ‡ç­¾ã€‚ æˆ‘çš„è§£ç­”1&lt;video src=&quot;&quot; onerror=&quot;fn()&quot; controls&gt;&lt;/video&gt;&lt;audio src=&quot;&quot; controls&gt;&lt;/audio&gt; æ³¨æ„ç‚¹ controlsï¼šå¦‚æœå­˜åœ¨è¯¥å±æ€§ï¼Œæµè§ˆå™¨ä¼šåœ¨è§†é¢‘åº•éƒ¨æä¾›ä¸€ä¸ªæ§åˆ¶é¢æ¿ï¼Œå…è®¸ç”¨æˆ·æ§åˆ¶è§†é¢‘çš„æ’­æ”¾ï¼ŒåŒ…æ‹¬éŸ³é‡ã€æ‹–åŠ¨è¿›åº¦ã€æš‚åœæˆ–æ¢å¤æ’­æ”¾ã€‚ 02 CSSFED9 CSS é€‰æ‹©å™¨â€”â€”æ ‡ç­¾ã€ç±»ã€ID é€‰æ‹©å™¨æè¿°è¯·å°† html æ¨¡å—ä¸­å­—ä½“å†…å®¹æ˜¯ â€œçº¢è‰²â€ çš„å­—ä½“é¢œè‰²è®¾ç½®ä¸º â€œrgb(255, 0, 0)â€ï¼Œâ€ç»¿è‰²â€ è®¾ç½®ä¸º â€œrgb(0, 128, 0)â€ï¼Œâ€é»‘è‰²â€ è®¾ç½®ä¸º â€œrgb(0, 0, 0)â€ï¼Œä¸”å­—ä½“å¤§å°éƒ½ä¸º 20pxã€‚ æˆ‘çš„è§£ç­”1234567891011121314&lt;style&gt; .green &#123; color: rgb(0, 128, 0); font-size: 20px; &#125; #black &#123; color: rgb(0, 0, 0); font-size: 20px; &#125;&lt;/style&gt;&lt;div style=&quot;color:rgb(255, 0, 0);font-size:20px&quot;&gt;çº¢è‰²&lt;/div&gt;&lt;div class=&quot;green&quot;&gt;ç»¿è‰²&lt;/div&gt;&lt;div id=&quot;black&quot;&gt;é»‘è‰²&lt;/div&gt; æ³¨æ„ç‚¹ ç±»é€‰æ‹©å™¨ï¼š. id é€‰æ‹©å™¨ï¼š# FED10 CSS é€‰æ‹©å™¨â€”â€”ä¼ªç±»é€‰æ‹©å™¨æè¿°è¯·å°† html æ¨¡å—ä¸­ ul åˆ—è¡¨çš„ç¬¬ 2 ä¸ª li æ ‡ç­¾å’Œç¬¬ 4 ä¸ª li æ ‡ç­¾çš„èƒŒæ™¯é¢œè‰²è®¾ç½®æˆ â€œrgb(255, 0, 0)â€ã€‚ æˆ‘çš„è§£ç­”1234567891011&lt;style&gt; li:nth-child(2n) &#123; background-color: rgb(255, 0, 0); &#125;&lt;/style&gt;&lt;ul&gt; &lt;li&gt;1&lt;/li&gt; &lt;li&gt;2&lt;/li&gt; &lt;li&gt;3&lt;/li&gt; &lt;li&gt;4&lt;/li&gt;&lt;/ul&gt; æ³¨æ„ç‚¹ ä¼ªç±»é€‰æ‹©å™¨ nth-child(2n)ï¼šå¶æ•°ä¸ª nth-child(2n-1)ï¼šå¥‡æ•°ä¸ª FED11 CSS é€‰æ‹©å™¨â€”â€”ä¼ªå…ƒç´ æè¿°è¯·ç»™ html æ¨¡å—çš„ div å…ƒç´ åŠ ä¸€ä¸ªåä¼ªå…ƒç´ ï¼Œä¸”åä¼ªå…ƒç´ çš„å®½åº¦å’Œé«˜åº¦éƒ½æ˜¯ 20pxï¼ŒèƒŒæ™¯é¢œè‰²ä¸º â€œrgb(255, 0, 0)â€ã€‚ æˆ‘çš„è§£ç­”12345678910&lt;style&gt; div::after &#123; content: &quot;&quot;; height: 20px; width: 20px; background-color: rgb(255, 0, 0); display: inline-block; &#125;&lt;/style&gt;&lt;div&gt;&lt;/div&gt; æ³¨æ„ç‚¹ ::after ä¼šåˆ›å»ºä¸€ä¸ª ä¼ªå…ƒç´ ï¼Œä½œä¸ºæ‰€é€‰å…ƒç´ çš„æœ€åä¸€ä¸ªå­å…ƒç´  åŒ…å« contentï¼Œå¯ä»¥è¡¨ç¤ºæ–‡å­—ï¼Œå›¾ç‰‡ç­‰ display: inline-block; è¦è®¾ç½®ä¸ºå—çº§å…ƒç´ æ‰èƒ½ç»™å…¶è®¾ç½®å®½é«˜ FED12 æŒ‰è¦æ±‚å†™ä¸€ä¸ªåœ†æè¿°è¯·å°† html æ¨¡å—çš„ div å…ƒç´ è®¾ç½®ä¸ºä¸€ä¸ªåŠå¾„æ˜¯ 50px çš„åœ†ï¼Œä¸”è¾¹æ¡†ä¸º 1px çš„é»‘è‰²å®çº¿ã€‚è¦æ±‚ï¼š åœ†è§’å±æ€§ä»…è®¾ç½®ä¸€ä¸ªå€¼ åœ†è§’å±æ€§å•ä½è¯·ä½¿ç”¨ px æ³¨æ„ï¼šç”±äºåœ†è§’å±æ€§è®¾ç½®å¹¿æ³›ä¸”éƒ½å¯ä»¥å®ç°é¢˜ç›®æ•ˆæœï¼Œæ‰€ä»¥è¯·æŒ‰ç…§è¦æ±‚è§„èŒƒä¹¦å†™ã€‚ æˆ‘çš„è§£ç­”123456789&lt;style&gt; div &#123; width: 100px; height: 100px; border-radius: 50px; border: 1px solid black; &#125;&lt;/style&gt;&lt;div&gt;&lt;/div&gt; æ³¨æ„ç‚¹ border-radius è®¾ç½®ä¸º 50%å°±æ˜¯ä¸€ä¸ªåœ† FED13 è®¾ç½®ç›’å­å®½é«˜æè¿°è¯·å°† html æ¨¡å—ç±»ä¸º â€œboxâ€ çš„ div å…ƒç´ å®½åº¦å’Œé«˜åº¦éƒ½è®¾ç½®ä¸º 100pxï¼Œä¸”å†…é—´è·ä¸º 20pxã€å¤–é—´è·ä¸º 10pxã€‚ æˆ‘çš„è§£ç­”123456789&lt;style&gt; .box &#123; width: 100px; height: 100px; padding: 20px; margin: 10px; &#125;&lt;/style&gt;&lt;div class=&quot;box&quot;&gt;&lt;/div&gt; æ³¨æ„ç‚¹ padding å†…è¾¹è·ï¼Œmargin å¤–è¾¹è· FED14 æµ®åŠ¨å’Œæ¸…é™¤æµ®åŠ¨æè¿°è¯·å°†ç±»ä¸º â€œleftâ€ çš„ div å…ƒç´ å’Œç±»ä¸º â€œrightâ€ çš„ div å…ƒç´ åœ¨åŒä¸€è¡Œä¸Šå‘å·¦æµ®åŠ¨ï¼Œä¸”æ¸…é™¤ç±»ä¸º â€œwrapâ€ çš„çˆ¶çº§ div å…ƒç´ å†…éƒ¨çš„æµ®åŠ¨ã€‚ æˆ‘çš„è§£ç­”123456789101112131415161718192021222324&lt;style&gt; .wrap::after &#123; content: &quot;&quot;; display: block; clear: both; &#125; .left &#123; width: 100px; height: 100px; background-color: red; float: left; &#125; .right &#123; width: 100px; height: 100px; background-color: yellow; float: left; &#125;&lt;/style&gt;&lt;div class=&quot;wrap&quot;&gt; &lt;div class=&quot;left&quot;&gt;&lt;/div&gt; &lt;div class=&quot;right&quot;&gt;&lt;/div&gt;&lt;/div&gt; æ³¨æ„ç‚¹ float å±æ€§å·¦å³å ä½ï¼Œä¸Šä¸‹ä¸å ä½ï¼Œæ‰€ä»¥ä¸‹é¢çš„å…ƒç´ ä¼šæµ®åŠ¨ä¸Šæ¥ï¼Œæ‰€ä»¥å¯ä»¥åœ¨çˆ¶ç±»ç›’å­åŠ ä¸€ä¸ª:: after ä¼ªç±»å…ƒç´ ï¼Œè®¾ç½® clear:both é—­åˆçˆ¶ç›’å­çš„è¾¹ç•Œä»¥è¾¾åˆ°æ¸…é™¤æµ®åŠ¨çš„ç›®çš„ã€‚ css - æ¸…é™¤æµ®åŠ¨ï¼ˆclearfixï¼‰çš„å¸¸è§æ–¹æ³• - front-end development - SegmentFault æ€å¦ FED15 æ®µè½æ ‡è¯†æè¿°è¯·å°†ä¸‹é¢è¿™å¥è¯ä»¥æ®µè½çš„å½¢å¼å±•ç¤ºåœ¨æµè§ˆå™¨ä¸­â€”â€”â€œç‰›å®¢ç½‘æ˜¯ä¸€ä¸ªä¸“æ³¨äºç¨‹åºå‘˜çš„å­¦ä¹ å’Œæˆé•¿çš„ä¸“ä¸šå¹³å°ã€‚â€ æˆ‘çš„è§£ç­”1&lt;p&gt;ç‰›å®¢ç½‘æ˜¯ä¸€ä¸ªä¸“æ³¨äºç¨‹åºå‘˜çš„å­¦ä¹ å’Œæˆé•¿çš„ä¸“ä¸šå¹³å°ã€‚&lt;/p&gt; æ³¨æ„ç‚¹ è€ƒå¯Ÿ p æ ‡ç­¾çš„ä½¿ç”¨æ–¹æ³• FED16 åœ£è¯æ ‘æè¿°åœ£è¯èŠ‚æ¥å•¦ï¼è¯·ç”¨ CSS ç»™ä½ çš„æœ‹å‹ä»¬åˆ¶ä½œä¸€é¢—åœ£è¯æ ‘å§~è¿™é¢—åœ£è¯æ ‘æè¿°èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š â€œtopbranchâ€æ˜¯åœ£è¯æ ‘çš„ä¸Šæå¶ï¼Œè¯¥ä¸Šæå¶ä»…é€šè¿‡è¾¹æ¡†å±æ€§ã€å·¦æµ®åŠ¨ã€å·¦å¤–è¾¹è·å³å¯å®ç°ã€‚è¾¹æ¡†çš„å±æ€§ä¾æ¬¡æ˜¯ï¼šå®½åº¦ä¸º 100pxã€æ˜¯ç›´çº¿ã€é¢œè‰²ä¸º greenï¼ˆæœªæ˜¾ç¤ºçš„è¾¹æ¡†é¢œè‰²éƒ½ä¸ºé€æ˜ï¼‰ â€œmiddleBranchâ€æ˜¯åœ£è¯æ ‘çš„ä¸­æå¶ï¼Œè¯¥ä¸Šæå¶ä»…é€šè¿‡è¾¹æ¡†å±æ€§å³å¯å®ç°ã€‚è¾¹æ¡†çš„å±æ€§ä¾æ¬¡æ˜¯ï¼šå®½åº¦ä¸º 200pxã€æ˜¯ç›´çº¿ã€é¢œè‰²ä¸º greenï¼ˆæœªæ˜¾ç¤ºçš„è¾¹æ¡†é¢œè‰²éƒ½ä¸ºé€æ˜ï¼‰ â€œbaseâ€æ˜¯åœ£è¯æ ‘çš„æ ‘å¹²ï¼Œè¯¥æ ‘å¹²ä»…é€šè¿‡å·¦å¤–è¾¹è·å®ç°å±…ä¸­äºä¸­æå¶ã€‚æ ‘å¹²çš„å®½åº¦ã€é«˜åº¦åˆ†åˆ«ä¸º 70pxã€200pxï¼Œé¢œè‰²ä¸º grayã€‚ æ³¨æ„ï¼š ä¸Šæå¶ã€æ ‘å¹²çš„å±…ä¸­éƒ½æ˜¯é€šè¿‡å·¦å¤–è¾¹è·å®ç°çš„ æ²¡æœ‰æ˜¾ç¤ºçš„è¾¹æ¡†ï¼Œå…¶å±æ€§éƒ½æ˜¯é€æ˜ï¼ˆå±æ€§ï¼‰ ä»…é€šè¿‡ border å±æ€§å®Œæˆè¾¹æ¡†çš„æ‰€æœ‰å±æ€§è®¾ç½® æˆ‘çš„è§£ç­”12345678910111213141516171819202122232425262728293031323334&lt;style&gt; .topbranch &#123; width: 0px; height: 0px; border-width: 100px; border-color: green; border-left-color: transparent; border-right-color: transparent; border-top-color: transparent; border-style: solid; float: left; margin-left: 100px; &#125; .middleBranch &#123; width: 0px; height: 0px; border-width: 200px; border-color: green; border-left-color: transparent; border-right-color: transparent; border-top-color: transparent; border-style: solid; &#125; .base &#123; width: 70px; height: 200px; background-color: grey; margin-left: 165px; &#125;&lt;/style&gt;&lt;section class=&quot;topbranch&quot;&gt;&lt;/section&gt;&lt;section class=&quot;middleBranch&quot;&gt;&lt;/section&gt;&lt;section class=&quot;base&quot;&gt;&lt;/section&gt; æ³¨æ„ç‚¹ 1234border-color: green;border-left-color: transparent;border-right-color: transparent;border-top-color: transparent; è¿™æ ·åšä¼šæ˜¾ç¤ºå‡ºä¸‰è§’å½¢ï¼ŒæŠŠå…¶ä»–è¾¹é¢œè‰²è®¾ç½®ä¸º transparent é€æ˜ FED17 å›ºå®šå®šä½æè¿°è¯·å°† html æ¨¡å—ç±»ä¸ºâ€boxâ€çš„ div å…ƒç´ å›ºå®šåœ¨è§†å£çš„å·¦ä¸Šè§’ã€‚ æˆ‘çš„è§£ç­”12345678&lt;style&gt; .box &#123; position: fixed; top: 0; left: 0; &#125;&lt;/style&gt;&lt;div class=&quot;box&quot;&gt;&lt;/div&gt; æ³¨æ„ç‚¹ position: fixed;å¯ä»¥è®©å…ƒç´ åœ¨æµè§ˆå™¨æŸä¸€ä¸ªä½ç½®å›ºå®šï¼Œä¸éšæ»šåŠ¨æ¡è€Œç§»åŠ¨ FED18 CSS å•ä½ï¼ˆä¸€ï¼‰æè¿°è¯·å°† html æ¨¡å—ä¸­ç±»ä¸ºâ€boxâ€çš„ div å…ƒç´ çš„å®½åº¦å’Œé«˜åº¦è®¾ç½®ä¸ºè‡ªèº«å­—ä½“å¤§å°çš„ 4 å€ã€‚ æˆ‘çš„è§£ç­”1234567&lt;div class=&quot;box&quot;&gt;&lt;/div&gt;&lt;style&gt; .box &#123; width: 4em; height: 4em; &#125;&lt;/style&gt; æ³¨æ„ç‚¹ em æŒ‡çš„ç›¸å¯¹çˆ¶çº§çš„å­—ä½“å¤§å° FED19 CSS å•ä½ï¼ˆäºŒï¼‰æè¿°è¯·å°† html æ¨¡å— div å…ƒç´ çš„å®½åº¦å’Œé«˜åº¦è®¾ç½®ä¸º html æ ¹å…ƒç´ å­—ä½“å¤§å°çš„ 4 å€ã€‚æ³¨æ„ï¼šåªéœ€åœ¨ css æ¨¡å—è¡¥å…¨æ ·å¼å†…å®¹ï¼Œè¯·å‹¿ä¿®æ”¹ html æ¨¡å—ã€‚ æˆ‘çš„è§£ç­”1234567&lt;div class=&quot;box&quot;&gt;&lt;/div&gt;&lt;style&gt; .box &#123; width: 4rem; height: 4rem; &#125;&lt;/style&gt; æ³¨æ„ç‚¹ rem æŒ‡çš„ç›¸å¯¹æ ¹çº§çš„å­—ä½“å¤§å°(:root&#x2F;html) 03 JAVASCRIPTFED20 åŸºæœ¬æ•°æ®ç±»å‹æ£€æµ‹æè¿°è¯·è¡¥å…¨ JavaScript å‡½æ•°ï¼Œè¦æ±‚ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›å‚æ•°çš„ç±»å‹ã€‚æ³¨æ„ï¼šåªéœ€æ£€æµ‹åŸºæœ¬æ•°æ®ç±»å‹ã€‚ æˆ‘çš„è§£ç­”12345&lt;script&gt; function _typeof(value) &#123; return typeof value; &#125;&lt;/script&gt; æ³¨æ„ç‚¹ typeof å¯ä»¥è¿”å›æ•°æ®ç±»å‹ FED21 æ£€æµ‹å¤æ‚æ•°æ®ç±»å‹æè¿°è¯·è¡¥å…¨ JavaScript å‡½æ•°ï¼Œè¦æ±‚ä»¥ Boolean çš„å½¢å¼è¿”å›ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦å±äºç¬¬äºŒä¸ªå‚æ•°å¯¹è±¡çš„å®ä¾‹ã€‚ æˆ‘çš„è§£ç­”12345&lt;script&gt; function _instanceof(left, right) &#123; return left instanceof right; &#125;&lt;/script&gt; æ³¨æ„ç‚¹ instanceof å¯ä»¥æ£€éªŒå‚æ•°æ˜¯å¦ä¸ºæŸä¸ªå¯¹è±¡çš„å®ä¾‹ FED22 æ•°æ®ç±»å‹è½¬æ¢æè¿°è¯·è¡¥å…¨ JavaScript å‡½æ•°ï¼Œè¦æ±‚ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ä¸¤ä¸ªæ•°å­—å‚æ•°çš„æ‹¼æ¥ç»“æœã€‚ç¤ºä¾‹ï¼š _splice(223,233) -&gt; â€œ223233â€ _splice(-223,-233) -&gt; â€œ-223-233â€ æˆ‘çš„è§£ç­”123456&lt;script type=&quot;text/javascript&quot;&gt; // å¡«å†™JavaScript function _splice(left, right) &#123; return left.toString() + right.toString(); &#125;&lt;/script&gt; æ³¨æ„ç‚¹ ä½¿ç”¨toStringæŠŠæ•°å­—ç±»å‹è½¬ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå†ç›¸åŠ  FED23 é˜¶ä¹˜æè¿°è¯·è¡¥å…¨ JavaScript å‡½æ•°ï¼Œè¦æ±‚è¿”å›æ•°å­—å‚æ•°çš„é˜¶ä¹˜ã€‚æ³¨æ„ï¼šå‚æ•°ä¸ºå¤§äºç­‰äº 0 çš„æ•´æ•°ã€‚ æˆ‘çš„è§£ç­”1234567&lt;script type=&quot;text/javascript&quot;&gt; function _factorial(number) &#123; if (number &lt; 0) return; if (number == 1 || number == 0) return 1; return number * _factorial(number - 1); &#125;&lt;/script&gt; æ³¨æ„ç‚¹ ä½¿ç”¨é€’å½’å®Œæˆé˜¶ä¹˜æ›´åŠ ç®€æ´"}]